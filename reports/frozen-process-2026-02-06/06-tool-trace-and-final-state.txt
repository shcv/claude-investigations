${$}`,JgB,FgB,KgB=(H,$,A)=>{let L=A===""?"":`with ${A.trim()}() `,I=XgB.bind(null,L,$.toString());Object.defineProperty(I,"name",FgB),Object.defineProperty(H,"toString",{...JgB,value:I})};var xAL=K(()=>{JgB=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),FgB=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name")});var voH,SAL=(H,$={})=>{if(typeof H!=="function")throw TypeError("Expected a function");let A,L=0,I=H.displayName||H.name||"<anonymous>",D=function(...B){if(voH.set(D,++L),L===1)A=H.apply(this,B),H=null;else if($.throw===!0)throw Error(`Function \`${I}\` can only be called once`);return A};return Bb$(D,H),voH.set(D,L),D},jAL;var RAL=K(()=>{xAL();voH=new WeakMap;SAL.callCount=(H)=>{if(!voH.has(H))throw Error(`The given function \`${H.name}\` is not wrapped by the \`onetime\` package`);return voH.get(H)};jAL=SAL});var yAL=()=>{let H=fb$-vAL+1;return Array.from({length:H},QgB)},QgB=(H,$)=>({name:`SIGRT${$+1}`,number:vAL+$,action:"terminate",description:"Application-specific signal (realtime)",standard:"posix"}),vAL=34,fb$=64;var hAL;var bAL=K(()=>{hAL=[{name:"SIGHUP",number:1,action:"terminate",description:"Terminal closed",standard:"posix"},{name:"SIGINT",number:2,action:"terminate",description:"User interruption with CTRL-C",standard:"ansi"},{name:"SIGQUIT",number:3,action:"core",description:"User interruption with CTRL-\\",standard:"posix"},{name:"SIGILL",number:4,action:"core",description:"Invalid machine instruction",standard:"ansi"},{name:"SIGTRAP",number:5,action:"core",description:"Debugger breakpoint",standard:"posix"},{name:"SIGABRT",number:6,action:"core",description:"Aborted",standard:"ansi"},{name:"SIGIOT",number:6,action:"core",description:"Aborted",standard:"bsd"},{name:"SIGBUS",number:7,action:"core",description:"Bus error due to misaligned, non-existing address or paging error",standard:"bsd"},{name:"SIGEMT",number:7,action:"terminate",description:"Command should be emulated but is not implemented",standard:"other"},{name:"SIGFPE",number:8,action:"core",description:"Floating point arithmetic error",standard:"ansi"},{name:"SIGKILL",number:9,action:"terminate",description:"Forced termination",standard:"posix",forced:!0},{name:"SIGUSR1",number:10,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGSEGV",number:11,action:"core",description:"Segmentation fault",standard:"ansi"},{name:"SIGUSR2",number:12,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGPIPE",number:13,action:"terminate",description:"Broken pipe or socket",standard:"posix"},{name:"SIGALRM",number:14,action:"terminate",description:"Timeout or timer",standard:"posix"},{name:"SIGTERM",number:15,action:"terminate",description:"Termination",standard:"ansi"},{name:"SIGSTKFLT",number:16,action:"terminate",description:"Stack is empty or overflowed",standard:"other"},{name:"SIGCHLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"posix"},{name:"SIGCLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"other"},{name:"SIGCONT",number:18,action:"unpause",description:"Unpaused",standard:"posix",forced:!0},{name:"SIGSTOP",number:19,action:"pause",description:"Paused",standard:"posix",forced:!0},{name:"SIGTSTP",number:20,action:"pause",description:'Paused using CTRL-Z or "suspend"',standard:"posix"},{name:"SIGTTIN",number:21,action:"pause",description:"Background process cannot read terminal input",standard:"posix"},{name:"SIGBREAK",number:21,action:"terminate",description:"User interruption with CTRL-BREAK",standard:"other"},{name:"SIGTTOU",number:22,action:"pause",description:"Background process cannot write to terminal output",standard:"posix"},{name:"SIGURG",number:23,action:"ignore",description:"Socket received out-of-band data",standard:"bsd"},{name:"SIGXCPU",number:24,action:"core",description:"Process timed out",standard:"bsd"},{name:"SIGXFSZ",number:25,action:"core",description:"File too big",standard:"bsd"},{name:"SIGVTALRM",number:26,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGPROF",number:27,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGWINCH",number:28,action:"ignore",description:"Terminal window size changed",standard:"bsd"},{name:"SIGIO",number:29,action:"terminate",description:"I/O is available",standard:"other"},{name:"SIGPOLL",number:29,action:"terminate",description:"Watched event",standard:"other"},{name:"SIGINFO",number:29,action:"ignore",description:"Request for process information",standard:"other"},{name:"SIGPWR",number:30,action:"terminate",description:"Device running out of power",standard:"systemv"},{name:"SIGSYS",number:31,action:"core",description:"Invalid system call",standard:"other"},{name:"SIGUNUSED",number:31,action:"terminate",description:"Invalid system call",standard:"other"}]});var kAL,Eb$=()=>{let H=yAL();return[...hAL,...H].map(WgB)},WgB=({name:H,number:$,description:A,action:L,forced:I=!1,standard:D})=>{let{signals:{[H]:B}}=kAL.constants,f=B!==void 0;return{name:H,number:f?B:$,description:A,supported:f,action:L,forced:I,standard:D}};var uAL=K(()=>{bAL();kAL=require("os")});var gAL,VgB=()=>{let H=Eb$();return Object.fromEntries(H.map(PgB))},PgB=({name:H,number:$,description:A,supported:L,action:I,forced:D,standard:B})=>[H,{name:H,number:$,description:A,supported:L,action:I,forced:D,standard:B}],mAL,_gB=()=>{let H=Eb$(),$=fb$+1,A=Array.from({length:$},(L,I)=>CgB(I,H));return Object.assign({},...A)},CgB=(H,$)=>{let A=YgB(H,$);if(A===void 0)return{};let{name:L,description:I,supported:D,action:B,forced:f,standard:E}=A;return{[H]:{name:L,number:H,description:I,supported:D,action:B,forced:f,standard:E}}},YgB=(H,$)=>{let A=$.find(({name:L})=>gAL.constants.signals[L]===H);if(A!==void 0)return A;return $.find((L)=>L.number===H)},L$8;var pAL=K(()=>{uAL();gAL=require("os"),mAL=VgB(),L$8=_gB()});var dAL,wgB=({timedOut:H,timeout:$,errorCode:A,signal:L,signalDescription:I,exitCode:D,isCanceled:B})=>{if(H)return`timed out after ${$} milliseconds`;if(B)return"was canceled";if(A!==void 0)return`failed with ${A}`;if(L!==void 0)return`was killed with ${L} (${I})`;if(D!==void 0)return`failed with exit code ${D}`;return"failed"},xYH=({stdout:H,stderr:$,all:A,error:L,signal:I,exitCode:D,command:B,escapedCommand:f,timedOut:E,isCanceled:M,killed:G,parsed:{options:{timeout:U,cwd:X=dAL.default.cwd()}}})=>{D=D===null?void 0:D,I=I===null?void 0:I;let J=I===void 0?void 0:mAL[I].description,F=L&&L.code,W=`Command ${wgB({timedOut:E,timeout:U,errorCode:F,signal:I,signalDescription:J,exitCode:D,isCanceled:M})}: ${B}`,P=Object.prototype.toString.call(L)==="[object Error]",Y=P?`${W}
${$}`;return Object.assign(Error(A),H,{stack:I})}class E1D extends vm9.EventEmitter{constructor(){super()}cancel(){var H;(H=this.call)===null||H===void 0||H.cancelWithStatus(cvH.Status.CANCELLED,"Cancelled on client")}getPeer(){var H,$;return($=(H=this.call)===null||H===void 0?void 0:H.getPeer())!==null&&$!==void 0?$:"unknown"}getAuthContext(){var H,$;return($=(H=this.call)===null||H===void 0?void 0:H.getAuthContext())!==null&&$!==void 0?$:null}}$S.ClientUnaryCallImpl=E1D;class M1D extends V_A.Readable{constructor(H){super({objectMode:!0});this.deserialize=H}cancel(){var H;(H=this.call)===null||H===void 0||H.cancelWithStatus(cvH.Status.CANCELLED,"Cancelled on client")}getPeer(){var H,$;return($=(H=this.call)===null||H===void 0?void 0:H.getPeer())!==null&&$!==void 0?$:"unknown"}getAuthContext(){var H,$;return($=(H=this.call)===null||H===void 0?void 0:H.getAuthContext())!==null&&$!==void 0?$:null}_read(H){var $;($=this.call)===null||$===void 0||$.startRead()}}$S.ClientReadableStreamImpl=M1D;class G1D extends V_A.Writable{constructor(H){super({objectMode:!0});this.serialize=H}cancel(){var H;(H=this.call)===null||H===void 0||H.cancelWithStatus(cvH.Status.CANCELLED,"Cancelled on client")}getPeer(){var H,$;return($=(H=this.call)===null||H===void 0?void 0:H.getPeer())!==null&&$!==void 0?$:"unknown"}getAuthContext(){var H,$;return($=(H=this.call)===null||H===void 0?void 0:H.getAuthContext())!==null&&$!==void 0?$:null}_write(H,$,A){var L;let I={callback:A},D=Number($);if(!Number.isNaN(D))I.flags=D;(L=this.call)===null||L===void 0||L.sendMessageWithContext(I,H)}_final(H){var $;($=this.call)===null||$===void 0||$.halfClose(),H()}}$S.ClientWritableStreamImpl=G1D;class U1D extends V_A.Duplex{constructor(H,$){super({objectMode:!0});this.serialize=H,this.deserialize=$}cancel(){var H;(H=this.call)===null||H===void 0||H.cancelWithStatus(cvH.Status.CANCELLED,"Cancelled on client")}getPeer(){var H,$;return($=(H=this.call)===null||H===void 0?void 0:H.getPeer())!==null&&$!==void 0?$:"unknown"}getAuthContext(){var H,$;return($=(H=this.call)===null||H===void 0?void 0:H.getAuthContext())!==null&&$!==void 0?$:null}_read(H){var $;($=this.call)===null||$===void 0||$.startRead()}_write(H,$,A){var L;let I={callback:A},D=Number($);if(!Number.isNaN(D))I.flags=D;(L=this.call)===null||L===void 0||L.sendMessageWithContext(I,H)}_final(H){var $;($=this.call)===null||$===void 0||$.halfClose(),H()}}$S.ClientDuplexStreamImpl=U1D});var B0H=z((D0H)=>{Object.defineProperty(D0H,"__esModule",{value:!0});D0H.InterceptingListenerImpl=void 0;D0H.statusOrFromValue=km9;D0H.statusOrFromError=um9;D0H.isInterceptingListener=gm9;var bm9=dQ();function km9(H){return{ok:!0,value:H}}function um9(H){var $;return{ok:!1,error:Object.assign(Object.assign({},H),{metadata:($=H.metadata)!==null&&$!==void 0?$:new bm9.Metadata})}}function gm9(H){return H.onReceiveMetadata!==void 0&&H.onReceiveMetadata.length===1}class J1D{constructor(H,$){this.listener=H,this.nextListener=$,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){if(this.hasPendingMessage)this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1}processPendingStatus(){if(this.pendingStatus)this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(H){this.processingMetadata=!0,this.listener.onReceiveMetadata(H,($)=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata($),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(H){this.processingMessage=!0,this.listener.onReceiveMessage(H,($)=>{if(this.processingMessage=!1,this.processingMetadata)this.pendingMessage=$,this.hasPendingMessage=!0;else this.nextListener.onReceiveMessage($),this.processPendingStatus()})}onReceiveStatus(H){this.listener.onReceiveStatus(H,($)=>{if(this.processingMetadata||this.processingMessage)this.pendingStatus=$;else this.nextListener.onReceiveStatus($)})}}D0H.InterceptingListenerImpl=J1D});var C_A=z((AS)=>{Object.defineProperty(AS,"__esModule",{value:!0});AS.InterceptingCall=AS.RequesterBuilder=AS.ListenerBuilder=AS.InterceptorConfigurationError=void 0;AS.getInterceptingCall=cm9;var mm9=dQ(),F1D=B0H(),K1D=I8(),Q1D=T6$();class ivH extends Error{constructor(H){super(H);this.name="InterceptorConfigurationError",Error.captureStackTrace(this,ivH)}}AS.InterceptorConfigurationError=ivH;class W1D{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(H){return this.metadata=H,this}withOnReceiveMessage(H){return this.message=H,this}withOnReceiveStatus(H){return this.status=H,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}AS.ListenerBuilder=W1D;class V1D{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(H){return this.start=H,this}withSendMessage(H){return this.message=H,this}withHalfClose(H){return this.halfClose=H,this}withCancel(H){return this.cancel=H,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}AS.RequesterBuilder=V1D;var P_A={onReceiveMetadata:(H,$)=>{$(H)},onReceiveMessage:(H,$)=>{$(H)},onReceiveStatus:(H,$)=>{$(H)}},lvH={start:(H,$,A)=>{A(H,$)},sendMessage:(H,$)=>{$(H)},halfClose:(H)=>{H()},cancel:(H)=>{H()}};class P1D{constructor(H,$){var A,L,I,D;if(this.nextCall=H,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,$)this.requester={start:(A=$.start)!==null&&A!==void 0?A:lvH.start,sendMessage:(L=$.sendMessage)!==null&&L!==void 0?L:lvH.sendMessage,halfClose:(I=$.halfClose)!==null&&I!==void 0?I:lvH.halfClose,cancel:(D=$.cancel)!==null&&D!==void 0?D:lvH.cancel};else this.requester=lvH}cancelWithStatus(H,$){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(H,$)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){if(this.pendingMessageContext)this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null}processPendingHalfClose(){if(this.pendingHalfClose)this.nextCall.halfClose()}start(H,$){var A,L,I,D,B,f;let E={onReceiveMetadata:(L=(A=$===null||$===void 0?void 0:$.onReceiveMetadata)===null||A===void 0?void 0:A.bind($))!==null&&L!==void 0?L:(M)=>{},onReceiveMessage:(D=(I=$===null||$===void 0?void 0:$.onReceiveMessage)===null||I===void 0?void 0:I.bind($))!==null&&D!==void 0?D:(M)=>{},onReceiveStatus:(f=(B=$===null||$===void 0?void 0:$.onReceiveStatus)===null||B===void 0?void 0:B.bind($))!==null&&f!==void 0?f:(M)=>{}};this.processingMetadata=!0,this.requester.start(H,E,(M,G)=>{var U,X,J;this.processingMetadata=!1;let F;if((0,F1D.isInterceptingListener)(G))F=G;else{let Q={onReceiveMetadata:(U=G.onReceiveMetadata)!==null&&U!==void 0?U:P_A.onReceiveMetadata,onReceiveMessage:(X=G.onReceiveMessage)!==null&&X!==void 0?X:P_A.onReceiveMessage,onReceiveStatus:(J=G.onReceiveStatus)!==null&&J!==void 0?J:P_A.onReceiveStatus};F=new F1D.InterceptingListenerImpl(Q,E)}this.nextCall.start(M,F),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(H,$){this.processingMessage=!0,this.requester.sendMessage($,(A)=>{if(this.processingMessage=!1,this.processingMetadata)this.pendingMessageContext=H,this.pendingMessage=$;else this.nextCall.sendMessageWithContext(H,A),this.processPendingHalfClose()})}sendMessage(H){this.sendMessageWithContext({},H)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{if(this.processingMetadata||this.processingMessage)this.pendingHalfClose=!0;else this.nextCall.halfClose()})}getAuthContext(){return this.nextCall.getAuthContext()}}AS.InterceptingCall=P1D;function pm9(H,$,A){var L,I;let D=(L=A.deadline)!==null&&L!==void 0?L:1/0,B=A.host,f=(I=A.parent)!==null&&I!==void 0?I:null,E=A.propagate_flags,M=A.credentials,G=H.createCall($,D,B,f,E);if(M)G.setCredentials(M);return G}class __A{constructor(H,$){this.call=H,this.methodDefinition=$}cancelWithStatus(H,$){this.call.cancelWithStatus(H,$)}getPeer(){return this.call.getPeer()}sendMessageWithContext(H,$){let A;try{A=this.methodDefinition.requestSerialize($)}catch(L){this.call.cancelWithStatus(K1D.Status.INTERNAL,`Request message serialization failure: ${(0,Q1D.getErrorMessage)(L)}`);return}this.call.sendMessageWithContext(H,A)}sendMessage(H){this.sendMessageWithContext({},H)}start(H,$){let A=null;this.call.start(H,{onReceiveMetadata:(L)=>{var I;(I=$===null||$===void 0?void 0:$.onReceiveMetadata)===null||I===void 0||I.call($,L)},onReceiveMessage:(L)=>{var I;let D;try{D=this.methodDefinition.responseDeserialize(L)}catch(B){A={code:K1D.Status.INTERNAL,details:`Response message parsing error: ${(0,Q1D.getErrorMessage)(B)}`,metadata:new mm9.Metadata},this.call.cancelWithStatus(A.code,A.details);return}(I=$===null||$===void 0?void 0:$.onReceiveMessage)===null||I===void 0||I.call($,D)},onReceiveStatus:(L)=>{var I,D;if(A)(I=$===null||$===void 0?void 0:$.onReceiveStatus)===null||I===void 0||I.call($,A);else(D=$===null||$===void 0?void 0:$.onReceiveStatus)===null||D===void 0||D.call($,L)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}getAuthContext(){return this.call.getAuthContext()}}class _1D extends __A{constructor(H,$){super(H,$)}start(H,$){var A,L;let I=!1,D={onReceiveMetadata:(L=(A=$===null||$===void 0?void 0:$.onReceiveMetadata)===null||A===void 0?void 0:A.bind($))!==null&&L!==void 0?L:(B)=>{},onReceiveMessage:(B)=>{var f;I=!0,(f=$===null||$===void 0?void 0:$.onReceiveMessage)===null||f===void 0||f.call($,B)},onReceiveStatus:(B)=>{var f,E;if(!I)(f=$===null||$===void 0?void 0:$.onReceiveMessage)===null||f===void 0||f.call($,null);(E=$===null||$===void 0?void 0:$.onReceiveStatus)===null||E===void 0||E.call($,B)}};super.start(H,D),this.call.startRead()}}class C1D extends __A{}function dm9(H,$,A){let L=pm9(H,A.path,$);if(A.responseStream)return new C1D(L,A);else return new _1D(L,A)}function cm9(H,$,A,L){if(H.clientInterceptors.length>0&&H.clientInterceptorProviders.length>0)throw new ivH("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(H.callInterceptors.length>0&&H.callInterceptorProviders.length>0)throw new ivH("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let I=[];if(H.callInterceptors.length>0||H.callInterceptorProviders.length>0)I=[].concat(H.callInterceptors,H.callInterceptorProviders.map((f)=>f($))).filter((f)=>f);else I=[].concat(H.clientInterceptors,H.clientInterceptorProviders.map((f)=>f($))).filter((f)=>f);let D=Object.assign({},A,{method_definition:$});return I.reduceRight((f,E)=>{return(M)=>E(M,f)},(f)=>dm9(L,f,$))(D)}});var w_A=z((a6$)=>{Object.defineProperty(a6$,"__esModule",{value:!0});a6$.Client=void 0;var Ih=X1D(),lm9=Z_A(),im9=YP(),Wo=I8(),KWH=dQ(),r6$=C_A(),LS=Symbol(),QWH=Symbol(),WWH=Symbol(),dm=Symbol();function Y_A(H){return typeof H==="function"}function VWH(H){var $;return(($=H.stack)===null||$===void 0?void 0:$.split(`
`))$=$.slice(0,-1)}return super.equals(H,$,A)}};pPI=new mPI});function Z99(H){return H=="."||H=="!"||H=="?"}var dPI,q99;var cPI=K(()=>{dPI=class dPI extends wQ{tokenize(H){var $;let A=[],L=0;for(let I=0;I<H.length;I++){if(I==H.length-1){A.push(H.slice(L));break}if(Z99(H[I])&&H[I+1].match(/\s/)){A.push(H.slice(L,I+1)),I=L=I+1;while(($=H[I+1])===null||$===void 0?void 0:$.match(/\s/))I++;A.push(H.slice(L,I+1)),L=I+1}}return A}};q99=new dPI});var lPI,T99;var iPI=K(()=>{lPI=class lPI extends wQ{tokenize(H){return H.split(/([{}:;,]|\s+)/)}};T99=new lPI});function W4$(H,$,A,L,I){if($=$||[],A=A||[],L)H=L(I===void 0?"":I,H);let D;for(D=0;D<$.length;D+=1)if($[D]===H)return A[D];let B;if(Object.prototype.toString.call(H)==="[object Array]"){$.push(H),B=Array(H.length),A.push(B);for(D=0;D<H.length;D+=1)B[D]=W4$(H[D],$,A,L,String(D));return $.pop(),A.pop(),B}if(H&&H.toJSON)H=H.toJSON();if(typeof H==="object"&&H!==null){$.push(H),B={},A.push(B);let f=[],E;for(E in H)if(Object.prototype.hasOwnProperty.call(H,E))f.push(E);f.sort();for(D=0;D<f.length;D+=1)E=f[D],B[E]=W4$(H[E],$,A,L,E);$.pop(),A.pop()}else B=H;return B}var nPI,z99;var rPI=K(()=>{Q4$();nPI=class nPI extends wQ{constructor(){super(...arguments);this.tokenize=N5A}get useLongestToken(){return!0}castInput(H,$){let{undefinedReplacement:A,stringifyReplacer:L=(I,D)=>typeof D>"u"?A:D}=$;return typeof H==="string"?H:JSON.stringify(W4$(H,null,null,L),null,"  ")}equals(H,$,A){return super.equals(H.replace(/,([\r\n])/g,"$1"),$.replace(/,([\r\n])/g,"$1"),A)}};z99=new nPI});var aPI,N99;var oPI=K(()=>{aPI=class aPI extends wQ{tokenize(H){return H.slice()}join(H){return H}removeEmpty(H){return H}};N99=new aPI});var tPI=()=>{};function vr(H,$,A,L,I,D,B){let f;if(!B)f={};else if(typeof B==="function")f={callback:B};else f=B;if(typeof f.context>"u")f.context=4;let E=f.context;if(f.newlineIsToken)throw Error("newlineIsToken may not be used with patch-generation functions, only with diffing functions");if(!f.callback)return M(LFH(A,L,f));else{let{callback:G}=f;LFH(A,L,Object.assign(Object.assign({},f),{callback:(U)=>{let X=M(U);G(X)}}))}function M(G){if(!G)return;G.push({value:"",lines:[]});function U(Y){return Y.map(function(C){return" "+C})}let X=[],J=0,F=0,Q=[],W=1,P=1;for(let Y=0;Y<G.length;Y++){let C=G[Y],Z=C.lines||x99(C.value);if(C.lines=Z,C.added||C.removed){if(!J){let q=G[Y-1];if(J=W,F=P,q)Q=E>0?U(q.lines.slice(-E)):[],J-=Q.length,F-=Q.length}for(let q of Z)Q.push((C.added?"+":"-")+q);if(C.added)P+=Z.length;else W+=Z.length}else{if(J)if(Z.length<=E*2&&Y<G.length-2)for(let q of U(Z))Q.push(q);else{let q=Math.min(Z.length,E);for(let j of U(Z.slice(0,q)))Q.push(j);let O={oldStart:J,oldLines:W-J+q,newStart:F,newLines:P-F+q,lines:Q};X.push(O),J=0,F=0,Q=[]}W+=Z.length,P+=Z.length}}for(let Y of X)for(let C=0;C<Y.lines.length;C++)if(Y.lines[C].endsWith(`
${$}`,tool_use_id:M}}}});var bsE;var aCD=K(()=>{gI();bsE=S.strictObject({})});function g01({answers:H}){return g5.createElement(x,{flexDirection:"column",marginTop:1},g5.createElement(x,{flexDirection:"row"},g5.createElement(V,{color:_6("default")},xf,"\xA0"),g5.createElement(V,null,"User answered Claude's questions:")),g5.createElement(HA,null,g5.createElement(x,{flexDirection:"column"},Object.entries(H).map(([$,A])=>g5.createElement(V,{key:$,color:"inactive"},"\xB7 ",$," \u2192 ",A)))))}var g5,u01,oCD,gzA,isE,jY$;var RY$=K(()=>{gI();xH();cB();xC();xW();g5=h(t(),1),u01=S.object({label:S.string().describe("The display text for this option that the user will see and select. Should be concise (1-5 words) and clearly describe the choice."),description:S.string().describe("Explanation of what this option means or what will happen if chosen. Useful for providing context about trade-offs or implications.")}),oCD=S.object({question:S.string().describe('The complete question to ask the user. Should be clear, specific, and end with a question mark. Example: "Which library should we use for date formatting?" If multiSelect is true, phrase it accordingly, e.g. "Which features do you want to enable?"'),header:S.string().describe(`Very short label displayed as a chip/tag (max ${dcL} chars). Examples: "Auth method", "Library", "Approach".`),options:S.array(u01).min(2).max(4).describe("The available choices for this question. Must have 2-4 options. Each option should be a distinct, mutually exclusive choice (unless multiSelect is enabled). There should be no 'Other' option, that will be provided automatically."),multiSelect:S.boolean().default(!1).describe("Set to true to allow the user to select multiple options instead of just one. Use when choices are not mutually exclusive.")}),gzA=S.strictObject({questions:S.array(oCD).min(1).max(4).describe("Questions to ask the user (1-4 questions)"),answers:S.record(S.string(),S.string()).optional().describe("User answers collected by the permission component"),metadata:S.object({source:S.string().optional().describe('Optional identifier for the source of this question (e.g., "remember" for /remember command). Used for analytics tracking.')}).optional().describe("Optional metadata for tracking and analytics purposes. Not displayed to user.")}).refine((H)=>{let $=H.questions.map((A)=>A.question);if($.length!==new Set($).size)return!1;for(let A of H.questions){let L=A.options.map((I)=>I.label);if(L.length!==new Set(L).size)return!1}return!0},{message:"Question texts must be unique, option labels must be unique within each question"}),isE=S.object({questions:S.array(oCD).describe("The questions that were asked"),answers:S.record(S.string(),S.string()).describe("The answers provided by the user (question text -> answer string; multi-select answers are comma-separated)")});jY$={name:rG,maxResultSizeChars:1e5,async description(){return ccL},async prompt(){return lcL},inputSchema:gzA,userFacingName(){return""},isEnabled(){return!0},isConcurrencySafe(){return!0},isReadOnly(){return!0},requiresUserInteraction(){return!0},async checkPermissions(H){return{behavior:"ask",message:"Answer questions?",updatedInput:H}},renderToolUseMessage(){return null},renderToolUseProgressMessage(){return null},renderToolResultMessage({answers:H},$){return g5.createElement(g01,{answers:H})},renderToolUseRejectedMessage(){return g5.createElement(x,{flexDirection:"row",marginTop:1},g5.createElement(V,{color:_6("default")},xf,"\xA0"),g5.createElement(V,null,"User declined to answer questions"))},renderToolUseErrorMessage(){return null},async call({questions:H,answers:$={}},A){return{data:{questions:H,answers:$}}},mapToolResultToToolResultBlockParam({answers:H},$){return{type:"tool_result",content:`User has answered your questions: ${Object.entries(H).map(([L,I])=>`"${L}"="${I}"`).join(", ")}. You can now continue with the user's answers in mind.`,tool_use_id:$}}}});var m01,p01,d01,c01,l01,i01,n01,r01,a01,tCD;var sCD=K(()=>{gI();m01=S.strictObject({operation:S.literal("goToDefinition"),filePath:S.string().describe("The absolute or relative path to the file"),line:S.number().int().positive().describe("The line number (1-based, as shown in editors)"),character:S.number().int().positive().describe("The character offset (1-based, as shown in editors)")}),p01=S.strictObject({operation:S.literal("findReferences"),filePath:S.string().describe("The absolute or relative path to the file"),line:S.number().int().positive().describe("The line number (1-based, as shown in editors)"),character:S.number().int().positive().describe("The character offset (1-based, as shown in editors)")}),d01=S.strictObject({operation:S.literal("hover"),filePath:S.string().describe("The absolute or relative path to the file"),line:S.number().int().positive().describe("The line number (1-based, as shown in editors)"),character:S.number().int().positive().describe("The character offset (1-based, as shown in editors)")}),c01=S.strictObject({operation:S.literal("documentSymbol"),filePath:S.string().describe("The absolute or relative path to the file"),line:S.number().int().positive().describe("The line number (1-based, as shown in editors)"),character:S.number().int().positive().describe("The character offset (1-based, as shown in editors)")}),l01=S.strictObject({operation:S.literal("workspaceSymbol"),filePath:S.string().describe("The absolute or relative path to the file"),line:S.number().int().positive().describe("The line number (1-based, as shown in editors)"),character:S.number().int().positive().describe("The character offset (1-based, as shown in editors)")}),i01=S.strictObject({operation:S.literal("goToImplementation"),filePath:S.string().describe("The absolute or relative path to the file"),line:S.number().int().positive().describe("The line number (1-based, as shown in editors)"),character:S.number().int().positive().describe("The character offset (1-based, as shown in editors)")}),n01=S.strictObject({operation:S.literal("prepareCallHierarchy"),filePath:S.string().describe("The absolute or relative path to the file"),line:S.number().int().positive().describe("The line number (1-based, as shown in editors)"),character:S.number().int().positive().describe("The character offset (1-based, as shown in editors)")}),r01=S.strictObject({operation:S.literal("incomingCalls"),filePath:S.string().describe("The absolute or relative path to the file"),line:S.number().int().positive().describe("The line number (1-based, as shown in editors)"),character:S.number().int().positive().describe("The character offset (1-based, as shown in editors)")}),a01=S.strictObject({operation:S.literal("outgoingCalls"),filePath:S.string().describe("The absolute or relative path to the file"),line:S.number().int().positive().describe("The line number (1-based, as shown in editors)"),character:S.number().int().positive().describe("The character offset (1-based, as shown in editors)")}),tCD=S.discriminatedUnion("operation",[m01,p01,d01,c01,l01,i01,n01,r01,a01])});function $uH(H,$){if(!H)return N("formatUri called with undefined URI - indicates malformed LSP server response",{level:"warn"}),"<unknown location>";let A=H.replace(/^file:\/\//,"");if(/^\/[A-Za-z]:/.test(A))A=A.slice(1);try{A=decodeURIComponent(A)}catch(L){let I=L instanceof Error?L.message:String(L);N(`Failed to decode LSP URI '${H}': ${I}. Using un-decoded path: ${A}`,{level:"warn"})}if($){let L=AYD.relative($,A).replaceAll("\\","/");if(L.length<A.length&&!L.startsWith("../../"))return L}return A.replaceAll("\\","/")}function LYD(H,$){let A=new Map;for(let L of H){let I="uri"in L?L.uri:L.location.uri,D=$uH(I,$),B=A.get(D);if(B)B.push(L);else A.set(D,[L])}return A}function yY$(H,$){let A=$uH(H.uri,$),L=H.range.start.line+1,I=H.range.start.character+1;return`${A}:${L}:${I}`}function eCD(H){return{uri:H.targetUri,range:H.targetSelectionRange||H.targetRange}}function HYD(H){return"targetUri"in H}function mzA(H,$){if(!H)return"No definition found. This may occur if the cursor is not on a symbol, or if the definition is in an external library not indexed by the LSP server.";if(Array.isArray(H)){let L=H.map((f)=>HYD(f)?eCD(f):f),I=L.filter((f)=>!f||!f.uri);if(I.length>0)N(`formatGoToDefinitionResult: Filtering out ${I.length} invalid location(s) - this should have been caught earlier`,{level:"warn"});let D=L.filter((f)=>f&&f.uri);if(D.length===0)return"No definition found. This may occur if the cursor is not on a symbol, or if the definition is in an external library not indexed by the LSP server.";if(D.length===1)return`Defined in ${yY$(D[0],$)}`;let B=D.map((f)=>`  ${yY$(f,$)}`).join(`
`,$)+1}return{type:H,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(H){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;let $=KB$(H),A=I4H($);return A.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:A,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;let $=KB$(H),A=I4H($);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:A,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(H,$){if(this.type!=="comment")return!1;if(this.indent<=$)return!1;return H.every((A)=>A.type==="newline"||A.type==="space")}*documentEnd(H){if(this.type!=="doc-mode"){if(H.end)H.end.push(this.sourceToken);else H.end=[this.sourceToken];if(this.type==="newline")yield*this.pop()}}*lineEnd(H){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:if(H.end)H.end.push(this.sourceToken);else H.end=[this.sourceToken];if(this.type==="newline")yield*this.pop()}}}kdL.Parser=bdL});var ddL=z((mqH)=>{var udL=rAA(),Aw0=RqH(),gqH=vqH(),Lw0=t$A(),Iw0=Bf(),Dw0=ILA(),gdL=DLA();function mdL(H){let $=H.prettyErrors!==!1;return{lineCounter:H.lineCounter||$&&new Dw0.LineCounter||null,prettyErrors:$}}function Bw0(H,$={}){let{lineCounter:A,prettyErrors:L}=mdL($),I=new gdL.Parser(A?.addNewLine),D=new udL.Composer($),B=Array.from(D.compose(I.parse(H)));if(L&&A)for(let f of B)f.errors.forEach(gqH.prettifyError(H,A)),f.warnings.forEach(gqH.prettifyError(H,A));if(B.length>0)return B;return Object.assign([],{empty:!0},D.streamInfo())}function pdL(H,$={}){let{lineCounter:A,prettyErrors:L}=mdL($),I=new gdL.Parser(A?.addNewLine),D=new udL.Composer($),B=null;for(let f of D.compose(I.parse(H),!0,H.length))if(!B)B=f;else if(B.options.logLevel!=="silent"){B.errors.push(new gqH.YAMLParseError(f.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}if(L&&A)B.errors.forEach(gqH.prettifyError(H,A)),B.warnings.forEach(gqH.prettifyError(H,A));return B}function fw0(H,$,A){let L=void 0;if(typeof $==="function")L=$;else if(A===void 0&&$&&typeof $==="object")A=$;let I=pdL(H,A);if(!I)return null;if(I.warnings.forEach((D)=>Lw0.warn(I.options.logLevel,D)),I.errors.length>0)if(I.options.logLevel!=="silent")throw I.errors[0];else I.errors=[];return I.toJS(Object.assign({reviver:L},A))}function Ew0(H,$,A){let L=null;if(typeof $==="function"||Array.isArray($))L=$;else if(A===void 0&&$)A=$;if(typeof A==="string")A=A.length;if(typeof A==="number"){let I=Math.round(A);A=I<1?void 0:I>8?{indent:8}:{indent:I}}if(H===void 0){let{keepUndefined:I}=A??$??{};if(!I)return}if(Iw0.isDocument(H)&&!L)return H.toString(A);return new Aw0.Document(H,L,A).toString(A)}mqH.parse=fw0;mqH.parseAllDocuments=Bw0;mqH.parseDocument=pdL;mqH.stringify=Ew0});var ldL=z((zE)=>{var Mw0=rAA(),Gw0=RqH(),Uw0=SAA(),BLA=vqH(),Xw0=QqH(),ji=Bf(),Jw0=zi(),Fw0=IF(),Kw0=Oi(),Qw0=xi(),Ww0=JB$(),Vw0=LLA(),Pw0=ILA(),_w0=DLA(),QB$=ddL(),cdL=JqH();zE.Composer=Mw0.Composer;zE.Document=Gw0.Document;zE.Schema=Uw0.Schema;zE.YAMLError=BLA.YAMLError;zE.YAMLParseError=BLA.YAMLParseError;zE.YAMLWarning=BLA.YAMLWarning;zE.Alias=Xw0.Alias;zE.isAlias=ji.isAlias;zE.isCollection=ji.isCollection;zE.isDocument=ji.isDocument;zE.isMap=ji.isMap;zE.isNode=ji.isNode;zE.isPair=ji.isPair;zE.isScalar=ji.isScalar;zE.isSeq=ji.isSeq;zE.Pair=Jw0.Pair;zE.Scalar=Fw0.Scalar;zE.YAMLMap=Kw0.YAMLMap;zE.YAMLSeq=Qw0.YAMLSeq;zE.CST=Ww0;zE.Lexer=Vw0.Lexer;zE.LineCounter=Pw0.LineCounter;zE.Parser=_w0.Parser;zE.parse=QB$.parse;zE.parseAllDocuments=QB$.parseAllDocuments;zE.parseDocument=QB$.parseDocument;zE.stringify=QB$.stringify;zE.visit=cdL.visit;zE.visitAsync=cdL.visitAsync});function fLA(H){if(typeof Bun<"u")return Bun.YAML.parse(H);return idL.parse(H)}var idL;var ndL=K(()=>{idL=h(ldL(),1)});function Yw0(H){let $=H.split(`
`),$9(1)}catch(H){r(H)}}function m7H(H){let A=XB()?.minimumVersion;if(!A)return!1;let L=!R_$.gte(H,A,{loose:!0});if(L)N(`Skipping update to ${H} - below minimumVersion ${A}`);return L}function D9H(){return FQD.join(UL(),".update.lock")}function dH1(){try{if(!zH().existsSync(UL()))zH().mkdirSync(UL());if(zH().existsSync(D9H())){let H=zH().statSync(D9H());if(Date.now()-H.mtimeMs<pH1)return!1;try{zH().unlinkSync(D9H())}catch(A){return r(A),!1}}return iL(D9H(),`${process.pid}`,{encoding:"utf8"}),!0}catch(H){return r(H),!1}}function cH1(){try{if(zH().existsSync(D9H())){if(zH().readFileSync(D9H(),{encoding:"utf8"})===`${process.pid}`)zH().unlinkSync(D9H())}}catch(H){r(H)}}async function lH1(){let H=OA.isRunningWithBun(),$=null;if(H)$=await mD("bun",["pm","bin","-g"],{cwd:g7H.homedir()});else $=await mD("npm",["-g","config","get","prefix"],{cwd:g7H.homedir()});if($.code!==0)return r(Error(`Failed to check ${H?"bun":"npm"} permissions`)),null;return $.stdout.trim()}async function DZA(){try{let H=await lH1();if(!H)return{hasPermissions:!1,npmPrefix:null};let $=!1;try{KQD.accessSync(H,JQD.constants.W_OK),$=!0}catch{$=!1}if($)return{hasPermissions:!0,npmPrefix:H};return r(new S_$("Insufficient permissions for global npm install.")),{hasPermissions:!1,npmPrefix:H}}catch(H){return r(H),{hasPermissions:!1,npmPrefix:null}}}async function B9H(H){let $=cD();setTimeout(()=>$.abort(),5000);let A=H==="stable"?"stable":"latest",L=await mD("npm",["view",`${{ISSUES_EXPLAINER:"report the issue at https://github.com/anthropics/claude-code/issues",PACKAGE_URL:"@anthropic-ai/claude-code",README_URL:"https://code.claude.com/docs/en/overview",VERSION:"2.1.33",FEEDBACK_CHANNEL:"https://github.com/anthropics/claude-code/issues",BUILD_TIME:"2026-02-06T00:15:09Z"}.PACKAGE_URL}@${A}`,"version","--prefer-online"],{abortSignal:$.signal,cwd:g7H.homedir()});if(L.code!==0){if(N(`npm view failed with code ${L.code}`),L.stderr)N(`npm stderr: ${L.stderr.trim()}`);else N("npm stderr: (empty)");if(L.stdout)N(`npm stdout: ${L.stdout.trim()}`);return null}return L.stdout.trim()}async function WQD(){let H=cD();setTimeout(()=>H.abort(),5000);let $=await mD("npm",["view",{ISSUES_EXPLAINER:"report the issue at https://github.com/anthropics/claude-code/issues",PACKAGE_URL:"@anthropic-ai/claude-code",README_URL:"https://code.claude.com/docs/en/overview",VERSION:"2.1.33",FEEDBACK_CHANNEL:"https://github.com/anthropics/claude-code/issues",BUILD_TIME:"2026-02-06T00:15:09Z"}.PACKAGE_URL,"dist-tags","--json","--prefer-online"],{abortSignal:H.signal,cwd:g7H.homedir()});if($.code!==0)return N(`npm view dist-tags failed with code ${$.code}`),{latest:null,stable:null};try{let A=DA($.stdout.trim());return{latest:typeof A.latest==="string"?A.latest:null,stable:typeof A.stable==="string"?A.stable:null}}catch(A){return N(`Failed to parse dist-tags: ${A}`),{latest:null,stable:null}}}async function j_$(H){try{return(await nA.get(`${mH1}/${H}`,{timeout:5000,responseType:"text"})).data.trim()}catch($){return N(`Failed to fetch ${H} from GCS: ${$}`),null}}async function VQD(){let[H,$]=await Promise.all([j_$("latest"),j_$("stable")]);return{latest:H,stable:$}}async function tbH(H){if(!dH1())return r(new S_$("Another process is currently installing an update")),c("tengu_auto_updater_lock_contention",{pid:process.pid,currentVersion:{ISSUES_EXPLAINER:"report the issue at https://github.com/anthropics/claude-code/issues",PACKAGE_URL:"@anthropic-ai/claude-code",README_URL:"https://code.claude.com/docs/en/overview",VERSION:"2.1.33",FEEDBACK_CHANNEL:"https://github.com/anthropics/claude-code/issues",BUILD_TIME:"2026-02-06T00:15:09Z"}.VERSION}),"in_progress";try{if(iH1(),!OA.isRunningWithBun()&&OA.isNpmFromWindowsPath())return r(Error("Windows NPM detected in WSL environment")),c("tengu_auto_updater_windows_npm_in_wsl",{currentVersion:{ISSUES_EXPLAINER:"report the issue at https://github.com/anthropics/claude-code/issues",PACKAGE_URL:"@anthropic-ai/claude-code",README_URL:"https://code.claude.com/docs/en/overview",VERSION:"2.1.33",FEEDBACK_CHANNEL:"https://github.com/anthropics/claude-code/issues",BUILD_TIME:"2026-02-06T00:15:09Z"}.VERSION}),console.error(`
`),$9(1),Error(D)}return Xx1(I)}return CF}async function Fx1(H,$,A,L,I,D,B,f,E,M,G){if(A){L.enqueue({type:"control_response",response:{subtype:"error",error:"Already initialized",request_id:$,pending_permission_requests:B.getPendingPermissionRequests()}});return}if(H.systemPrompt!==void 0)E.systemPrompt=H.systemPrompt;if(H.appendSystemPrompt!==void 0)E.appendSystemPrompt=H.appendSystemPrompt;if(H.agents){let W=NK$(H.agents,"flagSettings");M.push(...W)}if(E.agent){let W=M.find((P)=>P.agentType===E.agent);if(W){if(KN(W.agentType),!E.systemPrompt&&!_K(W)){let P=W.getSystemPrompt();if(P)E.systemPrompt=P}if(!E.userSpecifiedModel&&W.model&&W.model!=="inherit"){let P=t8(W.model);MV(P)}}}let X=VL()?.outputStyle||aQ,J=await M1H(Y$()),F=VD$();if(H.hooks){let W={};for(let[P,Y]of Object.entries(H.hooks))W[P]=Y.map((C)=>{let Z=C.hookCallbackIds.map((q)=>{return B.createHookCallback(q,C.timeout)});return{matcher:C.matcher,hooks:Z}});XHH(W)}if(H.jsonSchema)Ij$(H.jsonSchema);let Q={commands:I.map((W)=>({name:W.userFacingName(),description:JVH(W),argumentHint:W.argumentHint||""})),output_style:X,available_output_styles:Object.keys(J),models:D,account:{email:F?.email,organization:F?.organization,subscriptionType:F?.subscription,tokenSource:F?.tokenSource,apiKeySource:F?.apiKeySource}};if(L.enqueue({type:"control_response",response:{subtype:"success",request_id:$,response:Q}}),f){let P=P2.getInstance().getStatus();if(P)L.enqueue({type:"auth_status",isAuthenticating:P.isAuthenticating,output:P.output,error:P.error,uuid:zY.randomUUID(),session_id:j$()})}}async function wEB(H,$,A,L){if(!bE())return{canRewind:!1,error:"File rewinding is not enabled."};if(!OC$($.fileHistory,H))return{canRewind:!1,error:"No file checkpoint found for this message."};if(L){let I=xC$($.fileHistory,H);return{canRewind:!0,filesChanged:I?.filesChanged,insertions:I?.insertions,deletions:I?.deletions}}try{await NC$((I)=>A((D)=>({...D,fileHistory:I(D.fileHistory)})),H)}catch(I){return{canRewind:!1,error:`Failed to rewind: ${I.message}`}}return{canRewind:!0}}function Kx1(H,$,A,L){if(H.mode==="bypassPermissions"&&d3H())return L.enqueue({type:"control_response",response:{subtype:"error",request_id:$,error:"Cannot set permission mode to bypassPermissions because it is disabled by settings or configuration"}}),A;return L.enqueue({type:"control_response",response:{subtype:"success",request_id:$,response:{mode:H.mode}}}),FN(A.mode,H.mode),{...A,mode:H.mode}}function OO$(H,$){if($==="stream-json"){let A={type:"result",subtype:"error_during_execution",duration_ms:0,duration_api_ms:0,is_error:!0,num_turns:0,stop_reason:null,session_id:j$(),total_cost_usd:0,usage:TC,modelUsage:{},permission_denials:[],uuid:zY.randomUUID(),errors:[H]};process.stdout.write(vH(A)+`
`),$9(1,"other")});let wj=lA.useCallback((J$,FL)=>{$H((SL)=>({...SL,toolPermissionContext:{...J$,mode:FL?.preserveMode?SL.toolPermissionContext.mode:J$.mode}})),setImmediate(()=>{v0((SL)=>{return SL.forEach((I0)=>{I0.recheckPermission()}),SL})})},[$H,v0]);lA.useEffect(()=>{return cKD(wj),()=>iKD()},[wj]);let pM=NLB(v0,wj),kJ=lA.useCallback((J$,FL,SL,I0,SD,BD)=>{return{abortController:SL,options:{commands:sA,tools:HI,debug:$,verbose:y,mainLoopModel:BD,maxThinkingTokens:SD??(n===!0?_m(FL,void 0):n===!1?0:void 0),mcpClients:rH,mcpResources:g.resources,ideInstallationStatus:fA,isNonInteractiveSession:!1,dynamicMcpConfig:QH,theme:vD,agentDefinitions:$I?{...p,allowedAgentTypes:$I}:p,customSystemPrompt:X,appendSystemPrompt:J},getAppState(){return DH.setState((XI)=>({...XI,toolPermissionContext:{...XI.toolPermissionContext,alwaysAllowRules:{...XI.toolPermissionContext.alwaysAllowRules,command:I0}}})),Promise.resolve(DH.getState())},setAppState:$H,messages:J$,setMessages:eH,updateFileHistoryState(XI){$H((R1)=>({...R1,fileHistory:XI(R1.fileHistory)}))},updateAttributionState(XI){$H((R1)=>({...R1,attribution:XI(R1.attribution)}))},openMessageSelector:()=>{if(!W)OY(!0)},onChangeAPIKey:s5,onForegroundTask:VW,readFileState:K0.current,setToolJSX:uD,addNotification:iA,onChangeDynamicMcpConfig:hH,onInstallIDEExtension:n$,nestedMemoryAttachmentTriggers:new Set,dynamicSkillDirTriggers:new Set,setResponseLength:NY,setStreamMode:f9,onCompactProgress:(XI)=>{switch(XI.type){case"hooks_start":d9("claudeBlue_FOR_SYSTEM_SPINNER"),H_("claudeBlueShimmer_FOR_SYSTEM_SPINNER"),pK(XI.hookType==="pre_compact"?"Running PreCompact hooks\u2026":"Running SessionStart hooks\u2026");break;case"compact_start":pK("Compacting conversation");break;case"compact_end":pK(null),d9(null),H_(null);break}},setInProgressToolUseIDs:gK,resume:bA,setConversationId:dK}},[sA,HI,$,y,rH,g.resources,fA,QH,vD,p,$I,DH,$H,s5,iA,hH,VW,bA,n,W,X,J,dK]),_e=lA.useCallback(async(J$,FL,SL,I0,SD,BD,XI)=>{let R1=FL.filter((lX)=>lX.type==="user"||lX.type==="assistant").pop();if(I0){zp.handleQueryStart(rH);let lX=QC(rH);if(lX)gwI(lX)}if(hJH(),R1?.type==="user"&&typeof R1.message.content==="string")GPI(R1.message.content);if(!I0){F0(),IL(null);return}let yB=kJ(J$,FL,SL,SD,XI,BD);W9("query_context_loading_start");let[,,G9,W1,cX]=await Promise.all([nuA(u,$H),void 0,tC(HI,BD,Array.from(u.additionalWorkingDirectories.keys()),rH),y5(),R5()]),gJ={...W1,...zO1(rH),...{}};W9("query_context_loading_end");let wZ=k9H({mainThreadAgentDefinition:O,toolUseContext:yB,customSystemPrompt:X,defaultSystemPrompt:G9,appendSystemPrompt:J});W9("query_query_start");let nK,dM=new Promise((lX)=>{nK=lX});uG.current={promise:dM,resolve:nK};let B_=OP({messages:J$,systemPrompt:wZ,userContext:gJ,systemContext:cX,canUseTool:pM,toolUseContext:yB,querySource:F_$()})[Symbol.asyncIterator](),xY=!1,a3=!1;while(!a3){let lX=await Promise.race([B_.next().then((mJ)=>({type:"message",result:mJ})),dM.then(()=>({type:"background"}))]);if(lX.type==="background"){xY=!0,a3=!0;let mJ=BPI()||"Background session",{taskId:o3,abortSignal:SY}=QRI(mJ,$H,O,SL);PRI(B_,o3,$H,(az)=>void cS(az),aL,SY);let{clearConversation:N8H}=await Promise.resolve().then(() => (cZ$(),kjA));await N8H({setMessages:eH,readFileState:K0.current,getAppState:async()=>new Promise((az)=>{$H((Ce)=>{return az(Ce),Ce})}),setAppState:$H,setConversationId:dK})}else if(lX.result.done)a3=!0;else Q3H(lX.result.value,(mJ)=>{if(Mz(mJ))eH(()=>[mJ]);else eH((o3)=>[...o3,mJ])},(mJ)=>NY((o3)=>o3+mJ.length),f9,R9,(mJ)=>{eH((o3)=>o3.filter((SY)=>SY!==mJ)),XbA(mJ.uuid)},LB)}if(uG.current=null,W9("query_end"),xY){F0();return}F0(),lzD(),Q?.()},[rH,F0,kJ,u,$H,HI,X,Q,J,pM,O]),r3=lA.useCallback(async(J$,FL,SL,I0,SD,BD,XI,R1)=>{if(dL()){let yB=k9(),G9=k1();if(yB&&G9)DP$(yB,G9,!0)}if(xI.current){c("tengu_concurrent_onquery_detected",{}),J$.filter((yB)=>yB.type==="user").map((yB)=>H9H(yB.message.content)).filter((yB)=>yB!==null).forEach((yB,G9)=>{if(CX({value:yB,mode:"prompt"},$H),G9===0)c("tengu_concurrent_onquery_enqueued",{})}),j1(!1);return}xI.current=!0,gD.current=J$;try{j1(!0),eH((G9)=>[...G9,...J$]),MD(void 0),WW.current=0,R9([]);let yB=await new Promise((G9)=>{eH((W1)=>{return G9(W1),W1})});if(XI&&R1){let G9=[...yB,...J$];if(!await XI(R1,G9))return}await _e(yB,J$,FL,SL,I0,SD,BD)}finally{xI.current=!1,cz(Date.now()),F0();let yB=Date.now()-P9.current-Q1.current;if(yB>30000&&!FL.signal.aborted&&!TH)if(Kw(DH.getState().tasks).some((W1)=>W1.status==="running")){if(cE.current===null)cE.current=P9.current}else eH((W1)=>[...W1,EbA(yB)])}},[_e,j1,$H,F0]),kd=lA.useRef(!1);lA.useEffect(()=>{let J$=GH;if(!J$||ZA||kd.current)return;kd.current=!0;async function FL(SL){if(SL.clearContext){let BD=SL.message.planContent?xRH():void 0,{clearConversation:XI}=await Promise.resolve().then(() => (cZ$(),kjA));if(await XI({setMessages:eH,readFileState:K0.current,getAppState:async()=>new Promise((R1)=>{$H((yB)=>{return R1(yB),yB})}),setAppState:$H,setConversationId:dK}),BD)RWA(j$(),BD)}let I0=SL.message.planContent&&!1;if($H((BD)=>{let XI=SL.mode?_2(BD.toolPermissionContext,RpH(SL.mode,SL.allowedPrompts)):BD.toolPermissionContext;return{...BD,initialMessage:null,toolPermissionContext:XI,...I0&&{pendingPlanVerification:{plan:SL.message.planContent,verificationStarted:!1,verificationCompleted:!1}}}}),bE())J6H((BD)=>{$H((XI)=>({...XI,fileHistory:BD(XI.fileHistory)}))},SL.message.uuid);let SD=SL.message.message.content;if(typeof SD==="string"&&!SL.message.planContent)iK(SD,{setCursorOffset:()=>{},clearBuffer:()=>{},resetHistory:()=>{}});else{let BD=cD();IL(BD),r3([SL.message],BD,!0,[],AH,void 0)}setTimeout(()=>{kd.current=!1},100)}FL(J$)},[GH,ZA,eH,$H,r3,AH,HI]);let iK=lA.useCallback(async(J$,FL,SL,I0)=>{if(!SL&&J$.trim().startsWith("/")){let SD=J$.trim(),BD=SD.indexOf(" "),XI=BD===-1?SD.slice(1):SD.slice(1,BD),R1=BD===-1?"":SD.slice(BD+1).trim(),yB=sA.find((W1)=>W1.isEnabled()&&(W1.name===XI||W1.aliases?.includes(XI)||W1.userFacingName()===XI)),G9=yB?.immediate||I0?.fromKeybinding;if(yB&&G9&&yB.type==="local-jsx"){if(J$.trim()===II.current.trim())ML(""),FL.setCursorOffset(0),FL.clearBuffer();(async()=>{let cX=(dM,B_)=>{if(uD({jsx:null,shouldHidePromptInput:!1,clearLocalJSX:!0}),dM&&B_?.display!=="skip")iA({key:`immediate-${yB.name}`,text:dM,priority:"low"});if(B_?.metaMessages?.length){let xY=B_.metaMessages.map((a3)=>R$({content:a3,isMeta:!0}));eH((a3)=>[...a3,...xY])}},gJ=kJ(aL,[],cD(),[],void 0,AH),nK=await(await yB.load()).call(cX,gJ,R1);if(nK)uD({jsx:nK,shouldHidePromptInput:!0,isLocalJSXCommand:!0})})();return}}if(pF.isRemoteMode&&!J$.trim())return;if(!I0?.fromKeybinding)rIH({display:SL?J$:WVI(J$,RB),pastedContents:SL?{}:mK});if(J0!==void 0)ML(J0.text),FL.setCursorOffset(J0.cursorOffset),YU(J0.pastedContents),Pf(void 0);else if(!ZA||SL){if(!I0?.fromKeybinding)ML(""),FL.setCursorOffset(0);YU({})}if(!ZA||SL)y9("prompt"),b$(void 0),sP((SD)=>SD+1),FL.clearBuffer();if(SL){let{queryRequired:SD}=await AND(SL.state,SL.speculationSessionTimeSavedMs,SL.setAppState,J$,{setMessages:eH,readFileState:K0,cwd:zL()});if(SD){let BD=cD();IL(BD),r3([],BD,!0,[],AH,void 0)}return}if(pF.isRemoteMode){let SD=R$({content:J$.trim()});eH((BD)=>[...BD,SD]),await pF.sendMessage(J$.trim());return}await aN$({input:J$,helpers:FL,isLoading:ZA,mode:RB,commands:sA,onInputChange:ML,setPastedContents:YU,setIsLoading:j1,setToolJSX:uD,getToolUseContext:kJ,messages:aL,mainLoopModel:AH,pastedContents:mK,ideSelection:G$,setUserInputOnProcessing:MD,setAbortController:IL,abortController:E9,onQuery:r3,resetLoadingState:F0,thinkingEnabled:n,setAppState:$H,querySource:F_$(),onBeforeQuery:F,canUseTool:pM,addNotification:iA,streamMode:PD})},[ZA,RB,sA,ML,y9,YU,sP,b$,j1,uD,kJ,aL,AH,mK,G$,MD,IL,iA,r3,F0,J0,Pf,n,$H,F,pM,H6,eH,iA,PD]),PW=lA.useCallback(async(J$,FL,SL)=>{W2A(FL.id,J$,$H),ML(""),SL.setCursorOffset(0),SL.clearBuffer()},[$H,ML]),ud=lA.useCallback(()=>{let J$=Af?o8B(Af):"/issue";lK(null),iK(J$,{setCursorOffset:()=>{},clearBuffer:()=>{},resetHistory:()=>{}}).catch((FL)=>{N(`Auto-run ${J$} failed: ${FL instanceof Error?FL.message:String(FL)}`)})},[iK,Af]),q8H=lA.useCallback(()=>{lK(null)},[]),Ob=lA.useCallback(()=>{iK("/rate-limit-options",{setCursorOffset:()=>{},clearBuffer:()=>{},resetHistory:()=>{}})},[iK]),xb=lA.useCallback(async()=>{Qe(!0);let FL=await(await nmH.load()).call(()=>{});I_(FL)},[]),iE=lA.useCallback(()=>{OY((J$)=>!J$)},[]);async function oPH(){s5();let J$=XJ();for(let FL of J$)K0.current.set(FL.path,{content:FL.content,timestamp:Date.now(),offset:void 0,limit:void 0})}paL(aAB()),jtD(aL,aL.length===L?.length),tAB(),lA.useEffect(()=>{if(e.length<1)return;AA((J$)=>({...J$,promptQueueUseCount:(J$.promptQueueUseCount??0)+1}))},[e.length]);let YZ=lA.useCallback(()=>new Promise((J$)=>$H((FL)=>{return J$(FL),FL})),[$H]),d$=lA.useCallback(async(J$,FL)=>{await aN$({input:J$,helpers:{setCursorOffset:()=>{},clearBuffer:()=>{},resetHistory:()=>{}},isLoading:ZA,mode:"prompt",commands:sA,onInputChange:()=>{},setPastedContents:()=>{},setIsLoading:j1,setToolJSX:uD,getToolUseContext:kJ,messages:aL,mainLoopModel:AH,pastedContents:FL,ideSelection:G$,setUserInputOnProcessing:MD,setAbortController:IL,onQuery:r3,resetLoadingState:F0,thinkingEnabled:n,setAppState:$H,querySource:F_$(),onBeforeQuery:F,canUseTool:pM,addNotification:iA})},[ZA,sA,j1,uD,kJ,aL,AH,G$,MD,pM,IL,r3,F0,n,iA,$H,F]);dLB({isLoading:ZA,queuedCommandsLength:e.length,lastQueryCompletionTime:eP,getAppState:YZ,setAppState:$H,executeQueuedInput:d$,hasActiveLocalJsxUI:qL?.isLocalJSXCommand??!1,setIsLoading:j1}),lA.useEffect(()=>{dhH.recordUserActivity(),IHH()},[AL,hJ]);let mA=lA.useRef(new Set);lA.useEffect(()=>{let J$=new Set(aL.filter((SL)=>Mz(SL)).map((SL)=>SL.uuid));if(Array.from(J$).some((SL)=>!mA.current.has(SL)))mA.current=J$,dK(GdH.randomUUID())},[aL]),lA.useEffect(()=>{if(hJ===1)CuA()},[hJ]),lA.useEffect(()=>{if(ZA)return;if(hJ===0)return;if(eP===0)return;let J$=setTimeout(()=>{if(KCH()>eP)return;let SL=Date.now()-eP;if(!ZA&&!qL&&D4.current===void 0&&SL>=M$().messageIdleNotifThresholdMs)Yh({message:"Claude is waiting for your input",notificationType:"idle_prompt"},MH)},M$().messageIdleNotifThresholdMs);return()=>clearTimeout(J$)},[ZA,qL,hJ,eP,MH]);let _A=lA.useCallback((J$,FL)=>{if(xI.current)return!1;let SL=cD();IL(SL);let I0=R$({content:J$,isMeta:FL?.isMeta?!0:void 0});return r3([I0],SL,!0,[],AH,void 0),!0},[r3,AH]);if(dL())DIB({isLoading:ZA,focusedInputDialog:dX,onSubmitMessage:_A});lLB({isLoading:ZA,onSubmitMessage:_A}),lA.useEffect(()=>{return oPH(),()=>{zp.shutdown()}},[]);let{internal_eventEmitter:uI}=jJH(),[b0,l1]=lA.useState(0);lA.useEffect(()=>{let J$=()=>{process.stdout.write(`
`),$9(1);return}if(f.outputFormat==="stream-json"&&!f.verbose){process.stderr.write(`Error: When using --print, --output-format=stream-json requires --verbose
`),$9(1);return}let E=Wx1(H,f);if(f.outputFormat==="stream-json"&&f.verbose)OvI((q)=>{let O=(()=>{switch(q.type){case"started":return{type:"system",subtype:"hook_started",hook_id:q.hookId,hook_name:q.hookName,hook_event:q.hookEvent,uuid:zY.randomUUID(),session_id:j$()};case"progress":return{type:"system",subtype:"hook_progress",hook_id:q.hookId,hook_name:q.hookName,hook_event:q.hookEvent,stdout:q.stdout,stderr:q.stderr,output:q.output,uuid:zY.randomUUID(),session_id:j$()};case"response":return{type:"system",subtype:"hook_response",hook_id:q.hookId,hook_name:q.hookName,hook_event:q.hookEvent,output:q.output,stdout:q.stdout,stderr:q.stderr,exit_code:q.exitCode,outcome:q.outcome,uuid:zY.randomUUID(),session_id:j$()}}})();E.write(O)});if(f.setupTrigger)await e2$(f.setupTrigger);let M=await $(),G=await Qx1(A,{continue:f.continue,teleport:f.teleport,resume:f.resume,resumeSessionAt:f.resumeSessionAt,forkSession:f.forkSession,outputFormat:f.outputFormat});if(f.rewindFiles){let q=G.find((u)=>u.uuid===f.rewindFiles);if(!q||q.type!=="user"){process.stderr.write(`Error: --rewind-files requires a user message UUID, but ${f.rewindFiles} is not a user message in this session
`),$9(1);return}let J=fuH(M.mcp.tools,M.toolPermissionContext),F=sU()?I:[...I,...J],Q=f.sdkUrl?"stdio":f.permissionPromptToolName,W=void 0,P=Jx1(Q,E,M.mcp.tools,W);if(f.permissionPromptToolName)F=F.filter((q)=>q.name!==f.permissionPromptToolName);JpA(),await wgL();let Y=[],C=null;for await(let q of Ux1(E,M.mcp.clients,[...L,...M.mcp.commands],F,G,P,D,$,A,B,f)){if(C){let O=C(q);if(O)await E.write(O)}else if(f.outputFormat==="stream-json"&&f.verbose)await E.write(q);if(q.type!=="control_response"&&q.type!=="control_request"&&q.type!=="control_cancel_request"&&q.type!=="stream_event"&&q.type!=="keep_alive"&&q.type!=="streamlined_text"&&q.type!=="streamlined_tool_use_summary")Y.push(q)}let Z=K6(Y);switch(f.outputFormat){case"json":if(!Z||Z.type!=="result")throw Error("No messages returned");if(f.verbose){ND(vH(Y)+`
${A}`);if(H.new_context=L,I)H.new_context_truncated=!0,H.new_context_original_length=A.length}var $vI,oF$,eyI,wC9=61440,qC9;var tF$=K(()=>{NA();ga();x4();p$();Z$();$vI=require("crypto"),oF$=new Set,eyI=new Map;qC9=/^<system-reminder>\n?([\s\S]*?)\n?<\/system-reminder>$/});function fvI(H){let $=0;for(let A=0;A<H.length;A++){let L=H.charCodeAt(A);$=($<<5)-$+L,$=$&$}return Math.abs($)||1}function EvI(H){let $=BvI.get(H);if($!==void 0)return $;return L6A++,BvI.set(H,L6A),L6A}function sF$(){let H=EK()??j$(),$=k1()??"main",A=An(),L=I6A.get(H);if(L)return L;let I={agentId:H,agentName:$,parentAgentId:A,processId:H===j$()?1:EvI(H),threadId:fvI($)};return I6A.set(H,I),I}function pa(){return(Date.now()-zC9)*1000}function eF$(){return`span_${++NC9}`}function MvI(){let H=process.env.CLAUDE_CODE_PERFETTO_TRACE;N(`[Perfetto] initializePerfettoTracing called, env value: ${H}`)}function OC9(H){if(!jx)return;if(WP.push({name:"process_name",cat:"__metadata",ph:"M",ts:0,pid:H.processId,tid:0,args:{name:H.agentName}}),WP.push({name:"thread_name",cat:"__metadata",ph:"M",ts:0,pid:H.processId,tid:H.threadId,args:{name:H.agentName}}),H.parentAgentId)WP.push({name:"parent_agent",cat:"__metadata",ph:"M",ts:0,pid:H.processId,tid:0,args:{parent_agent_id:H.parentAgentId}})}function Fm(){return jx}function HK$(H,$,A){if(!jx)return;let L={agentId:H,agentName:$,parentAgentId:A,processId:EvI(H),threadId:fvI($)};I6A.set(H,L),OC9(L)}function GvI(H){if(!jx)return"";let $=eF$(),A=sF$();return ZF.set($,{name:"API Call",category:"api",startTime:pa(),agentInfo:A,args:{model:H.model,prompt_tokens:H.promptTokens,message_id:H.messageId,is_speculative:H.isSpeculative??!1,query_source:H.querySource}}),WP.push({name:"API Call",cat:"api",ph:"B",ts:ZF.get($).startTime,pid:A.processId,tid:A.threadId,args:ZF.get($).args}),$}function UvI(H,$){if(!jx||!H)return;let A=ZF.get(H);if(!A)return;let L=pa(),I=L-A.startTime,D=$.promptTokens??A.args.prompt_tokens,B=$.ttftMs,f=$.ttltMs,E=$.outputTokens,M=$.cacheReadTokens,G=B!==void 0&&D!==void 0&&B>0?Math.round(D/(B/1000)*100)/100:void 0,U=f!==void 0&&B!==void 0?f-B:void 0,X=U!==void 0&&E!==void 0&&U>0?Math.round(E/(U/1000)*100)/100:void 0,J=M!==void 0&&D!==void 0&&D>0?Math.round(M/D*1e4)/100:void 0,F={...A.args,ttft_ms:B,ttlt_ms:f,prompt_tokens:D,output_tokens:E,cache_read_tokens:M,cache_creation_tokens:$.cacheCreationTokens,message_id:$.messageId??A.args.message_id,success:$.success??!0,error:$.error,duration_ms:I/1000,itps:G,otps:X,cache_hit_rate_pct:J};if(B!==void 0){let Q=A.startTime+B*1000;if(WP.push({name:"First Token",cat:"api,ttft",ph:"B",ts:A.startTime,pid:A.agentInfo.processId,tid:A.agentInfo.threadId,args:{ttft_ms:B,prompt_tokens:D,itps:G,cache_hit_rate_pct:J}}),WP.push({name:"First Token",cat:"api,ttft",ph:"E",ts:Q,pid:A.agentInfo.processId,tid:A.agentInfo.threadId}),U!==void 0&&U>0)WP.push({name:"Sampling",cat:"api,sampling",ph:"B",ts:Q,pid:A.agentInfo.processId,tid:A.agentInfo.threadId,args:{sampling_ms:U,output_tokens:E,otps:X}}),WP.push({name:"Sampling",cat:"api,sampling",ph:"E",ts:Q+U*1000,pid:A.agentInfo.processId,tid:A.agentInfo.threadId})}WP.push({name:A.name,cat:A.category,ph:"E",ts:L,pid:A.agentInfo.processId,tid:A.agentInfo.threadId,args:F}),ZF.delete(H)}function XvI(H,$){if(!jx)return"";let A=eF$(),L=sF$();return ZF.set(A,{name:`Tool: ${H}`,category:"tool",startTime:pa(),agentInfo:L,args:{tool_name:H,...$}}),WP.push({name:`Tool: ${H}`,cat:"tool",ph:"B",ts:ZF.get(A).startTime,pid:L.processId,tid:L.threadId,args:ZF.get(A).args}),A}function JvI(H,$){if(!jx||!H)return;let A=ZF.get(H);if(!A)return;let L=pa(),I=L-A.startTime,D={...A.args,success:$?.success??!0,error:$?.error,result_tokens:$?.resultTokens,duration_ms:I/1000};WP.push({name:A.name,cat:A.category,ph:"E",ts:L,pid:A.agentInfo.processId,tid:A.agentInfo.threadId,args:D}),ZF.delete(H)}function FvI(H){if(!jx)return"";let $=eF$(),A=sF$();return ZF.set($,{name:"Waiting for User Input",category:"user_input",startTime:pa(),agentInfo:A,args:{context:H}}),WP.push({name:"Waiting for User Input",cat:"user_input",ph:"B",ts:ZF.get($).startTime,pid:A.processId,tid:A.threadId,args:ZF.get($).args}),$}function KvI(H,$){if(!jx||!H)return;let A=ZF.get(H);if(!A)return;let L=pa(),I=L-A.startTime,D={...A.args,decision:$?.decision,source:$?.source,duration_ms:I/1000};WP.push({name:A.name,cat:A.category,ph:"E",ts:L,pid:A.agentInfo.processId,tid:A.agentInfo.threadId,args:D}),ZF.delete(H)}function QvI(H){if(!jx)return"";let $=eF$(),A=sF$();return ZF.set($,{name:"Interaction",category:"interaction",startTime:pa(),agentInfo:A,args:{user_prompt_length:H?.length}}),WP.push({name:"Interaction",cat:"interaction",ph:"B",ts:ZF.get($).startTime,pid:A.processId,tid:A.threadId,args:ZF.get($).args}),$}function WvI(H){if(!jx||!H)return;let $=ZF.get(H);if(!$)return;let A=pa(),L=A-$.startTime;WP.push({name:$.name,cat:$.category,ph:"E",ts:A,pid:$.agentInfo.processId,tid:$.agentInfo.threadId,args:{...$.args,duration_ms:L/1000}}),ZF.delete(H)}var jx=!1,WP,ZF,I6A,zC9=0,NC9=0,L6A=1,BvI;var MyH=K(()=>{NA();p$();Z$();ME();CE();E$();WP=[],ZF=new Map,I6A=new Map,BvI=new Map});function qF(H){return H.spanContext().spanId||""}function B6A(){{let H=process.env.CLAUDE_CODE_ENHANCED_TELEMETRY_BETA??process.env.ENABLE_ENHANCED_TELEMETRY_BETA;if(A$(H))return!0;if(LE(H))return!1;return gL("enhanced_telemetry_beta",!1)}return!1}function Rx(){return B6A()||wF()}function B3(){return yM.trace.getTracer("com.anthropic.claude_code.tracing","1.0.0")}function aKH(H,$={}){return{...kKH(),"span.type":H,...$}}function PvI(H){let $=Fm()?QvI(H):void 0;if(!Rx()){if($){let E=yM.trace.getActiveSpan()||B3().startSpan("dummy"),M=qF(E);return VG.set(M,{span:E,startTime:Date.now(),attributes:{},perfettoSpanId:$}),da.enterWith(E),E}return yM.trace.getActiveSpan()||B3().startSpan("dummy")}let A=B3(),I=A$(process.env.OTEL_LOG_USER_PROMPTS)?H:"<REDACTED>";VvI++;let D=aKH("interaction",{user_prompt:I,user_prompt_length:H.length,"interaction.sequence":VvI}),B=A.startSpan("claude_code.interaction",{attributes:D});AvI(B,H);let f=qF(B);return VG.set(f,{span:B,startTime:Date.now(),attributes:D,perfettoSpanId:$}),da.enterWith(B),B}function GyH(){let H=da.getStore();if(!H)return;let $=qF(H),A=VG.get($);if(!A)return;if(A.ended)return;if(A.perfettoSpanId)WvI(A.perfettoSpanId);if(!Rx()){A.ended=!0,VG.delete($),da.exit(()=>{});return}let L=Date.now()-A.startTime;A.span.setAttributes({"interaction.duration_ms":L}),A.span.end(),A.ended=!0,VG.delete($),da.exit(()=>{})}function _vI(H,$,A){let L=Fm()?GvI({model:H,querySource:$?.querySource,messageId:void 0}):void 0;if(!Rx()){if(L){let G=yM.trace.getActiveSpan()||B3().startSpan("dummy"),U=qF(G);return VG.set(U,{span:G,startTime:Date.now(),attributes:{model:H},perfettoSpanId:L}),G}return yM.trace.getActiveSpan()||B3().startSpan("dummy")}let I=B3(),D=da.getStore(),B=aKH("llm_request",{model:H,"llm_request.context":D?"interaction":"standalone"}),f=D?yM.trace.setSpan(yM.context.active(),D):yM.context.active(),E=I.startSpan("claude_code.llm_request",{attributes:B},f);if($?.querySource)E.setAttribute("query_source",$.querySource);LvI(E,$,A);let M=qF(E);return VG.set(M,{span:E,startTime:Date.now(),attributes:B,perfettoSpanId:L}),E}function f6A(H,$){let A;if(H){let D=qF(H);A=VG.get(D)}else for(let[,D]of Array.from(VG.entries()).reverse())if(D.attributes["span.type"]==="llm_request"||D.attributes.model){A=D;break}if(!A)return;let L=Date.now()-A.startTime;if(A.perfettoSpanId)UvI(A.perfettoSpanId,{ttftMs:$?.ttftMs,ttltMs:L,promptTokens:$?.inputTokens,outputTokens:$?.outputTokens,cacheReadTokens:$?.cacheReadTokens,cacheCreationTokens:$?.cacheCreationTokens,success:$?.success,error:$?.error});if(!Rx()){VG.delete(qF(A.span));return}let I={duration_ms:L};if($){if($.inputTokens!==void 0)I.input_tokens=$.inputTokens;if($.outputTokens!==void 0)I.output_tokens=$.outputTokens;if($.cacheReadTokens!==void 0)I.cache_read_tokens=$.cacheReadTokens;if($.cacheCreationTokens!==void 0)I.cache_creation_tokens=$.cacheCreationTokens;if($.success!==void 0)I.success=$.success;if($.statusCode!==void 0)I.status_code=$.statusCode;if($.error!==void 0)I.error=$.error;if($.attempt!==void 0)I.attempt=$.attempt;if($.hasToolCall!==void 0)I["response.has_tool_call"]=$.hasToolCall;if($.ttftMs!==void 0)I.ttft_ms=$.ttftMs;IvI(I,$)}A.span.setAttributes(I),A.span.end(),VG.delete(qF(A.span))}function CvI(H,$){let A=Fm()?XvI(H,$):void 0;if(!Rx()){if(A){let M=yM.trace.getActiveSpan()||B3().startSpan("dummy"),G=qF(M);return VG.set(G,{span:M,startTime:Date.now(),attributes:{"span.type":"tool",tool_name:H},perfettoSpanId:A}),ca.enterWith(M),M}return yM.trace.getActiveSpan()||B3().startSpan("dummy")}let L=B3(),I=da.getStore(),D=aKH("tool",{tool_name:H,...$}),B=I?yM.trace.setSpan(yM.context.active(),I):yM.context.active(),f=L.startSpan("claude_code.tool",{attributes:D},B),E=qF(f);return VG.set(E,{span:f,startTime:Date.now(),attributes:D,perfettoSpanId:A}),ca.enterWith(f),f}function YvI(){let H=Fm()?FvI("tool_permission"):void 0;if(!Rx()){if(H){let f=yM.trace.getActiveSpan()||B3().startSpan("dummy"),E=qF(f);return VG.set(E,{span:f,startTime:Date.now(),attributes:{"span.type":"tool.blocked_on_user"},perfettoSpanId:H}),f}return yM.trace.getActiveSpan()||B3().startSpan("dummy")}let $=B3(),A=ca.getStore(),L=aKH("tool.blocked_on_user"),I=A?yM.trace.setSpan(yM.context.active(),A):yM.context.active(),D=$.startSpan("claude_code.tool.blocked_on_user",{attributes:L},I),B=qF(D);return VG.set(B,{span:D,startTime:Date.now(),attributes:L,perfettoSpanId:H}),D}function E6A(H,$){let A;for(let[,B]of Array.from(VG.entries()).reverse())if(B.attributes["span.type"]==="tool.blocked_on_user"){A=B;break}if(!A)return;if(A.perfettoSpanId)KvI(A.perfettoSpanId,{decision:H,source:$});if(!Rx()){let B=qF(A.span);VG.delete(B);return}let I={duration_ms:Date.now()-A.startTime};if(H)I.decision=H;if($)I.source=$;A.span.setAttributes(I),A.span.end();let D=qF(A.span);VG.delete(D)}function wvI(){if(!Rx())return yM.trace.getActiveSpan()||B3().startSpan("dummy");let H=B3(),$=ca.getStore(),A=aKH("tool.execution"),L=$?yM.trace.setSpan(yM.context.active(),$):yM.context.active(),I=H.startSpan("claude_code.tool.execution",{attributes:A},L),D=qF(I);return VG.set(D,{span:I,startTime:Date.now(),attributes:A}),I}function M6A(H){if(!Rx())return;let $;for(let[,D]of Array.from(VG.entries()).reverse())if(D.attributes["span.type"]==="tool.execution"){$=D;break}if(!$)return;let L={duration_ms:Date.now()-$.startTime};if(H){if(H.success!==void 0)L.success=H.success;if(H.error!==void 0)L.error=H.error}$.span.setAttributes(L),$.span.end();let I=qF($.span);VG.delete(I)}function $K$(H,$){let A;for(let[,B]of Array.from(VG.entries()).reverse())if(B.attributes["span.type"]==="tool"){A=B;break}if(!A)return;if(A.perfettoSpanId)JvI(A.perfettoSpanId,{success:!0,resultTokens:$});if(!Rx()){let B=qF(A.span);VG.delete(B),ca.exit(()=>{});return}let I={duration_ms:Date.now()-A.startTime};if(H){let B=A.attributes.tool_name||"unknown";DvI(I,B,H)}if($!==void 0)I.result_tokens=$;A.span.setAttributes(I),A.span.end();let D=qF(A.span);VG.delete(D),ca.exit(()=>{})}function xC9(){return A$(process.env.OTEL_LOG_TOOL_CONTENT)}function ZvI(H,$){if(!Rx()||!xC9())return;let A=ca.getStore();if(!A)return;let L={};for(let[I,D]of Object.entries($))if(typeof D==="string"){let{content:B,truncated:f}=Jm(D);if(L[I]=B,f)L[`${I}_truncated`]=!0,L[`${I}_original_length`]=D.length}else L[I]=D;A.addEvent(H,L)}function qvI(H,$,A,L){if(!wF())return yM.trace.getActiveSpan()||B3().startSpan("dummy");let I=B3(),D=ca.getStore()||da.getStore(),B=aKH("hook",{hook_event:H,hook_name:$,num_hooks:A,hook_definitions:L}),f=D?yM.trace.setSpan(yM.context.active(),D):yM.context.active(),E=I.startSpan("claude_code.hook",{attributes:B},f),M=qF(E);return VG.set(M,{span:E,startTime:Date.now(),attributes:B}),E}function TvI(H,$){if(!wF())return;let A=qF(H),L=VG.get(A);if(!L)return;let D={duration_ms:Date.now()-L.startTime};if($){if($.numSuccess!==void 0)D.num_success=$.numSuccess;if($.numBlocking!==void 0)D.num_blocking=$.numBlocking;if($.numNonBlockingError!==void 0)D.num_non_blocking_error=$.numNonBlockingError;if($.numCancelled!==void 0)D.num_cancelled=$.numCancelled}L.span.setAttributes(D),L.span.end(),VG.delete(A)}var yM,D6A,da,ca,VG,VvI=0;var la=K(()=>{jD();KF$();NA();tF$();MyH();yM=h(hB(),1),D6A=require("async_hooks"),da=new D6A.AsyncLocalStorage,ca=new D6A.AsyncLocalStorage,VG=new Map});var uUE,AK$;var zvI=K(()=>{gI();uUE=FD.enum(["allow","deny","ask"]),AK$=FD.object({toolName:FD.string(),ruleContent:FD.string().optional()})});var oKH,LK$;var G6A=K(()=>{gI();zvI();xW();oKH=FD.enum(["userSettings","projectSettings","localSettings","session","cliArg"]),LK$=FD.discriminatedUnion("type",[FD.object({type:FD.literal("addRules"),rules:FD.array(AK$),behavior:FD.enum(["allow","deny","ask"]),destination:oKH}),FD.object({type:FD.literal("replaceRules"),rules:FD.array(AK$),behavior:FD.enum(["allow","deny","ask"]),destination:oKH}),FD.object({type:FD.literal("removeRules"),rules:FD.array(AK$),behavior:FD.enum(["allow","deny","ask"]),destination:oKH}),FD.object({type:FD.literal("setMode"),mode:q0L,destination:oKH}),FD.object({type:FD.literal("addDirectories"),directories:FD.array(FD.string()),destination:oKH}),FD.object({type:FD.literal("removeDirectories"),directories:FD.array(FD.string()),destination:oKH})])});function NvI(H){return!(("async"in H)&&H.async===!0)}function GBH(H){return"async"in H&&H.async===!0}var SC9,jC9,IK$;var U6A=K(()=>{gI();$GH();G6A();SC9=S.object({async:S.literal(!0),asyncTimeout:S.number().optional()}),jC9=S.object({continue:S.boolean().describe("Whether Claude should continue after hook (default: true)").optional(),suppressOutput:S.boolean().describe("Hide stdout from transcript (default: false)").optional(),stopReason:S.string().describe("Message shown when continue is false").optional(),decision:S.enum(["approve","block"]).optional(),reason:S.string().describe("Explanation for the decision").optional(),systemMessage:S.string().describe("Warning message shown to the user").optional(),hookSpecificOutput:S.union([S.object({hookEventName:S.literal("PreToolUse"),permissionDecision:S.enum(["allow","deny","ask"]).optional(),permissionDecisionReason:S.string().optional(),updatedInput:S.record(S.string(),S.unknown()).optional(),additionalContext:S.string().optional()}),S.object({hookEventName:S.literal("UserPromptSubmit"),additionalContext:S.string().optional()}),S.object({hookEventName:S.literal("SessionStart"),additionalContext:S.string().optional()}),S.object({hookEventName:S.literal("Setup"),additionalContext:S.string().optional()}),S.object({hookEventName:S.literal("SubagentStart"),additionalContext:S.string().optional()}),S.object({hookEventName:S.literal("PostToolUse"),additionalContext:S.string().optional(),updatedMCPToolOutput:S.unknown().describe("Updates the output for MCP tools").optional()}),S.object({hookEventName:S.literal("PostToolUseFailure"),additionalContext:S.string().optional()}),S.object({hookEventName:S.literal("Notification"),additionalContext:S.string().optional()}),S.object({hookEventName:S.literal("PermissionRequest"),decision:S.union([S.object({behavior:S.literal("allow"),updatedInput:S.record(S.string(),S.unknown()).optional(),updatedPermissions:S.array(LK$).optional()}),S.object({behavior:S.literal("deny"),message:S.string().optional(),interrupt:S.boolean().optional()})])})]).optional()}),IK$=S.union([SC9,jC9])});function zT(H,$){let A=cD();if(H.aborted||$?.aborted)return A.abort(),{signal:A.signal,cleanup:()=>{}};let L=()=>{A.abort()};H.addEventListener("abort",L),$?.addEventListener("abort",L);let I=()=>{H.removeEventListener("abort",L),$?.removeEventListener("abort",L)};return{signal:A.signal,cleanup:I}}var UyH=K(()=>{aE()});function OvI(H){if(J6A=H,H&&X6A.length>0)for(let $ of X6A.splice(0))H($)}function F6A(H){if(J6A)J6A(H);else X6A.push(H)}function DK$(H){return RC9.includes(H)}function xvI(H,$,A){if(!DK$(A))return;F6A({type:"started",hookId:H,hookName:$,hookEvent:A})}function yC9(H){if(!DK$(H.hookEvent))return;if(!A$(process.env.CLAUDE_CODE_REMOTE))return;F6A({type:"progress",...H})}function BK$(H){if(!DK$(H.hookEvent))return()=>{};if(!A$(process.env.CLAUDE_CODE_REMOTE))return()=>{};let $="",A=setInterval(()=>{let{stdout:L,stderr:I,output:D}=H.getOutput();if(D===$)return;$=D,yC9({hookId:H.hookId,hookName:H.hookName,hookEvent:H.hookEvent,stdout:L,stderr:I,output:D})},1000);return A.unref(),()=>clearInterval(A)}function yx(H){let $=H.stdout||H.stderr||H.output;if($)N(`Hook ${H.hookName} (${H.hookEvent}) ${H.outcome}:
${A("/plugin install frontend-design@claude-code-plugins")}`},cooldownSessions:3,async isRelevant(H){if(G7("frontend-design@claude-code-plugins"))return!1;if(!H?.readFileState)return!1;return Tx(H.readFileState).some((A)=>/\.(html|css|htm)$/i.test(A))}},{id:"guest-passes",content:async(H)=>{let $=ZL("claude",H.theme),A=Os();return A?`Share Claude Code and earn ${$(Ns(A))} of extra usage \xB7 ${$("/passes")}`:`You have free guest passes to share \xB7 ${$("/passes")}`},cooldownSessions:3,isRelevant:async()=>{if(M$().hasVisitedPasses)return!1;let{eligible:$}=JT$();return $}},{id:"overage-promo",content:async(H)=>{return`${ZL("claude",H.theme)("$50 free extra usage")} \xB7 /extra-usage to enable`},cooldownSessions:3,isRelevant:async()=>ggH()}],PN1=[]});function _N1(H){if(H.length===0)return;if(H.length===1)return H[0];let $=H.map((A)=>({tip:A,sessions:DO$(A.id)}));return $.sort((A,L)=>L.sessions-A.sessions),$[0]?.tip}async function hIB(H){if(VL().spinnerTipsEnabled===!1)return;let $=await BO$(H);if($.length===0)return;return _N1($)}function bIB(H){vIB(H.id),c("tengu_tip_shown",{tipIdLength:H.id,cooldownSessions:H.cooldownSessions})}var kIB=K(()=>{luA();z$();mL();iuA()});function gIB(){let H=W$((A)=>A.toolPermissionContext),$=RI();uIB.useEffect(()=>{nuA(H,$)},[])}var uIB,nuA;var mIB=K(()=>{aD();pL();bp();uIB=h(t(),1),nuA=o$(async(H,$)=>{if(!H.isBypassPermissionsModeAvailable)return;if(!await DbA())return;$((L)=>{return{...L,toolPermissionContext:c3H(L.toolPermissionContext)}})})});function pIB(H,$,A){let L=fO$.useRef(!1);fO$.useEffect(()=>{if(!bE()||L.current)return;if(L.current=!0,H)SC$(H,A)},[$,H,A])}var fO$;var dIB=K(()=>{sC();fO$=h(t(),1)});function ruA({hostPattern:{host:H},onUserResponse:$}){function A(D){switch(D){case"yes":$({allow:!0,persistToSettings:!1});break;case"yes-dont-ask-again":$({allow:!0,persistToSettings:!0});break;case"no":$({allow:!1,persistToSettings:!1});break}}let L=$zH(),I=[{label:"Yes",value:"yes"},...!L?[{label:hG.createElement(V,null,"Yes, and don't ask again for ",hG.createElement(V,{bold:!0},H)),value:"yes-dont-ask-again"}]:[],{label:hG.createElement(V,null,"No, and tell Claude what to do differently ",hG.createElement(V,{bold:!0},"(esc)")),value:"no"}];return hG.createElement(CG,{title:"Network request outside of sandbox"},hG.createElement(x,{flexDirection:"column",paddingX:2,paddingY:1},hG.createElement(x,null,hG.createElement(V,{dimColor:!0},"Host:"),hG.createElement(V,null," ",H)),hG.createElement(x,{marginTop:1},hG.createElement(V,null,"Do you want to allow this connection?")),hG.createElement(x,null,hG.createElement(QA,{options:I,onChange:A,onCancel:()=>{$({allow:!1,persistToSettings:!1})}}))))}var hG;var cIB=K(()=>{xH();zM();T1();Bw();z$();hG=h(t(),1)});var CN1,jvG,EO$=604800000,lIB=86400000,auA;var HdH=K(()=>{CN1=Math.pow(10,8)*24*60*60*1000,jvG=-CN1,auA=Symbol.for("constructDateFrom")});function qY(H,$){if(typeof H==="function")return H($);if(H&&typeof H==="object"&&auA in H)return H[auA]($);if(H instanceof Date)return new H.constructor($);return new Date($)}var Ue=K(()=>{HdH()});function mX(H,$){return qY($||H,H)}var XZ=K(()=>{Ue()});var iIB=()=>{};var nIB=()=>{};var rIB=()=>{};var aIB=()=>{};var oIB=()=>{};var tIB=()=>{};var sIB=()=>{};var eIB=()=>{};var HDB=()=>{};function Xe(){return YN1}var YN1;var $dH=K(()=>{YN1={}});function jd(H,$){let A=Xe(),L=$?.weekStartsOn??$?.locale?.options?.weekStartsOn??A.weekStartsOn??A.locale?.options?.weekStartsOn??0,I=mX(H,$?.in),D=I.getDay(),B=(D<L?7:0)+D-L;return I.setDate(I.getDate()-B),I.setHours(0,0,0,0),I}var mPH=K(()=>{$dH();XZ()});function Q8H(H,$){return jd(H,{...$,weekStartsOn:1})}var AdH=K(()=>{mPH()});function MO$(H,$){let A=mX(H,$?.in),L=A.getFullYear(),I=qY(A,0);I.setFullYear(L+1,0,4),I.setHours(0,0,0,0);let D=Q8H(I),B=qY(A,0);B.setFullYear(L,0,4),B.setHours(0,0,0,0);let f=Q8H(B);if(A.getTime()>=D.getTime())return L+1;else if(A.getTime()>=f.getTime())return L;else return L-1}var GO$=K(()=>{Ue();AdH();XZ()});function ouA(H){let $=mX(H),A=new Date(Date.UTC($.getFullYear(),$.getMonth(),$.getDate(),$.getHours(),$.getMinutes(),$.getSeconds(),$.getMilliseconds()));return A.setUTCFullYear($.getFullYear()),+H-+A}var $DB=K(()=>{XZ()});function ADB(H,...$){let A=qY.bind(null,H||$.find((L)=>typeof L==="object"));return $.map(A)}var LDB=K(()=>{Ue()});function tuA(H,$){let A=mX(H,$?.in);return A.setHours(0,0,0,0),A}var suA=K(()=>{XZ()});function IDB(H,$,A){let[L,I]=ADB(A?.in,H,$),D=tuA(L),B=tuA(I),f=+D-ouA(D),E=+B-ouA(B);return Math.round((f-E)/lIB)}var euA=K(()=>{$DB();LDB();HdH();suA()});function DDB(H,$){let A=MO$(H,$),L=qY($?.in||H,0);return L.setFullYear(A,0,4),L.setHours(0,0,0,0),Q8H(L)}var HgA=K(()=>{Ue();GO$();AdH()});var BDB=()=>{};var fDB=()=>{};var EDB=()=>{};var MDB=()=>{};var GDB=()=>{};var UDB=()=>{};var XDB=()=>{};var JDB=()=>{};var FDB=()=>{};var KDB=()=>{};var QDB=()=>{};var WDB=()=>{};var VDB=()=>{};var PDB=()=>{};var _DB=()=>{};var CDB=()=>{};var YDB=()=>{};var wDB=()=>{};function ZDB(H){return H instanceof Date||typeof H==="object"&&Object.prototype.toString.call(H)==="[object Date]"}var $gA=()=>{};function qDB(H){return!(!ZDB(H)&&typeof H!=="number"||isNaN(+mX(H)))}var AgA=K(()=>{$gA();XZ()});var TDB=()=>{};var zDB=()=>{};var NDB=()=>{};var ODB=()=>{};var xDB=()=>{};var SDB=()=>{};var jDB=()=>{};var RDB=()=>{};var yDB=()=>{};var vDB=()=>{};var hDB=()=>{};var bDB=()=>{};var kDB=()=>{};var uDB=()=>{};var gDB=()=>{};var mDB=()=>{};var pDB=()=>{};var dDB=()=>{};var cDB=()=>{};var lDB=()=>{};var iDB=()=>{};var nDB=()=>{};var rDB=()=>{};var aDB=()=>{};var oDB=()=>{};var tDB=()=>{};var sDB=()=>{};var eDB=()=>{};var HBB=()=>{};var $BB=()=>{};var ABB=()=>{};var LBB=()=>{};var IBB=()=>{};function DBB(H,$){let A=mX(H,$?.in);return A.setFullYear(A.getFullYear(),0,1),A.setHours(0,0,0,0),A}var LgA=K(()=>{XZ()});var BBB=()=>{};var fBB=()=>{};var EBB=()=>{};var MBB=()=>{};var GBB=()=>{};var UBB=()=>{};var XBB=()=>{};var JBB=()=>{};var FBB=()=>{};var KBB=()=>{};var QBB=()=>{};var WBB=()=>{};var VBB=()=>{};var wN1,PBB=(H,$,A)=>{let L,I=wN1[H];if(typeof I==="string")L=I;else if($===1)L=I.one;else L=I.other.replace("{{count}}",$.toString());if(A?.addSuffix)if(A.comparison&&A.comparison>0)return"in "+L;else return L+" ago";return L};var _BB=K(()=>{wN1={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}}});function UO$(H){return($={})=>{let A=$.width?String($.width):H.defaultWidth;return H.formats[A]||H.formats[H.defaultWidth]}}var ZN1,qN1,TN1,CBB;var YBB=K(()=>{ZN1={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},qN1={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},TN1={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},CBB={date:UO$({formats:ZN1,defaultWidth:"full"}),time:UO$({formats:qN1,defaultWidth:"full"}),dateTime:UO$({formats:TN1,defaultWidth:"full"})}});var zN1,wBB=(H,$,A,L)=>zN1[H];var ZBB=K(()=>{zN1={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"}});function pPH(H){return($,A)=>{let L=A?.context?String(A.context):"standalone",I;if(L==="formatting"&&H.formattingValues){let B=H.defaultFormattingWidth||H.defaultWidth,f=A?.width?String(A.width):B;I=H.formattingValues[f]||H.formattingValues[B]}else{let B=H.defaultWidth,f=A?.width?String(A.width):H.defaultWidth;I=H.values[f]||H.values[B]}let D=H.argumentCallback?H.argumentCallback($):$;return I[D]}}var NN1,ON1,xN1,SN1,jN1,RN1,yN1=(H,$)=>{let A=Number(H),L=A%100;if(L>20||L<10)switch(L%10){case 1:return A+"st";case 2:return A+"nd";case 3:return A+"rd"}return A+"th"},qBB;var TBB=K(()=>{NN1={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},ON1={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},xN1={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},SN1={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},jN1={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},RN1={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},qBB={ordinalNumber:yN1,era:pPH({values:NN1,defaultWidth:"wide"}),quarter:pPH({values:ON1,defaultWidth:"wide",argumentCallback:(H)=>H-1}),month:pPH({values:xN1,defaultWidth:"wide"}),day:pPH({values:SN1,defaultWidth:"wide"}),dayPeriod:pPH({values:jN1,defaultWidth:"wide",formattingValues:RN1,defaultFormattingWidth:"wide"})}});function dPH(H){return($,A={})=>{let L=A.width,I=L&&H.matchPatterns[L]||H.matchPatterns[H.defaultMatchWidth],D=$.match(I);if(!D)return null;let B=D[0],f=L&&H.parsePatterns[L]||H.parsePatterns[H.defaultParseWidth],E=Array.isArray(f)?hN1(f,(U)=>U.test(B)):vN1(f,(U)=>U.test(B)),M;M=H.valueCallback?H.valueCallback(E):E,M=A.valueCallback?A.valueCallback(M):M;let G=$.slice(B.length);return{value:M,rest:G}}}function vN1(H,$){for(let A in H)if(Object.prototype.hasOwnProperty.call(H,A)&&$(H[A]))return A;return}function hN1(H,$){for(let A=0;A<H.length;A++)if($(H[A]))return A;return}function zBB(H){return($,A={})=>{let L=$.match(H.matchPattern);if(!L)return null;let I=L[0],D=$.match(H.parsePattern);if(!D)return null;let B=H.valueCallback?H.valueCallback(D[0]):D[0];B=A.valueCallback?A.valueCallback(B):B;let f=$.slice(I.length);return{value:B,rest:f}}}var bN1,kN1,uN1,gN1,mN1,pN1,dN1,cN1,lN1,iN1,nN1,rN1,NBB;var OBB=K(()=>{bN1=/^(\d+)(th|st|nd|rd)?/i,kN1=/\d+/i,uN1={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},gN1={any:[/^b/i,/^(a|c)/i]},mN1={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},pN1={any:[/1/i,/2/i,/3/i,/4/i]},dN1={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},cN1={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},lN1={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},iN1={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},nN1={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},rN1={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},NBB={ordinalNumber:zBB({matchPattern:bN1,parsePattern:kN1,valueCallback:(H)=>parseInt(H,10)}),era:dPH({matchPatterns:uN1,defaultMatchWidth:"wide",parsePatterns:gN1,defaultParseWidth:"any"}),quarter:dPH({matchPatterns:mN1,defaultMatchWidth:"wide",parsePatterns:pN1,defaultParseWidth:"any",valueCallback:(H)=>H+1}),month:dPH({matchPatterns:dN1,defaultMatchWidth:"wide",parsePatterns:cN1,defaultParseWidth:"any"}),day:dPH({matchPatterns:lN1,defaultMatchWidth:"wide",parsePatterns:iN1,defaultParseWidth:"any"}),dayPeriod:dPH({matchPatterns:nN1,defaultMatchWidth:"any",parsePatterns:rN1,defaultParseWidth:"any"})}});var IgA;var xBB=K(()=>{_BB();YBB();ZBB();TBB();OBB();IgA={code:"en-US",formatDistance:PBB,formatLong:CBB,formatRelative:wBB,localize:qBB,match:NBB,options:{weekStartsOn:0,firstWeekContainsDate:1}}});var SBB=K(()=>{xBB()});function jBB(H,$){let A=mX(H,$?.in);return IDB(A,DBB(A))+1}var DgA=K(()=>{euA();LgA();XZ()});function RBB(H,$){let A=mX(H,$?.in),L=+Q8H(A)-+DDB(A);return Math.round(L/EO$)+1}var BgA=K(()=>{HdH();AdH();HgA();XZ()});function XO$(H,$){let A=mX(H,$?.in),L=A.getFullYear(),I=Xe(),D=$?.firstWeekContainsDate??$?.locale?.options?.firstWeekContainsDate??I.firstWeekContainsDate??I.locale?.options?.firstWeekContainsDate??1,B=qY($?.in||H,0);B.setFullYear(L+1,0,D),B.setHours(0,0,0,0);let f=jd(B,$),E=qY($?.in||H,0);E.setFullYear(L,0,D),E.setHours(0,0,0,0);let M=jd(E,$);if(+A>=+f)return L+1;else if(+A>=+M)return L;else return L-1}var JO$=K(()=>{$dH();Ue();mPH();XZ()});function yBB(H,$){let A=Xe(),L=$?.firstWeekContainsDate??$?.locale?.options?.firstWeekContainsDate??A.firstWeekContainsDate??A.locale?.options?.firstWeekContainsDate??1,I=XO$(H,$),D=qY($?.in||H,0);return D.setFullYear(I,0,L),D.setHours(0,0,0,0),jd(D,$)}var fgA=K(()=>{$dH();Ue();JO$();mPH()});function vBB(H,$){let A=mX(H,$?.in),L=+jd(A,$)-+yBB(A,$);return Math.round(L/EO$)+1}var EgA=K(()=>{HdH();mPH();fgA();XZ()});function WE(H,$){let A=H<0?"-":"",L=Math.abs(H).toString().padStart($,"0");return A+L}var Rd;var hBB=K(()=>{Rd={y(H,$){let A=H.getFullYear(),L=A>0?A:1-A;return WE($==="yy"?L%100:L,$.length)},M(H,$){let A=H.getMonth();return $==="M"?String(A+1):WE(A+1,2)},d(H,$){return WE(H.getDate(),$.length)},a(H,$){let A=H.getHours()/12>=1?"pm":"am";switch($){case"a":case"aa":return A.toUpperCase();case"aaa":return A;case"aaaaa":return A[0];case"aaaa":default:return A==="am"?"a.m.":"p.m."}},h(H,$){return WE(H.getHours()%12||12,$.length)},H(H,$){return WE(H.getHours(),$.length)},m(H,$){return WE(H.getMinutes(),$.length)},s(H,$){return WE(H.getSeconds(),$.length)},S(H,$){let A=$.length,L=H.getMilliseconds(),I=Math.trunc(L*Math.pow(10,A-3));return WE(I,$.length)}}});function bBB(H,$=""){let A=H>0?"-":"+",L=Math.abs(H),I=Math.trunc(L/60),D=L%60;if(D===0)return A+String(I);return A+String(I)+$+WE(D,2)}function kBB(H,$){if(H%60===0)return(H>0?"-":"+")+WE(Math.abs(H)/60,2);return W8H(H,$)}function W8H(H,$=""){let A=H>0?"-":"+",L=Math.abs(H),I=WE(Math.trunc(L/60),2),D=WE(L%60,2);return A+I+$+D}var cPH,MgA;var uBB=K(()=>{DgA();BgA();GO$();EgA();JO$();hBB();cPH={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},MgA={G:function(H,$,A){let L=H.getFullYear()>0?1:0;switch($){case"G":case"GG":case"GGG":return A.era(L,{width:"abbreviated"});case"GGGGG":return A.era(L,{width:"narrow"});case"GGGG":default:return A.era(L,{width:"wide"})}},y:function(H,$,A){if($==="yo"){let L=H.getFullYear(),I=L>0?L:1-L;return A.ordinalNumber(I,{unit:"year"})}return Rd.y(H,$)},Y:function(H,$,A,L){let I=XO$(H,L),D=I>0?I:1-I;if($==="YY"){let B=D%100;return WE(B,2)}if($==="Yo")return A.ordinalNumber(D,{unit:"year"});return WE(D,$.length)},R:function(H,$){let A=MO$(H);return WE(A,$.length)},u:function(H,$){let A=H.getFullYear();return WE(A,$.length)},Q:function(H,$,A){let L=Math.ceil((H.getMonth()+1)/3);switch($){case"Q":return String(L);case"QQ":return WE(L,2);case"Qo":return A.ordinalNumber(L,{unit:"quarter"});case"QQQ":return A.quarter(L,{width:"abbreviated",context:"formatting"});case"QQQQQ":return A.quarter(L,{width:"narrow",context:"formatting"});case"QQQQ":default:return A.quarter(L,{width:"wide",context:"formatting"})}},q:function(H,$,A){let L=Math.ceil((H.getMonth()+1)/3);switch($){case"q":return String(L);case"qq":return WE(L,2);case"qo":return A.ordinalNumber(L,{unit:"quarter"});case"qqq":return A.quarter(L,{width:"abbreviated",context:"standalone"});case"qqqqq":return A.quarter(L,{width:"narrow",context:"standalone"});case"qqqq":default:return A.quarter(L,{width:"wide",context:"standalone"})}},M:function(H,$,A){let L=H.getMonth();switch($){case"M":case"MM":return Rd.M(H,$);case"Mo":return A.ordinalNumber(L+1,{unit:"month"});case"MMM":return A.month(L,{width:"abbreviated",context:"formatting"});case"MMMMM":return A.month(L,{width:"narrow",context:"formatting"});case"MMMM":default:return A.month(L,{width:"wide",context:"formatting"})}},L:function(H,$,A){let L=H.getMonth();switch($){case"L":return String(L+1);case"LL":return WE(L+1,2);case"Lo":return A.ordinalNumber(L+1,{unit:"month"});case"LLL":return A.month(L,{width:"abbreviated",context:"standalone"});case"LLLLL":return A.month(L,{width:"narrow",context:"standalone"});case"LLLL":default:return A.month(L,{width:"wide",context:"standalone"})}},w:function(H,$,A,L){let I=vBB(H,L);if($==="wo")return A.ordinalNumber(I,{unit:"week"});return WE(I,$.length)},I:function(H,$,A){let L=RBB(H);if($==="Io")return A.ordinalNumber(L,{unit:"week"});return WE(L,$.length)},d:function(H,$,A){if($==="do")return A.ordinalNumber(H.getDate(),{unit:"date"});return Rd.d(H,$)},D:function(H,$,A){let L=jBB(H);if($==="Do")return A.ordinalNumber(L,{unit:"dayOfYear"});return WE(L,$.length)},E:function(H,$,A){let L=H.getDay();switch($){case"E":case"EE":case"EEE":return A.day(L,{width:"abbreviated",context:"formatting"});case"EEEEE":return A.day(L,{width:"narrow",context:"formatting"});case"EEEEEE":return A.day(L,{width:"short",context:"formatting"});case"EEEE":default:return A.day(L,{width:"wide",context:"formatting"})}},e:function(H,$,A,L){let I=H.getDay(),D=(I-L.weekStartsOn+8)%7||7;switch($){case"e":return String(D);case"ee":return WE(D,2);case"eo":return A.ordinalNumber(D,{unit:"day"});case"eee":return A.day(I,{width:"abbreviated",context:"formatting"});case"eeeee":return A.day(I,{width:"narrow",context:"formatting"});case"eeeeee":return A.day(I,{width:"short",context:"formatting"});case"eeee":default:return A.day(I,{width:"wide",context:"formatting"})}},c:function(H,$,A,L){let I=H.getDay(),D=(I-L.weekStartsOn+8)%7||7;switch($){case"c":return String(D);case"cc":return WE(D,$.length);case"co":return A.ordinalNumber(D,{unit:"day"});case"ccc":return A.day(I,{width:"abbreviated",context:"standalone"});case"ccccc":return A.day(I,{width:"narrow",context:"standalone"});case"cccccc":return A.day(I,{width:"short",context:"standalone"});case"cccc":default:return A.day(I,{width:"wide",context:"standalone"})}},i:function(H,$,A){let L=H.getDay(),I=L===0?7:L;switch($){case"i":return String(I);case"ii":return WE(I,$.length);case"io":return A.ordinalNumber(I,{unit:"day"});case"iii":return A.day(L,{width:"abbreviated",context:"formatting"});case"iiiii":return A.day(L,{width:"narrow",context:"formatting"});case"iiiiii":return A.day(L,{width:"short",context:"formatting"});case"iiii":default:return A.day(L,{width:"wide",context:"formatting"})}},a:function(H,$,A){let I=H.getHours()/12>=1?"pm":"am";switch($){case"a":case"aa":return A.dayPeriod(I,{width:"abbreviated",context:"formatting"});case"aaa":return A.dayPeriod(I,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return A.dayPeriod(I,{width:"narrow",context:"formatting"});case"aaaa":default:return A.dayPeriod(I,{width:"wide",context:"formatting"})}},b:function(H,$,A){let L=H.getHours(),I;if(L===12)I=cPH.noon;else if(L===0)I=cPH.midnight;else I=L/12>=1?"pm":"am";switch($){case"b":case"bb":return A.dayPeriod(I,{width:"abbreviated",context:"formatting"});case"bbb":return A.dayPeriod(I,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return A.dayPeriod(I,{width:"narrow",context:"formatting"});case"bbbb":default:return A.dayPeriod(I,{width:"wide",context:"formatting"})}},B:function(H,$,A){let L=H.getHours(),I;if(L>=17)I=cPH.evening;else if(L>=12)I=cPH.afternoon;else if(L>=4)I=cPH.morning;else I=cPH.night;switch($){case"B":case"BB":case"BBB":return A.dayPeriod(I,{width:"abbreviated",context:"formatting"});case"BBBBB":return A.dayPeriod(I,{width:"narrow",context:"formatting"});case"BBBB":default:return A.dayPeriod(I,{width:"wide",context:"formatting"})}},h:function(H,$,A){if($==="ho"){let L=H.getHours()%12;if(L===0)L=12;return A.ordinalNumber(L,{unit:"hour"})}return Rd.h(H,$)},H:function(H,$,A){if($==="Ho")return A.ordinalNumber(H.getHours(),{unit:"hour"});return Rd.H(H,$)},K:function(H,$,A){let L=H.getHours()%12;if($==="Ko")return A.ordinalNumber(L,{unit:"hour"});return WE(L,$.length)},k:function(H,$,A){let L=H.getHours();if(L===0)L=24;if($==="ko")return A.ordinalNumber(L,{unit:"hour"});return WE(L,$.length)},m:function(H,$,A){if($==="mo")return A.ordinalNumber(H.getMinutes(),{unit:"minute"});return Rd.m(H,$)},s:function(H,$,A){if($==="so")return A.ordinalNumber(H.getSeconds(),{unit:"second"});return Rd.s(H,$)},S:function(H,$){return Rd.S(H,$)},X:function(H,$,A){let L=H.getTimezoneOffset();if(L===0)return"Z";switch($){case"X":return kBB(L);case"XXXX":case"XX":return W8H(L);case"XXXXX":case"XXX":default:return W8H(L,":")}},x:function(H,$,A){let L=H.getTimezoneOffset();switch($){case"x":return kBB(L);case"xxxx":case"xx":return W8H(L);case"xxxxx":case"xxx":default:return W8H(L,":")}},O:function(H,$,A){let L=H.getTimezoneOffset();switch($){case"O":case"OO":case"OOO":return"GMT"+bBB(L,":");case"OOOO":default:return"GMT"+W8H(L,":")}},z:function(H,$,A){let L=H.getTimezoneOffset();switch($){case"z":case"zz":case"zzz":return"GMT"+bBB(L,":");case"zzzz":default:return"GMT"+W8H(L,":")}},t:function(H,$,A){let L=Math.trunc(+H/1000);return WE(L,$.length)},T:function(H,$,A){return WE(+H,$.length)}}});var gBB=(H,$)=>{switch(H){case"P":return $.date({width:"short"});case"PP":return $.date({width:"medium"});case"PPP":return $.date({width:"long"});case"PPPP":default:return $.date({width:"full"})}},mBB=(H,$)=>{switch(H){case"p":return $.time({width:"short"});case"pp":return $.time({width:"medium"});case"ppp":return $.time({width:"long"});case"pppp":default:return $.time({width:"full"})}},aN1=(H,$)=>{let A=H.match(/(P+)(p+)?/)||[],L=A[1],I=A[2];if(!I)return gBB(H,$);let D;switch(L){case"P":D=$.dateTime({width:"short"});break;case"PP":D=$.dateTime({width:"medium"});break;case"PPP":D=$.dateTime({width:"long"});break;case"PPPP":default:D=$.dateTime({width:"full"});break}return D.replace("{{date}}",gBB(L,$)).replace("{{time}}",mBB(I,$))},pBB;var dBB=K(()=>{pBB={p:mBB,P:aN1}});function cBB(H){return oN1.test(H)}function lBB(H){return tN1.test(H)}function iBB(H,$,A){let L=eN1(H,$,A);if(console.warn(L),sN1.includes(H))throw RangeError(L)}function eN1(H,$,A){let L=H[0]==="Y"?"years":"days of the month";return`Use \`${H.toLowerCase()}\` instead of \`${H}\` (in \`${$}\`) for formatting ${L} to the input \`${A}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}var oN1,tN1,sN1;var nBB=K(()=>{oN1=/^D+$/,tN1=/^Y+$/,sN1=["D","DD","YY","YYYY"]});function rBB(H,$,A){let L=Xe(),I=A?.locale??L.locale??IgA,D=A?.firstWeekContainsDate??A?.locale?.options?.firstWeekContainsDate??L.firstWeekContainsDate??L.locale?.options?.firstWeekContainsDate??1,B=A?.weekStartsOn??A?.locale?.options?.weekStartsOn??L.weekStartsOn??L.locale?.options?.weekStartsOn??0,f=mX(H,A?.in);if(!qDB(f))throw RangeError("Invalid time value");let E=$.match($O1).map((G)=>{let U=G[0];if(U==="p"||U==="P"){let X=pBB[U];return X(G,I.formatLong)}return G}).join("").match(HO1).map((G)=>{if(G==="''")return{isToken:!1,value:"'"};let U=G[0];if(U==="'")return{isToken:!1,value:DO1(G)};if(MgA[U])return{isToken:!0,value:G};if(U.match(IO1))throw RangeError("Format string contains an unescaped latin alphabet character `"+U+"`");return{isToken:!1,value:G}});if(I.localize.preprocessor)E=I.localize.preprocessor(f,E);let M={firstWeekContainsDate:D,weekStartsOn:B,locale:I};return E.map((G)=>{if(!G.isToken)return G.value;let U=G.value;if(!A?.useAdditionalWeekYearTokens&&lBB(U)||!A?.useAdditionalDayOfYearTokens&&cBB(U))iBB(U,$,String(H));let X=MgA[U[0]];return X(f,U,I.localize,M)}).join("")}function DO1(H){let $=H.match(AO1);if(!$)return H;return $[1].replace(LO1,"'")}var HO1,$O1,AO1,LO1,IO1;var aBB=K(()=>{SBB();$dH();uBB();dBB();nBB();AgA();XZ();HO1=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,$O1=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,AO1=/^'([^]*?)'?$/,LO1=/''/g,IO1=/[a-zA-Z]/});var oBB=()=>{};var tBB=()=>{};var sBB=()=>{};var eBB=()=>{};var H0B=()=>{};var $0B=()=>{};var A0B=()=>{};var L0B=()=>{};var I0B=()=>{};var D0B=()=>{};var B0B=()=>{};var f0B=()=>{};var E0B=()=>{};var M0B=()=>{};var G0B=()=>{};var U0B=()=>{};var X0B=()=>{};var J0B=()=>{};var F0B=()=>{};var K0B=()=>{};var Q0B=()=>{};var W0B=()=>{};var V0B=()=>{};var P0B=()=>{};var _0B=()=>{};var C0B=()=>{};var Y0B=()=>{};var w0B=()=>{};var Z0B=()=>{};var q0B=()=>{};var T0B=()=>{};var z0B=()=>{};var N0B=()=>{};var O0B=()=>{};var x0B=()=>{};var S0B=()=>{};var j0B=()=>{};var R0B=()=>{};var y0B=()=>{};var v0B=()=>{};var h0B=()=>{};var b0B=()=>{};var k0B=()=>{};var u0B=()=>{};var g0B=()=>{};var m0B=()=>{};var p0B=()=>{};var d0B=()=>{};var c0B=()=>{};var l0B=()=>{};var i0B=()=>{};var n0B=()=>{};var r0B=()=>{};var a0B=()=>{};var o0B=()=>{};var t0B=()=>{};var s0B=()=>{};var e0B=()=>{};var H9B=()=>{};var $9B=()=>{};var A9B=()=>{};var L9B=()=>{};var I9B=()=>{};var D9B=()=>{};var B9B=()=>{};var f9B=()=>{};var E9B=()=>{};var M9B=()=>{};var G9B=()=>{};var U9B=()=>{};var X9B=()=>{};var J9B=()=>{};var F9B=()=>{};var K9B=()=>{};var Q9B=()=>{};var W9B=()=>{};var V9B=()=>{};var P9B=()=>{};var _9B=()=>{};var C9B=()=>{};var Y9B=()=>{};var w9B=()=>{};var Z9B=()=>{};var q9B=()=>{};var T9B=()=>{};var z9B=()=>{};var N9B=()=>{};var O9B=()=>{};var x9B=()=>{};var S9B=()=>{};var j9B=()=>{};var R9B=()=>{};var y9B=()=>{};var v9B=()=>{};var h9B=()=>{};var b9B=()=>{};var k9B=()=>{};var u9B=()=>{};var g9B=()=>{};var m9B=()=>{};var p9B=()=>{};var d9B=()=>{};var c9B=()=>{};var l9B=()=>{};var i9B=()=>{};var n9B=()=>{};var r9B=()=>{};var a9B=()=>{};var o9B=()=>{};var t9B=()=>{};var s9B=()=>{};var e9B=()=>{};var H1B=()=>{};var $1B=()=>{};var A1B=()=>{};var L1B=()=>{};var I1B=()=>{};var D1B=()=>{};var B1B=()=>{};var f1B=()=>{};var E1B=()=>{};var M1B=()=>{};var G1B=()=>{};var U1B=()=>{};var X1B=()=>{};var J1B=()=>{};var F1B=()=>{};var K1B=()=>{};var Q1B=()=>{};var W1B=()=>{};var V1B=()=>{};var P1B=()=>{};var _1B=()=>{};var C1B=()=>{};var Y1B=()=>{};var w1B=()=>{};var Z1B=()=>{};var q1B=()=>{};var T1B=()=>{};var z1B=()=>{};var N1B=()=>{};var O1B=()=>{};var x1B=()=>{};var S1B=()=>{};var j1B=()=>{};var R1B=()=>{};var y1B=()=>{};var v1B=()=>{};var h1B=()=>{};var b1B=()=>{};var k1B=()=>{};var u1B=()=>{};var g1B=()=>{};var m1B=()=>{};var p1B=()=>{};var d1B=K(()=>{rIB();sIB();iIB();HDB();fDB();eIB();EDB();nIB();MDB();GDB();UDB();XDB();JDB();QDB();WDB();VDB();PDB();_DB();Ue();CDB();YDB();TDB();euA();zDB();NDB();ODB();SDB();jDB();RDB();yDB();vDB();bDB();kDB();uDB();dDB();cDB();lDB();iDB();nDB();rDB();aDB();oDB();tDB();eDB();HBB();$BB();LBB();BBB();fBB();gDB();EBB();MBB();UBB();XBB();JBB();mDB();FBB();KBB();QBB();WBB();GBB();IBB();VBB();aBB();oBB();tBB();sBB();eBB();H0B();$0B();A0B();L0B();I0B();D0B();B0B();f0B();E0B();M0B();DgA();G0B();X0B();J0B();F0B();K0B();Q0B();BgA();GO$();W0B();V0B();P0B();_0B();C0B();xDB();Y0B();w0B();Z0B();EgA();q0B();JO$();z0B();N0B();O0B();x0B();S0B();j0B();R0B();y0B();v0B();h0B();b0B();$gA();k0B();u0B();g0B();m0B();p0B();pDB();U0B();a0B();o0B();t0B();wDB();e0B();$9B();A9B();I9B();D9B();B9B();E9B();H9B();M9B();aIB();oIB();G9B();U9B();X9B();J9B();F9B();K9B();Q9B();W9B();V9B();P9B();_9B();C9B();AgA();Y9B();tIB();w9B();q9B();T9B();N9B();O9B();T0B();x9B();z9B();S9B();j9B();FDB();R9B();y9B();v9B();h9B();KDB();b9B();k9B();u9B();g9B();m9B();p9B();d9B();c9B();l9B();i9B();n9B();r9B();a9B();r0B();o9B();t9B();s9B();e9B();H1B();$1B();A1B();L1B();I1B();D1B();B1B();f1B();E1B();M1B();G1B();U1B();X1B();F1B();K1B();i0B();Q1B();W1B();V1B();n0B();l0B();BDB();P1B();_1B();J1B();C1B();Y1B();c0B();w1B();Z1B();suA();q1B();s0B();AdH();HgA();L9B();ABB();sDB();f9B();T1B();z1B();mPH();fgA();LgA();N1B();x1B();S1B();Z9B();j1B();hDB();R1B();y1B();O1B();v1B();h1B();b1B();k1B();XZ();d0B();u1B();g1B();m1B();p1B()});function c1B(){let[H,$]=LdH.useState([]),[A,L]=LdH.useState(0);if(LdH.useEffect(()=>{let I=kL.getSandboxViolationStore();return I.subscribe((B)=>{$(B.slice(-10)),L(I.getTotalCount())})},[]),!kL.isSandboxingEnabled()||oA()==="linux")return null;if(A===0)return null;return oP.createElement(x,{flexDirection:"column",marginTop:1},oP.createElement(x,{marginLeft:0},oP.createElement(V,{color:"permission"},"\u29C8 Sandbox blocked ",A," total"," ",A===1?"operation":"operations")),H.map((I,D)=>oP.createElement(x,{key:`${I.timestamp.getTime()}-${D}`,paddingLeft:2},oP.createElement(V,{dimColor:!0},rBB(I.timestamp,"h:mm:ssa"),I.command?` ${I.command}:`:""," ",I.line))),oP.createElement(x,{paddingLeft:2},oP.createElement(V,{dimColor:!0},"\u2026 showing last ",Math.min(10,H.length)," of ",A)))}var oP,LdH;var l1B=K(()=>{xH();zM();d1B();C9();oP=h(t(),1),LdH=h(t(),1)});function n1B({mcpClients:H=[]}){let{addNotification:$}=OB();i1B.useEffect(()=>{let A=H.filter((I)=>I.type==="failed"&&I.config.type!=="sse-ide"&&I.config.type!=="ws-ide"&&I.config.type!=="claudeai-proxy"),L=H.filter((I)=>I.type==="needs-auth"&&I.config.type!=="claudeai-proxy");if(A.length===0&&L.length===0)return;if(A.length>0)$({key:"mcp-failed",jsx:FW.createElement(FW.Fragment,null,FW.createElement(V,{color:"error"},A.length," MCP"," ",A.length===1?"server":"servers"," failed"),FW.createElement(V,{dimColor:!0}," \xB7 /mcp")),priority:"medium"});if(L.length)$({key:"mcp-needs-auth",jsx:FW.createElement(FW.Fragment,null,FW.createElement(V,{color:"warning"},L.length," MCP"," ",L.length===1?"server needs":"servers need"," ","auth"),FW.createElement(V,{dimColor:!0}," \xB7 /mcp")),priority:"medium"})},[$,H])}var FW,i1B;var r1B=K(()=>{xH();yE();FW=h(t(),1),i1B=h(t(),1)});function a1B(){let{addNotification:H}=OB(),$=RI(),[A,L]=uK.useState(!!process.env.ENABLE_LSP_TOOL),I=uK.useRef(new Set),D=uK.useCallback((f,E)=>{let M=`${f}:${E}`;if(I.current.has(M))return;I.current.add(M),N(`LSP error: ${f} - ${E}`),$((U)=>{let X=new Set(U.plugins.errors.map((F)=>{if(F.type==="generic-error")return`generic-error:${F.source}:${F.error}`;return`${F.type}:${F.source}`})),J=`generic-error:${f}:${E}`;if(X.has(J))return U;return{...U,plugins:{...U.plugins,errors:[...U.plugins.errors,{type:"generic-error",source:f,error:E}]}}});let G=f.startsWith("plugin:")?f.split(":")[1]??f:f;H({key:`lsp-error-${f}`,jsx:uK.createElement(uK.Fragment,null,uK.createElement(V,{color:"error"},"LSP for ",G," failed"),uK.createElement(V,{dimColor:!0}," \xB7 /plugin for details")),priority:"medium",timeoutMs:8000})},[H,$]),B=uK.useCallback(()=>{if(!process.env.ENABLE_LSP_TOOL){L(!1);return}let f=U9H();if(f.status==="failed"){D("lsp-manager",f.error.message),L(!1);return}if(f.status==="pending"||f.status==="not-started")return;let E=Tp();if(E){let M=E.getAllServers();for(let[G,U]of M)if(U.state==="error"&&U.lastError)D(G,U.lastError.message)}},[D]);FF(B,A?BO1:null),uK.useEffect(()=>{if(process.env.ENABLE_LSP_TOOL)B()},[B])}var uK,BO1=5000;var o1B=K(()=>{xH();yE();pL();n6();Wt();E$();uK=h(t(),1)});async function s1B(H){if(!H||!H.trim())return N("[binaryCheck] Empty command provided, returning false"),!1;let $=H.trim(),A=t1B.get($);if(A!==void 0)return N(`[binaryCheck] Cache hit for '${$}': ${A}`),A;let L=!1;if(await q_($).catch(()=>null))L=!0;return t1B.set($,L),N(`[binaryCheck] Binary '${$}' ${L?"found":"not found"}`),L}var t1B;var e1B=K(()=>{E$();Kk();t1B=new Map});function EO1(H){return L2.has(H.toLowerCase())}function MO1(H){if(!H)return null;if(typeof H==="string")return N("[lspRecommendation] Skipping string path lspServers (not readable from marketplace)"),null;if(Array.isArray(H)){for(let $ of H){if(typeof $==="string")continue;let A=$8B($);if(A)return A}return null}return $8B(H)}function H8B(H){return typeof H==="object"&&H!==null}function $8B(H){let $=new Set,A=null;for(let[L,I]of Object.entries(H)){if(!H8B(I))continue;if(!A&&typeof I.command==="string")A=I.command;let D=I.extensionToLanguage;if(H8B(D))for(let B of Object.keys(D))$.add(B.toLowerCase())}if(!A||$.size===0)return null;return{extensions:$,command:A}}async function GO1(){let H=new Map;try{let $=await d1();for(let A of Object.keys($))try{let L=await $P(A),I=EO1(A);for(let D of L.plugins){if(!D.lspServers)continue;let B=MO1(D.lspServers);if(!B)continue;let f=`${D.name}@${A}`;H.set(f,{entry:D,marketplaceName:A,extensions:B.extensions,command:B.command,isOfficial:I})}}catch(L){N(`[lspRecommendation] Failed to load marketplace ${A}: ${L}`)}}catch($){N(`[lspRecommendation] Failed to load marketplaces config: ${$}`)}return H}async function L8B(H){if(UO1())return N("[lspRecommendation] Recommendations are disabled"),[];let $=A8B.extname(H).toLowerCase();if(!$)return N("[lspRecommendation] No file extension found"),[];N(`[lspRecommendation] Looking for LSP plugins for ${$}`);let A=await GO1(),I=M$().lspRecommendationNeverPlugins??[],D=[];for(let[f,E]of A){if(!E.extensions.has($))continue;if(I.includes(f)){N(`[lspRecommendation] Skipping ${f} (in never suggest list)`);continue}if(G7(f)){N(`[lspRecommendation] Skipping ${f} (already installed)`);continue}D.push({info:E,pluginId:f})}let B=[];for(let{info:f,pluginId:E}of D)if(await s1B(f.command))B.push({info:f,pluginId:E}),N(`[lspRecommendation] Binary '${f.command}' found for ${E}`);else N(`[lspRecommendation] Skipping ${E} (binary '${f.command}' not found)`);return B.sort((f,E)=>{if(f.info.isOfficial&&!E.info.isOfficial)return-1;if(!f.info.isOfficial&&E.info.isOfficial)return 1;return 0}),B.map(({info:f,pluginId:E})=>({pluginId:E,pluginName:f.entry.name,marketplaceName:f.marketplaceName,description:f.entry.description,isOfficial:f.isOfficial,extensions:Array.from(f.extensions),command:f.command}))}function I8B(H){AA(($)=>{let A=$.lspRecommendationNeverPlugins??[];if(A.includes(H))return $;return{...$,lspRecommendationNeverPlugins:[...A,H]}}),N(`[lspRecommendation] Added ${H} to never suggest`)}function D8B(){AA((H)=>{let $=(H.lspRecommendationIgnoredCount??0)+1;return{...H,lspRecommendationIgnoredCount:$}}),N("[lspRecommendation] Incremented ignored count")}function UO1(){let H=M$();return H.lspRecommendationDisabled===!0||(H.lspRecommendationIgnoredCount??0)>=fO1}var A8B,fO1=5;var B8B=K(()=>{S4();BQ();U7();e1B();vA();E$();A8B=require("path")});function f8B(){let H=W$((f)=>f.fileHistory.trackedFiles),{addNotification:$}=OB(),[A,L]=TY.useState(null),I=TY.useRef(new Set),D=TY.useRef(!1);TY.useEffect(()=>{if(A)return;if(D.current)return;if(Aj$())return;let f=[];for(let M of H)if(!I.current.has(M))I.current.add(M),f.push(M);if(f.length===0)return;D.current=!0,E(f).finally(()=>{D.current=!1});async function E(M){for(let G of M)try{let X=(await L8B(G))[0];if(X){N(`[useLspPluginRecommendation] Found match: ${X.pluginName} for ${G}`),L({pluginId:X.pluginId,pluginName:X.pluginName,pluginDescription:X.description,fileExtension:FO$.extname(G),shownAt:Date.now()}),Lj$(!0);return}}catch(U){r(U instanceof Error?U:Error(String(U)))}}},[H,A]);let B=TY.useCallback((f)=>{if(!A)return;let{pluginId:E,pluginName:M,shownAt:G}=A;switch(N(`[useLspPluginRecommendation] User response: ${f} for ${M}`),f){case"yes":JO1(E,M,$);break;case"no":{let U=Date.now()-G;if(U>=XO1)N(`[useLspPluginRecommendation] Timeout detected (${U}ms), incrementing ignored count`),D8B();break}case"never":I8B(E);break;case"disable":AA((U)=>{if(U.lspRecommendationDisabled)return U;return{...U,lspRecommendationDisabled:!0}});break}L(null)},[A,$]);return{recommendation:A,handleResponse:B}}async function JO1(H,$,A){try{N(`[useLspPluginRecommendation] Installing plugin: ${H}`);let L=await VK(H);if(!L)throw Error(`Plugin ${H} not found in marketplace`);let I=typeof L.entry.source==="string"?FO$.join(L.marketplaceInstallLocation,L.entry.source):void 0;await bw(H,L.entry,"user",void 0,I);let D=wI("userSettings");QI("userSettings",{enabledPlugins:{...D?.enabledPlugins,[H]:!0}}),N(`[useLspPluginRecommendation] Plugin installed: ${H}`),A({key:"lsp-plugin-installed",jsx:TY.createElement(V,{color:"success"},mH.tick," ",$," installed \xB7 restart to apply"),priority:"immediate",timeoutMs:5000})}catch(L){r(L instanceof Error?L:Error(String(L))),A({key:"lsp-plugin-install-failed",jsx:TY.createElement(V,{color:"error"},"Failed to install ",$),priority:"immediate",timeoutMs:5000})}}var TY,FO$,XO1=28000;var E8B=K(()=>{SI();xH();pL();yE();vA();p$();_$();E$();B8B();np();S4();mL();TY=h(t(),1),FO$=require("path")});function M8B(){}function G8B({pluginName:H,pluginDescription:$,fileExtension:A,onResponse:L}){let I=j9.useRef(L);I.current=L,j9.useEffect(()=>{let f=setTimeout(()=>{I.current("no")},FO1);return()=>clearTimeout(f)},[]);function D(f){switch(f){case"yes":L("yes");break;case"no":L("no");break;case"never":L("never");break;case"disable":L("disable");break}}return j9.createElement(CG,{title:"LSP Plugin Recommendation"},j9.createElement(x,{flexDirection:"column",paddingX:2,paddingY:1},j9.createElement(x,{marginBottom:1},j9.createElement(V,{dimColor:!0},"LSP provides code intelligence like go-to-definition and error checking")),j9.createElement(x,null,j9.createElement(V,{dimColor:!0},"Plugin:"),j9.createElement(V,null," ",H)),$&&j9.createElement(x,null,j9.createElement(V,{dimColor:!0},$)),j9.createElement(x,null,j9.createElement(V,{dimColor:!0},"Triggered by:"),j9.createElement(V,null," ",A," files")),j9.createElement(x,{marginTop:1},j9.createElement(V,null,"Would you like to install this LSP plugin?")),j9.createElement(x,null,j9.createElement(QA,{options:[{label:j9.createElement(V,null,"Yes, install ",j9.createElement(V,{bold:!0},H)),value:"yes"},{label:"No, not now",value:"no"},{label:j9.createElement(V,null,"Never for ",j9.createElement(V,{bold:!0},H)),value:"never"},{label:"Disable all LSP recommendations",value:"disable"}],onChange:D,onCancel:()=>L("no")}))))}var j9,FO1=30000;var U8B=K(()=>{xH();T1();Bw();j9=h(t(),1)});function X8B(){let{addNotification:H}=OB(),$=W$((D)=>D.plugins.installationStatus),{totalFailed:A,failedMarketplacesCount:L,failedPluginsCount:I}=KO$.useMemo(()=>{if(!$)return{totalFailed:0,failedMarketplacesCount:0,failedPluginsCount:0};let D=$.marketplaces.filter((f)=>f.status==="failed"),B=$.plugins.filter((f)=>f.status==="failed");return{totalFailed:D.length+B.length,failedMarketplacesCount:D.length,failedPluginsCount:B.length}},[$]);KO$.useEffect(()=>{if(!$){N("No installation status to monitor");return}if(A===0)return;if(N(`Plugin installation status: ${L} failed marketplaces, ${I} failed plugins`),A===0)return;N(`Adding notification for ${A} failed installations`),H({key:"plugin-install-failed",jsx:Zb.createElement(Zb.Fragment,null,Zb.createElement(V,{color:"error"},A," plugin",A===1?"":"s"," failed to install"),Zb.createElement(V,{dimColor:!0}," \xB7 /plugin for details")),priority:"medium"})},[H,A,L,I])}var Zb,KO$;var J8B=K(()=>{xH();yE();pL();E$();Zb=h(t(),1),KO$=h(t(),1)});function F8B(){let{addNotification:H}=OB(),[$,A]=IdH.useState([]);IdH.useEffect(()=>{return lAB((I)=>{N(`Plugin autoupdate notification: ${I.length} plugin(s) updated`),A(I)})},[]),IdH.useEffect(()=>{if($.length===0)return;let L=$.map((D)=>{let B=D.indexOf("@");return B>0?D.substring(0,B):D}),I=L.length<=2?L.join(" and "):`${L.length} plugins`;H({key:"plugin-autoupdate-restart",jsx:qb.createElement(qb.Fragment,null,qb.createElement(V,{color:"success"},L.length===1?"Plugin":"Plugins"," updated:"," ",I),qb.createElement(V,{dimColor:!0}," \xB7 Restart to apply")),priority:"low",timeoutMs:1e4}),N(`Showing plugin autoupdate notification for: ${L.join(", ")}`)},[$,H])}var qb,IdH;var K8B=K(()=>{xH();yE();_uA();E$();qb=h(t(),1),IdH=h(t(),1)});async function Q8B(H){if(N("performStartupChecks called"),!GG(!0)){N("Trust not accepted for current directory - skipping plugin installations");return}try{N("Starting background plugin installations"),await bq$(H)}catch($){N(`Error initiating background plugin installations: ${$}`)}}var W8B=K(()=>{E$();kq$();vA()});function V8B(H){let{addNotification:$}=OB(),A=Fr(),L=RUA(A,H),I=yUA(A),D=V8H.useRef(null),B=aq(),f=B0(),E=Ry(),M=f==="team"||f==="enterprise",[G,U]=V8H.useState(!1);V8H.useEffect(()=>{if(A.isUsingOverage&&!G&&(!B||!M||E))$({key:"limit-reached",text:I,priority:"immediate"}),U(!0);else if(!A.isUsingOverage&&G)U(!1)},[A.isUsingOverage,I,G,$,B,E,M]),V8H.useEffect(()=>{if(L&&L!==D.current)D.current=L,$({key:"rate-limit-warning",jsx:DdH.createElement(V,null,DdH.createElement(V,{color:"warning"},L)),priority:"high"})},[L,$])}var DdH,V8H;var P8B=K(()=>{yE();yy();xH();vA();fI();DdH=h(t(),1),V8H=h(t(),1)});function _8B(){}function QO1(H){let $=H.toLowerCase(),A=HD();for(let[L,I]of Object.entries(KO1)){let D=I.retirementDates[A];if(!$.includes(L)||!D)continue;return{isDeprecated:!0,modelName:I.modelName,retirementDate:D}}return{isDeprecated:!1}}function QO$(H){if(!H)return null;let $=QO1(H);if(!$.isDeprecated)return null;return`\u26A0 ${$.modelName} will be retired on ${$.retirementDate}. Consider switching to a newer model.`}var KO1;var GgA=K(()=>{rM();KO1={"claude-3-opus":{modelName:"Claude 3 Opus",retirementDates:{firstParty:"January 5, 2026",bedrock:"January 15, 2026",vertex:"January 5, 2026",foundry:"January 5, 2026"}},"claude-3-7-sonnet":{modelName:"Claude 3.7 Sonnet",retirementDates:{firstParty:"February 19, 2026",bedrock:"April 28, 2026",vertex:"May 11, 2026",foundry:"February 19, 2026"}},"claude-3-5-haiku":{modelName:"Claude 3.5 Haiku",retirementDates:{firstParty:"February 19, 2026",bedrock:null,vertex:null,foundry:null}}}});function C8B(H){let{addNotification:$}=OB(),A=WO$.useRef(null);WO$.useEffect(()=>{let L=QO$(H);if(L&&L!==A.current)A.current=L,$({key:"model-deprecation-warning",text:L,color:"warning",priority:"high"});if(!L)A.current=null},[H,$])}var WO$;var Y8B=K(()=>{yE();GgA();WO$=h(t(),1)});function w8B(){let{addNotification:H}=OB(),$=VO$.useRef(!1);VO$.useEffect(()=>{if($.current||w8()||A$(process.env.DISABLE_INSTALLATION_CHECKS))return;Th().then((A)=>{if($.current||A==="development")return;$.current=!0,H({timeoutMs:15000,key:"npm-deprecation-warning",text:WO1,color:"warning",priority:"high"})})},[H])}var VO$,WO1="Claude Code has switched from npm to native installer. Run `claude install` or see https://docs.anthropic.com/en/docs/claude-code/getting-started for more options.";var Z8B=K(()=>{yE();zh();NA();VO$=h(t(),1)});function q8B(){let{addNotification:H}=OB(),$=PO$.useRef(!1);PO$.useEffect(()=>{if($.current)return;if(mgL())$.current=!0,H({timeoutMs:15000,key:"programdata-deprecation-warning",text:VO1,color:"warning",priority:"high"})},[H])}var PO$,VO1="This device contains a C:\\ProgramData\\ClaudeCode\\managed-settings.json file. In a future version of Claude Code, managed settings at this location will no longer be applied. Contact your administrator to migrate this file to C:\\Program Files\\ClaudeCode\\managed-settings.json";var T8B=K(()=>{yE();mL();PO$=h(t(),1)});function z8B({ideSelection:H,mcpClients:$,ideInstallationStatus:A}){let{addNotification:L}=OB(),I=OPH($),D=A?Mx(A?.ideType):!1,B=A?.error||D,f=I==="connected"&&(H?.filePath||H?.text&&H.lineCount>0),E=I==="connected"&&!f,M=B&&!D&&!E&&!f,G=B&&D&&!E&&!f;BdH.useEffect(()=>{if(_F()||I!==null||G)return;qjH(!0).then((U)=>{let X=U[0]?.name;if(X)L({key:"ide-status-hint",text:`${mH.circle} /ide for ${X}`,priority:"low"})})},[L,I,G]),BdH.useEffect(()=>{if(M||G||I!=="disconnected")return;L({key:"ide-status-disconnected",text:`${mH.circle} IDE disconnected`,color:"error",priority:"medium"})},[L,I,M,G]),BdH.useEffect(()=>{if(!G)return;L({key:"ide-status-jetbrains-disconnected",text:"IDE plugin not connected \xB7 /status for info",priority:"medium"})},[L,G]),BdH.useEffect(()=>{if(!M)return;L({key:"ide-status-install-error",text:"IDE extension install failed (see /status for info)",color:"error",priority:"medium"})},[L,M])}var BdH;var N8B=K(()=>{yE();lU();FN$();SI();BdH=h(t(),1)});function x8B(){let{addNotification:H}=OB();O8B.useEffect(()=>{let A=M$().sonnet45MigrationTimestamp;if(A){if(Date.now()-A<3000)H({key:"sonnet-4.5-update",text:"Model updated to Sonnet 4.5",color:"suggestion",priority:"high",timeoutMs:3000})}},[H])}var O8B;var S8B=K(()=>{yE();vA();O8B=h(t(),1)});function R8B(){let{addNotification:H}=OB();j8B.useEffect(()=>{let A=M$().opusProMigrationTimestamp;if(A){if(Date.now()-A<3000)H({key:"opus-pro-update",text:"Model updated to Opus 4.5",color:"suggestion",priority:"high",timeoutMs:3000})}},[H])}var j8B;var y8B=K(()=>{yE();vA();j8B=h(t(),1)});function PO1(H){let $=H.toLowerCase();if($.includes("opus-4-6"))return null;if($.includes("opus-4-5"))return"Opus 4.5";if($.includes("opus-4-1"))return"Opus 4.1";if($.includes("opus-4"))return"Opus 4";return null}function h8B(){let{addNotification:H}=OB();v8B.useEffect(()=>{if(HD()!=="firstParty")return;let A=G1(),L=PO1(A);if(!L)return;c("tengu_opus46_upgrade_nudge_shown",{currentModel:A}),H({key:"opus-46-upgrade-nudge",jsx:fdH.createElement(V,{color:"suggestion"},"Currently using ",L,". Opus 4.6 is our best model for coding",fdH.createElement(V,{color:"text",dimColor:!0}," ","\xB7 /model to upgrade")),priority:"medium",timeoutMs:1e4})},[H])}var fdH,v8B;var b8B=K(()=>{xH();yE();rM();iI();z$();fdH=h(t(),1),v8B=h(t(),1)});function u8B(){let{addNotification:H}=OB();k8B.useEffect(()=>{if(M$().subscriptionNoticeCount??0>=_O1)return;CO1().then(($)=>{if($===null)return;AA((A)=>({...A,subscriptionNoticeCount:(A.subscriptionNoticeCount??0)+1})),c("tengu_switch_to_subscription_notice_shown",{}),H({key:"switch-to-subscription",jsx:EdH.createElement(V,{color:"suggestion"},"Use your existing Claude ",$," plan with Claude Code",EdH.createElement(V,{color:"text",dimColor:!0}," ","\xB7 /login to activate")),priority:"low"})})},[H])}async function CO1(){if(nL())return null;let H=await AeH();if(!H)return null;if(H.account.has_claude_max)return"Max";if(H.account.has_claude_pro)return"Pro";return null}var EdH,k8B,_O1=3;var g8B=K(()=>{xH();MwH();vA();z$();fI();yE();EdH=h(t(),1),k8B=h(t(),1)});function m8B(){let H=_O$.useRef(!1);_O$.useEffect(()=>{if(H.current)return;H.current=!0,egD()},[])}var _O$;var p8B=K(()=>{iyA();_O$=h(t(),1)});function d8B(H){if(!("text"in H))return 1;let $=H.text.match(/^(\d+)/);return $?.[1]?parseInt($[1],10):1}function YO1(H,$){return c8B(d8B(H)+1)}function c8B(H){return{key:"teammate-spawn",text:H===1?"1 agent spawned":`${H} agents spawned`,priority:"low",timeoutMs:5000,fold:YO1}}function wO1(H,$){return l8B(d8B(H)+1)}function l8B(H){return{key:"teammate-shutdown",text:H===1?"1 agent shut down":`${H} agents shut down`,priority:"low",timeoutMs:5000,fold:wO1}}function i8B(){let H=W$((I)=>I.tasks),{addNotification:$}=OB(),A=MdH.useRef(new Set),L=MdH.useRef(new Set);MdH.useEffect(()=>{for(let[I,D]of Object.entries(H)){if(!y4(D))continue;if(D.status==="running"&&!A.current.has(I))A.current.add(I),$(c8B(1));if(D.status==="completed"&&!L.current.has(I))L.current.add(I),$(l8B(1))}},[H,$])}var MdH;var n8B=K(()=>{pL();yE();MdH=h(t(),1)});var ZO1;var r8B=K(()=>{yE();i6();pL();q9();ZO1=h(t(),1)});function a8B({onRun:H,onCancel:$,reason:A}){let L=CO$.useRef(!1);return BA("confirm:no",$,{context:"Confirmation"}),CO$.useEffect(()=>{if(!L.current)L.current=!0,H()},[H]),s7.createElement(x,{flexDirection:"column",marginTop:1},s7.createElement(x,null,s7.createElement(V,{bold:!0},"Running feedback capture...")),s7.createElement(x,null,s7.createElement(V,{dimColor:!0},"Press ",s7.createElement(s$,{shortcut:"Esc",action:"cancel"})," anytime")),s7.createElement(x,null,s7.createElement(V,{dimColor:!0},"Reason: ",A)))}function UgA(H){return!1;switch(H){case"feedback_survey_bad":return!0;case"feedback_survey_good":return!1;default:return!1}}function o8B(H){return"/issue"}function t8B(H){switch(H){case"feedback_survey_bad":return'You responded "Bad" to the feedback survey';case"feedback_survey_good":return'You responded "Good" to the feedback survey';default:return"Unknown reason"}}var s7,CO$;var s8B=K(()=>{xH();LI();dB();s7=h(t(),1),CO$=h(t(),1)});var e8B,qO1;var HfB=K(()=>{xH();p$();e8B=h(t(),1),qO1=h(t(),1)});function NO1({showAllInTranscript:H}){let $=C0("app:toggleTranscript","Global","ctrl+o"),A=C0("transcript:toggleShowAll","Transcript","ctrl+e");return CI.createElement(x,{alignItems:"center",alignSelf:"center",borderTopDimColor:!0,borderBottom:!1,borderLeft:!1,borderRight:!1,borderStyle:"single",marginTop:1,paddingLeft:2,width:"100%"},CI.createElement(V,{dimColor:!0},"Showing detailed transcript \xB7 ",$," to toggle \xB7"," ",A," to ",H?"collapse":"show all"))}function P8H({commands:H,debug:$,initialTools:A,initialMessages:L,initialFileHistorySnapshots:I,initialAgentName:D,initialAgentColor:B,mcpClients:f,dynamicMcpConfig:E,mcpCliEndpoint:M,autoConnectIdeFlag:G,strictMcpConfig:U=!1,systemPrompt:X,appendSystemPrompt:J,onBeforeQuery:F,onTurnComplete:Q,disabled:W=!1,mainThreadAgentDefinition:P,disableSlashCommands:Y=!1,taskListId:C,remoteSessionConfig:Z,directConnectConfig:q}){lA.useEffect(()=>{return N(`[REPL:mount] REPL mounted, disabled=${W}`),DPI(),()=>N("[REPL:unmount] REPL unmounting")},[W]);let[O,j]=lA.useState(P),u=W$((J$)=>J$.toolPermissionContext),y=W$((J$)=>J$.verbose),g=W$((J$)=>J$.mcp),v=W$((J$)=>J$.plugins),p=W$((J$)=>J$.agentDefinitions),d=W$((J$)=>J$.fileHistory),k=W$((J$)=>J$.todos),n=W$((J$)=>J$.thinkingEnabled),GH=W$((J$)=>J$.initialMessage),e=W$((J$)=>J$.queuedCommands),BH=void 0,VH=!1,wH=void 0,WH=W$((J$)=>J$.spinnerTip),qH=W$((J$)=>J$.expandedView)==="tasks",s=W$((J$)=>J$.pendingWorkerRequest),IH=W$((J$)=>J$.pendingSandboxRequest),FH=W$((J$)=>J$.teamContext),EH=W$((J$)=>J$.tasks),YH=W$((J$)=>J$.workerSandboxPermissions),OH=W$((J$)=>J$.elicitation),HH=W$((J$)=>J$.viewingAgentTaskId),$H=RI(),DH=TX(),MH=Gy(),AH=mo(),[KH,CH]=lA.useState(H);sLB(iJ(),CH);let[TH,yH]=lA.useState(YO$?.isProactiveActive()??!1);lA.useEffect(()=>{if(!YO$)return;return YO$.subscribeToProactiveChanges(()=>{yH(YO$.isProactiveActive())})},[]);let gH=lA.useMemo(()=>NK(u),[u,TH]);gIB();let[QH,lH]=lA.useState(E),hH=lA.useCallback((J$)=>{lH(J$)},[lH]),[sH,F$]=lA.useState("prompt"),[KA,UA]=lA.useState(1),[U$,hA]=lA.useState(!1),{addNotification:iA}=OB(),rH=rLB(f,g.clients),[G$,b$]=lA.useState(void 0),[qA,n$]=lA.useState(null),[fA,UH]=lA.useState(null),[_H,aH]=lA.useState(!1),[f$,I$]=lA.useState(()=>{return!1});x8B(),R8B(),h8B(),u8B(),z8B({ideSelection:G$,mcpClients:rH,ideInstallationStatus:fA}),n1B({mcpClients:rH}),X8B(),F8B(),Gq$(),V8B(AH),_8B(),C8B(AH),w8B(),q8B(),qIB(),zIB(),xIB(),a1B(),i8B();let{recommendation:$$,handleResponse:e$}=f8B();M8B();let x$=lA.useMemo(()=>{return[...gH,...A]},[gH,A]);sN$();let zA=$P$();lA.useEffect(()=>{Q8B($H)},[$H]),jIB(rH,$H,u.mode),XLB($H,L);let gA=kT$(x$,g.tools,u),{tools:HI,allowedAgentTypes:$I}=lA.useMemo(()=>{if(!O)return{tools:gA,allowedAgentTypes:void 0};let J$=ia(O,gA,!1);return{tools:J$.resolvedTools,allowedAgentTypes:J$.allowedAgentTypes}},[O,gA]),wB=vuA(KH,v.commands),jB=vuA(wB,g.commands),sA=lA.useMemo(()=>Y?[]:jB,[Y,jB]);gtD(g.clients),AIB(g.clients,b$);let[PD,f9]=lA.useState("responding"),[k8,R9]=lA.useState([]),[FI,LB]=lA.useState(null);lA.useEffect(()=>{if(FI&&!FI.isStreaming&&FI.streamingEndedAt){let FL=30000-(Date.now()-FI.streamingEndedAt);if(FL>0){let SL=setTimeout(()=>{LB(null)},FL);return()=>clearTimeout(SL)}else LB(null)}},[FI]);let[E9,IL]=lA.useState(null),[ZA,IB]=lA.useState(Z?.hasInitialPrompt??!1),[KB,MD]=lA.useState(void 0),P9=lA.useRef(0),Q1=lA.useRef(0),E8=lA.useRef(null),cE=lA.useRef(null),D4=lA.useRef(void 0),c8=1500,[o4,mM]=lA.useState(!1),j1=lA.useCallback((J$)=>{if(IB(J$),J$)P9.current=Date.now(),Q1.current=0,E8.current=null},[]),[kG,pA]=lA.useState(null);lA.useEffect(()=>{if(kG?.notifications)kG.notifications.forEach((J$)=>{iA({key:"auto-updater-notification",text:J$,priority:"low"})})},[kG,iA]);let[qL,mB]=lA.useState(null),oB=lA.useRef(null),uD=lA.useCallback((J$)=>{if(J$?.isLocalJSXCommand){let{clearLocalJSX:FL,...SL}=J$;oB.current={...SL,isLocalJSXCommand:!0},mB(SL);return}if(oB.current){if(J$?.clearLocalJSX){oB.current=null,mB(null);return}return}if(J$?.clearLocalJSX){mB(null);return}mB(J$)},[]),[p9,v0]=lA.useState([]),[M9,bf]=lA.useState([]),h0=p9.length>0||s||IH,AE=qL?.isLocalJSXCommand===!0;lA.useEffect(()=>{if(ZA&&!h0&&!AE)MPI();else _SH();return()=>_SH()},[ZA,h0,AE]),lA.useEffect(()=>{if(ZA&&!h0&&!AE)return wtD(),()=>ZtD()},[ZA,h0,AE]),lA.useEffect(()=>{return pKD(v0),()=>dKD()},[v0]);let[aL,RH]=lA.useState(L??[]),bH=lA.useRef(aL),eH=lA.useCallback((J$)=>{if(typeof J$==="function")RH((FL)=>{let SL=J$(FL);return bH.current=SL,SL});else bH.current=J$,RH(J$)},[]),Q$=lA.useDeferredValue(aL),O$=aL.length-Q$.length;if(O$>0)N(`[useDeferredValue] Messages deferred by ${O$} (${Q$.length}\u2192${aL.length})`);let[CA,aA]=lA.useState(null);m8B();let[eA,hL]=lA.useState([]),[AL,ML]=lA.useState(()=>P0A()),II=lA.useRef(AL);II.current=AL,lA.useEffect(()=>{if(AL.trim().length===0){mM(!1);return}mM(!0);let J$=setTimeout(()=>{mM(!1)},c8);return()=>clearTimeout(J$)},[AL]);let[RB,y9]=lA.useState("prompt"),[J0,Pf]=lA.useState(),{tip:CU,dismissTip:t4}=PAB({inputValue:AL,isAssistantResponding:ZA}),B4=lA.useCallback((J$)=>{let FL=new Set(J$);CH((SL)=>SL.filter((I0)=>FL.has(I0.name)||lhA.has(I0)))},[CH]),[f4,gK]=lA.useState(new Set),H6=TAB({config:Z,setMessages:eH,setIsLoading:j1,onInit:B4,setToolUseConfirmQueue:v0,tools:x$,setStreamingToolUses:R9,setStreamMode:f9,setInProgressToolUseIDs:gK}),$6=OAB({config:q,setMessages:eH,setIsLoading:j1,setToolUseConfirmQueue:v0,tools:x$}),pF=$6.isRemoteMode?$6:H6,[mK,YU]=lA.useState({}),[hJ,sP]=lA.useState(0),WW=lA.useRef(0),NY=lA.useCallback((J$)=>{WW.current=J$(WW.current)},[]),[eP,cz]=lA.useState(0),[lz,pK]=lA.useState(null),[l8,d9]=lA.useState(null),[A6,H_]=lA.useState(null),[o5,OY]=lA.useState(!1),[$_,QZ]=lA.useState(!1),[t5,dK]=lA.useState(GdH.randomUUID()),[VM,WZ]=lA.useState(M$().hasAcknowledgedCostThreshold),[bJ,iz]=lA.useState("INSERT"),[A_,E4]=lA.useState(!1),[cK,VZ]=lA.useState(!1),[L_,n3]=lA.useState(!1),[_f,PZ]=lA.useState(!1),[wU,tD]=lA.useState(!1),[lE,s4]=lA.useState(!1),y$=IJ(),YL=lA.useRef(y$);YL.current=y$;let xI=lA.useRef(!1),gD=lA.useRef(null),[vD]=PI(),v9=lA.useCallback(()=>{hIB({theme:vD,readFileState:K0.current}).then(async(J$)=>{if(J$){let FL=await J$.content({theme:vD});$H((SL)=>({...SL,spinnerTip:FL})),bIB(J$)}else $H((FL)=>({...FL,spinnerTip:void 0}))})},[$H,vD]),F0=lA.useCallback(()=>{j1(!1),MD(void 0),WW.current=0,R9([]),pK(null),d9(null),H_(null),v9(),GyH()},[j1,v9]),{backgroundSignalRef:uG,handleBackgroundSession:dF,handleForegroundTask:VW}=JIB({setMessages:eH,setIsLoading:j1,resetLoadingState:F0,setAbortController:IL}),_Z=Kw(EH).some((J$)=>J$.status==="running");lA.useEffect(()=>{if(!_Z&&cE.current!==null){let J$=Date.now()-cE.current;cE.current=null,eH((FL)=>[...FL,EbA(J$)])}},[_Z,eH]);let Tb=aL.findLast((J$)=>J$.type==="assistant"),zb=Tb?.type==="assistant"?Tb.message.content.filter((J$)=>J$.type==="tool_use"&&f4.has(J$.id)):[],gG=zb.length>0&&zb.every((J$)=>J$.type==="tool_use"&&J$.name===ihA),L6=(!qL||qL.showSpinner===!0)&&p9.length===0&&(ZA||KB||_Z||gjI()>0)&&!s&&!gG,PH=p9.length>0||M9.length>0||OH.queue.length>0||YH.queue.length>0,ZH=WIB(aL,ZA,hJ,"session",PH),B$=lA.useMemo(()=>({...ZH,handleSelect:(J$)=>{if(ZH.handleSelect(J$),J$==="bad"&&UgA("feedback_survey_bad")||J$==="good"&&UgA("feedback_survey_good"))lK(J$==="bad"?"feedback_survey_bad":"feedback_survey_good")}}),[ZH]),IA=PIB(aL,ZA,PH);MIB({autoConnectIdeFlag:G,ideToInstallExtension:qA,setDynamicMcpConfig:lH,setShowIdeOnboarding:aH,setIDEInstallationState:UH}),pIB(I,d,(J$)=>$H((FL)=>({...FL,fileHistory:J$})));let bA=lA.useCallback(async(J$,FL,SL)=>{c("tengu_session_resumed",{entrypoint:SL});let I0=auH(FL.messages),SD=await p7("resume",{sessionId:J$,agentType:O?.agentType,model:AH});if(I0.push(...SD),NJ$(FL),xJ$(FL,P7(J$)),apH(FL,$H),FL.fileHistorySnapshots)jC$(FL);if(!P){let XI=FL.agentSetting?p?.activeAgents.find((R1)=>R1.agentType===FL.agentSetting):void 0;if(j(XI),KN(XI?.agentType),$H((R1)=>({...R1,agent:XI?.agentType})),XI&&!W_()&&XI.model&&XI.model!=="inherit")MV(t8(XI.model))}if(dL())$H((XI)=>({...XI,standaloneAgentContext:FL.agentName||FL.agentColor?{name:FL.agentName??"",color:FL.agentColor}:void 0}));YNA(I0),i8(I0,FL.projectPath??zL()),F0(),IL(null),dK(J$);let BD=CDA(J$);if(YDA(),afH(),EV(P7(J$)),await cw(),BD)WCH(BD);eH(()=>I0),uD(null),ML(""),hL([])},[F0,$H]),KI=j$(),QB=lA.useMemo(()=>ja(j$()),[]),K0=lA.useRef((()=>{let J$=Dm(iDH);return J$.set(QB,{content:vH(k[KI]||[]),timestamp:0,offset:void 0,limit:void 0}),J$})()),i8=lA.useCallback((J$,FL)=>{let SL=g9H(J$,FL,iDH);K0.current=qKH(K0.current,SL)},[]);lA.useEffect(()=>{if(L&&L.length>0)YNA(L),i8(L,zL())},[]);let{status:ZU,reverify:s5}=eAB(),[Af,lK]=lA.useState(null),[pX,I_]=lA.useState(null),[Yj,Qe]=lA.useState(!1),Nb=!ZA&&$_;function We(){if(Yj||pX)return;if(o5)return"message-selector";if(o4)return;if(M9[0])return"sandbox-permission";let J$=!qL||qL.shouldContinueAnimation;if(J$&&p9[0])return"tool-permission";if(J$&&YH.queue[0])return"worker-sandbox-permission";if(J$&&OH.queue[0])return"elicitation";if(J$&&Nb)return"cost";if(J$&&_H)return"ide-onboarding";if(J$&&$$)return"lsp-recommendation";return}let dX=We(),Ve=o4&&(M9[0]||p9[0]||YH.queue[0]||OH.queue[0]||Nb);D4.current=dX,lA.useEffect(()=>{if(!ZA)return;let J$=dX==="tool-permission",FL=Date.now();if(J$&&E8.current===null)E8.current=FL;else if(!J$&&E8.current!==null)Q1.current+=FL-E8.current,E8.current=null},[dX,ZA]);function CZ(){if(dX==="elicitation")return;if(N(`[onCancel] focusedInputDialog=${dX} streamMode=${PD}`),xI.current=!1,F0(),dX==="tool-permission")p9[0]?.onAbort(),v0([]);else if(pF.isRemoteMode)pF.cancelRequest();else E9?.abort();if(R8())ERI(EH,$H),djI(),$H((J$)=>{if(J$.queuedCommands.length===0)return J$;return{...J$,queuedCommands:[]}})}let D_=lA.useCallback(async()=>{let J$=await iJ$(AL,0,async()=>new Promise((FL)=>$H((SL)=>{return FL(SL),SL})),$H);if(!J$)return;if(ML(J$.text),y9("prompt"),J$.images.length>0)YU((FL)=>{let SL={...FL};for(let I0 of J$.images)SL[I0.id]=I0;return SL})},[$H,ML,y9,AL,YU]),bd={setToolUseConfirmQueue:v0,onCancel:CZ,isMessageSelectorVisible:o5||A_||cK,screen:sH,abortSignal:E9?.signal,popCommandFromQueue:D_,vimMode:bJ,isLocalJSXCommand:qL?.isLocalJSXCommand,isSearchingHistory:wU,isHelpOpen:lE,inputMode:RB,inputValue:AL};lA.useEffect(()=>{if($Q()>=5&&!$_&&!VM){if(c("tengu_cost_threshold_reached",{}),A9$())QZ(!0)}},[aL,$_,VM]);let Pe=lA.useCallback(async(J$)=>{if(dL()&&mbH())return new Promise((FL)=>{let SL=yKD();if(!vKD(J$.host,SL)){bf((SD)=>[...SD,{hostPattern:J$,resolvePromise:FL}]);return}uKD({requestId:SL,host:J$.host,resolve:FL}),$H((SD)=>({...SD,pendingSandboxRequest:{requestId:SL,host:J$.host}}))});return new Promise((FL)=>{bf((SL)=>[...SL,{hostPattern:J$,resolvePromise:FL}])})},[$H]);if(kL.isSandboxingEnabled())kL.initialize(Pe).catch((J$)=>{process.stderr.write(`
${A}`}]}}}return H[0]}scheduleReconnect(){let{logger:H,serverName:$}=this.context;if(this.reconnectTimer)return;if(this.reconnectAttempts++,this.reconnectAttempts>100){H.info(`[${$}] Giving up bridge reconnection after 100 attempts`),this.reconnectAttempts=0;return}let A=Math.min(2000*Math.pow(1.5,this.reconnectAttempts-1),30000);if(this.reconnectAttempts<=10||this.reconnectAttempts%10===0)H.info(`[${$}] Bridge reconnecting in ${Math.round(A)}ms (attempt ${this.reconnectAttempts})`);this.reconnectTimer=setTimeout(()=>{this.reconnectTimer=null,this.connect()},A)}closeSocket(){if(this.ws)this.ws.removeAllListeners(),this.ws.close(),this.ws=null;this.connected=!1,this.authenticated=!1}cleanup(){if(this.reconnectTimer)clearTimeout(this.reconnectTimer),this.reconnectTimer=null;for(let[H,$]of this.pendingCalls)clearTimeout($.timer),$.reject(Error("Bridge client disconnected")),this.pendingCalls.delete(H);this.closeSocket(),this.reconnectAttempts=0}}function LhA(H){return new AhA(H)}var cmH;var IhA=K(()=>{cmH=h(require("ws"))});var g1H;var DhA=K(()=>{g1H=[{name:"javascript_tool",description:"Execute JavaScript code in the context of the current page. The code runs in the page's context and can interact with the DOM, window object, and page variables. Returns the result of the last expression or any thrown errors. If you don't have a valid tab ID, use tabs_context_mcp first to get available tabs.",inputSchema:{type:"object",properties:{action:{type:"string",description:"Must be set to 'javascript_exec'"},text:{type:"string",description:"The JavaScript code to execute. The code will be evaluated in the page context. The result of the last expression will be returned automatically. Do NOT use 'return' statements - just write the expression you want to evaluate (e.g., 'window.myData.value' not 'return window.myData.value'). You can access and modify the DOM, call page functions, and interact with page variables."},tabId:{type:"number",description:"Tab ID to execute the code in. Must be a tab in the current group. Use tabs_context_mcp first if you don't have a valid tab ID."}},required:["action","text","tabId"]}},{name:"read_page",description:"Get an accessibility tree representation of elements on the page. By default returns all elements including non-visible ones. Output is limited to 50000 characters by default. If the output exceeds this limit, you will receive an error asking you to specify a smaller depth or focus on a specific element using ref_id. Optionally filter for only interactive elements. If you don't have a valid tab ID, use tabs_context_mcp first to get available tabs.",inputSchema:{type:"object",properties:{filter:{type:"string",enum:["interactive","all"],description:'Filter elements: "interactive" for buttons/links/inputs only, "all" for all elements including non-visible ones (default: all elements)'},tabId:{type:"number",description:"Tab ID to read from. Must be a tab in the current group. Use tabs_context_mcp first if you don't have a valid tab ID."},depth:{type:"number",description:"Maximum depth of the tree to traverse (default: 15). Use a smaller depth if output is too large."},ref_id:{type:"string",description:"Reference ID of a parent element to read. Will return the specified element and all its children. Use this to focus on a specific part of the page when output is too large."},max_chars:{type:"number",description:"Maximum characters for output (default: 50000). Set to a higher value if your client can handle large outputs."}},required:["tabId"]}},{name:"find",description:`Find elements on the page using natural language. Can search for elements by their purpose (e.g., "search bar", "login button") or by text content (e.g., "organic mango product"). Returns up to 20 matching elements with references that can be used with other tools. If more than 20 matches exist, you'll be notified to use a more specific query. If you don't have a valid tab ID, use tabs_context_mcp first to get available tabs.`,inputSchema:{type:"object",properties:{query:{type:"string",description:'Natural language description of what to find (e.g., "search bar", "add to cart button", "product title containing organic")'},tabId:{type:"number",description:"Tab ID to search in. Must be a tab in the current group. Use tabs_context_mcp first if you don't have a valid tab ID."}},required:["query","tabId"]}},{name:"form_input",description:"Set values in form elements using element reference ID from the read_page tool. If you don't have a valid tab ID, use tabs_context_mcp first to get available tabs.",inputSchema:{type:"object",properties:{ref:{type:"string",description:'Element reference ID from the read_page tool (e.g., "ref_1", "ref_2")'},value:{type:["string","boolean","number"],description:"The value to set. For checkboxes use boolean, for selects use option value or text, for other inputs use appropriate string/number"},tabId:{type:"number",description:"Tab ID to set form value in. Must be a tab in the current group. Use tabs_context_mcp first if you don't have a valid tab ID."}},required:["ref","value","tabId"]}},{name:"computer",description:`Use a mouse and keyboard to interact with a web browser, and take screenshots. If you don't have a valid tab ID, use tabs_context_mcp first to get available tabs.
${A}`);this.errors=H,this.name=Oc0}};nu=class nu extends Error{constructor(H){super(H.message,H.cause?{cause:H.cause}:void 0);this.scopes=H.scopes,this.getTokenOptions=H.getTokenOptions,this.name="AuthenticationRequiredError"}}});function xc0(H){return`The current credential is not configured to acquire tokens for tenant ${H}. To enable acquiring tokens for this tenant add it to the AdditionallyAllowedTenants on the credential options, or add "*" to AdditionallyAllowedTenants to allow acquiring tokens for any tenant.`}function bV(H,$,A=[],L){var I;let D;if(process.env.AZURE_IDENTITY_DISABLE_MULTITENANTAUTH)D=H;else if(H==="adfs")D=H;else D=(I=$===null||$===void 0?void 0:$.tenantId)!==null&&I!==void 0?I:H;if(H&&D!==H&&!A.includes("*")&&!A.some((B)=>B.localeCompare(D)===0)){let B=xc0(D);throw L===null||L===void 0||L.info(B),new Q0(B)}return D}var vMI=K(()=>{hV()});function r_(H,$){if(!$.match(/^[0-9a-zA-Z-.]+$/)){let A=Error("Invalid tenant id provided. You can locate your tenant id by following the instructions listed here: https://learn.microsoft.com/partner-center/find-ids-and-domain-names.");throw H.info(NE("",A)),A}}function hMI(H,$,A){if($)return r_(H,$),$;if(!A)A=DfA;if(A!==DfA)return"common";return"organizations"}function a_(H){if(!H||H.length===0)return[];if(H.includes("*"))return UMI;return H}var RO=K(()=>{KXH();DJ();vMI()});var KfA="$",$E$="_";function Sc0(H,$){return $!=="Composite"&&$!=="Dictionary"&&(typeof H==="string"||typeof H==="number"||typeof H==="boolean"||($===null||$===void 0?void 0:$.match(/^(Date|DateTime|DateTimeRfc1123|UnixTime|ByteArray|Base64Url)$/i))!==null||H===void 0||H===null)}function jc0(H){let $=Object.assign(Object.assign({},H.headers),H.body);if(H.hasNullableType&&Object.getOwnPropertyNames($).length===0)return H.shouldWrapBody?{body:null}:null;else return H.shouldWrapBody?Object.assign(Object.assign({},H.headers),{body:H.body}):$}function QfA(H,$){var A,L;let I=H.parsedHeaders;if(H.request.method==="HEAD")return Object.assign(Object.assign({},I),{body:H.parsedBody});let D=$&&$.bodyMapper,B=Boolean(D===null||D===void 0?void 0:D.nullable),f=D===null||D===void 0?void 0:D.type.name;if(f==="Stream")return Object.assign(Object.assign({},I),{blobBody:H.blobBody,readableStreamBody:H.readableStreamBody});let E=f==="Composite"&&D.type.modelProperties||{},M=Object.keys(E).some((G)=>E[G].serializedName==="");if(f==="Sequence"||M){let G=(A=H.parsedBody)!==null&&A!==void 0?A:[];for(let U of Object.keys(E))if(E[U].serializedName)G[U]=(L=H.parsedBody)===null||L===void 0?void 0:L[U];if(I)for(let U of Object.keys(I))G[U]=I[U];return B&&!H.parsedBody&&!I&&Object.getOwnPropertyNames(E).length===0?null:G}return jc0({body:H.parsedBody,headers:I,hasNullableType:B,shouldWrapBody:Sc0(H.parsedBody,f)})}var bMI=()=>{};var ru;var AE$=K(()=>{ru={Base64Url:"Base64Url",Boolean:"Boolean",ByteArray:"ByteArray",Composite:"Composite",Date:"Date",DateTime:"DateTime",DateTimeRfc1123:"DateTimeRfc1123",Dictionary:"Dictionary",Enum:"Enum",Number:"Number",Object:"Object",Sequence:"Sequence",String:"String",Stream:"Stream",TimeSpan:"TimeSpan",UnixTime:"UnixTime"}});var hn;var LE$=K(()=>{hn=class hn extends Error{constructor(H){super(H);this.name="AbortError"}}});function IE$(H){return H.toLowerCase()}function*Rc0(H){for(let $ of H.values())yield[$.name,$.value]}function _y(H){return new kMI(H)}var kMI;var uNH=K(()=>{kMI=class kMI{constructor(H){if(this._headersMap=new Map,H)for(let $ of Object.keys(H))this.set($,H[$])}set(H,$){this._headersMap.set(IE$(H),{name:H,value:String($).trim()})}get(H){var $;return($=this._headersMap.get(IE$(H)))===null||$===void 0?void 0:$.value}has(H){return this._headersMap.has(IE$(H))}delete(H){this._headersMap.delete(IE$(H))}toJSON(H={}){let $={};if(H.preserveCase)for(let A of this._headersMap.values())$[A.name]=A.value;else for(let[A,L]of this._headersMap)$[A]=L.value;return $}toString(){return JSON.stringify(this.toJSON({preserveCase:!0}))}[Symbol.iterator](){return Rc0(this._headersMap)}}});var uMI=()=>{};var gMI=()=>{};function gNH(){return yc0()}var mMI,WfA,yc0;var VfA=K(()=>{mMI=require("crypto"),yc0=typeof((WfA=globalThis===null||globalThis===void 0?void 0:globalThis.crypto)===null||WfA===void 0?void 0:WfA.randomUUID)==="function"?globalThis.crypto.randomUUID.bind(globalThis.crypto):mMI.randomUUID});class pMI{constructor(H){var $,A,L,I,D,B,f;this.url=H.url,this.body=H.body,this.headers=($=H.headers)!==null&&$!==void 0?$:_y(),this.method=(A=H.method)!==null&&A!==void 0?A:"GET",this.timeout=(L=H.timeout)!==null&&L!==void 0?L:0,this.multipartBody=H.multipartBody,this.formData=H.formData,this.disableKeepAlive=(I=H.disableKeepAlive)!==null&&I!==void 0?I:!1,this.proxySettings=H.proxySettings,this.streamResponseStatusCodes=H.streamResponseStatusCodes,this.withCredentials=(D=H.withCredentials)!==null&&D!==void 0?D:!1,this.abortSignal=H.abortSignal,this.onUploadProgress=H.onUploadProgress,this.onDownloadProgress=H.onDownloadProgress,this.requestId=H.requestId||gNH(),this.allowInsecureConnection=(B=H.allowInsecureConnection)!==null&&B!==void 0?B:!1,this.enableBrowserStreams=(f=H.enableBrowserStreams)!==null&&f!==void 0?f:!1,this.requestOverrides=H.requestOverrides,this.authSchemes=H.authSchemes}}function PfA(H){return new pMI(H)}var dMI=K(()=>{uNH();VfA()});class DE${constructor(H){var $;this._policies=[],this._policies=($=H===null||H===void 0?void 0:H.slice(0))!==null&&$!==void 0?$:[],this._orderedPolicies=void 0}addPolicy(H,$={}){if($.phase&&$.afterPhase)throw Error("Policies inside a phase cannot specify afterPhase.");if($.phase&&!cMI.has($.phase))throw Error(`Invalid phase name: ${$.phase}`);if($.afterPhase&&!cMI.has($.afterPhase))throw Error(`Invalid afterPhase name: ${$.afterPhase}`);this._policies.push({policy:H,options:$}),this._orderedPolicies=void 0}removePolicy(H){let $=[];return this._policies=this._policies.filter((A)=>{if(H.name&&A.policy.name===H.name||H.phase&&A.options.phase===H.phase)return $.push(A.policy),!1;else return!0}),this._orderedPolicies=void 0,$}sendRequest(H,$){return this.getOrderedPolicies().reduceRight((I,D)=>{return(B)=>{return D.sendRequest(B,I)}},(I)=>H.sendRequest(I))($)}getOrderedPolicies(){if(!this._orderedPolicies)this._orderedPolicies=this.orderPolicies();return this._orderedPolicies}clone(){return new DE$(this._policies)}static create(){return new DE$}orderPolicies(){let H=[],$=new Map;function A(J){return{name:J,policies:new Set,hasRun:!1,hasAfterPolicies:!1}}let L=A("Serialize"),I=A("None"),D=A("Deserialize"),B=A("Retry"),f=A("Sign"),E=[L,I,D,B,f];function M(J){if(J==="Retry")return B;else if(J==="Serialize")return L;else if(J==="Deserialize")return D;else if(J==="Sign")return f;else return I}for(let J of this._policies){let{policy:F,options:Q}=J,W=F.name;if($.has(W))throw Error("Duplicate policy names not allowed in pipeline");let P={policy:F,dependsOn:new Set,dependants:new Set};if(Q.afterPhase)P.afterPhase=M(Q.afterPhase),P.afterPhase.hasAfterPolicies=!0;$.set(W,P),M(Q.phase).policies.add(P)}for(let J of this._policies){let{policy:F,options:Q}=J,W=F.name,P=$.get(W);if(!P)throw Error(`Missing node for policy ${W}`);if(Q.afterPolicies)for(let Y of Q.afterPolicies){let C=$.get(Y);if(C)P.dependsOn.add(C),C.dependants.add(P)}if(Q.beforePolicies)for(let Y of Q.beforePolicies){let C=$.get(Y);if(C)C.dependsOn.add(P),P.dependants.add(C)}}function G(J){J.hasRun=!0;for(let F of J.policies){if(F.afterPhase&&(!F.afterPhase.hasRun||F.afterPhase.policies.size))continue;if(F.dependsOn.size===0){H.push(F.policy);for(let Q of F.dependants)Q.dependsOn.delete(F);$.delete(F.policy.name),J.policies.delete(F)}}}function U(){for(let J of E){if(G(J),J.policies.size>0&&J!==I){if(!I.hasRun)G(I);return}if(J.hasAfterPolicies)G(I)}}let X=0;while($.size>0){X++;let J=H.length;if(U(),H.length<=J&&X>1)throw Error("Cannot satisfy policy dependencies due to requirements cycle.")}return H}}function _fA(){return DE$.create()}var cMI;var lMI=K(()=>{cMI=new Set(["Deserialize","Serialize","Retry","Sign"])});function mNH(H){return typeof H==="object"&&H!==null&&!Array.isArray(H)&&!(H instanceof RegExp)&&!(H instanceof Date)}function zLH(H){if(mNH(H)){let $=typeof H.name==="string",A=typeof H.message==="string";return $&&A}return!1}var CfA=()=>{};var iMI,nMI;var rMI=K(()=>{iMI=require("util"),nMI=iMI.inspect.custom});class Cy{constructor({additionalAllowedHeaderNames:H=[],additionalAllowedQueryParameters:$=[]}={}){H=vc0.concat(H),$=hc0.concat($),this.allowedHeaderNames=new Set(H.map((A)=>A.toLowerCase())),this.allowedQueryParameters=new Set($.map((A)=>A.toLowerCase()))}sanitize(H){let $=new Set;return JSON.stringify(H,(A,L)=>{if(L instanceof Error)return Object.assign(Object.assign({},L),{name:L.name,message:L.message});if(A==="headers")return this.sanitizeHeaders(L);else if(A==="url")return this.sanitizeUrl(L);else if(A==="query")return this.sanitizeQuery(L);else if(A==="body")return;else if(A==="response")return;else if(A==="operationSpec")return;else if(Array.isArray(L)||mNH(L)){if($.has(L))return"[Circular]";$.add(L)}return L},2)}sanitizeUrl(H){if(typeof H!=="string"||H===null||H==="")return H;let $=new URL(H);if(!$.search)return H;for(let[A]of $.searchParams)if(!this.allowedQueryParameters.has(A.toLowerCase()))$.searchParams.set(A,YfA);return $.toString()}sanitizeHeaders(H){let $={};for(let A of Object.keys(H))if(this.allowedHeaderNames.has(A.toLowerCase()))$[A]=H[A];else $[A]=YfA;return $}sanitizeQuery(H){if(typeof H!=="object"||H===null)return H;let $={};for(let A of Object.keys(H))if(this.allowedQueryParameters.has(A.toLowerCase()))$[A]=H[A];else $[A]=YfA;return $}}var YfA="REDACTED",vc0,hc0;var pNH=K(()=>{vc0=["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent","WWW-Authenticate"],hc0=["api-version"]});function wfA(H){if(H instanceof o_)return!0;return zLH(H)&&H.name==="RestError"}var bc0,o_;var ZfA=K(()=>{CfA();rMI();pNH();bc0=new Cy;o_=class o_ extends Error{constructor(H,$={}){super(H);this.name="RestError",this.code=$.code,this.statusCode=$.statusCode,Object.defineProperty(this,"request",{value:$.request,enumerable:!1}),Object.defineProperty(this,"response",{value:$.response,enumerable:!1}),Object.defineProperty(this,nMI,{value:()=>{return`RestError: ${this.message} 
              || ${B} === "boolean" || ${I} === null`).assign(f,z1._`[${I}]`)}}}function $f9({gen:H,parentData:$,parentDataProperty:A},L){H.if(z1._`${$} !== undefined`,()=>H.assign(z1._`${$}[${A}]`,L))}function hXA(H,$,A,L=KFH.Correct){let I=L===KFH.Correct?z1.operators.EQ:z1.operators.NEQ,D;switch(H){case"null":return z1._`${$} ${I} null`;case"array":D=z1._`Array.isArray(${$})`;break;case"object":D=z1._`${$} && typeof ${$} == "object" && !Array.isArray(${$})`;break;case"integer":D=B(z1._`!(${$} % 1) && !isNaN(${$})`);break;case"number":D=B();break;default:return z1._`typeof ${$} ${I} ${H}`}return L===KFH.Correct?D:(0,z1.not)(D);function B(f=z1.nil){return(0,z1.and)(z1._`typeof ${$} == "number"`,f,A?z1._`isFinite(${$})`:z1.nil)}}t6.checkDataType=hXA;function bXA(H,$,A,L){if(H.length===1)return hXA(H[0],$,A,L);let I,D=(0,FCI.toHash)(H);if(D.array&&D.object){let B=z1._`typeof ${$} != "object"`;I=D.null?B:z1._`!${$} || ${B}`,delete D.null,delete D.array,delete D.object}else I=z1.nil;if(D.number)delete D.integer;for(let B in D)I=(0,z1.and)(I,hXA(B,$,A,L));return I}t6.checkDataTypes=bXA;var Af9={message:({schema:H})=>`must be ${H}`,params:({schema:H,schemaValue:$})=>typeof H=="string"?z1._`{type: ${H}}`:z1._`{type: ${$}}`};function kXA(H){let $=Lf9(H);(0,o89.reportError)($,Af9)}t6.reportTypeError=kXA;function Lf9(H){let{gen:$,data:A,schema:L}=H,I=(0,FCI.schemaRefOrVal)(H,L,"type");return{gen:$,keyword:"type",data:A,schema:L.type,schemaCode:I,schemaValue:I,parentSchema:L,params:{},it:H}}});var VCI=z((a4$)=>{Object.defineProperty(a4$,"__esModule",{value:!0});a4$.assignDefaults=void 0;var QFH=u1(),If9=Zf();function Df9(H,$){let{properties:A,items:L}=H.schema;if($==="object"&&A)for(let I in A)WCI(H,I,A[I].default);else if($==="array"&&Array.isArray(L))L.forEach((I,D)=>WCI(H,D,I.default))}a4$.assignDefaults=Df9;function WCI(H,$,A){let{gen:L,compositeRule:I,data:D,opts:B}=H;if(A===void 0)return;let f=QFH._`${D}${(0,QFH.getProperty)($)}`;if(I){(0,If9.checkStrictMode)(H,`default is ignored for: ${f}`);return}let E=QFH._`${f} === undefined`;if(B.useDefaults==="empty")E=QFH._`${E} || ${f} === null || ${f} === ""`;L.if(E,QFH._`${f} = ${(0,QFH.stringify)(A)}`)}});var fT=z((jM)=>{Object.defineProperty(jM,"__esModule",{value:!0});jM.validateUnion=jM.validateArray=jM.usePattern=jM.callValidateCode=jM.schemaProperties=jM.allSchemaProperties=jM.noPropertyInData=jM.propertyInData=jM.isOwnProperty=jM.hasPropFunc=jM.reportMissingProp=jM.checkMissingProp=jM.checkReportMissingProp=void 0;var dU=u1(),uXA=Zf(),dr=ug(),Bf9=Zf();function ff9(H,$){let{gen:A,data:L,it:I}=H;A.if(mXA(A,L,$,I.opts.ownProperties),()=>{H.setParams({missingProperty:dU._`${$}`},!0),H.error()})}jM.checkReportMissingProp=ff9;function Ef9({gen:H,data:$,it:{opts:A}},L,I){return(0,dU.or)(...L.map((D)=>(0,dU.and)(mXA(H,$,D,A.ownProperties),dU._`${I} = ${D}`)))}jM.checkMissingProp=Ef9;function Mf9(H,$){H.setParams({missingProperty:$},!0),H.error()}jM.reportMissingProp=Mf9;function PCI(H){return H.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:dU._`Object.prototype.hasOwnProperty`})}jM.hasPropFunc=PCI;function gXA(H,$,A){return dU._`${PCI(H)}.call(${$}, ${A})`}jM.isOwnProperty=gXA;function Gf9(H,$,A,L){let I=dU._`${$}${(0,dU.getProperty)(A)} !== undefined`;return L?dU._`${I} && ${gXA(H,$,A)}`:I}jM.propertyInData=Gf9;function mXA(H,$,A,L){let I=dU._`${$}${(0,dU.getProperty)(A)} === undefined`;return L?(0,dU.or)(I,(0,dU.not)(gXA(H,$,A))):I}jM.noPropertyInData=mXA;function _CI(H){return H?Object.keys(H).filter(($)=>$!=="__proto__"):[]}jM.allSchemaProperties=_CI;function Uf9(H,$){return _CI($).filter((A)=>!(0,uXA.alwaysValidSchema)(H,$[A]))}jM.schemaProperties=Uf9;function Xf9({schemaCode:H,data:$,it:{gen:A,topSchemaRef:L,schemaPath:I,errorPath:D},it:B},f,E,M){let G=M?dU._`${H}, ${$}, ${L}${I}`:$,U=[[dr.default.instancePath,(0,dU.strConcat)(dr.default.instancePath,D)],[dr.default.parentData,B.parentData],[dr.default.parentDataProperty,B.parentDataProperty],[dr.default.rootData,dr.default.rootData]];if(B.opts.dynamicRef)U.push([dr.default.dynamicAnchors,dr.default.dynamicAnchors]);let X=dU._`${G}, ${A.object(...U)}`;return E!==dU.nil?dU._`${f}.call(${E}, ${X})`:dU._`${f}(${X})`}jM.callValidateCode=Xf9;var Jf9=dU._`new RegExp`;function Ff9({gen:H,it:{opts:$}},A){let L=$.unicodeRegExp?"u":"",{regExp:I}=$.code,D=I(A,L);return H.scopeValue("pattern",{key:D.toString(),ref:D,code:dU._`${I.code==="new RegExp"?Jf9:(0,Bf9.useFunc)(H,I)}(${A}, ${L})`})}jM.usePattern=Ff9;function Kf9(H){let{gen:$,data:A,keyword:L,it:I}=H,D=$.name("valid");if(I.allErrors){let f=$.let("valid",!0);return B(()=>$.assign(f,!1)),f}return $.var(D,!0),B(()=>$.break()),D;function B(f){let E=$.const("len",dU._`${A}.length`);$.forRange("i",0,E,(M)=>{H.subschema({keyword:L,dataProp:M,dataPropType:uXA.Type.Num},D),$.if((0,dU.not)(D),f)})}}jM.validateArray=Kf9;function Qf9(H){let{gen:$,schema:A,keyword:L,it:I}=H;if(!Array.isArray(A))throw Error("ajv implementation error");if(A.some((E)=>(0,uXA.alwaysValidSchema)(I,E))&&!I.opts.unevaluated)return;let B=$.let("valid",!1),f=$.name("_valid");$.block(()=>A.forEach((E,M)=>{let G=H.subschema({keyword:L,schemaProp:M,compositeRule:!0},f);if($.assign(B,dU._`${B} || ${f}`),!H.mergeValidEvaluated(G,f))$.if((0,dU.not)(B))})),H.result(B,()=>H.reset(),()=>H.error(!0))}jM.validateUnion=Qf9});var wCI=z((ey)=>{Object.defineProperty(ey,"__esModule",{value:!0});ey.validateKeywordUsage=ey.validSchemaType=ey.funcKeywordCode=ey.macroKeywordCode=void 0;var HP=u1(),MDH=ug(),Wf9=fT(),Vf9=lSH();function Pf9(H,$){let{gen:A,keyword:L,schema:I,parentSchema:D,it:B}=H,f=$.macro.call(B.self,I,D,B),E=YCI(A,L,f);if(B.opts.validateSchema!==!1)B.self.validateSchema(f,!0);let M=A.name("valid");H.subschema({schema:f,schemaPath:HP.nil,errSchemaPath:`${B.errSchemaPath}/${L}`,topSchemaRef:E,compositeRule:!0},M),H.pass(M,()=>H.error(!0))}ey.macroKeywordCode=Pf9;function _f9(H,$){var A;let{gen:L,keyword:I,schema:D,parentSchema:B,$data:f,it:E}=H;Yf9(E,$);let M=!f&&$.compile?$.compile.call(E.self,D,B,E):$.validate,G=YCI(L,I,M),U=L.let("valid");H.block$data(U,X),H.ok((A=$.valid)!==null&&A!==void 0?A:U);function X(){if($.errors===!1){if(Q(),$.modifying)CCI(H);W(()=>H.error())}else{let P=$.async?J():F();if($.modifying)CCI(H);W(()=>Cf9(H,P))}}function J(){let P=L.let("ruleErrs",null);return L.try(()=>Q(HP._`await `),(Y)=>L.assign(U,!1).if(HP._`${Y} instanceof ${E.ValidationError}`,()=>L.assign(P,HP._`${Y}.errors`),()=>L.throw(Y))),P}function F(){let P=HP._`${G}.errors`;return L.assign(P,null),Q(HP.nil),P}function Q(P=$.async?HP._`await `:HP.nil){let Y=E.opts.passContext?MDH.default.this:MDH.default.self,C=!(("compile"in $)&&!f||$.schema===!1);L.assign(U,HP._`${P}${(0,Wf9.callValidateCode)(H,G,Y,C)}`,$.modifying)}function W(P){var Y;L.if((0,HP.not)((Y=$.valid)!==null&&Y!==void 0?Y:U),P)}}ey.funcKeywordCode=_f9;function CCI(H){let{gen:$,data:A,it:L}=H;$.if(L.parentData,()=>$.assign(A,HP._`${L.parentData}[${L.parentDataProperty}]`))}function Cf9(H,$){let{gen:A}=H;A.if(HP._`Array.isArray(${$})`,()=>{A.assign(MDH.default.vErrors,HP._`${MDH.default.vErrors} === null ? ${$} : ${MDH.default.vErrors}.concat(${$})`).assign(MDH.default.errors,HP._`${MDH.default.vErrors}.length`),(0,Vf9.extendErrors)(H)},()=>H.error())}function Yf9({schemaEnv:H},$){if($.async&&!H.$async)throw Error("async keyword in sync schema")}function YCI(H,$,A){if(A===void 0)throw Error(`keyword "${$}" failed to compile`);return H.scopeValue("keyword",typeof A=="function"?{ref:A}:{ref:A,code:(0,HP.stringify)(A)})}function wf9(H,$,A=!1){return!$.length||$.some((L)=>L==="array"?Array.isArray(H):L==="object"?H&&typeof H=="object"&&!Array.isArray(H):typeof H==L||A&&typeof H>"u")}ey.validSchemaType=wf9;function Zf9({schema:H,opts:$,self:A,errSchemaPath:L},I,D){if(Array.isArray(I.keyword)?!I.keyword.includes(D):I.keyword!==D)throw Error("ajv implementation error");let B=I.dependencies;if(B===null||B===void 0?void 0:B.some((f)=>!Object.prototype.hasOwnProperty.call(H,f)))throw Error(`parent schema must have dependencies of ${D}: ${B.join(",")}`);if(I.validateSchema){if(!I.validateSchema(H[D])){let E=`keyword "${D}" value is invalid at path "${L}": `+A.errorsText(I.validateSchema.errors);if($.validateSchema==="log")A.logger.error(E);else throw Error(E)}}}ey.validateKeywordUsage=Zf9});var qCI=z((cr)=>{Object.defineProperty(cr,"__esModule",{value:!0});cr.extendSubschemaMode=cr.extendSubschemaData=cr.getSubschema=void 0;var Hv=u1(),ZCI=Zf();function qf9(H,{keyword:$,schemaProp:A,schema:L,schemaPath:I,errSchemaPath:D,topSchemaRef:B}){if($!==void 0&&L!==void 0)throw Error('both "keyword" and "schema" passed, only one allowed');if($!==void 0){let f=H.schema[$];return A===void 0?{schema:f,schemaPath:Hv._`${H.schemaPath}${(0,Hv.getProperty)($)}`,errSchemaPath:`${H.errSchemaPath}/${$}`}:{schema:f[A],schemaPath:Hv._`${H.schemaPath}${(0,Hv.getProperty)($)}${(0,Hv.getProperty)(A)}`,errSchemaPath:`${H.errSchemaPath}/${$}/${(0,ZCI.escapeFragment)(A)}`}}if(L!==void 0){if(I===void 0||D===void 0||B===void 0)throw Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:L,schemaPath:I,topSchemaRef:B,errSchemaPath:D}}throw Error('either "keyword" or "schema" must be passed')}cr.getSubschema=qf9;function Tf9(H,$,{dataProp:A,dataPropType:L,data:I,dataTypes:D,propertyName:B}){if(I!==void 0&&A!==void 0)throw Error('both "data" and "dataProp" passed, only one allowed');let{gen:f}=$;if(A!==void 0){let{errorPath:M,dataPathArr:G,opts:U}=$,X=f.let("data",Hv._`${$.data}${(0,Hv.getProperty)(A)}`,!0);E(X),H.errorPath=Hv.str`${M}${(0,ZCI.getErrorPath)(A,L,U.jsPropertySyntax)}`,H.parentDataProperty=Hv._`${A}`,H.dataPathArr=[...G,H.parentDataProperty]}if(I!==void 0){let M=I instanceof Hv.Name?I:f.let("data",I,!0);if(E(M),B!==void 0)H.propertyName=B}if(D)H.dataTypes=D;function E(M){H.data=M,H.dataLevel=$.dataLevel+1,H.dataTypes=[],$.definedProperties=new Set,H.parentData=$.data,H.dataNames=[...$.dataNames,M]}}cr.extendSubschemaData=Tf9;function zf9(H,{jtdDiscriminator:$,jtdMetadata:A,compositeRule:L,createErrors:I,allErrors:D}){if(L!==void 0)H.compositeRule=L;if(I!==void 0)H.createErrors=I;if(D!==void 0)H.allErrors=D;H.jtdDiscriminator=$,H.jtdMetadata=A}cr.extendSubschemaMode=zf9});var pXA=z((U$E,TCI)=>{TCI.exports=function H($,A){if($===A)return!0;if($&&A&&typeof $=="object"&&typeof A=="object"){if($.constructor!==A.constructor)return!1;var L,I,D;if(Array.isArray($)){if(L=$.length,L!=A.length)return!1;for(I=L;I--!==0;)if(!H($[I],A[I]))return!1;return!0}if($.constructor===RegExp)return $.source===A.source&&$.flags===A.flags;if($.valueOf!==Object.prototype.valueOf)return $.valueOf()===A.valueOf();if($.toString!==Object.prototype.toString)return $.toString()===A.toString();if(D=Object.keys($),L=D.length,L!==Object.keys(A).length)return!1;for(I=L;I--!==0;)if(!Object.prototype.hasOwnProperty.call(A,D[I]))return!1;for(I=L;I--!==0;){var B=D[I];if(!H($[B],A[B]))return!1}return!0}return $!==$&&A!==A}});var NCI=z((X$E,zCI)=>{var lr=zCI.exports=function(H,$,A){if(typeof $=="function")A=$,$={};A=$.cb||A;var L=typeof A=="function"?A:A.pre||function(){},I=A.post||function(){};o4$($,L,I,H,"",H)};lr.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};lr.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};lr.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};lr.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function o4$(H,$,A,L,I,D,B,f,E,M){if(L&&typeof L=="object"&&!Array.isArray(L)){$(L,I,D,B,f,E,M);for(var G in L){var U=L[G];if(Array.isArray(U)){if(G in lr.arrayKeywords)for(var X=0;X<U.length;X++)o4$(H,$,A,U[X],I+"/"+G+"/"+X,D,I,G,L,X)}else if(G in lr.propsKeywords){if(U&&typeof U=="object")for(var J in U)o4$(H,$,A,U[J],I+"/"+G+"/"+Nf9(J),D,I,G,L,J)}else if(G in lr.keywords||H.allKeys&&!(G in lr.skipKeywords))o4$(H,$,A,U,I+"/"+G,D,I,G,L)}A(L,I,D,B,f,E,M)}}function Nf9(H){return H.replace(/~/g,"~0").replace(/\//g,"~1")}});var nSH=z((XC)=>{Object.defineProperty(XC,"__esModule",{value:!0});XC.getSchemaRefs=XC.resolveUrl=XC.normalizeId=XC._getFullPath=XC.getFullPath=XC.inlineRef=void 0;var Of9=Zf(),xf9=pXA(),Sf9=NCI(),jf9=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function Rf9(H,$=!0){if(typeof H=="boolean")return!0;if($===!0)return!dXA(H);if(!$)return!1;return OCI(H)<=$}XC.inlineRef=Rf9;var yf9=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function dXA(H){for(let $ in H){if(yf9.has($))return!0;let A=H[$];if(Array.isArray(A)&&A.some(dXA))return!0;if(typeof A=="object"&&dXA(A))return!0}return!1}function OCI(H){let $=0;for(let A in H){if(A==="$ref")return 1/0;if($++,jf9.has(A))continue;if(typeof H[A]=="object")(0,Of9.eachItem)(H[A],(L)=>$+=OCI(L));if($===1/0)return 1/0}return $}function xCI(H,$="",A){if(A!==!1)$=WFH($);let L=H.parse($);return SCI(H,L)}XC.getFullPath=xCI;function SCI(H,$){return H.serialize($).split("#")[0]+"#"}XC._getFullPath=SCI;var vf9=/#\/?$/;function WFH(H){return H?H.replace(vf9,""):""}XC.normalizeId=WFH;function hf9(H,$,A){return A=WFH(A),H.resolve($,A)}XC.resolveUrl=hf9;var bf9=/^[a-z_][-a-z0-9._]*$/i;function kf9(H,$){if(typeof H=="boolean")return{};let{schemaId:A,uriResolver:L}=this.opts,I=WFH(H[A]||$),D={"":I},B=xCI(L,I,!1),f={},E=new Set;return Sf9(H,{allKeys:!0},(U,X,J,F)=>{if(F===void 0)return;let Q=B+X,W=D[F];if(typeof U[A]=="string")W=P.call(this,U[A]);Y.call(this,U.$anchor),Y.call(this,U.$dynamicAnchor),D[X]=W;function P(C){let Z=this.opts.uriResolver.resolve;if(C=WFH(W?Z(W,C):C),E.has(C))throw G(C);E.add(C);let q=this.refs[C];if(typeof q=="string")q=this.refs[q];if(typeof q=="object")M(U,q.schema,C);else if(C!==WFH(Q))if(C[0]==="#")M(U,f[C],C),f[C]=U;else this.refs[C]=Q;return C}function Y(C){if(typeof C=="string"){if(!bf9.test(C))throw Error(`invalid anchor "${C}"`);P.call(this,`#${C}`)}}}),f;function M(U,X,J){if(X!==void 0&&!xf9(U,X))throw G(J)}function G(U){return Error(`reference "${U}" resolves to more than one schema`)}}XC.getSchemaRefs=kf9});var oSH=z((ir)=>{Object.defineProperty(ir,"__esModule",{value:!0});ir.getData=ir.KeywordCxt=ir.validateFunctionCode=void 0;var hCI=UCI(),jCI=iSH(),lXA=vXA(),t4$=iSH(),uf9=VCI(),aSH=wCI(),cXA=qCI(),_B=u1(),Q9=ug(),gf9=nSH(),gg=Zf(),rSH=lSH();function mf9(H){if(uCI(H)){if(gCI(H),kCI(H)){cf9(H);return}}bCI(H,()=>(0,hCI.topBoolOrEmptySchema)(H))}ir.validateFunctionCode=mf9;function bCI({gen:H,validateName:$,schema:A,schemaEnv:L,opts:I},D){if(I.code.es5)H.func($,_B._`${Q9.default.data}, ${Q9.default.valCxt}`,L.$async,()=>{H.code(_B._`"use strict"; ${RCI(A,I)}`),df9(H,I),H.code(D)});else H.func($,_B._`${Q9.default.data}, ${pf9(I)}`,L.$async,()=>H.code(RCI(A,I)).code(D))}function pf9(H){return _B._`{${Q9.default.instancePath}="", ${Q9.default.parentData}, ${Q9.default.parentDataProperty}, ${Q9.default.rootData}=${Q9.default.data}${H.dynamicRef?_B._`, ${Q9.default.dynamicAnchors}={}`:_B.nil}}={}`}function df9(H,$){H.if(Q9.default.valCxt,()=>{if(H.var(Q9.default.instancePath,_B._`${Q9.default.valCxt}.${Q9.default.instancePath}`),H.var(Q9.default.parentData,_B._`${Q9.default.valCxt}.${Q9.default.parentData}`),H.var(Q9.default.parentDataProperty,_B._`${Q9.default.valCxt}.${Q9.default.parentDataProperty}`),H.var(Q9.default.rootData,_B._`${Q9.default.valCxt}.${Q9.default.rootData}`),$.dynamicRef)H.var(Q9.default.dynamicAnchors,_B._`${Q9.default.valCxt}.${Q9.default.dynamicAnchors}`)},()=>{if(H.var(Q9.default.instancePath,_B._`""`),H.var(Q9.default.parentData,_B._`undefined`),H.var(Q9.default.parentDataProperty,_B._`undefined`),H.var(Q9.default.rootData,Q9.default.data),$.dynamicRef)H.var(Q9.default.dynamicAnchors,_B._`{}`)})}function cf9(H){let{schema:$,opts:A,gen:L}=H;bCI(H,()=>{if(A.$comment&&$.$comment)pCI(H);if(af9(H),L.let(Q9.default.vErrors,null),L.let(Q9.default.errors,0),A.unevaluated)lf9(H);mCI(H),sf9(H)});return}function lf9(H){let{gen:$,validateName:A}=H;H.evaluated=$.const("evaluated",_B._`${A}.evaluated`),$.if(_B._`${H.evaluated}.dynamicProps`,()=>$.assign(_B._`${H.evaluated}.props`,_B._`undefined`)),$.if(_B._`${H.evaluated}.dynamicItems`,()=>$.assign(_B._`${H.evaluated}.items`,_B._`undefined`))}function RCI(H,$){let A=typeof H=="object"&&H[$.schemaId];return A&&($.code.source||$.code.process)?_B._`/*# sourceURL=${A} */`:_B.nil}function if9(H,$){if(uCI(H)){if(gCI(H),kCI(H)){nf9(H,$);return}}(0,hCI.boolOrEmptySchema)(H,$)}function kCI({schema:H,self:$}){if(typeof H=="boolean")return!H;for(let A in H)if($.RULES.all[A])return!0;return!1}function uCI(H){return typeof H.schema!="boolean"}function nf9(H,$){let{schema:A,gen:L,opts:I}=H;if(I.$comment&&A.$comment)pCI(H);of9(H),tf9(H);let D=L.const("_errs",Q9.default.errors);mCI(H,D),L.var($,_B._`${D} === ${Q9.default.errors}`)}function gCI(H){(0,gg.checkUnknownRules)(H),rf9(H)}function mCI(H,$){if(H.opts.jtd)return yCI(H,[],!1,$);let A=(0,jCI.getSchemaTypes)(H.schema),L=(0,jCI.coerceAndCheckDataType)(H,A);yCI(H,A,!L,$)}function rf9(H){let{schema:$,errSchemaPath:A,opts:L,self:I}=H;if($.$ref&&L.ignoreKeywordsWithRef&&(0,gg.schemaHasRulesButRef)($,I.RULES))I.logger.warn(`$ref: keywords ignored in schema at path "${A}"`)}function af9(H){let{schema:$,opts:A}=H;if($.default!==void 0&&A.useDefaults&&A.strictSchema)(0,gg.checkStrictMode)(H,"default is ignored in the schema root")}function of9(H){let $=H.schema[H.opts.schemaId];if($)H.baseId=(0,gf9.resolveUrl)(H.opts.uriResolver,H.baseId,$)}function tf9(H){if(H.schema.$async&&!H.schemaEnv.$async)throw Error("async schema in sync schema")}function pCI({gen:H,schemaEnv:$,schema:A,errSchemaPath:L,opts:I}){let D=A.$comment;if(I.$comment===!0)H.code(_B._`${Q9.default.self}.logger.log(${D})`);else if(typeof I.$comment=="function"){let B=_B.str`${L}/$comment`,f=H.scopeValue("root",{ref:$.root});H.code(_B._`${Q9.default.self}.opts.$comment(${D}, ${B}, ${f}.schema)`)}}function sf9(H){let{gen:$,schemaEnv:A,validateName:L,ValidationError:I,opts:D}=H;if(A.$async)$.if(_B._`${Q9.default.errors} === 0`,()=>$.return(Q9.default.data),()=>$.throw(_B._`new ${I}(${Q9.default.vErrors})`));else{if($.assign(_B._`${L}.errors`,Q9.default.vErrors),D.unevaluated)ef9(H);$.return(_B._`${Q9.default.errors} === 0`)}}function ef9({gen:H,evaluated:$,props:A,items:L}){if(A instanceof _B.Name)H.assign(_B._`${$}.props`,A);if(L instanceof _B.Name)H.assign(_B._`${$}.items`,L)}function yCI(H,$,A,L){let{gen:I,schema:D,data:B,allErrors:f,opts:E,self:M}=H,{RULES:G}=M;if(D.$ref&&(E.ignoreKeywordsWithRef||!(0,gg.schemaHasRulesButRef)(D,G))){I.block(()=>cCI(H,"$ref",G.all.$ref.definition));return}if(!E.jtd)HE9(H,$);I.block(()=>{for(let X of G.rules)U(X);U(G.post)});function U(X){if(!(0,lXA.shouldUseGroup)(D,X))return;if(X.type){if(I.if((0,t4$.checkDataType)(X.type,B,E.strictNumbers)),vCI(H,X),$.length===1&&$[0]===X.type&&A)I.else(),(0,t4$.reportTypeError)(H);I.endIf()}else vCI(H,X);if(!f)I.if(_B._`${Q9.default.errors} === ${L||0}`)}}function vCI(H,$){let{gen:A,schema:L,opts:{useDefaults:I}}=H;if(I)(0,uf9.assignDefaults)(H,$.type);A.block(()=>{for(let D of $.rules)if((0,lXA.shouldUseRule)(L,D))cCI(H,D.keyword,D.definition,$.type)})}function HE9(H,$){if(H.schemaEnv.meta||!H.opts.strictTypes)return;if($E9(H,$),!H.opts.allowUnionTypes)AE9(H,$);LE9(H,H.dataTypes)}function $E9(H,$){if(!$.length)return;if(!H.dataTypes.length){H.dataTypes=$;return}$.forEach((A)=>{if(!dCI(H.dataTypes,A))iXA(H,`type "${A}" not allowed by context "${H.dataTypes.join(",")}"`)}),DE9(H,$)}function AE9(H,$){if($.length>1&&!($.length===2&&$.includes("null")))iXA(H,"use allowUnionTypes to allow union type keyword")}function LE9(H,$){let A=H.self.RULES.all;for(let L in A){let I=A[L];if(typeof I=="object"&&(0,lXA.shouldUseRule)(H.schema,I)){let{type:D}=I.definition;if(D.length&&!D.some((B)=>IE9($,B)))iXA(H,`missing type "${D.join(",")}" for keyword "${L}"`)}}}function IE9(H,$){return H.includes($)||$==="number"&&H.includes("integer")}function dCI(H,$){return H.includes($)||$==="integer"&&H.includes("number")}function DE9(H,$){let A=[];for(let L of H.dataTypes)if(dCI($,L))A.push(L);else if($.includes("integer")&&L==="number")A.push("integer");H.dataTypes=A}function iXA(H,$){let A=H.schemaEnv.baseId+H.errSchemaPath;$+=` at "${A}" (strictTypes)`,(0,gg.checkStrictMode)(H,$,H.opts.strictTypes)}class nXA{constructor(H,$,A){if((0,aSH.validateKeywordUsage)(H,$,A),this.gen=H.gen,this.allErrors=H.allErrors,this.keyword=A,this.data=H.data,this.schema=H.schema[A],this.$data=$.$data&&H.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,gg.schemaRefOrVal)(H,this.schema,A,this.$data),this.schemaType=$.schemaType,this.parentSchema=H.schema,this.params={},this.it=H,this.def=$,this.$data)this.schemaCode=H.gen.const("vSchema",lCI(this.$data,H));else if(this.schemaCode=this.schemaValue,!(0,aSH.validSchemaType)(this.schema,$.schemaType,$.allowUndefined))throw Error(`${A} value must be ${JSON.stringify($.schemaType)}`);if("code"in $?$.trackErrors:$.errors!==!1)this.errsCount=H.gen.const("_errs",Q9.default.errors)}result(H,$,A){this.failResult((0,_B.not)(H),$,A)}failResult(H,$,A){if(this.gen.if(H),A)A();else this.error();if($){if(this.gen.else(),$(),this.allErrors)this.gen.endIf()}else if(this.allErrors)this.gen.endIf();else this.gen.else()}pass(H,$){this.failResult((0,_B.not)(H),void 0,$)}fail(H){if(H===void 0){if(this.error(),!this.allErrors)this.gen.if(!1);return}if(this.gen.if(H),this.error(),this.allErrors)this.gen.endIf();else this.gen.else()}fail$data(H){if(!this.$data)return this.fail(H);let{schemaCode:$}=this;this.fail(_B._`${$} !== undefined && (${(0,_B.or)(this.invalid$data(),H)})`)}error(H,$,A){if($){this.setParams($),this._error(H,A),this.setParams({});return}this._error(H,A)}_error(H,$){(H?rSH.reportExtraError:rSH.reportError)(this,this.def.error,$)}$dataError(){(0,rSH.reportError)(this,this.def.$dataError||rSH.keyword$DataError)}reset(){if(this.errsCount===void 0)throw Error('add "trackErrors" to keyword definition');(0,rSH.resetErrorsCount)(this.gen,this.errsCount)}ok(H){if(!this.allErrors)this.gen.if(H)}setParams(H,$){if($)Object.assign(this.params,H);else this.params=H}block$data(H,$,A=_B.nil){this.gen.block(()=>{this.check$data(H,A),$()})}check$data(H=_B.nil,$=_B.nil){if(!this.$data)return;let{gen:A,schemaCode:L,schemaType:I,def:D}=this;if(A.if((0,_B.or)(_B._`${L} === undefined`,$)),H!==_B.nil)A.assign(H,!0);if(I.length||D.validateSchema){if(A.elseIf(this.invalid$data()),this.$dataError(),H!==_B.nil)A.assign(H,!1)}A.else()}invalid$data(){let{gen:H,schemaCode:$,schemaType:A,def:L,it:I}=this;return(0,_B.or)(D(),B());function D(){if(A.length){if(!($ instanceof _B.Name))throw Error("ajv implementation error");let f=Array.isArray(A)?A:[A];return _B._`${(0,t4$.checkDataTypes)(f,$,I.opts.strictNumbers,t4$.DataType.Wrong)}`}return _B.nil}function B(){if(L.validateSchema){let f=H.scopeValue("validate$data",{ref:L.validateSchema});return _B._`!${f}(${$})`}return _B.nil}}subschema(H,$){let A=(0,cXA.getSubschema)(this.it,H);(0,cXA.extendSubschemaData)(A,this.it,H),(0,cXA.extendSubschemaMode)(A,H);let L={...this.it,...A,items:void 0,props:void 0};return if9(L,$),L}mergeEvaluated(H,$){let{it:A,gen:L}=this;if(!A.opts.unevaluated)return;if(A.props!==!0&&H.props!==void 0)A.props=gg.mergeEvaluated.props(L,H.props,A.props,$);if(A.items!==!0&&H.items!==void 0)A.items=gg.mergeEvaluated.items(L,H.items,A.items,$)}mergeValidEvaluated(H,$){let{it:A,gen:L}=this;if(A.opts.unevaluated&&(A.props!==!0||A.items!==!0))return L.if($,()=>this.mergeEvaluated(H,_B.Name)),!0}}ir.KeywordCxt=nXA;function cCI(H,$,A,L){let I=new nXA(H,A,$);if("code"in A)A.code(I,L);else if(I.$data&&A.validate)(0,aSH.funcKeywordCode)(I,A);else if("macro"in A)(0,aSH.macroKeywordCode)(I,A);else if(A.compile||A.validate)(0,aSH.funcKeywordCode)(I,A)}var BE9=/^\/(?:[^~]|~0|~1)*$/,fE9=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function lCI(H,{dataLevel:$,dataNames:A,dataPathArr:L}){let I,D;if(H==="")return Q9.default.rootData;if(H[0]==="/"){if(!BE9.test(H))throw Error(`Invalid JSON-pointer: ${H}`);I=H,D=Q9.default.rootData}else{let M=fE9.exec(H);if(!M)throw Error(`Invalid JSON-pointer: ${H}`);let G=+M[1];if(I=M[2],I==="#"){if(G>=$)throw Error(E("property/index",G));return L[$-G]}if(G>$)throw Error(E("data",G));if(D=A[$-G],!I)return D}let B=D,f=I.split("/");for(let M of f)if(M)D=_B._`${D}${(0,_B.getProperty)((0,gg.unescapeJsonPointer)(M))}`,B=_B._`${B} && ${D}`;return B;function E(M,G){return`Cannot access ${M} ${G} levels up, current level is ${$}`}}ir.getData=lCI});var s4$=z((rXA)=>{Object.defineProperty(rXA,"__esModule",{value:!0});class iCI extends Error{constructor(H){super("validation failed");this.errors=H,this.ajv=this.validation=!0}}rXA.default=iCI});var tSH=z((oXA)=>{Object.defineProperty(oXA,"__esModule",{value:!0});var aXA=nSH();class nCI extends Error{constructor(H,$,A,L){super(L||`can't resolve reference ${A} from id ${$}`);this.missingRef=(0,aXA.resolveUrl)(H,$,A),this.missingSchema=(0,aXA.normalizeId)((0,aXA.getFullPath)(H,this.missingRef))}}oXA.default=nCI});var H5$=z((ET)=>{Object.defineProperty(ET,"__esModule",{value:!0});ET.resolveSchema=ET.getCompilingSchema=ET.resolveRef=ET.compileSchema=ET.SchemaEnv=void 0;var Ix=u1(),EE9=s4$(),GDH=ug(),Dx=nSH(),rCI=Zf(),ME9=oSH();class sSH{constructor(H){var $;this.refs={},this.dynamicAnchors={};let A;if(typeof H.schema=="object")A=H.schema;this.schema=H.schema,this.schemaId=H.schemaId,this.root=H.root||this,this.baseId=($=H.baseId)!==null&&$!==void 0?$:(0,Dx.normalizeId)(A===null||A===void 0?void 0:A[H.schemaId||"$id"]),this.schemaPath=H.schemaPath,this.localRefs=H.localRefs,this.meta=H.meta,this.$async=A===null||A===void 0?void 0:A.$async,this.refs={}}}ET.SchemaEnv=sSH;function sXA(H){let $=aCI.call(this,H);if($)return $;let A=(0,Dx.getFullPath)(this.opts.uriResolver,H.root.baseId),{es5:L,lines:I}=this.opts.code,{ownProperties:D}=this.opts,B=new Ix.CodeGen(this.scope,{es5:L,lines:I,ownProperties:D}),f;if(H.$async)f=B.scopeValue("Error",{ref:EE9.default,code:Ix._`require("ajv/dist/runtime/validation_error").default`});let E=B.scopeName("validate");H.validateName=E;let M={gen:B,allErrors:this.opts.allErrors,data:GDH.default.data,parentData:GDH.default.parentData,parentDataProperty:GDH.default.parentDataProperty,dataNames:[GDH.default.data],dataPathArr:[Ix.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:B.scopeValue("schema",this.opts.code.source===!0?{ref:H.schema,code:(0,Ix.stringify)(H.schema)}:{ref:H.schema}),validateName:E,ValidationError:f,schema:H.schema,schemaEnv:H,rootId:A,baseId:H.baseId||A,schemaPath:Ix.nil,errSchemaPath:H.schemaPath||(this.opts.jtd?"":"#"),errorPath:Ix._`""`,opts:this.opts,self:this},G;try{this._compilations.add(H),(0,ME9.validateFunctionCode)(M),B.optimize(this.opts.code.optimize);let U=B.toString();if(G=`${B.scopeRefs(GDH.default.scope)}return ${U}`,this.opts.code.process)G=this.opts.code.process(G,H);let J=Function(`${GDH.default.self}`,`${GDH.default.scope}`,G)(this,this.scope.get());if(this.scope.value(E,{ref:J}),J.errors=null,J.schema=H.schema,J.schemaEnv=H,H.$async)J.$async=!0;if(this.opts.code.source===!0)J.source={validateName:E,validateCode:U,scopeValues:B._values};if(this.opts.unevaluated){let{props:F,items:Q}=M;if(J.evaluated={props:F instanceof Ix.Name?void 0:F,items:Q instanceof Ix.Name?void 0:Q,dynamicProps:F instanceof Ix.Name,dynamicItems:Q instanceof Ix.Name},J.source)J.source.evaluated=(0,Ix.stringify)(J.evaluated)}return H.validate=J,H}catch(U){if(delete H.validate,delete H.validateName,G)this.logger.error("Error compiling schema, function code:",G);throw U}finally{this._compilations.delete(H)}}ET.compileSchema=sXA;function GE9(H,$,A){var L;A=(0,Dx.resolveUrl)(this.opts.uriResolver,$,A);let I=H.refs[A];if(I)return I;let D=JE9.call(this,H,A);if(D===void 0){let B=(L=H.localRefs)===null||L===void 0?void 0:L[A],{schemaId:f}=this.opts;if(B)D=new sSH({schema:B,schemaId:f,root:H,baseId:$})}if(D===void 0)return;return H.refs[A]=UE9.call(this,D)}ET.resolveRef=GE9;function UE9(H){if((0,Dx.inlineRef)(H.schema,this.opts.inlineRefs))return H.schema;return H.validate?H:sXA.call(this,H)}function aCI(H){for(let $ of this._compilations)if(XE9($,H))return $}ET.getCompilingSchema=aCI;function XE9(H,$){return H.schema===$.schema&&H.root===$.root&&H.baseId===$.baseId}function JE9(H,$){let A;while(typeof(A=this.refs[$])=="string")$=A;return A||this.schemas[$]||e4$.call(this,H,$)}function e4$(H,$){let A=this.opts.uriResolver.parse($),L=(0,Dx._getFullPath)(this.opts.uriResolver,A),I=(0,Dx.getFullPath)(this.opts.uriResolver,H.baseId,void 0);if(Object.keys(H.schema).length>0&&L===I)return tXA.call(this,A,H);let D=(0,Dx.normalizeId)(L),B=this.refs[D]||this.schemas[D];if(typeof B=="string"){let f=e4$.call(this,H,B);if(typeof(f===null||f===void 0?void 0:f.schema)!=="object")return;return tXA.call(this,A,f)}if(typeof(B===null||B===void 0?void 0:B.schema)!=="object")return;if(!B.validate)sXA.call(this,B);if(D===(0,Dx.normalizeId)($)){let{schema:f}=B,{schemaId:E}=this.opts,M=f[E];if(M)I=(0,Dx.resolveUrl)(this.opts.uriResolver,I,M);return new sSH({schema:f,schemaId:E,root:H,baseId:I})}return tXA.call(this,A,B)}ET.resolveSchema=e4$;var FE9=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function tXA(H,{baseId:$,schema:A,root:L}){var I;if(((I=H.fragment)===null||I===void 0?void 0:I[0])!=="/")return;for(let f of H.fragment.slice(1).split("/")){if(typeof A==="boolean")return;let E=A[(0,rCI.unescapeFragment)(f)];if(E===void 0)return;A=E;let M=typeof A==="object"&&A[this.opts.schemaId];if(!FE9.has(f)&&M)$=(0,Dx.resolveUrl)(this.opts.uriResolver,$,M)}let D;if(typeof A!="boolean"&&A.$ref&&!(0,rCI.schemaHasRulesButRef)(A,this.RULES)){let f=(0,Dx.resolveUrl)(this.opts.uriResolver,$,A.$ref);D=e4$.call(this,L,f)}let{schemaId:B}=this.opts;if(D=D||new sSH({schema:A,schemaId:B,root:L,baseId:$}),D.schema!==D.root.schema)return D;return}});var oCI=z((V$E,KE9)=>{KE9.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var sCI=z((P$E,tCI)=>{var QE9={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};tCI.exports={HEX:QE9}});var BYI=z((_$E,DYI)=>{var{HEX:WE9}=sCI(),VE9=/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u;function AYI(H){if(IYI(H,".")<3)return{host:H,isIPV4:!1};let $=H.match(VE9)||[],[A]=$;if(A)return{host:_E9(A,"."),isIPV4:!0};else return{host:H,isIPV4:!1}}function eXA(H,$=!1){let A="",L=!0;for(let I of H){if(WE9[I]===void 0)return;if(I!=="0"&&L===!0)L=!1;if(!L)A+=I}if($&&A.length===0)A="0";return A}function PE9(H){let $=0,A={error:!1,address:"",zone:""},L=[],I=[],D=!1,B=!1,f=!1;function E(){if(I.length){if(D===!1){let M=eXA(I);if(M!==void 0)L.push(M);else return A.error=!0,!1}I.length=0}return!0}for(let M=0;M<H.length;M++){let G=H[M];if(G==="["||G==="]")continue;if(G===":"){if(B===!0)f=!0;if(!E())break;if($++,L.push(":"),$>7){A.error=!0;break}if(M-1>=0&&H[M-1]===":")B=!0;continue}else if(G==="%"){if(!E())break;D=!0}else{I.push(G);continue}}if(I.length)if(D)A.zone=I.join("");else if(f)L.push(I.join(""));else L.push(eXA(I));return A.address=L.join(""),A}function LYI(H){if(IYI(H,":")<2)return{host:H,isIPV6:!1};let $=PE9(H);if(!$.error){let{address:A,address:L}=$;if($.zone)A+="%"+$.zone,L+="%25"+$.zone;return{host:A,escapedHost:L,isIPV6:!0}}else return{host:H,isIPV6:!1}}function _E9(H,$){let A="",L=!0,I=H.length;for(let D=0;D<I;D++){let B=H[D];if(B==="0"&&L){if(D+1<=I&&H[D+1]===$||D+1===I)A+=B,L=!1}else{if(B===$)L=!0;else L=!1;A+=B}}return A}function IYI(H,$){let A=0;for(let L=0;L<H.length;L++)if(H[L]===$)A++;return A}var eCI=/^\.\.?\//u,HYI=/^\/\.(?:\/|$)/u,$YI=/^\/\.\.(?:\/|$)/u,CE9=/^\/?(?:.|\n)*?(?=\/|$)/u;function YE9(H){let $=[];while(H.length)if(H.match(eCI))H=H.replace(eCI,"");else if(H.match(HYI))H=H.replace(HYI,"/");else if(H.match($YI))H=H.replace($YI,"/"),$.pop();else if(H==="."||H==="..")H="";else{let A=H.match(CE9);if(A){let L=A[0];H=H.slice(L.length),$.push(L)}else throw Error("Unexpected dot segment condition")}return $.join("")}function wE9(H,$){let A=$!==!0?escape:unescape;if(H.scheme!==void 0)H.scheme=A(H.scheme);if(H.userinfo!==void 0)H.userinfo=A(H.userinfo);if(H.host!==void 0)H.host=A(H.host);if(H.path!==void 0)H.path=A(H.path);if(H.query!==void 0)H.query=A(H.query);if(H.fragment!==void 0)H.fragment=A(H.fragment);return H}function ZE9(H){let $=[];if(H.userinfo!==void 0)$.push(H.userinfo),$.push("@");if(H.host!==void 0){let A=unescape(H.host),L=AYI(A);if(L.isIPV4)A=L.host;else{let I=LYI(L.host);if(I.isIPV6===!0)A=`[${I.escapedHost}]`;else A=H.host}$.push(A)}if(typeof H.port==="number"||typeof H.port==="string")$.push(":"),$.push(String(H.port));return $.length?$.join(""):void 0}DYI.exports={recomposeAuthority:ZE9,normalizeComponentEncoding:wE9,removeDotSegments:YE9,normalizeIPv4:AYI,normalizeIPv6:LYI,stringArrayToHexStripped:eXA}});var XYI=z((C$E,UYI)=>{var qE9=/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu,TE9=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu;function fYI(H){return typeof H.secure==="boolean"?H.secure:String(H.scheme).toLowerCase()==="wss"}function EYI(H){if(!H.host)H.error=H.error||"HTTP URIs must have a host.";return H}function MYI(H){let $=String(H.scheme).toLowerCase()==="https";if(H.port===($?443:80)||H.port==="")H.port=void 0;if(!H.path)H.path="/";return H}function zE9(H){return H.secure=fYI(H),H.resourceName=(H.path||"/")+(H.query?"?"+H.query:""),H.path=void 0,H.query=void 0,H}function NE9(H){if(H.port===(fYI(H)?443:80)||H.port==="")H.port=void 0;if(typeof H.secure==="boolean")H.scheme=H.secure?"wss":"ws",H.secure=void 0;if(H.resourceName){let[$,A]=H.resourceName.split("?");H.path=$&&$!=="/"?$:void 0,H.query=A,H.resourceName=void 0}return H.fragment=void 0,H}function OE9(H,$){if(!H.path)return H.error="URN can not be parsed",H;let A=H.path.match(TE9);if(A){let L=$.scheme||H.scheme||"urn";H.nid=A[1].toLowerCase(),H.nss=A[2];let I=`${L}:${$.nid||H.nid}`,D=HJA[I];if(H.path=void 0,D)H=D.parse(H,$)}else H.error=H.error||"URN can not be parsed.";return H}function xE9(H,$){let A=$.scheme||H.scheme||"urn",L=H.nid.toLowerCase(),I=`${A}:${$.nid||L}`,D=HJA[I];if(D)H=D.serialize(H,$);let B=H,f=H.nss;return B.path=`${L||$.nid}:${f}`,$.skipEscape=!0,B}function SE9(H,$){let A=H;if(A.uuid=A.nss,A.nss=void 0,!$.tolerant&&(!A.uuid||!qE9.test(A.uuid)))A.error=A.error||"UUID is not valid.";return A}function jE9(H){let $=H;return $.nss=(H.uuid||"").toLowerCase(),$}var GYI={scheme:"http",domainHost:!0,parse:EYI,serialize:MYI},RE9={scheme:"https",domainHost:GYI.domainHost,parse:EYI,serialize:MYI},$5$={scheme:"ws",domainHost:!0,parse:zE9,serialize:NE9},yE9={scheme:"wss",domainHost:$5$.domainHost,parse:$5$.parse,serialize:$5$.serialize},vE9={scheme:"urn",parse:OE9,serialize:xE9,skipNormalize:!0},hE9={scheme:"urn:uuid",parse:SE9,serialize:jE9,skipNormalize:!0},HJA={http:GYI,https:RE9,ws:$5$,wss:yE9,urn:vE9,"urn:uuid":hE9};UYI.exports=HJA});var FYI=z((Y$E,L5$)=>{var{normalizeIPv6:bE9,normalizeIPv4:kE9,removeDotSegments:eSH,recomposeAuthority:uE9,normalizeComponentEncoding:A5$}=BYI(),$JA=XYI();function gE9(H,$){if(typeof H==="string")H=$v(mg(H,$),$);else if(typeof H==="object")H=mg($v(H,$),$);return H}function mE9(H,$,A){let L=Object.assign({scheme:"null"},A),I=JYI(mg(H,L),mg($,L),L,!0);return $v(I,{...L,skipEscape:!0})}function JYI(H,$,A,L){let I={};if(!L)H=mg($v(H,A),A),$=mg($v($,A),A);if(A=A||{},!A.tolerant&&$.scheme)I.scheme=$.scheme,I.userinfo=$.userinfo,I.host=$.host,I.port=$.port,I.path=eSH($.path||""),I.query=$.query;else{if($.userinfo!==void 0||$.host!==void 0||$.port!==void 0)I.userinfo=$.userinfo,I.host=$.host,I.port=$.port,I.path=eSH($.path||""),I.query=$.query;else{if(!$.path)if(I.path=H.path,$.query!==void 0)I.query=$.query;else I.query=H.query;else{if($.path.charAt(0)==="/")I.path=eSH($.path);else{if((H.userinfo!==void 0||H.host!==void 0||H.port!==void 0)&&!H.path)I.path="/"+$.path;else if(!H.path)I.path=$.path;else I.path=H.path.slice(0,H.path.lastIndexOf("/")+1)+$.path;I.path=eSH(I.path)}I.query=$.query}I.userinfo=H.userinfo,I.host=H.host,I.port=H.port}I.scheme=H.scheme}return I.fragment=$.fragment,I}function pE9(H,$,A){if(typeof H==="string")H=unescape(H),H=$v(A5$(mg(H,A),!0),{...A,skipEscape:!0});else if(typeof H==="object")H=$v(A5$(H,!0),{...A,skipEscape:!0});if(typeof $==="string")$=unescape($),$=$v(A5$(mg($,A),!0),{...A,skipEscape:!0});else if(typeof $==="object")$=$v(A5$($,!0),{...A,skipEscape:!0});return H.toLowerCase()===$.toLowerCase()}function $v(H,$){let A={host:H.host,scheme:H.scheme,userinfo:H.userinfo,port:H.port,path:H.path,query:H.query,nid:H.nid,nss:H.nss,uuid:H.uuid,fragment:H.fragment,reference:H.reference,resourceName:H.resourceName,secure:H.secure,error:""},L=Object.assign({},$),I=[],D=$JA[(L.scheme||A.scheme||"").toLowerCase()];if(D&&D.serialize)D.serialize(A,L);if(A.path!==void 0)if(!L.skipEscape){if(A.path=escape(A.path),A.scheme!==void 0)A.path=A.path.split("%3A").join(":")}else A.path=unescape(A.path);if(L.reference!=="suffix"&&A.scheme)I.push(A.scheme,":");let B=uE9(A);if(B!==void 0){if(L.reference!=="suffix")I.push("//");if(I.push(B),A.path&&A.path.charAt(0)!=="/")I.push("/")}if(A.path!==void 0){let f=A.path;if(!L.absolutePath&&(!D||!D.absolutePath))f=eSH(f);if(B===void 0)f=f.replace(/^\/\//u,"/%2F");I.push(f)}if(A.query!==void 0)I.push("?",A.query);if(A.fragment!==void 0)I.push("#",A.fragment);return I.join("")}var dE9=Array.from({length:127},(H,$)=>/[^!"$&'()*+,\-.;=_`a-z{}~]/u.test(String.fromCharCode($)));function cE9(H){let $=0;for(let A=0,L=H.length;A<L;++A)if($=H.charCodeAt(A),$>126||dE9[$])return!0;return!1}var lE9=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function mg(H,$){let A=Object.assign({},$),L={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},I=H.indexOf("%")!==-1,D=!1;if(A.reference==="suffix")H=(A.scheme?A.scheme+":":"")+"//"+H;let B=H.match(lE9);if(B){if(L.scheme=B[1],L.userinfo=B[3],L.host=B[4],L.port=parseInt(B[5],10),L.path=B[6]||"",L.query=B[7],L.fragment=B[8],isNaN(L.port))L.port=B[5];if(L.host){let E=kE9(L.host);if(E.isIPV4===!1){let M=bE9(E.host);L.host=M.host.toLowerCase(),D=M.isIPV6}else L.host=E.host,D=!0}if(L.scheme===void 0&&L.userinfo===void 0&&L.host===void 0&&L.port===void 0&&L.query===void 0&&!L.path)L.reference="same-document";else if(L.scheme===void 0)L.reference="relative";else if(L.fragment===void 0)L.reference="absolute";else L.reference="uri";if(A.reference&&A.reference!=="suffix"&&A.reference!==L.reference)L.error=L.error||"URI is not a "+A.reference+" reference.";let f=$JA[(A.scheme||L.scheme||"").toLowerCase()];if(!A.unicodeSupport&&(!f||!f.unicodeSupport)){if(L.host&&(A.domainHost||f&&f.domainHost)&&D===!1&&cE9(L.host))try{L.host=URL.domainToASCII(L.host.toLowerCase())}catch(E){L.error=L.error||"Host's domain name can not be converted to ASCII: "+E}}if(!f||f&&!f.skipNormalize){if(I&&L.scheme!==void 0)L.scheme=unescape(L.scheme);if(I&&L.host!==void 0)L.host=unescape(L.host);if(L.path)L.path=escape(unescape(L.path));if(L.fragment)L.fragment=encodeURI(decodeURIComponent(L.fragment))}if(f&&f.parse)f.parse(L,A)}else L.error=L.error||"URI can not be parsed.";return L}var AJA={SCHEMES:$JA,normalize:gE9,resolve:mE9,resolveComponents:JYI,equal:pE9,serialize:$v,parse:mg};L5$.exports=AJA;L5$.exports.default=AJA;L5$.exports.fastUri=AJA});var QYI=z((LJA)=>{Object.defineProperty(LJA,"__esModule",{value:!0});var KYI=FYI();KYI.code='require("ajv/dist/runtime/uri").default';LJA.default=KYI});var ZYI=z((B7)=>{Object.defineProperty(B7,"__esModule",{value:!0});B7.CodeGen=B7.Name=B7.nil=B7.stringify=B7.str=B7._=B7.KeywordCxt=void 0;var iE9=oSH();Object.defineProperty(B7,"KeywordCxt",{enumerable:!0,get:function(){return iE9.KeywordCxt}});var VFH=u1();Object.defineProperty(B7,"_",{enumerable:!0,get:function(){return VFH._}});Object.defineProperty(B7,"str",{enumerable:!0,get:function(){return VFH.str}});Object.defineProperty(B7,"stringify",{enumerable:!0,get:function(){return VFH.stringify}});Object.defineProperty(B7,"nil",{enumerable:!0,get:function(){return VFH.nil}});Object.defineProperty(B7,"Name",{enumerable:!0,get:function(){return VFH.Name}});Object.defineProperty(B7,"CodeGen",{enumerable:!0,get:function(){return VFH.CodeGen}});var nE9=s4$(),CYI=tSH(),rE9=yXA(),HjH=H5$(),aE9=u1(),$jH=nSH(),I5$=iSH(),DJA=Zf(),WYI=oCI(),oE9=QYI(),YYI=(H,$)=>new RegExp(H,$);YYI.code="new RegExp";var tE9=["removeAdditional","useDefaults","coerceTypes"],sE9=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),eE9={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},HM9={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},VYI=200;function $M9(H){var $,A,L,I,D,B,f,E,M,G,U,X,J,F,Q,W,P,Y,C,Z,q,O,j,u,y;let g=H.strict,v=($=H.code)===null||$===void 0?void 0:$.optimize,p=v===!0||v===void 0?1:v||0,d=(L=(A=H.code)===null||A===void 0?void 0:A.regExp)!==null&&L!==void 0?L:YYI,k=(I=H.uriResolver)!==null&&I!==void 0?I:oE9.default;return{strictSchema:(B=(D=H.strictSchema)!==null&&D!==void 0?D:g)!==null&&B!==void 0?B:!0,strictNumbers:(E=(f=H.strictNumbers)!==null&&f!==void 0?f:g)!==null&&E!==void 0?E:!0,strictTypes:(G=(M=H.strictTypes)!==null&&M!==void 0?M:g)!==null&&G!==void 0?G:"log",strictTuples:(X=(U=H.strictTuples)!==null&&U!==void 0?U:g)!==null&&X!==void 0?X:"log",strictRequired:(F=(J=H.strictRequired)!==null&&J!==void 0?J:g)!==null&&F!==void 0?F:!1,code:H.code?{...H.code,optimize:p,regExp:d}:{optimize:p,regExp:d},loopRequired:(Q=H.loopRequired)!==null&&Q!==void 0?Q:VYI,loopEnum:(W=H.loopEnum)!==null&&W!==void 0?W:VYI,meta:(P=H.meta)!==null&&P!==void 0?P:!0,messages:(Y=H.messages)!==null&&Y!==void 0?Y:!0,inlineRefs:(C=H.inlineRefs)!==null&&C!==void 0?C:!0,schemaId:(Z=H.schemaId)!==null&&Z!==void 0?Z:"$id",addUsedSchema:(q=H.addUsedSchema)!==null&&q!==void 0?q:!0,validateSchema:(O=H.validateSchema)!==null&&O!==void 0?O:!0,validateFormats:(j=H.validateFormats)!==null&&j!==void 0?j:!0,unicodeRegExp:(u=H.unicodeRegExp)!==null&&u!==void 0?u:!0,int32range:(y=H.int32range)!==null&&y!==void 0?y:!0,uriResolver:k}}class D5${constructor(H={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,H=this.opts={...H,...$M9(H)};let{es5:$,lines:A}=this.opts.code;this.scope=new aE9.ValueScope({scope:{},prefixes:sE9,es5:$,lines:A}),this.logger=fM9(H.logger);let L=H.validateFormats;if(H.validateFormats=!1,this.RULES=(0,rE9.getRules)(),PYI.call(this,eE9,H,"NOT SUPPORTED"),PYI.call(this,HM9,H,"DEPRECATED","warn"),this._metaOpts=DM9.call(this),H.formats)LM9.call(this);if(this._addVocabularies(),this._addDefaultMetaSchema(),H.keywords)IM9.call(this,H.keywords);if(typeof H.meta=="object")this.addMetaSchema(H.meta);AM9.call(this),H.validateFormats=L}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:H,meta:$,schemaId:A}=this.opts,L=WYI;if(A==="id")L={...WYI},L.id=L.$id,delete L.$id;if($&&H)this.addMetaSchema(L,L[A],!1)}defaultMeta(){let{meta:H,schemaId:$}=this.opts;return this.opts.defaultMeta=typeof H=="object"?H[$]||H:void 0}validate(H,$){let A;if(typeof H=="string"){if(A=this.getSchema(H),!A)throw Error(`no schema with key or ref "${H}"`)}else A=this.compile(H);let L=A($);if(!("$async"in A))this.errors=A.errors;return L}compile(H,$){let A=this._addSchema(H,$);return A.validate||this._compileSchemaEnv(A)}compileAsync(H,$){if(typeof this.opts.loadSchema!="function")throw Error("options.loadSchema should be a function");let{loadSchema:A}=this.opts;return L.call(this,H,$);async function L(M,G){await I.call(this,M.$schema);let U=this._addSchema(M,G);return U.validate||D.call(this,U)}async function I(M){if(M&&!this.getSchema(M))await L.call(this,{$ref:M},!0)}async function D(M){try{return this._compileSchemaEnv(M)}catch(G){if(!(G instanceof CYI.default))throw G;return B.call(this,G),await f.call(this,G.missingSchema),D.call(this,M)}}function B({missingSchema:M,missingRef:G}){if(this.refs[M])throw Error(`AnySchema ${M} is loaded but ${G} cannot be resolved`)}async function f(M){let G=await E.call(this,M);if(!this.refs[M])await I.call(this,G.$schema);if(!this.refs[M])this.addSchema(G,M,$)}async function E(M){let G=this._loading[M];if(G)return G;try{return await(this._loading[M]=A(M))}finally{delete this._loading[M]}}}addSchema(H,$,A,L=this.opts.validateSchema){if(Array.isArray(H)){for(let D of H)this.addSchema(D,void 0,A,L);return this}let I;if(typeof H==="object"){let{schemaId:D}=this.opts;if(I=H[D],I!==void 0&&typeof I!="string")throw Error(`schema ${D} must be string`)}return $=(0,$jH.normalizeId)($||I),this._checkUnique($),this.schemas[$]=this._addSchema(H,A,$,L,!0),this}addMetaSchema(H,$,A=this.opts.validateSchema){return this.addSchema(H,$,!0,A),this}validateSchema(H,$){if(typeof H=="boolean")return!0;let A;if(A=H.$schema,A!==void 0&&typeof A!="string")throw Error("$schema must be a string");if(A=A||this.opts.defaultMeta||this.defaultMeta(),!A)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let L=this.validate(A,H);if(!L&&$){let I="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(I);else throw Error(I)}return L}getSchema(H){let $;while(typeof($=_YI.call(this,H))=="string")H=$;if($===void 0){let{schemaId:A}=this.opts,L=new HjH.SchemaEnv({schema:{},schemaId:A});if($=HjH.resolveSchema.call(this,L,H),!$)return;this.refs[H]=$}return $.validate||this._compileSchemaEnv($)}removeSchema(H){if(H instanceof RegExp)return this._removeAllSchemas(this.schemas,H),this._removeAllSchemas(this.refs,H),this;switch(typeof H){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let $=_YI.call(this,H);if(typeof $=="object")this._cache.delete($.schema);return delete this.schemas[H],delete this.refs[H],this}case"object":{let $=H;this._cache.delete($);let A=H[this.opts.schemaId];if(A)A=(0,$jH.normalizeId)(A),delete this.schemas[A],delete this.refs[A];return this}default:throw Error("ajv.removeSchema: invalid parameter")}}addVocabulary(H){for(let $ of H)this.addKeyword($);return this}addKeyword(H,$){let A;if(typeof H=="string"){if(A=H,typeof $=="object")this.logger.warn("these parameters are deprecated, see docs for addKeyword"),$.keyword=A}else if(typeof H=="object"&&$===void 0){if($=H,A=$.keyword,Array.isArray(A)&&!A.length)throw Error("addKeywords: keyword must be string or non-empty array")}else throw Error("invalid addKeywords parameters");if(MM9.call(this,A,$),!$)return(0,DJA.eachItem)(A,(I)=>IJA.call(this,I)),this;UM9.call(this,$);let L={...$,type:(0,I5$.getJSONTypes)($.type),schemaType:(0,I5$.getJSONTypes)($.schemaType)};return(0,DJA.eachItem)(A,L.type.length===0?(I)=>IJA.call(this,I,L):(I)=>L.type.forEach((D)=>IJA.call(this,I,L,D))),this}getKeyword(H){let $=this.RULES.all[H];return typeof $=="object"?$.definition:!!$}removeKeyword(H){let{RULES:$}=this;delete $.keywords[H],delete $.all[H];for(let A of $.rules){let L=A.rules.findIndex((I)=>I.keyword===H);if(L>=0)A.rules.splice(L,1)}return this}addFormat(H,$){if(typeof $=="string")$=new RegExp($);return this.formats[H]=$,this}errorsText(H=this.errors,{separator:$=", ",dataVar:A="data"}={}){if(!H||H.length===0)return"No errors";return H.map((L)=>`${A}${L.instancePath} ${L.message}`).reduce((L,I)=>L+$+I)}$dataMetaSchema(H,$){let A=this.RULES.all;H=JSON.parse(JSON.stringify(H));for(let L of $){let I=L.split("/").slice(1),D=H;for(let B of I)D=D[B];for(let B in A){let f=A[B];if(typeof f!="object")continue;let{$data:E}=f.definition,M=D[B];if(E&&M)D[B]=wYI(M)}}return H}_removeAllSchemas(H,$){for(let A in H){let L=H[A];if(!$||$.test(A)){if(typeof L=="string")delete H[A];else if(L&&!L.meta)this._cache.delete(L.schema),delete H[A]}}}_addSchema(H,$,A,L=this.opts.validateSchema,I=this.opts.addUsedSchema){let D,{schemaId:B}=this.opts;if(typeof H=="object")D=H[B];else if(this.opts.jtd)throw Error("schema must be object");else if(typeof H!="boolean")throw Error("schema must be object or boolean");let f=this._cache.get(H);if(f!==void 0)return f;A=(0,$jH.normalizeId)(D||A);let E=$jH.getSchemaRefs.call(this,H,A);if(f=new HjH.SchemaEnv({schema:H,schemaId:B,meta:$,baseId:A,localRefs:E}),this._cache.set(f.schema,f),I&&!A.startsWith("#")){if(A)this._checkUnique(A);this.refs[A]=f}if(L)this.validateSchema(H,!0);return f}_checkUnique(H){if(this.schemas[H]||this.refs[H])throw Error(`schema with key or id "${H}" already exists`)}_compileSchemaEnv(H){if(H.meta)this._compileMetaSchema(H);else HjH.compileSchema.call(this,H);if(!H.validate)throw Error("ajv implementation error");return H.validate}_compileMetaSchema(H){let $=this.opts;this.opts=this._metaOpts;try{HjH.compileSchema.call(this,H)}finally{this.opts=$}}}D5$.ValidationError=nE9.default;D5$.MissingRefError=CYI.default;B7.default=D5$;function PYI(H,$,A,L="error"){for(let I in H){let D=I;if(D in $)this.logger[L](`${A}: option ${I}. ${H[D]}`)}}function _YI(H){return H=(0,$jH.normalizeId)(H),this.schemas[H]||this.refs[H]}function AM9(){let H=this.opts.schemas;if(!H)return;if(Array.isArray(H))this.addSchema(H);else for(let $ in H)this.addSchema(H[$],$)}function LM9(){for(let H in this.opts.formats){let $=this.opts.formats[H];if($)this.addFormat(H,$)}}function IM9(H){if(Array.isArray(H)){this.addVocabulary(H);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let $ in H){let A=H[$];if(!A.keyword)A.keyword=$;this.addKeyword(A)}}function DM9(){let H={...this.opts};for(let $ of tE9)delete H[$];return H}var BM9={log(){},warn(){},error(){}};function fM9(H){if(H===!1)return BM9;if(H===void 0)return console;if(H.log&&H.warn&&H.error)return H;throw Error("logger must implement log, warn and error methods")}var EM9=/^[a-z_$][a-z0-9_$:-]*$/i;function MM9(H,$){let{RULES:A}=this;if((0,DJA.eachItem)(H,(L)=>{if(A.keywords[L])throw Error(`Keyword ${L} is already defined`);if(!EM9.test(L))throw Error(`Keyword ${L} has invalid name`)}),!$)return;if($.$data&&!(("code"in $)||("validate"in $)))throw Error('$data keyword must have "code" or "validate" function')}function IJA(H,$,A){var L;let I=$===null||$===void 0?void 0:$.post;if(A&&I)throw Error('keyword with "post" flag cannot have "type"');let{RULES:D}=this,B=I?D.post:D.rules.find(({type:E})=>E===A);if(!B)B={type:A,rules:[]},D.rules.push(B);if(D.keywords[H]=!0,!$)return;let f={keyword:H,definition:{...$,type:(0,I5$.getJSONTypes)($.type),schemaType:(0,I5$.getJSONTypes)($.schemaType)}};if($.before)GM9.call(this,B,f,$.before);else B.rules.push(f);D.all[H]=f,(L=$.implements)===null||L===void 0||L.forEach((E)=>this.addKeyword(E))}function GM9(H,$,A){let L=H.rules.findIndex((I)=>I.keyword===A);if(L>=0)H.rules.splice(L,0,$);else H.rules.push($),this.logger.warn(`rule ${A} is not defined`)}function UM9(H){let{metaSchema:$}=H;if($===void 0)return;if(H.$data&&this.opts.$data)$=wYI($);H.validateSchema=this.compile($,!0)}var XM9={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function wYI(H){return{anyOf:[H,XM9]}}});var qYI=z((BJA)=>{Object.defineProperty(BJA,"__esModule",{value:!0});var JM9={keyword:"id",code(){throw Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};BJA.default=JM9});var OYI=z((UDH)=>{Object.defineProperty(UDH,"__esModule",{value:!0});UDH.callRef=UDH.getValidate=void 0;var FM9=tSH(),TYI=fT(),JC=u1(),PFH=ug(),zYI=H5$(),B5$=Zf(),KM9={keyword:"$ref",schemaType:"string",code(H){let{gen:$,schema:A,it:L}=H,{baseId:I,schemaEnv:D,validateName:B,opts:f,self:E}=L,{root:M}=D;if((A==="#"||A==="#/")&&I===M.baseId)return U();let G=zYI.resolveRef.call(E,M,I,A);if(G===void 0)throw new FM9.default(L.opts.uriResolver,I,A);if(G instanceof zYI.SchemaEnv)return X(G);return J(G);function U(){if(D===M)return f5$(H,B,D,D.$async);let F=$.scopeValue("root",{ref:M});return f5$(H,JC._`${F}.validate`,M,M.$async)}function X(F){let Q=NYI(H,F);f5$(H,Q,F,F.$async)}function J(F){let Q=$.scopeValue("schema",f.code.source===!0?{ref:F,code:(0,JC.stringify)(F)}:{ref:F}),W=$.name("valid"),P=H.subschema({schema:F,dataTypes:[],schemaPath:JC.nil,topSchemaRef:Q,errSchemaPath:A},W);H.mergeEvaluated(P),H.ok(W)}}};function NYI(H,$){let{gen:A}=H;return $.validate?A.scopeValue("validate",{ref:$.validate}):JC._`${A.scopeValue("wrapper",{ref:$})}.validate`}UDH.getValidate=NYI;function f5$(H,$,A,L){let{gen:I,it:D}=H,{allErrors:B,schemaEnv:f,opts:E}=D,M=E.passContext?PFH.default.this:JC.nil;if(L)G();else U();function G(){if(!f.$async)throw Error("async schema referenced by sync schema");let F=I.let("valid");I.try(()=>{if(I.code(JC._`await ${(0,TYI.callValidateCode)(H,$,M)}`),J($),!B)I.assign(F,!0)},(Q)=>{if(I.if(JC._`!(${Q} instanceof ${D.ValidationError})`,()=>I.throw(Q)),X(Q),!B)I.assign(F,!1)}),H.ok(F)}function U(){H.result((0,TYI.callValidateCode)(H,$,M),()=>J($),()=>X($))}function X(F){let Q=JC._`${F}.errors`;I.assign(PFH.default.vErrors,JC._`${PFH.default.vErrors} === null ? ${Q} : ${PFH.default.vErrors}.concat(${Q})`),I.assign(PFH.default.errors,JC._`${PFH.default.vErrors}.length`)}function J(F){var Q;if(!D.opts.unevaluated)return;let W=(Q=A===null||A===void 0?void 0:A.validate)===null||Q===void 0?void 0:Q.evaluated;if(D.props!==!0)if(W&&!W.dynamicProps){if(W.props!==void 0)D.props=B5$.mergeEvaluated.props(I,W.props,D.props)}else{let P=I.var("props",JC._`${F}.evaluated.props`);D.props=B5$.mergeEvaluated.props(I,P,D.props,JC.Name)}if(D.items!==!0)if(W&&!W.dynamicItems){if(W.items!==void 0)D.items=B5$.mergeEvaluated.items(I,W.items,D.items)}else{let P=I.var("items",JC._`${F}.evaluated.items`);D.items=B5$.mergeEvaluated.items(I,P,D.items,JC.Name)}}}UDH.callRef=f5$;UDH.default=KM9});var xYI=z((fJA)=>{Object.defineProperty(fJA,"__esModule",{value:!0});var QM9=qYI(),WM9=OYI(),VM9=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",QM9.default,WM9.default];fJA.default=VM9});var SYI=z((EJA)=>{Object.defineProperty(EJA,"__esModule",{value:!0});var E5$=u1(),nr=E5$.operators,M5$={maximum:{okStr:"<=",ok:nr.LTE,fail:nr.GT},minimum:{okStr:">=",ok:nr.GTE,fail:nr.LT},exclusiveMaximum:{okStr:"<",ok:nr.LT,fail:nr.GTE},exclusiveMinimum:{okStr:">",ok:nr.GT,fail:nr.LTE}},PM9={message:({keyword:H,schemaCode:$})=>E5$.str`must be ${M5$[H].okStr} ${$}`,params:({keyword:H,schemaCode:$})=>E5$._`{comparison: ${M5$[H].okStr}, limit: ${$}}`},_M9={keyword:Object.keys(M5$),type:"number",schemaType:"number",$data:!0,error:PM9,code(H){let{keyword:$,data:A,schemaCode:L}=H;H.fail$data(E5$._`${A} ${M5$[$].fail} ${L} || isNaN(${A})`)}};EJA.default=_M9});var jYI=z((MJA)=>{Object.defineProperty(MJA,"__esModule",{value:!0});var AjH=u1(),CM9={message:({schemaCode:H})=>AjH.str`must be multiple of ${H}`,params:({schemaCode:H})=>AjH._`{multipleOf: ${H}}`},YM9={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:CM9,code(H){let{gen:$,data:A,schemaCode:L,it:I}=H,D=I.opts.multipleOfPrecision,B=$.let("res"),f=D?AjH._`Math.abs(Math.round(${B}) - ${B}) > 1e-${D}`:AjH._`${B} !== parseInt(${B})`;H.fail$data(AjH._`(${L} === 0 || (${B} = ${A}/${L}, ${f}))`)}};MJA.default=YM9});var yYI=z((GJA)=>{Object.defineProperty(GJA,"__esModule",{value:!0});function RYI(H){let $=H.length,A=0,L=0,I;while(L<$)if(A++,I=H.charCodeAt(L++),I>=55296&&I<=56319&&L<$){if(I=H.charCodeAt(L),(I&64512)===56320)L++}return A}GJA.default=RYI;RYI.code='require("ajv/dist/runtime/ucs2length").default'});var vYI=z((UJA)=>{Object.defineProperty(UJA,"__esModule",{value:!0});var XDH=u1(),wM9=Zf(),ZM9=yYI(),qM9={message({keyword:H,schemaCode:$}){let A=H==="maxLength"?"more":"fewer";return XDH.str`must NOT have ${A} than ${$} characters`},params:({schemaCode:H})=>XDH._`{limit: ${H}}`},TM9={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:qM9,code(H){let{keyword:$,data:A,schemaCode:L,it:I}=H,D=$==="maxLength"?XDH.operators.GT:XDH.operators.LT,B=I.opts.unicode===!1?XDH._`${A}.length`:XDH._`${(0,wM9.useFunc)(H.gen,ZM9.default)}(${A})`;H.fail$data(XDH._`${B} ${D} ${L}`)}};UJA.default=TM9});var hYI=z((XJA)=>{Object.defineProperty(XJA,"__esModule",{value:!0});var zM9=fT(),G5$=u1(),NM9={message:({schemaCode:H})=>G5$.str`must match pattern "${H}"`,params:({schemaCode:H})=>G5$._`{pattern: ${H}}`},OM9={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:NM9,code(H){let{data:$,$data:A,schema:L,schemaCode:I,it:D}=H,B=D.opts.unicodeRegExp?"u":"",f=A?G5$._`(new RegExp(${I}, ${B}))`:(0,zM9.usePattern)(H,L);H.fail$data(G5$._`!${f}.test(${$})`)}};XJA.default=OM9});var bYI=z((JJA)=>{Object.defineProperty(JJA,"__esModule",{value:!0});var LjH=u1(),xM9={message({keyword:H,schemaCode:$}){let A=H==="maxProperties"?"more":"fewer";return LjH.str`must NOT have ${A} than ${$} properties`},params:({schemaCode:H})=>LjH._`{limit: ${H}}`},SM9={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:xM9,code(H){let{keyword:$,data:A,schemaCode:L}=H,I=$==="maxProperties"?LjH.operators.GT:LjH.operators.LT;H.fail$data(LjH._`Object.keys(${A}).length ${I} ${L}`)}};JJA.default=SM9});var kYI=z((FJA)=>{Object.defineProperty(FJA,"__esModule",{value:!0});var IjH=fT(),DjH=u1(),jM9=Zf(),RM9={message:({params:{missingProperty:H}})=>DjH.str`must have required property '${H}'`,params:({params:{missingProperty:H}})=>DjH._`{missingProperty: ${H}}`},yM9={keyword:"required",type:"object",schemaType:"array",$data:!0,error:RM9,code(H){let{gen:$,schema:A,schemaCode:L,data:I,$data:D,it:B}=H,{opts:f}=B;if(!D&&A.length===0)return;let E=A.length>=f.loopRequired;if(B.allErrors)M();else G();if(f.strictRequired){let J=H.parentSchema.properties,{definedProperties:F}=H.it;for(let Q of A)if((J===null||J===void 0?void 0:J[Q])===void 0&&!F.has(Q)){let W=B.schemaEnv.baseId+B.errSchemaPath,P=`required property "${Q}" is not defined at "${W}" (strictRequired)`;(0,jM9.checkStrictMode)(B,P,B.opts.strictRequired)}}function M(){if(E||D)H.block$data(DjH.nil,U);else for(let J of A)(0,IjH.checkReportMissingProp)(H,J)}function G(){let J=$.let("missing");if(E||D){let F=$.let("valid",!0);H.block$data(F,()=>X(J,F)),H.ok(F)}else $.if((0,IjH.checkMissingProp)(H,A,J)),(0,IjH.reportMissingProp)(H,J),$.else()}function U(){$.forOf("prop",L,(J)=>{H.setParams({missingProperty:J}),$.if((0,IjH.noPropertyInData)($,I,J,f.ownProperties),()=>H.error())})}function X(J,F){H.setParams({missingProperty:J}),$.forOf(J,L,()=>{$.assign(F,(0,IjH.propertyInData)($,I,J,f.ownProperties)),$.if((0,DjH.not)(F),()=>{H.error(),$.break()})},DjH.nil)}}};FJA.default=yM9});var uYI=z((KJA)=>{Object.defineProperty(KJA,"__esModule",{value:!0});var BjH=u1(),vM9={message({keyword:H,schemaCode:$}){let A=H==="maxItems"?"more":"fewer";return BjH.str`must NOT have ${A} than ${$} items`},params:({schemaCode:H})=>BjH._`{limit: ${H}}`},hM9={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:vM9,code(H){let{keyword:$,data:A,schemaCode:L}=H,I=$==="maxItems"?BjH.operators.GT:BjH.operators.LT;H.fail$data(BjH._`${A}.length ${I} ${L}`)}};KJA.default=hM9});var U5$=z((QJA)=>{Object.defineProperty(QJA,"__esModule",{value:!0});var gYI=pXA();gYI.code='require("ajv/dist/runtime/equal").default';QJA.default=gYI});var mYI=z((VJA)=>{Object.defineProperty(VJA,"__esModule",{value:!0});var WJA=iSH(),f7=u1(),bM9=Zf(),kM9=U5$(),uM9={message:({params:{i:H,j:$}})=>f7.str`must NOT have duplicate items (items ## ${$} and ${H} are identical)`,params:({params:{i:H,j:$}})=>f7._`{i: ${H}, j: ${$}}`},gM9={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:uM9,code(H){let{gen:$,data:A,$data:L,schema:I,parentSchema:D,schemaCode:B,it:f}=H;if(!L&&!I)return;let E=$.let("valid"),M=D.items?(0,WJA.getSchemaTypes)(D.items):[];H.block$data(E,G,f7._`${B} === false`),H.ok(E);function G(){let F=$.let("i",f7._`${A}.length`),Q=$.let("j");H.setParams({i:F,j:Q}),$.assign(E,!0),$.if(f7._`${F} > 1`,()=>(U()?X:J)(F,Q))}function U(){return M.length>0&&!M.some((F)=>F==="object"||F==="array")}function X(F,Q){let W=$.name("item"),P=(0,WJA.checkDataTypes)(M,W,f.opts.strictNumbers,WJA.DataType.Wrong),Y=$.const("indices",f7._`{}`);$.for(f7._`;${F}--;`,()=>{if($.let(W,f7._`${A}[${F}]`),$.if(P,f7._`continue`),M.length>1)$.if(f7._`typeof ${W} == "string"`,f7._`${W} += "_"`);$.if(f7._`typeof ${Y}[${W}] == "number"`,()=>{$.assign(Q,f7._`${Y}[${W}]`),H.error(),$.assign(E,!1).break()}).code(f7._`${Y}[${W}] = ${F}`)})}function J(F,Q){let W=(0,bM9.useFunc)($,kM9.default),P=$.name("outer");$.label(P).for(f7._`;${F}--;`,()=>$.for(f7._`${Q} = ${F}; ${Q}--;`,()=>$.if(f7._`${W}(${A}[${F}], ${A}[${Q}])`,()=>{H.error(),$.assign(E,!1).break(P)})))}}};VJA.default=gM9});var pYI=z((_JA)=>{Object.defineProperty(_JA,"__esModule",{value:!0});var PJA=u1(),mM9=Zf(),pM9=U5$(),dM9={message:"must be equal to constant",params:({schemaCode:H})=>PJA._`{allowedValue: ${H}}`},cM9={keyword:"const",$data:!0,error:dM9,code(H){let{gen:$,data:A,$data:L,schemaCode:I,schema:D}=H;if(L||D&&typeof D=="object")H.fail$data(PJA._`!${(0,mM9.useFunc)($,pM9.default)}(${A}, ${I})`);else H.fail(PJA._`${D} !== ${A}`)}};_JA.default=cM9});var dYI=z((CJA)=>{Object.defineProperty(CJA,"__esModule",{value:!0});var fjH=u1(),lM9=Zf(),iM9=U5$(),nM9={message:"must be equal to one of the allowed values",params:({schemaCode:H})=>fjH._`{allowedValues: ${H}}`},rM9={keyword:"enum",schemaType:"array",$data:!0,error:nM9,code(H){let{gen:$,data:A,$data:L,schema:I,schemaCode:D,it:B}=H;if(!L&&I.length===0)throw Error("enum must have non-empty array");let f=I.length>=B.opts.loopEnum,E,M=()=>E!==null&&E!==void 0?E:E=(0,lM9.useFunc)($,iM9.default),G;if(f||L)G=$.let("valid"),H.block$data(G,U);else{if(!Array.isArray(I))throw Error("ajv implementation error");let J=$.const("vSchema",D);G=(0,fjH.or)(...I.map((F,Q)=>X(J,Q)))}H.pass(G);function U(){$.assign(G,!1),$.forOf("v",D,(J)=>$.if(fjH._`${M()}(${A}, ${J})`,()=>$.assign(G,!0).break()))}function X(J,F){let Q=I[F];return typeof Q==="object"&&Q!==null?fjH._`${M()}(${A}, ${J}[${F}])`:fjH._`${A} === ${Q}`}}};CJA.default=rM9});var cYI=z((YJA)=>{Object.defineProperty(YJA,"__esModule",{value:!0});var aM9=SYI(),oM9=jYI(),tM9=vYI(),sM9=hYI(),eM9=bYI(),HG9=kYI(),$G9=uYI(),AG9=mYI(),LG9=pYI(),IG9=dYI(),DG9=[aM9.default,oM9.default,tM9.default,sM9.default,eM9.default,HG9.default,$G9.default,AG9.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},LG9.default,IG9.default];YJA.default=DG9});var ZJA=z((EjH)=>{Object.defineProperty(EjH,"__esModule",{value:!0});EjH.validateAdditionalItems=void 0;var JDH=u1(),wJA=Zf(),BG9={message:({params:{len:H}})=>JDH.str`must NOT have more than ${H} items`,params:({params:{len:H}})=>JDH._`{limit: ${H}}`},fG9={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:BG9,code(H){let{parentSchema:$,it:A}=H,{items:L}=$;if(!Array.isArray(L)){(0,wJA.checkStrictMode)(A,'"additionalItems" is ignored when "items" is not an array of schemas');return}lYI(H,L)}};function lYI(H,$){let{gen:A,schema:L,data:I,keyword:D,it:B}=H;B.items=!0;let f=A.const("len",JDH._`${I}.length`);if(L===!1)H.setParams({len:$.length}),H.pass(JDH._`${f} <= ${$.length}`);else if(typeof L=="object"&&!(0,wJA.alwaysValidSchema)(B,L)){let M=A.var("valid",JDH._`${f} <= ${$.length}`);A.if((0,JDH.not)(M),()=>E(M)),H.ok(M)}function E(M){A.forRange("i",$.length,f,(G)=>{if(H.subschema({keyword:D,dataProp:G,dataPropType:wJA.Type.Num},M),!B.allErrors)A.if((0,JDH.not)(M),()=>A.break())})}}EjH.validateAdditionalItems=lYI;EjH.default=fG9});var qJA=z((MjH)=>{Object.defineProperty(MjH,"__esModule",{value:!0});MjH.validateTuple=void 0;var iYI=u1(),X5$=Zf(),EG9=fT(),MG9={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(H){let{schema:$,it:A}=H;if(Array.isArray($))return nYI(H,"additionalItems",$);if(A.items=!0,(0,X5$.alwaysValidSchema)(A,$))return;H.ok((0,EG9.validateArray)(H))}};function nYI(H,$,A=H.schema){let{gen:L,parentSchema:I,data:D,keyword:B,it:f}=H;if(G(I),f.opts.unevaluated&&A.length&&f.items!==!0)f.items=X5$.mergeEvaluated.items(L,A.length,f.items);let E=L.name("valid"),M=L.const("len",iYI._`${D}.length`);A.forEach((U,X)=>{if((0,X5$.alwaysValidSchema)(f,U))return;L.if(iYI._`${M} > ${X}`,()=>H.subschema({keyword:B,schemaProp:X,dataProp:X},E)),H.ok(E)});function G(U){let{opts:X,errSchemaPath:J}=f,F=A.length,Q=F===U.minItems&&(F===U.maxItems||U[$]===!1);if(X.strictTuples&&!Q){let W=`"${B}" is ${F}-tuple, but minItems or maxItems/${$} are not specified or different at path "${J}"`;(0,X5$.checkStrictMode)(f,W,X.strictTuples)}}}MjH.validateTuple=nYI;MjH.default=MG9});var rYI=z((TJA)=>{Object.defineProperty(TJA,"__esModule",{value:!0});var GG9=qJA(),UG9={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:(H)=>(0,GG9.validateTuple)(H,"items")};TJA.default=UG9});var oYI=z((zJA)=>{Object.defineProperty(zJA,"__esModule",{value:!0});var aYI=u1(),XG9=Zf(),JG9=fT(),FG9=ZJA(),KG9={message:({params:{len:H}})=>aYI.str`must NOT have more than ${H} items`,params:({params:{len:H}})=>aYI._`{limit: ${H}}`},QG9={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:KG9,code(H){let{schema:$,parentSchema:A,it:L}=H,{prefixItems:I}=A;if(L.items=!0,(0,XG9.alwaysValidSchema)(L,$))return;if(I)(0,FG9.validateAdditionalItems)(H,I);else H.ok((0,JG9.validateArray)(H))}};zJA.default=QG9});var tYI=z((NJA)=>{Object.defineProperty(NJA,"__esModule",{value:!0});var MT=u1(),J5$=Zf(),WG9={message:({params:{min:H,max:$}})=>$===void 0?MT.str`must contain at least ${H} valid item(s)`:MT.str`must contain at least ${H} and no more than ${$} valid item(s)`,params:({params:{min:H,max:$}})=>$===void 0?MT._`{minContains: ${H}}`:MT._`{minContains: ${H}, maxContains: ${$}}`},VG9={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:WG9,code(H){let{gen:$,schema:A,parentSchema:L,data:I,it:D}=H,B,f,{minContains:E,maxContains:M}=L;if(D.opts.next)B=E===void 0?1:E,f=M;else B=1;let G=$.const("len",MT._`${I}.length`);if(H.setParams({min:B,max:f}),f===void 0&&B===0){(0,J5$.checkStrictMode)(D,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(f!==void 0&&B>f){(0,J5$.checkStrictMode)(D,'"minContains" > "maxContains" is always invalid'),H.fail();return}if((0,J5$.alwaysValidSchema)(D,A)){let Q=MT._`${G} >= ${B}`;if(f!==void 0)Q=MT._`${Q} && ${G} <= ${f}`;H.pass(Q);return}D.items=!0;let U=$.name("valid");if(f===void 0&&B===1)J(U,()=>$.if(U,()=>$.break()));else if(B===0){if($.let(U,!0),f!==void 0)$.if(MT._`${I}.length > 0`,X)}else $.let(U,!1),X();H.result(U,()=>H.reset());function X(){let Q=$.name("_valid"),W=$.let("count",0);J(Q,()=>$.if(Q,()=>F(W)))}function J(Q,W){$.forRange("i",0,G,(P)=>{H.subschema({keyword:"contains",dataProp:P,dataPropType:J5$.Type.Num,compositeRule:!0},Q),W()})}function F(Q){if($.code(MT._`${Q}++`),f===void 0)$.if(MT._`${Q} >= ${B}`,()=>$.assign(U,!0).break());else if($.if(MT._`${Q} > ${f}`,()=>$.assign(U,!1).break()),B===1)$.assign(U,!0);else $.if(MT._`${Q} >= ${B}`,()=>$.assign(U,!0))}}};NJA.default=VG9});var H2I=z((Av)=>{Object.defineProperty(Av,"__esModule",{value:!0});Av.validateSchemaDeps=Av.validatePropertyDeps=Av.error=void 0;var OJA=u1(),PG9=Zf(),GjH=fT();Av.error={message:({params:{property:H,depsCount:$,deps:A}})=>{let L=$===1?"property":"properties";return OJA.str`must have ${L} ${A} when property ${H} is present`},params:({params:{property:H,depsCount:$,deps:A,missingProperty:L}})=>OJA._`{property: ${H},
 ${bc0.sanitize(Object.assign(Object.assign({},this),{request:this.request,response:this.response}))}`},enumerable:!1}),Object.setPrototypeOf(this,o_.prototype)}};o_.REQUEST_SEND_ERROR="REQUEST_SEND_ERROR";o_.PARSE_ERROR="PARSE_ERROR"});function Yy(H,$){return Buffer.from(H,$)}var yO;var BE$=K(()=>{sf$();yO=tf$("ts-http-runtime")});function dNH(H){return H&&typeof H.pipe==="function"}function aMI(H){if(H.readable===!1)return Promise.resolve();return new Promise(($)=>{let A=()=>{$(),H.removeListener("close",A),H.removeListener("end",A),H.removeListener("error",A)};H.on("close",A),H.on("end",A),H.on("error",A)})}function tMI(H){return H&&typeof H.byteLength==="number"}class sMI{constructor(){this.cachedHttpsAgents=new WeakMap}async sendRequest(H){var $,A,L;let I=new AbortController,D;if(H.abortSignal){if(H.abortSignal.aborted)throw new hn("The operation was aborted. Request has already been canceled.");D=(U)=>{if(U.type==="abort")I.abort()},H.abortSignal.addEventListener("abort",D)}let B;if(H.timeout>0)B=setTimeout(()=>{let U=new Cy;yO.info(`request to '${U.sanitizeUrl(H.url)}' timed out. canceling...`),I.abort()},H.timeout);let f=H.headers.get("Accept-Encoding"),E=(f===null||f===void 0?void 0:f.includes("gzip"))||(f===null||f===void 0?void 0:f.includes("deflate")),M=typeof H.body==="function"?H.body():H.body;if(M&&!H.headers.has("Content-Length")){let U=pc0(M);if(U!==null)H.headers.set("Content-Length",U)}let G;try{if(M&&H.onUploadProgress){let W=H.onUploadProgress,P=new qfA(W);if(P.on("error",(Y)=>{yO.error("Error in upload progress",Y)}),dNH(M))M.pipe(P);else P.end(M);M=P}let U=await this.makeRequest(H,I,M);if(B!==void 0)clearTimeout(B);let X=uc0(U),F={status:($=U.statusCode)!==null&&$!==void 0?$:0,headers:X,request:H};if(H.method==="HEAD")return U.resume(),F;G=E?gc0(U,X):U;let Q=H.onDownloadProgress;if(Q){let W=new qfA(Q);W.on("error",(P)=>{yO.error("Error in download progress",P)}),G.pipe(W),G=W}if(((A=H.streamResponseStatusCodes)===null||A===void 0?void 0:A.has(Number.POSITIVE_INFINITY))||((L=H.streamResponseStatusCodes)===null||L===void 0?void 0:L.has(F.status)))F.readableStreamBody=G;else F.bodyAsText=await mc0(G);return F}finally{if(H.abortSignal&&D){let U=Promise.resolve();if(dNH(M))U=aMI(M);let X=Promise.resolve();if(dNH(G))X=aMI(G);Promise.all([U,X]).then(()=>{var J;if(D)(J=H.abortSignal)===null||J===void 0||J.removeEventListener("abort",D)}).catch((J)=>{yO.warning("Error when cleaning up abortListener on httpRequest",J)})}}}makeRequest(H,$,A){var L;let I=new URL(H.url),D=I.protocol!=="https:";if(D&&!H.allowInsecureConnection)throw Error(`Cannot connect to ${H.url} while allowInsecureConnection is false.`);let B=(L=H.agent)!==null&&L!==void 0?L:this.getOrCreateAgent(H,D),f=Object.assign({agent:B,hostname:I.hostname,path:`${I.pathname}${I.search}`,port:I.port,method:H.method,headers:H.headers.toJSON({preserveCase:!0})},H.requestOverrides);return new Promise((E,M)=>{let G=D?WXH.request(f,E):VXH.request(f,E);if(G.once("error",(U)=>{var X;M(new o_(U.message,{code:(X=U.code)!==null&&X!==void 0?X:o_.REQUEST_SEND_ERROR,request:H}))}),$.signal.addEventListener("abort",()=>{let U=new hn("The operation was aborted. Rejecting from abort signal callback while making request.");G.destroy(U),M(U)}),A&&dNH(A))A.pipe(G);else if(A)if(typeof A==="string"||Buffer.isBuffer(A))G.end(A);else if(tMI(A))G.end(ArrayBuffer.isView(A)?Buffer.from(A.buffer):Buffer.from(A));else yO.error("Unrecognized body type",A),M(new o_("Unrecognized body type"));else G.end()})}getOrCreateAgent(H,$){var A;let L=H.disableKeepAlive;if($){if(L)return WXH.globalAgent;if(!this.cachedHttpAgent)this.cachedHttpAgent=new WXH.Agent({keepAlive:!0});return this.cachedHttpAgent}else{if(L&&!H.tlsSettings)return VXH.globalAgent;let I=(A=H.tlsSettings)!==null&&A!==void 0?A:kc0,D=this.cachedHttpsAgents.get(I);if(D&&D.options.keepAlive===!L)return D;return yO.info("No cached TLS Agent exist, creating a new Agent"),D=new VXH.Agent(Object.assign({keepAlive:!L},I)),this.cachedHttpsAgents.set(I,D),D}}}function uc0(H){let $=_y();for(let A of Object.keys(H.headers)){let L=H.headers[A];if(Array.isArray(L)){if(L.length>0)$.set(A,L[0])}else if(L)$.set(A,L)}return $}function gc0(H,$){let A=$.get("Content-Encoding");if(A==="gzip"){let L=fE$.createGunzip();return H.pipe(L),L}else if(A==="deflate"){let L=fE$.createInflate();return H.pipe(L),L}return H}function mc0(H){return new Promise(($,A)=>{let L=[];H.on("data",(I)=>{if(Buffer.isBuffer(I))L.push(I);else L.push(Buffer.from(I))}),H.on("end",()=>{$(Buffer.concat(L).toString("utf8"))}),H.on("error",(I)=>{if(I&&(I===null||I===void 0?void 0:I.name)==="AbortError")A(I);else A(new o_(`Error reading response as text: ${I.message}`,{code:o_.PARSE_ERROR}))})})}function pc0(H){if(!H)return 0;else if(Buffer.isBuffer(H))return H.length;else if(dNH(H))return null;else if(tMI(H))return H.byteLength;else if(typeof H==="string")return Buffer.from(H).length;else return null}function eMI(){return new sMI}var WXH,VXH,fE$,oMI,kc0,qfA;var HGI=K(()=>{LE$();uNH();ZfA();BE$();pNH();WXH=h(require("http")),VXH=h(require("https")),fE$=h(require("zlib")),oMI=require("stream"),kc0={};qfA=class qfA extends oMI.Transform{_transform(H,$,A){this.push(H),this.loadedBytes+=H.length;try{this.progressCallback({loadedBytes:this.loadedBytes}),A()}catch(L){A(L)}}constructor(H){super();this.loadedBytes=0,this.progressCallback=H}}});function TfA(){return eMI()}var $GI=K(()=>{HGI()});function NfA(H={}){var $;let A=($=H.logger)!==null&&$!==void 0?$:yO.info,L=new Cy({additionalAllowedHeaderNames:H.additionalAllowedHeaderNames,additionalAllowedQueryParameters:H.additionalAllowedQueryParameters});return{name:zfA,async sendRequest(I,D){if(!A.enabled)return D(I);A(`Request: ${L.sanitize(I)}`);let B=await D(I);return A(`Response status code: ${B.status}`),A(`Headers: ${L.sanitize(B.headers)}`),B}}}var zfA="logPolicy";var AGI=K(()=>{BE$();pNH()});function OfA(H={}){let{maxRetries:$=20}=H;return{name:"redirectPolicy",async sendRequest(A,L){let I=await L(A);return IGI(L,I,$)}}}async function IGI(H,$,A,L=0){let{request:I,status:D,headers:B}=$,f=B.get("location");if(f&&(D===300||D===301&&LGI.includes(I.method)||D===302&&LGI.includes(I.method)||D===303&&I.method==="POST"||D===307)&&L<A){let E=new URL(f,I.url);if(I.url=E.toString(),D===303)I.method="GET",I.headers.delete("Content-Length"),delete I.body;I.headers.delete("Authorization");let M=await H(I);return IGI(H,M,A,L+1)}return $}var LGI;var DGI=K(()=>{LGI=["GET","HEAD"]});var cNH=3;function xfA(){return{name:"decompressResponsePolicy",async sendRequest(H,$){if(H.method!=="HEAD")H.headers.set("Accept-Encoding","gzip,deflate");return $(H)}}}function SfA(H,$){return H=Math.ceil(H),$=Math.floor($),Math.floor(Math.random()*($-H+1))+H}function lNH(H,$){let A=$.retryDelayInMs*Math.pow(2,H),L=Math.min($.maxRetryDelayInMs,A);return{retryAfterInMs:L/2+SfA(0,L/2)}}var jfA=()=>{};function BGI(H,$,A){return new Promise((L,I)=>{let D=void 0,B=void 0,f=()=>{return I(new hn((A===null||A===void 0?void 0:A.abortErrorMsg)?A===null||A===void 0?void 0:A.abortErrorMsg:dc0))},E=()=>{if((A===null||A===void 0?void 0:A.abortSignal)&&B)A.abortSignal.removeEventListener("abort",B)};if(B=()=>{if(D)clearTimeout(D);return E(),f()},(A===null||A===void 0?void 0:A.abortSignal)&&A.abortSignal.aborted)return f();if(D=setTimeout(()=>{E(),L($)},H),A===null||A===void 0?void 0:A.abortSignal)A.abortSignal.addEventListener("abort",B)})}function fGI(H,$){let A=H.headers.get($);if(!A)return;let L=Number(A);if(Number.isNaN(L))return;return L}var dc0="The operation was aborted.";var RfA=K(()=>{LE$()});function EGI(H){if(!(H&&[429,503].includes(H.status)))return;try{for(let I of cc0){let D=fGI(H,I);if(D===0||D)return D*(I===yfA?1000:1)}let $=H.headers.get(yfA);if(!$)return;let L=Date.parse($)-Date.now();return Number.isFinite(L)?Math.max(0,L):void 0}catch($){return}}function MGI(H){return Number.isFinite(EGI(H))}function GGI(){return{name:"throttlingRetryStrategy",retry({response:H}){let $=EGI(H);if(!Number.isFinite($))return{skipStrategy:!0};return{retryAfterInMs:$}}}}var yfA="Retry-After",cc0;var vfA=K(()=>{RfA();cc0=["retry-after-ms","x-ms-retry-after-ms",yfA]});function UGI(H={}){var $,A;let L=($=H.retryDelayInMs)!==null&&$!==void 0?$:lc0,I=(A=H.maxRetryDelayInMs)!==null&&A!==void 0?A:ic0;return{name:"exponentialRetryStrategy",retry({retryCount:D,response:B,responseError:f}){let E=rc0(f),M=E&&H.ignoreSystemErrors,G=nc0(B),U=G&&H.ignoreHttpStatusCodes;if(B&&(MGI(B)||!G)||U||M)return{skipStrategy:!0};if(f&&!E&&!G)return{errorToThrow:f};return lNH(D,{retryDelayInMs:L,maxRetryDelayInMs:I})}}}function nc0(H){return Boolean(H&&H.status!==void 0&&(H.status>=500||H.status===408)&&H.status!==501&&H.status!==505)}function rc0(H){if(!H)return!1;return H.code==="ETIMEDOUT"||H.code==="ESOCKETTIMEDOUT"||H.code==="ECONNREFUSED"||H.code==="ECONNRESET"||H.code==="ENOENT"||H.code==="ENOTFOUND"}var lc0=1000,ic0=64000;var XGI=K(()=>{jfA();vfA()});function iNH(H,$={maxRetries:cNH}){let A=$.logger||ac0;return{name:oc0,async sendRequest(L,I){var D,B;let f,E,M=-1;H:while(!0){M+=1,f=void 0,E=void 0;try{A.info(`Retry ${M}: Attempting to send request`,L.requestId),f=await I(L),A.info(`Retry ${M}: Received a response from request`,L.requestId)}catch(G){if(A.error(`Retry ${M}: Received an error from request`,L.requestId),E=G,!G||E.name!=="RestError")throw G;f=E.response}if((D=L.abortSignal)===null||D===void 0?void 0:D.aborted)throw A.error(`Retry ${M}: Request aborted.`),new hn;if(M>=((B=$.maxRetries)!==null&&B!==void 0?B:cNH))if(A.info(`Retry ${M}: Maximum retries reached. Returning the last received response, or throwing the last received error.`),E)throw E;else if(f)return f;else throw Error("Maximum retries reached with no response or error to throw");A.info(`Retry ${M}: Processing ${H.length} retry strategies.`);$:for(let G of H){let U=G.logger||A;U.info(`Retry ${M}: Processing retry strategy ${G.name}.`);let X=G.retry({retryCount:M,response:f,responseError:E});if(X.skipStrategy){U.info(`Retry ${M}: Skipped.`);continue $}let{errorToThrow:J,retryAfterInMs:F,redirectTo:Q}=X;if(J)throw U.error(`Retry ${M}: Retry strategy ${G.name} throws error:`,J),J;if(F||F===0){U.info(`Retry ${M}: Retry strategy ${G.name} retries after ${F}`),await BGI(F,void 0,{abortSignal:L.abortSignal});continue H}if(Q){U.info(`Retry ${M}: Retry strategy ${G.name} redirects to ${Q}`),L.url=Q;continue H}}if(E)throw A.info("None of the retry strategies could work with the received error. Throwing it."),E;if(f)return A.info("None of the retry strategies could work with the received response. Returning it."),f}}}}var ac0,oc0="retryPolicy";var hfA=K(()=>{RfA();LE$();sf$();ac0=tf$("ts-http-runtime retryPolicy")});function kfA(H={}){var $;return{name:bfA,sendRequest:iNH([GGI(),UGI(H)],{maxRetries:($=H.maxRetries)!==null&&$!==void 0?$:cNH}).sendRequest}}var bfA="defaultRetryPolicy";var JGI=K(()=>{XGI();vfA();hfA()});var ufA,gfA,mfA,pfA,FGI,KGI,QGI,WGI,PXH,VGI;var dfA=K(()=>{FGI=typeof window<"u"&&typeof window.document<"u",KGI=typeof self==="object"&&typeof(self===null||self===void 0?void 0:self.importScripts)==="function"&&(((ufA=self.constructor)===null||ufA===void 0?void 0:ufA.name)==="DedicatedWorkerGlobalScope"||((gfA=self.constructor)===null||gfA===void 0?void 0:gfA.name)==="ServiceWorkerGlobalScope"||((mfA=self.constructor)===null||mfA===void 0?void 0:mfA.name)==="SharedWorkerGlobalScope"),QGI=typeof Deno<"u"&&typeof Deno.version<"u"&&typeof Deno.version.deno<"u",WGI=typeof Bun<"u"&&typeof Bun.version<"u",PXH=typeof globalThis.process<"u"&&Boolean(globalThis.process.version)&&Boolean((pfA=globalThis.process.versions)===null||pfA===void 0?void 0:pfA.node),VGI=typeof navigator<"u"&&(navigator===null||navigator===void 0?void 0:navigator.product)==="ReactNative"});function tc0(H){var $;let A={};for(let[L,I]of H.entries())($=A[L])!==null&&$!==void 0||(A[L]=[]),A[L].push(I);return A}function lfA(){return{name:cfA,async sendRequest(H,$){if(PXH&&typeof FormData<"u"&&H.body instanceof FormData)H.formData=tc0(H.body),H.body=void 0;if(H.formData){let A=H.headers.get("Content-Type");if(A&&A.indexOf("application/x-www-form-urlencoded")!==-1)H.body=sc0(H.formData);else await ec0(H.formData,H);H.formData=void 0}return $(H)}}}function sc0(H){let $=new URLSearchParams;for(let[A,L]of Object.entries(H))if(Array.isArray(L))for(let I of L)$.append(A,I.toString());else $.append(A,L.toString());return $.toString()}async function ec0(H,$){let A=$.headers.get("Content-Type");if(A&&!A.startsWith("multipart/form-data"))return;$.headers.set("Content-Type",A!==null&&A!==void 0?A:"multipart/form-data");let L=[];for(let[I,D]of Object.entries(H))for(let B of Array.isArray(D)?D:[D])if(typeof B==="string")L.push({headers:_y({"Content-Disposition":`form-data; name="${I}"`}),body:Yy(B,"utf-8")});else if(B===void 0||B===null||typeof B!=="object")throw Error(`Unexpected value for key ${I}: ${B}. Value should be serialized to string first.`);else{let f=B.name||"blob",E=_y();E.set("Content-Disposition",`form-data; name="${I}"; filename="${f}"`),E.set("Content-Type",B.type||"application/octet-stream"),L.push({headers:E,body:B})}$.multipartBody={parts:L}}var cfA="formDataPolicy";var PGI=K(()=>{dfA();uNH()});var YGI=z((mq)=>{var Hl0=mq&&mq.__createBinding||(Object.create?function(H,$,A,L){if(L===void 0)L=A;var I=Object.getOwnPropertyDescriptor($,A);if(!I||("get"in I?!$.__esModule:I.writable||I.configurable))I={enumerable:!0,get:function(){return $[A]}};Object.defineProperty(H,L,I)}:function(H,$,A,L){if(L===void 0)L=A;H[L]=$[A]}),$l0=mq&&mq.__setModuleDefault||(Object.create?function(H,$){Object.defineProperty(H,"default",{enumerable:!0,value:$})}:function(H,$){H.default=$}),CGI=mq&&mq.__importStar||function(H){if(H&&H.__esModule)return H;var $={};if(H!=null){for(var A in H)if(A!=="default"&&Object.prototype.hasOwnProperty.call(H,A))Hl0($,H,A)}return $l0($,H),$},Al0=mq&&mq.__importDefault||function(H){return H&&H.__esModule?H:{default:H}};Object.defineProperty(mq,"__esModule",{value:!0});mq.HttpProxyAgent=void 0;var Ll0=CGI(require("net")),Il0=CGI(require("tls")),Dl0=Al0(jHH()),Bl0=require("events"),fl0=W$A(),_GI=require("url"),_XH=(0,Dl0.default)("http-proxy-agent");class ifA extends fl0.Agent{constructor(H,$){super($);this.proxy=typeof H==="string"?new _GI.URL(H):H,this.proxyHeaders=$?.headers??{},_XH("Creating new HttpProxyAgent instance: %o",this.proxy.href);let A=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),L=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={...$?El0($,"headers"):null,host:A,port:L}}addRequest(H,$){H._header=null,this.setRequestProps(H,$),super.addRequest(H,$)}setRequestProps(H,$){let{proxy:A}=this,L=$.secureEndpoint?"https:":"http:",I=H.getHeader("host")||"localhost",D=`${L}//${I}`,B=new _GI.URL(H.path,D);if($.port!==80)B.port=String($.port);H.path=String(B);let f=typeof this.proxyHeaders==="function"?this.proxyHeaders():{...this.proxyHeaders};if(A.username||A.password){let E=`${decodeURIComponent(A.username)}:${decodeURIComponent(A.password)}`;f["Proxy-Authorization"]=`Basic ${Buffer.from(E).toString("base64")}`}if(!f["Proxy-Connection"])f["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close";for(let E of Object.keys(f)){let M=f[E];if(M)H.setHeader(E,M)}}async connect(H,$){if(H._header=null,!H.path.includes("://"))this.setRequestProps(H,$);let A,L;if(_XH("Regenerating stored HTTP header string for request"),H._implicitHeader(),H.outputData&&H.outputData.length>0)_XH("Patching connection write() output buffer with updated header"),A=H.outputData[0].data,L=A.indexOf(`\r
${B}`}]}}}for(let B of I)if(B.status==="fulfilled")return B.value.result;throw new Bj(`[${A}] All sockets failed for tabs_context_mcp`)}updateTabRoutes(H,$){let A=this.extractTabs(H);if(!A)return;for(let L of A)if(typeof L==="object"&&L!==null&&"tabId"in L){let I=L.tabId;this.tabRoutes.set(I,$)}}extractTabs(H){if(!H||typeof H!=="object")return null;let A=H.result?.content;if(!A||!Array.isArray(A))return null;for(let L of A)if(L.type==="text"&&L.text)try{let I=JSON.parse(L.text);if(Array.isArray(I))return I;if(I&&Array.isArray(I.availableTabs))return I.availableTabs}catch{}return null}getSocketPathForClient(H){for(let[$,A]of this.clients.entries())if(A===H)return $;return""}refreshClients(){let H=this.getAvailableSocketPaths(),{logger:$,serverName:A}=this.context;for(let L of H)if(!this.clients.has(L)){$.info(`[${A}] Adding socket to pool: ${L}`);let I={...this.context,socketPath:L,getSocketPath:void 0,getSocketPaths:void 0},D=uT$(I);if(D.disableAutoReconnect=!0,this.notificationHandler)D.setNotificationHandler(this.notificationHandler);this.clients.set(L,D)}for(let[L,I]of this.clients.entries())if(!H.includes(L)){$.info(`[${A}] Removing stale socket from pool: ${L}`),I.disconnect(),this.clients.delete(L);for(let[D,B]of this.tabRoutes.entries())if(B===L)this.tabRoutes.delete(D)}}getAvailableSocketPaths(){return this.context.getSocketPaths?.()??[]}}function YiD(H){return new CiD(H)}var wiD=K(()=>{gT$()});async function TP1(H,$,A,L){let I=await $.callTool(A,L);if(H.logger.silly(`[${H.serverName}] Received result from socket bridge: ${JSON.stringify(I)}`),I===null||I===void 0)return{content:[{type:"text",text:"Tool execution completed"}]};let{result:D,error:B}=I,f=B||D,E=!!B;if(!f)return{content:[{type:"text",text:"Tool execution completed"}]};if(E&&NP1(f.content))H.onAuthenticationError();let{content:M}=f;if(M&&Array.isArray(M)){if(E)return{content:M.map((U)=>{if(typeof U==="object"&&U!==null&&"type"in U)return U;return{type:"text",text:String(U)}}),isError:!0};return{content:M.map((U)=>{if(typeof U==="object"&&U!==null&&"type"in U&&"source"in U){let X=U;if(X.type==="image"&&typeof X.source==="object"&&X.source!==null&&"data"in X.source)return{type:"image",data:X.source.data,mimeType:"media_type"in X.source?X.source.media_type||"image/png":"image/png"}}if(typeof U==="object"&&U!==null&&"type"in U)return U;return{type:"text",text:String(U)}}),isError:E}}if(typeof M==="string")return{content:[{type:"text",text:M}],isError:E};return H.logger.warn(`[${H.serverName}] Unexpected result format from socket bridge`,I),{content:[{type:"text",text:JSON.stringify(I)}],isError:E}}function ZiD(H){return{content:[{type:"text",text:H.onToolCallDisconnected()}]}}async function zP1(H,$){let A=["ask","skip_all_permission_checks","follow_a_plan"],L=$.mode,I=L&&A.includes(L)?L:"ask";if(H.setPermissionMode)await H.setPermissionMode(I,$.allowed_domains);return{content:[{type:"text",text:`Permission mode set to: ${I}`}]}}function NP1(H){return(Array.isArray(H)?H.map((A)=>{if(typeof A==="string")return A;if(typeof A==="object"&&A!==null&&"text"in A&&typeof A.text==="string")return A.text;return""}).join(" "):String(H)).toLowerCase().includes("re-authenticated")}var qiD=async(H,$,A,L)=>{if(A==="set_permission_mode")return zP1($,L);try{let I=await $.ensureConnected();if(H.logger.silly(`[${H.serverName}] Server is connected: ${I}. Received tool call: ${A} with args: ${JSON.stringify(L)}.`),I)return await TP1(H,$,A,L);return ZiD(H)}catch(I){if(H.logger.info(`[${H.serverName}] Error calling tool:`,I),I instanceof Bj)return ZiD(H);return{content:[{type:"text",text:`Error calling tool, please try again. : ${I instanceof Error?I.message:String(I)}`}],isError:!0}}};var TiD=K(()=>{gT$()});function ziD(H){return H.bridgeConfig?LhA(H):H.getSocketPaths?YiD(H):uT$(H)}function MhA(H,$){let{serverName:A,logger:L}=H,I=$??ziD(H),D=new lmH({name:A,version:"1.0.0"},{capabilities:{tools:{},logging:{}}});return D.setRequestHandler(hSH,async()=>{if(H.isDisabled?.())return{tools:[]};return{tools:g1H}}),D.setRequestHandler(BDH,async(B)=>{return L.info(`[${A}] Executing tool: ${B.params.name}`),qiD(H,I,B.params.name,B.params.arguments||{})}),I.setNotificationHandler((B)=>{L.info(`[${A}] Forwarding MCP notification: ${B.method}`),D.notification({method:B.method,params:B.params}).catch((f)=>{L.info(`[${A}] Failed to forward MCP notification: ${f.message}`)})}),D}var NiD=K(()=>{fhA();QK();IhA();DhA();gT$();wiD();TiD()});var mT$=K(()=>{IhA();DhA();NiD()});function GhA(){return`# Claude in Chrome browser automation
${CaD}`}}});function pY1(){return oU(),UN(bFD)}function GaD(H){return`Permission to use ${H} has been denied. ${dY1}`}function pY$(H){return H.type!=="progress"&&H.type!=="attachment"&&H.type!=="system"&&Array.isArray(H.message.content)&&H.message.content[0]?.type==="text"&&V6A.has(H.message.content[0].text)}function YaD(H){return H.type==="assistant"&&H.isApiErrorMessage===!0&&H.message.model===eKH}function IY(H){let $=H.filter((A)=>A.type==="assistant");return K6($)}function BpH(H){for(let $=H.length-1;$>=0;$--){let A=H[$];if(A&&A.type==="assistant"){let I=A.message.content;if(Array.isArray(I))return I.some((D)=>D.type==="tool_use")}}return!1}function ZaD({content:H,isApiErrorMessage:$=!1,apiError:A,error:L,usage:I={input_tokens:0,output_tokens:0,cache_creation_input_tokens:0,cache_read_input_tokens:0,server_tool_use:{web_search_requests:0,web_fetch_requests:0},service_tier:null,cache_creation:{ephemeral_1h_input_tokens:0,ephemeral_5m_input_tokens:0}}}){return{type:"assistant",uuid:p3.randomUUID(),timestamp:new Date().toISOString(),message:{id:p3.randomUUID(),container:null,model:eKH,role:"assistant",stop_reason:"stop_sequence",stop_sequence:"",type:"message",usage:I,content:H,context_management:null},requestId:void 0,apiError:A,error:L,isApiErrorMessage:$}}function XT({content:H,usage:$}){return ZaD({content:typeof H==="string"?[{type:"text",text:H===""?Pw:H}]:H,usage:$})}function Yf({content:H,apiError:$,error:A}){return ZaD({content:[{type:"text",text:H===""?Pw:H}],isApiErrorMessage:!0,apiError:$,error:A})}function R$({content:H,isMeta:$,isVisibleInTranscriptOnly:A,isCompactSummary:L,summarizeMetadata:I,toolUseResult:D,mcpMeta:B,uuid:f,thinkingMetadata:E,timestamp:M,todos:G,imagePasteIds:U,sourceToolAssistantUUID:X,permissionMode:J}){return{type:"user",message:{role:"user",content:H||Pw},isMeta:$,isVisibleInTranscriptOnly:A,isCompactSummary:L,summarizeMetadata:I,uuid:f??p3.randomUUID(),timestamp:M??new Date().toISOString(),toolUseResult:D,mcpMeta:B,thinkingMetadata:E,todos:G,imagePasteIds:U,sourceToolAssistantUUID:X,permissionMode:J}}function NP({inputString:H,precedingInputBlocks:$}){if($.length===0)return H;return[...$,{text:H,type:"text"}]}function K3H({toolUse:H=!1}){return R$({content:[{type:"text",text:H?OC:ro}]})}function m7(){return R$({content:`<${yb$}>Caveat: The messages below were generated by the user while running local commands. DO NOT respond to these messages or otherwise consider them in your response unless the user explicitly asks you to.</${yb$}>`,isMeta:!0})}function uzD({toolUseID:H,parentToolUseID:$,data:A}){return{type:"progress",data:A,toolUseID:H,parentToolUseID:$,uuid:p3.randomUUID(),timestamp:new Date().toISOString()}}function cOA(H){return{type:"tool_result",content:WQH,is_error:!0,tool_use_id:H}}function WD(H,$){if(!H.trim()||!$.trim())return null;let A=$.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),L=new RegExp(`<${A}(?:\\s+[^>]*)?>([\\s\\S]*?)<\\/${A}>`,"gi"),I,D=0,B=0,f=new RegExp(`<${A}(?:\\s+[^>]*?)?>`,"gi"),E=new RegExp(`<\\/${A}>`,"gi");while((I=L.exec(H))!==null){let M=I[1],G=H.slice(B,I.index);D=0,f.lastIndex=0;while(f.exec(G)!==null)D++;E.lastIndex=0;while(E.exec(G)!==null)D--;if(D===0&&M)return M;B=I.index+I[0].length}return null}function at(H){if(H.type==="progress"||H.type==="attachment"||H.type==="system")return!0;if(typeof H.message.content==="string")return H.message.content.trim().length>0;if(H.message.content.length===0)return!1;if(H.message.content.length>1)return!0;if(H.message.content[0].type!=="text")return!0;return H.message.content[0].text.trim().length>0&&H.message.content[0].text!==Pw&&H.message.content[0].text!==OC}function b5(H){let $=!1;return H.flatMap((A)=>{switch(A.type){case"assistant":return $=$||A.message.content.length>1,A.message.content.map((L)=>{let I=$?p3.randomUUID():A.uuid;return{type:"assistant",timestamp:A.timestamp,message:{...A.message,content:[L],context_management:A.message.context_management??null},isMeta:A.isMeta,requestId:A.requestId,uuid:I,error:A.error,isApiErrorMessage:A.isApiErrorMessage}});case"attachment":return[A];case"progress":return[A];case"system":return[A];case"user":{if(typeof A.message.content==="string"){let I=$?p3.randomUUID():A.uuid;return[{...A,uuid:I,message:{...A.message,content:[{type:"text",text:A.message.content}]}}]}$=$||A.message.content.length>1;let L=0;return A.message.content.map((I)=>{let D=I.type==="image",B=D&&A.imagePasteIds?A.imagePasteIds[L]:void 0;if(D)L++;return{...R$({content:[I],toolUseResult:A.toolUseResult,mcpMeta:A.mcpMeta,isMeta:A.isMeta,isVisibleInTranscriptOnly:A.isVisibleInTranscriptOnly,timestamp:A.timestamp,imagePasteIds:B!==void 0?[B]:void 0}),uuid:$?p3.randomUUID():A.uuid}})}}})}function waD(H){return H.type==="assistant"&&H.message.content.some(($)=>$.type==="tool_use")}function qaD(H){return H.type==="user"&&(Array.isArray(H.message.content)&&H.message.content[0]?.type==="tool_result"||Boolean(H.toolUseResult))}function omD(H,$){let A=new Map;for(let B of H){if(waD(B)){let f=B.message.content[0]?.id;if(f){if(!A.has(f))A.set(f,{toolUse:null,preHooks:[],toolResult:null,postHooks:[]});A.get(f).toolUse=B}continue}if(DpH(B)&&B.attachment.hookEvent==="PreToolUse"){let f=B.attachment.toolUseID;if(!A.has(f))A.set(f,{toolUse:null,preHooks:[],toolResult:null,postHooks:[]});A.get(f).preHooks.push(B);continue}if(B.type==="user"&&B.message.content[0]?.type==="tool_result"){let f=B.message.content[0].tool_use_id;if(!A.has(f))A.set(f,{toolUse:null,preHooks:[],toolResult:null,postHooks:[]});A.get(f).toolResult=B;continue}if(DpH(B)&&B.attachment.hookEvent==="PostToolUse"){let f=B.attachment.toolUseID;if(!A.has(f))A.set(f,{toolUse:null,preHooks:[],toolResult:null,postHooks:[]});A.get(f).postHooks.push(B);continue}}let L=[],I=new Set;for(let B of H){if(waD(B)){let f=B.message.content[0]?.id;if(f&&!I.has(f)){I.add(f);let E=A.get(f);if(E&&E.toolUse){if(L.push(E.toolUse),L.push(...E.preHooks),E.toolResult)L.push(E.toolResult);L.push(...E.postHooks)}}continue}if(DpH(B)&&(B.attachment.hookEvent==="PreToolUse"||B.attachment.hookEvent==="PostToolUse"))continue;if(B.type==="user"&&B.message.content[0]?.type==="tool_result")continue;if(B.type==="system"&&B.subtype==="api_error"){let f=L.at(-1);if(f?.type==="system"&&f.subtype==="api_error")L[L.length-1]=B;else L.push(B);continue}L.push(B)}for(let B of $)L.push(B);let D=L.at(-1);return L.filter((B)=>B.type!=="system"||B.subtype!=="api_error"||B===D)}function DpH(H){return H.type==="attachment"&&(H.attachment.type==="hook_blocking_error"||H.attachment.type==="hook_cancelled"||H.attachment.type==="hook_error_during_execution"||H.attachment.type==="hook_non_blocking_error"||H.attachment.type==="hook_success"||H.attachment.type==="hook_system_message"||H.attachment.type==="hook_additional_context"||H.attachment.type==="hook_stopped_continuation")}function tmD(H,$){let A=new Map,L=new Map,I=new Map;for(let J of $)if(J.type==="assistant"){let F=J.message.id,Q=A.get(F);if(!Q)Q=new Set,A.set(F,Q);for(let W of J.message.content)if(W.type==="tool_use")Q.add(W.id),L.set(W.id,F),I.set(W.id,W)}let D=new Map;for(let[J,F]of L)D.set(J,A.get(F));let B=new Map,f=new Map,E=new Map,M=new Map,G=new Set,U=new Set;for(let J of H){if(J.type==="progress"){let F=J.parentToolUseID,Q=B.get(F);if(Q)Q.push(J);else B.set(F,[J]);if(J.data.type==="hook_progress"){let W=J.data.hookEvent,P=f.get(F);if(!P)P=new Map,f.set(F,P);P.set(W,(P.get(W)??0)+1)}}if(J.type==="user"){for(let F of J.message.content)if(F.type==="tool_result"){if(M.set(F.tool_use_id,J),G.add(F.tool_use_id),F.is_error)U.add(F.tool_use_id)}}if(DpH(J)){let F=J.attachment.toolUseID,Q=J.attachment.hookEvent,W=J.attachment.hookName;if(W!==void 0){let P=E.get(F);if(!P)P=new Map,E.set(F,P);let Y=P.get(Q);if(!Y)Y=new Set,P.set(Q,Y);Y.add(W)}}}let X=new Map;for(let[J,F]of E){let Q=new Map;for(let[W,P]of F)Q.set(W,P.size);X.set(J,Q)}return{siblingToolUseIDs:D,progressMessagesByToolUseID:B,inProgressHookCounts:f,resolvedHookCounts:X,toolResultByToolUseID:M,toolUseByToolUseID:I,normalizedMessageCount:H.length,resolvedToolUseIDs:G,erroredToolUseIDs:U}}function rmD(H,$){let A=Ss(H);if(!A)return new Set;return $.siblingToolUseIDs.get(A)??new Set}function amD(H,$){let A=Ss(H);if(!A)return[];return $.progressMessagesByToolUseID.get(A)??[]}function smD(H,$,A){let L=A.inProgressHookCounts.get(H)?.get($)??0,I=A.resolvedHookCounts.get(H)?.get($)??0;return L>I}function cY1(H){let $=[],A=[];for(let L=H.length-1;L>=0;L--){let I=H[L];if(I.type==="attachment")A.unshift(I);else if((I.type==="assistant"||I.type==="user"&&Array.isArray(I.message.content)&&I.message.content[0]?.type==="tool_result")&&A.length>0)$.unshift(I,...A),A.length=0;else $.unshift(I)}return $.unshift(...A),$}function pwD(H){return H.type==="system"&&H.subtype==="local_command"}function lY1(H,$){let A=H.message.content;if(!Array.isArray(A))return H;if(!A.some((I)=>I.type==="tool_result"&&Array.isArray(I.content)&&I.content.some((D)=>{if(!cg(D))return!1;let B=D.tool_name;return B&&!$.has(B)})))return H;return{...H,message:{...H.message,content:A.map((I)=>{if(I.type!=="tool_result"||!Array.isArray(I.content))return I;let D=I.content.filter((B)=>{if(!cg(B))return!0;let f=B.tool_name;if(!f)return!0;let E=$.has(f);if(!E)N(`Filtering out tool_reference for unavailable tool: ${f}`,{level:"warn"});return E});if(D.length===0)return{...I,content:[{type:"text",text:"[Tool references removed - tools no longer available]"}]};return{...I,content:D}})}}}function shA(H){let $=H.message.content;if(!Array.isArray($))return H;if(!$.some((L)=>L.type==="tool_result"&&Array.isArray(L.content)&&L.content.some(cg)))return H;return{...H,message:{...H.message,content:$.map((L)=>{if(L.type!=="tool_result"||!Array.isArray(L.content))return L;let I=L.content.filter((D)=>!cg(D));if(I.length===0)return{...L,content:[{type:"text",text:"[Tool references removed - tool search not enabled]"}]};return{...L,content:I}})}}}function arD(H){if(!H.message.content.some((A)=>A.type==="tool_use"&&("caller"in A)&&A.caller!==null))return H;return{...H,message:{...H.message,content:H.message.content.map((A)=>{if(A.type!=="tool_use")return A;return{type:"tool_use",id:A.id,name:A.name,input:A.input}})}}}function GJ(H,$=[]){let A=new Set($.map((G)=>G.name)),L=cY1(H),D=new Set([K4A(),Q4A(),W4A(),BU$()].flatMap((G)=>L.filter((U)=>YaD(U)&&U.message.content.some((X)=>X.type==="text"&&X.text===G)).map((U)=>U.uuid))).size>0,B=[];L.filter((G)=>{if(G.type==="progress"||G.type==="system"||YaD(G))return!1;return!0}).forEach((G)=>{switch(G.type){case"user":{let U=G;if(!Pm())U=shA(G);else U=lY1(G,A);if(D&&U.isMeta){let J=U.message.content;if(Array.isArray(J)){let F=J.filter((Q)=>Q.type!=="document");if(F.length===0)return;if(F.length<J.length)U={...U,message:{...U.message,content:F}}}}let X=K6(B);if(X?.type==="user"){B[B.indexOf(X)]=TaD(X,U);return}B.push(U);return}case"assistant":{let U=Pm(),X={...G,message:{...G.message,content:G.message.content.map((J)=>{if(J.type==="tool_use"){let F=$.find((W)=>W.name===J.name),Q=F?zzD(F,J.input):J.input;if(U)return{...J,input:Q};return{type:"tool_use",id:J.id,name:J.name,input:Q}}return J})}};for(let J=B.length-1;J>=0;J--){let F=B[J];if(F.type!=="assistant"&&!rY1(F))break;if(F.type==="assistant"){if(F.message.id===X.message.id){B[J]=nY1(F,X);return}break}}B.push(X);return}case"attachment":{let U=L21(G.attachment),X=K6(B);if(X?.type==="user"){B[B.indexOf(X)]=U.reduce((J,F)=>iY1(J,F),X);return}B.push(...U);return}}}),j6I(B);let f=GuH(B),E=D21(f),M=MuH(E);return f21(M)}function iY1(H,$){let A=Qz$(H.message.content),L=Qz$($.message.content);return{...H,message:{...H.message,content:zaD(aY1(A,L))}}}function nY1(H,$){return{...H,message:{...H.message,content:[...H.message.content,...$.message.content]}}}function rY1(H){if(H.type!=="user")return!1;let $=H.message.content;if(typeof $==="string")return!1;return $.some((A)=>A.type==="tool_result")}function TaD(H,$){let A=Qz$(H.message.content),L=Qz$($.message.content);return{...H,message:{...H.message,content:zaD([...A,...L])}}}function zaD(H){let $=[],A=[];for(let L of H)if(L.type==="tool_result")$.push(L);else A.push(L);return[...$,...A]}function Qz$(H){if(typeof H==="string")return[{type:"text",text:H}];return H}function aY1(H,$){let A=K6(H);if(A?.type==="tool_result"&&typeof A.content==="string"&&$.every((L)=>L.type==="text"))return[...H.slice(0,-1),{...A,content:[A.content,...$.map((L)=>L.text)].map((L)=>L.trim()).filter(Boolean).join(`
`,$++;continue}bu+=A,$++}}function Pn(){if(!j5H)return;if(j5H=!1,lzH)process.stdin.removeListener("readable",lzH),lzH=null}function P0A(){Pn();let H=bu.trim();return bu="",H}function pR0(){return bu.trim().length>0}function dR0(){return j5H}var bu="",j5H=!1,lzH=null;function rR0(H,$,A,L){if($.length>0)IHH();for(let I of $){let D=I.sequence;if(D===jtL){H.handleTerminalFocus(!0);let f=new dzH("terminalfocus");H.internal_eventEmitter.emit("terminalfocus",f);continue}if(D===RtL){H.handleTerminalFocus(!1);let f=new dzH("terminalblur");H.internal_eventEmitter.emit("terminalblur",f);continue}if(I.name==="z"&&I.ctrl&&nR0){H.handleSuspend();continue}H.handleInput(D);let B=new F1$(I);H.internal_eventEmitter.emit("input",B)}}var PO,leL,cR0="\t",lR0="\x1B[Z",iR0="\x1B",nR0=!0,V1$;var ieL=K(()=>{D1$();$0A();A0A();M1$();B0A();xeL();J1$();K0A();mzH();Q0A();W0A();K1$();yBA();MLH();Dy();Y1();NA();z5H();p$();PO=h(t(),1),leL=["iTerm.app","kitty","WezTerm","ghostty"];V1$=class V1$ extends PO.PureComponent{static displayName="InternalApp";static getDerivedStateFromError(H){return{error:H}}state={isFocusEnabled:!0,activeFocusId:void 0,focusables:[],error:void 0};rawModeEnabledCount=0;internal_eventEmitter=new T5H;keyParseState=heL;incompleteEscapeTimer=null;NORMAL_TIMEOUT=50;PASTE_TIMEOUT=500;isRawModeSupported(){return this.props.stdin.isTTY}render(){return PO.default.createElement(x5H.Provider,{value:{columns:this.props.terminalColumns,rows:this.props.terminalRows}},PO.default.createElement(B1$.Provider,{value:{exit:this.handleExit}},PO.default.createElement(M0A,{initialState:this.props.initialTheme,onThemeChange:this.props.onThemeChange,onThemeSave:this.props.onThemeSave},PO.default.createElement(f1$.Provider,{value:{stdin:this.props.stdin,setRawMode:this.handleSetRawMode,isRawModeSupported:this.isRawModeSupported(),internal_exitOnCtrlC:this.props.exitOnCtrlC,internal_eventEmitter:this.internal_eventEmitter}},PO.default.createElement(E1$.Provider,{value:{activeId:this.state.activeFocusId,add:this.addFocusable,remove:this.removeFocusable,activate:this.activateFocusable,deactivate:this.deactivateFocusable,enableFocus:this.enableFocus,disableFocus:this.disableFocus,focusNext:this.focusNext,focusPrevious:this.focusPrevious,focus:this.focus}},PO.default.createElement(UeL,null,PO.default.createElement(jeL,null,this.state.error?PO.default.createElement(J0A,{error:this.state.error}):this.props.children)))))))}componentDidMount(){if(this.props.stdout.isTTY&&!A$(process.env.CLAUDE_CODE_ACCESSIBILITY))this.props.stdout.write(czH)}componentWillUnmount(){if(this.props.stdout.isTTY)this.props.stdout.write(VO);if(this.incompleteEscapeTimer)clearTimeout(this.incompleteEscapeTimer),this.incompleteEscapeTimer=null;if(this.isRawModeSupported())this.handleSetRawMode(!1)}componentDidCatch(H){this.handleExit(H)}handleSetRawMode=(H)=>{let{stdin:$}=this.props;if(!this.isRawModeSupported())if($===process.stdin)throw Error(`Raw mode is not supported on the current process.stdin, which Ink uses as input stream by default.
${D}`:A}}if($)Array.prototype.push.apply(H.errors,this.errors),Array.prototype.push.apply(H.warnings,this.warnings);else H.errors=this.errors,H.warnings=this.warnings;this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:QdL(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(H,$=!1,A=-1){for(let L of H)yield*this.next(L);yield*this.end($,A)}*next(H){if(j20.env.LOG_STREAM)console.dir(H,{depth:null});switch(H.type){case"directive":this.directives.add(H.source,($,A,L)=>{let I=kqH(H);I[0]+=$,this.onError(I,"BAD_DIRECTIVE",A,L)}),this.prelude.push(H.source),this.atDirectives=!0;break;case"document":{let $=v20.composeDoc(this.options,this.directives,H,this.onError);if(this.atDirectives&&!$.directives.docStart)this.onError(H,"MISSING_CHAR","Missing directives-end/doc-start indicator line");if(this.decorate($,!1),this.doc)yield this.doc;this.doc=$,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(H.source);break;case"error":{let $=H.source?`${H.message}: ${JSON.stringify(H.source)}`:H.message,A=new bqH.YAMLParseError(kqH(H),"UNEXPECTED_TOKEN",$);if(this.atDirectives||!this.doc)this.errors.push(A);else this.doc.errors.push(A);break}case"doc-end":{if(!this.doc){this.errors.push(new bqH.YAMLParseError(kqH(H),"UNEXPECTED_TOKEN","Unexpected doc-end without preceding document"));break}this.doc.directives.docEnd=!0;let $=h20.resolveEnd(H.end,H.offset+H.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),$.comment){let A=this.doc.comment;this.doc.comment=A?`${A}
`,$),D=I>=0?H.slice($,I):H.slice($);if($=I>=0?I+1:H.length,!D.includes('"type":"user"')&&!D.includes('"type": "user"'))continue;if(D.includes('"tool_result"'))continue;if(D.includes('"isMeta":true')||D.includes('"isMeta": true'))continue;try{let B=DA(D);if(B.type!=="user")continue;let f=B.message;if(!f)continue;let E=f.content,M="";if(typeof E==="string")M=E;else if(Array.isArray(E)){let X=E.find((J)=>J.type==="text");if(X?.text&&typeof X.text==="string")M=X.text}if(!M)continue;let G=M.replace(/\n/g," ").trim(),U=WD(G,UV);if(U){let X=U.replace(/^\//,""),J=WD(G,"command-args")?.trim()||"";if(Yp().has(X)||!J){if(!L)L=U;continue}return J?`${U} ${J}`:U}if(OaD.test(G))continue;if(G.length>200)G=G.slice(0,200).trim()+"\u2026";return G}catch{continue}}if(L)return L;return""}function Wz$(H,$){let A=[`"${$}":"`,`"${$}": "`];for(let L of A){let I=H.indexOf(L);if(I<0)continue;let D=I+L.length,B=D;while(B<H.length){if(H[B]==="\\"){B+=2;continue}if(H[B]==='"')return H.slice(D,B);B++}}return}function LPH(H,$){let A=[`"${$}":"`,`"${$}": "`],L;for(let I of A){let D=0;while(!0){let B=H.indexOf(I,D);if(B<0)break;let f=B+I.length,E=f;while(E<H.length){if(H[E]==="\\"){E+=2;continue}if(H[E]==='"'){L=H.slice(f,E);break}E++}D=E+1}}return L}function IPH(H,$,A){let I=[...vaD(H).entries()].sort((B,f)=>f[1].mtime-B[1].mtime);if($&&I.length>$)I=I.slice(0,$);let D=[];for(let[B,f]of I)D.push({date:new Date(f.mtime).toISOString(),messages:[],isLite:!0,fullPath:f.path,value:0,created:new Date(f.ctime),modified:new Date(f.mtime),firstPrompt:"",messageCount:0,fileSize:f.size,isSidechain:!1,sessionId:B,projectPath:A});return oHH(D).map((B,f)=>({...B,value:f}))}async function z21(H,$){if(!H.isLite||!H.fullPath)return H;let A=await q21(H.fullPath,H.fileSize??0,$),L={...H,isLite:!1,firstPrompt:A.firstPrompt,gitBranch:A.gitBranch,isSidechain:A.isSidechain,teamName:A.teamName,customTitle:A.customTitle,tag:A.tag,agentSetting:A.agentSetting,prNumber:A.prNumber,prUrl:A.prUrl,prRepository:A.prRepository,projectPath:A.projectPath??H.projectPath};if(!L.firstPrompt&&!L.customTitle)return null;if(L.isSidechain||L.teamName)return null;return L}async function r1H(H,$,A){let L=[],I=Buffer.alloc(Vz$),D=$;while(D<H.length&&L.length<A){let B=H[D];D++;let f=await z21(B,I);if(f)L.push(f)}return{logs:L,nextIndex:D}}var d3,Oz,M21,DPH,OaD,AZ=null,NaD=!1,X21=10,PbA,Vz$=16384;var nB=K(()=>{_L();lM();p$();NA();VI();CM();Z$();DL();mL();aD();r8();VmH();Dw$();E$();_$();vx();R4();DE();z$();CE();P6();Z$();MU();d3=require("path"),Oz=require("fs/promises"),M21={ISSUES_EXPLAINER:"report the issue at https://github.com/anthropics/claude-code/issues",PACKAGE_URL:"@anthropic-ai/claude-code",README_URL:"https://code.claude.com/docs/en/overview",VERSION:"2.1.33",FEEDBACK_CHANNEL:"https://github.com/anthropics/claude-code/issues",BUILD_TIME:"2026-02-06T00:15:09Z"}.VERSION,DPH=Y$(),OaD=new RegExp(`^(?:<local-command-stdout>|<session-start-hook>|<${TN}>|\\s*<ide_opened_file>[\\s\\S]*</ide_opened_file>\\s*$|\\s*<ide_selection>[\\s\\S]*</ide_selection>\\s*$)`);PbA=o$(async(H)=>{let{messages:$}=await VbA(H);return new Set($.keys())},(H)=>H)});function Vd(){return process.env.USE_MCP_CLI_DIR||YbA.join(haD.tmpdir(),"claude-code-mcp-cli")}function BPH(){if(sU()){let H=process.env.CLAUDE_CODE_SESSION_ID;if(H)return H}return j$()}function baD(){if(!sU())return;WB(async()=>{try{let H=Yz$();await Wd.rm(H,{force:!0});let $=Vd();if((await Wd.readdir($)).length===0)await Wd.rm($,{recursive:!0,force:!0})}catch{}})}function Yz$(){let H=BPH();return YbA.join(Vd(),`${H}.json`)}function N21(H){let $={name:H.name,type:H.type};if(H.type==="connected")return{...$,capabilities:H.capabilities};return $}async function O21(H){let $="";try{$=await H.description({},{isNonInteractiveSession:!1,toolPermissionContext:{mode:"default",additionalWorkingDirectories:new Map,alwaysAllowRules:{},alwaysDenyRules:{},alwaysAskRules:{},isBypassPermissionsModeAvailable:!1},tools:[]})}catch{}return{name:H.name,description:$,inputJSONSchema:H.inputJSONSchema,isMcp:H.isMcp,originalToolName:H.originalMcpToolName}}async function kaD(H,$,A){if(!sU())return;try{await Wd.mkdir(Vd(),{recursive:!0});let L=await Promise.all($.filter((E)=>E.isMcp).map(O21)),I={},D={};for(let E of H){I[E.name]=E.config;let M=B1(E.name);if(D[M]&&D[M]!==E.name)console.warn(`Warning: MCP server name collision detected. Both "${D[M]}" and "${E.name}" normalize to "${M}". Only "${E.name}" will be accessible via normalized lookup.`);D[M]=E.name}let B={clients:H.map(N21),configs:I,tools:L,resources:A,normalizedNames:D},f=Yz$();await Wd.writeFile(f,vH(B,null,2))}catch{}}var YbA,haD,Wd;var fPH=K(()=>{p$();CE();tQ();Z$();YbA=require("path"),haD=require("os"),Wd=require("fs/promises")});function _Y(H){return H.toLowerCase()}function gaD(H,$){if(oA()==="windows"){let A=XR(H),L=XR($);return B9.posix.relative(A,L)}return B9.posix.relative(H,$)}function _B$(H){if(oA()==="windows")return XR(H);return H}function j21(){return z_.map((H)=>nM(H)).filter((H)=>H!==void 0)}function dqA(H){let $=OD(H),A=_Y($);if(A.endsWith(`${B9.sep}.claude${B9.sep}settings.json`)||A.endsWith(`${B9.sep}.claude${B9.sep}settings.local.json`))return!0;return j21().some((L)=>_Y(L)===A)}function R21(H){if(dqA(H))return!0;let $=B9.join(zL(),".claude","commands"),A=B9.join(zL(),".claude","agents"),L=B9.join(zL(),".claude","skills");return Em(H,$)||Em(H,A)||Em(H,L)}function y21(H){if(!Vd())return!1;let $=OD(H);return Em($,Vd())}function maD(H){let $=B9.join(K7(),xRH()),A=B9.normalize(H);return A.startsWith($)&&A.endsWith(".md")}function Zz$(){return B9.join(iU(Y$()),j$(),"session-memory")+B9.sep}function l6H(){return B9.join(Zz$(),"summary.md")}function v21(H){return B9.normalize(H).startsWith(Zz$())}function h21(H){let $=iU(Y$()),A=B9.normalize(H);return A===$||A.startsWith($+B9.sep)}function $PH(){return pf("tengu_scratch")}function xSA(){if(oA()==="windows")return"claude";return`claude-${process.getuid?.()??0}`}function AzH(){let H=process.env.CLAUDE_CODE_TMPDIR||(oA()==="windows"?wz$.tmpdir():"/tmp"),$=zH(),A=H;try{A=$.realpathSync(H)}catch{}return B9.join(A,xSA())+B9.sep}function gJ$(){return B9.join(AzH(),dYH(zL()))+B9.sep}function Gz$(){return B9.join(gJ$(),j$(),"scratchpad")}function paD(){if(!$PH())throw Error("Scratchpad directory feature is not enabled");let H=zH(),$=Gz$();return H.mkdirSync($,{mode:448}),$}function daD(H){if(!$PH())return!1;let $=Gz$(),A=B9.normalize(H);return A===$||A.startsWith($+B9.sep)}function b21(H){let A=OD(H).split(B9.sep),L=A[A.length-1];if(H.startsWith("\\\\")||H.startsWith("//"))return!0;for(let I=0;I<A.length;I++){let D=A[I],B=_Y(D);for(let f of S21){if(B!==_Y(f))continue;if(f===".claude"){let E=A[I+1];if(E&&_Y(E)==="worktrees")break}return!0}}if(L){let I=_Y(L);if(x21.some((D)=>_Y(D)===I))return!0}return!1}function caD(H){if(H.indexOf(":",2)!==-1)return!0;if(/~\d/.test(H))return!0;if(H.startsWith("\\\\?\\")||H.startsWith("\\\\.\\")||H.startsWith("//?/")||H.startsWith("//./"))return!0;if(/[.\s]+$/.test(H))return!0;if(/\.(CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])$/i.test(H))return!0;if(/(^|\/|\\)\.{3,}(\/|\\|$)/.test(H))return!0;if(m2$(H))return!0;return!1}function _ZA(H){let $=QHH(H);for(let A of $)if(caD(A))return{safe:!1,message:`Claude requested permissions to write to ${H}, which contains a suspicious Windows path pattern that requires manual approval.`};for(let A of $)if(R21(A))return{safe:!1,message:`Claude requested permissions to write to ${H}, but you haven't granted it yet.`};for(let A of $)if(y21(A));for(let A of $)if(b21(A))return{safe:!1,message:`Claude requested permissions to edit ${H} which is a sensitive file.`};return{safe:!0}}function l7H(H){return new Set([zL(),...H.additionalWorkingDirectories.keys()])}function YS(H,$){return QHH(H).every((L)=>Array.from(l7H($)).some((I)=>Em(L,I)))}function Em(H,$){let A=OD(H),L=OD($),I=A.replace(/^\/private\/var\//,"/var/").replace(/^\/private\/tmp(\/|$)/,"/tmp$1"),D=L.replace(/^\/private\/var\//,"/var/").replace(/^\/private\/tmp(\/|$)/,"/tmp$1"),B=_Y(I),f=_Y(D),E=gaD(f,B);if(E==="")return!0;if(RMH(E))return!1;return!B9.posix.isAbsolute(E)}function k21(H){switch(H){case"cliArg":case"command":case"session":return OD(zL());case"userSettings":case"policySettings":case"projectSettings":case"localSettings":case"flagSettings":return iUH(H)}}function wbA(H){return B9.posix.join(nP,H)}function u21({patternRoot:H,pattern:$,rootPath:A}){let L=B9.posix.join(H,$);if(H===A)return wbA($);else if(L.startsWith(`${A}${nP}`)){let I=L.slice(A.length);return wbA(I)}else{let I=B9.posix.relative(A,H);if(!I||I.startsWith(`..${nP}`)||I==="..")return null;else{let D=B9.posix.join(I,$);return wbA(D)}}}function eJH(H,$){let A=new Set(H.get(null)??[]);for(let[L,I]of H.entries()){if(L===null)continue;for(let D of I){let B=u21({patternRoot:L,pattern:D,rootPath:$});if(B)A.add(B)}}return Array.from(A)}function HFH(H){let $=laD(H,"read","deny"),A=new Map;for(let[L,I]of $.entries())A.set(L,Array.from(I.keys()));return A}function g21(H,$){if(H.startsWith(`${nP}${nP}`)){let L=H.slice(1);if(oA()==="windows"&&L.match(/^\/[a-z]\//i)){let I=L[1]?.toUpperCase()??"C",D=L.slice(2),B=`${I}:\\`;return{relativePattern:D.startsWith("/")?D.slice(1):D,root:B}}return{relativePattern:L,root:nP}}else if(H.startsWith(`~${nP}`))return{relativePattern:H.slice(1),root:wz$.homedir()};else if(H.startsWith(nP))return{relativePattern:H,root:k21($)};let A=H;if(H.startsWith(`.${nP}`))A=H.slice(2);return{relativePattern:A,root:null}}function laD(H,$,A){let L=(()=>{switch($){case"edit":return ZB;case"read":return eD}})(),I=IbA(H,L,A),D=new Map;for(let[B,f]of I.entries()){let{relativePattern:E,root:M}=g21(B,f.source),G=D.get(M);if(G===void 0)G=new Map,D.set(M,G);G.set(E,f)}return D}function oQ(H,$,A,L){let I=OD(H);if(oA()==="windows"&&I.includes("\\"))I=XR(I);let D=laD($,A,L);for(let[B,f]of D.entries()){let E=Array.from(f.keys()).map((X)=>{let J=X;if(B===nP&&X.startsWith(nP))J=X.slice(1);if(J.endsWith("/**"))J=J.slice(0,-3);return J}),M=uaD.default().add(E),G=gaD(B??Y$(),I??Y$());if(G.startsWith(`..${nP}`))continue;if(!G)continue;let U=M.test(G);if(U.ignored&&U.rule){let X=U.rule.pattern,J=X+"/**";if(f.has(J))return f.get(J)??null;if(B===nP&&!X.startsWith(nP)){X=nP+X;let F=X+"/**";if(f.has(F))return f.get(F)??null}return f.get(X)??null}}return null}function Rr(H,$,A){if(typeof H.getPath!=="function")return{behavior:"ask",message:`Claude requested permissions to use ${H.name}, but you haven't granted it yet.`};let L=H.getPath($),I=QHH(L);for(let G of I)if(G.startsWith("\\\\")||G.startsWith("//"))return{behavior:"ask",message:`Claude requested permissions to read from ${L}, which appears to be a UNC path that could access network resources.`,decisionReason:{type:"other",reason:"UNC path detected (defense-in-depth check)"}};for(let G of I)if(caD(G))return{behavior:"ask",message:`Claude requested permissions to read from ${L}, which contains a suspicious Windows path pattern that requires manual approval.`,decisionReason:{type:"other",reason:"Path contains suspicious Windows-specific patterns (alternate data streams, short names, long path prefixes, or three or more consecutive dots) that require manual verification"}};for(let G of I){let U=oQ(G,A,"read","deny");if(U)return{behavior:"deny",message:`Permission to read ${L} has been denied.`,decisionReason:{type:"rule",rule:U}}}for(let G of I){let U=oQ(G,A,"read","ask");if(U)return{behavior:"ask",message:`Claude requested permissions to read from ${L}, but you haven't granted it yet.`,decisionReason:{type:"rule",rule:U}}}let D=K9H(H,$,A);if(D.behavior==="allow")return D;if(YS(L,A))return{behavior:"allow",updatedInput:$,decisionReason:{type:"mode",mode:"default"}};let f=OD(L),E=YZA(f,$);if(E.behavior!=="passthrough")return E;let M=oQ(L,A,"read","allow");if(M)return{behavior:"allow",updatedInput:$,decisionReason:{type:"rule",rule:M}};return{behavior:"ask",message:`Claude requested permissions to read from ${L}, but you haven't granted it yet.`,suggestions:qz$(L,"read",A),decisionReason:{type:"workingDir",reason:"Path is outside allowed working directories"}}}function K9H(H,$,A){if(typeof H.getPath!=="function")return{behavior:"ask",message:`Claude requested permissions to use ${H.name}, but you haven't granted it yet.`};let L=H.getPath($),I=QHH(L);for(let U of I){let X=oQ(U,A,"edit","deny");if(X)return{behavior:"deny",message:`Permission to edit ${L} has been denied.`,decisionReason:{type:"rule",rule:X}}}let D=OD(L),B=CZA(D,$);if(B.behavior!=="passthrough")return B;let f=oQ(L,A,"edit","allow");if(f&&f.source==="session"){let U=f.ruleValue.ruleContent;if(U===r0$||U===a0$)return{behavior:"allow",updatedInput:$,decisionReason:{type:"rule",rule:f}}}let E=_ZA(L);if(!E.safe)return{behavior:"ask",message:E.message,decisionReason:{type:"other",reason:E.message}};for(let U of I){let X=oQ(U,A,"edit","ask");if(X)return{behavior:"ask",message:`Claude requested permissions to write to ${L}, but you haven't granted it yet.`,decisionReason:{type:"rule",rule:X}}}let M=YS(L,A);if(A.mode==="acceptEdits"&&M)return{behavior:"allow",updatedInput:$,decisionReason:{type:"mode",mode:A.mode}};let G=oQ(L,A,"edit","allow");if(G)return{behavior:"allow",updatedInput:$,decisionReason:{type:"rule",rule:G}};return{behavior:"ask",message:`Claude requested permissions to write to ${L}, but you haven't granted it yet.`,suggestions:qz$(L,"write",A),decisionReason:!M?{type:"workingDir",reason:"Path is outside allowed working directories"}:void 0}}function qz$(H,$,A){let L=!YS(H,A);if($==="read"&&L){let I=Qk(H);return QHH(I).map((f)=>PB$(f,"session")).filter((f)=>f!==void 0)}if($==="write"||$==="create"){let I=[{type:"setMode",mode:"acceptEdits",destination:"session"}];if(L){let D=Qk(H),B=QHH(D);I.push({type:"addDirectories",directories:B,destination:"session"})}return I}return[{type:"setMode",mode:"acceptEdits",destination:"session"}]}function CZA(H,$){let A=B9.normalize(H);if(maD(A))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:"Plan files for current session are allowed for writing"}};if(daD(A))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:"Scratchpad files for current session are allowed for writing"}};if(qRH(A))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:"Agent memory files are allowed for writing"}};if(wRH(A))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:`${Im()} files are allowed for writing`}};let L=B9.join(UL(),"teams")+B9.sep;if(A===L.slice(0,-1)||A.startsWith(L))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:"Team files are allowed for writing"}};let I=B9.join(UL(),"tasks")+B9.sep;if(A===I.slice(0,-1)||A.startsWith(I))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:"Task files are allowed for writing"}};return{behavior:"passthrough",message:""}}function YZA(H,$){let A=B9.normalize(H);if(v21(A))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:"Session memory files are allowed for reading"}};if(h21(A))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:"Project directory files are allowed for reading"}};if(maD(A))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:"Plan files for current session are allowed for reading"}};let L=iFH(),I=L.endsWith(B9.sep)?L:L+B9.sep;if(A===L||A.startsWith(I))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:"Tool result files are allowed for reading"}};if(daD(A))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:"Scratchpad files for current session are allowed for reading"}};let D=gJ$();if(A.startsWith(D))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:"Project temp directory files are allowed for reading"}};if(qRH(A))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:"Agent memory files are allowed for reading"}};if(wRH(A))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:`${Im()} files are allowed for reading`}};let B=B9.join(UL(),"tasks")+B9.sep;if(A===B.slice(0,-1)||A.startsWith(B))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:"Task files are allowed for reading"}};let f=B9.join(UL(),"teams")+B9.sep;if(A===f.slice(0,-1)||A.startsWith(f))return{behavior:"allow",updatedInput:$,decisionReason:{type:"other",reason:"Team files are allowed for reading"}};return{behavior:"passthrough",message:""}}var B9,uaD,wz$,x21,S21,nP;var AM=K(()=>{p$();jD();VI();CM();jMH();nB();C9();CM();P5();UJ();oG();mL();K4();DL();fPH();d2$();vQ();lg();gDH();I3();NA();B9=require("path"),uaD=h(ujH(),1),wz$=require("os"),x21=[".gitconfig",".gitmodules",".bashrc",".bash_profile",".zshrc",".zprofile",".profile",".ripgreprc",".mcp.json",".claude.json"],S21=[".git",".vscode",".idea",".claude"];nP=B9.posix.sep});function m21(H){let $=/[*?[{]/,A=H.match($);if(!A||A.index===void 0){let f=KM.dirname(H),E=KM.basename(H);return{baseDir:f,relativePattern:E}}let L=H.slice(0,A.index),I=Math.max(L.lastIndexOf("/"),L.lastIndexOf(KM.sep));if(I===-1)return{baseDir:"",relativePattern:H};let D=L.slice(0,I),B=H.slice(I+1);if(D===""&&I===0)D="/";if(oA()==="windows"&&/^[A-Za-z]:$/.test(D))D=D+KM.sep;return{baseDir:D,relativePattern:B}}async function jPI(H,$,{limit:A,offset:L},I,D){let B=$,f=H;if(KM.isAbsolute(H)){let{baseDir:W,relativePattern:P}=m21(H);if(W)B=W,f=P}let E=eJH(HFH(D),B),M=A$(process.env.CLAUDE_CODE_GLOB_NO_IGNORE||"true"),G=A$(process.env.CLAUDE_CODE_GLOB_HIDDEN||"true"),U=["--files","--glob",f,"--sort=modified",...M?["--no-ignore"]:[],...G?["--hidden"]:[]];for(let W of E)U.push("--glob",`!${W}`);let J=(await FR(U,B,I)).map((W)=>KM.isAbsolute(W)?W:KM.join(B,W)),F=J.length>L+A;return{files:J.slice(L,L+A),truncated:F}}function raD(H){try{return zH().readFileSync(H,{encoding:"utf8"})}catch($){return r($),null}}function Z3(H){let $=zH();return Math.floor($.statSync(H).mtimeMs)}function xSD(H,$=0,A){let D=zH().readFileSync(H,{encoding:"utf8"}).split(/\r?\n/),B=A!==void 0&&D.length-$>A?D.slice($,$+A):D.slice($);return{content:B.join(`
)${E}\\s*\\)`).test(f))return!1;let G=new RegExp(`^\\$\\(cat\\s*<<-?\\s*(?:'+${E}'+|\\\\${E})[^\\n]*\\n(?:[\\s\\S]*?\\n)?${E}\\s*\\)`);if(!f.match(G))return!1}let I=H;for(let{delimiter:D}of L){let B=D.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),f=new RegExp(`\\$\\(cat\\s*<<-?\\s*(?:'+${B}'+|\\\\${B})[^\\n]*\\n(?:[\\s\\S]*?\\n)?${B}\\s*\\)`);I=I.replace(f,"")}if(/\$\(/.test(I))return!1;if(/\${/.test(I))return!1;return!0}function QH1(H){let{originalCommand:$}=H;if(!twA.test($))return{behavior:"passthrough",message:"No heredoc in substitution"};if(KH1($))return{behavior:"allow",updatedInput:{command:$},decisionReason:{type:"other",reason:"Safe command substitution: cat with quoted/escaped heredoc delimiter"}};return{behavior:"passthrough",message:"Command substitution needs validation"}}function WH1(H){let{originalCommand:$,baseCommand:A}=H;if(A!=="git"||!/^git\s+commit\s+/.test($))return{behavior:"passthrough",message:"Not a git commit"};let L=$.match(/^git\s+commit\s+.*-m\s+(["'])([\s\S]*?)\1(.*)$/);if(L){let[,I,D,B]=L;if(I==='"'&&D&&/\$\(|`|\$\{/.test(D))return c("tengu_bash_security_check_triggered",{checkId:JU.GIT_COMMIT_SUBSTITUTION,subId:1}),{behavior:"ask",message:"Git commit message contains command substitution patterns"};if(B&&/\$\(|`|\$\{/.test(B))return{behavior:"passthrough",message:"Check patterns in flags"};if(D&&D.startsWith("-"))return c("tengu_bash_security_check_triggered",{checkId:JU.OBFUSCATED_FLAGS,subId:5}),{behavior:"ask",message:"Command contains quoted characters in flag names"};return{behavior:"allow",updatedInput:{command:$},decisionReason:{type:"other",reason:"Git commit with simple quoted message is allowed"}}}return{behavior:"passthrough",message:"Git commit needs validation"}}function VH1(H){let{originalCommand:$}=H;if(twA.test($))return{behavior:"passthrough",message:"Heredoc in substitution"};let A=/<<-?\s*'[^']+'/,L=/<<-?\s*\\\w+/;if(A.test($)||L.test($))return{behavior:"allow",updatedInput:{command:$},decisionReason:{type:"other",reason:"Heredoc with quoted/escaped delimiter is safe"}};return{behavior:"passthrough",message:"No heredoc patterns"}}function PH1(H){let{originalCommand:$,baseCommand:A}=H;if(A!=="jq")return{behavior:"passthrough",message:"Not jq"};if(/\bsystem\s*\(/.test($))return c("tengu_bash_security_check_triggered",{checkId:JU.JQ_SYSTEM_FUNCTION,subId:1}),{behavior:"ask",message:"jq command contains system() function which executes arbitrary commands"};let L=$.substring(3).trim();if(/(?:^|\s)(?:-f\b|--from-file|--rawfile|--slurpfile|-L\b|--library-path)/.test(L))return c("tengu_bash_security_check_triggered",{checkId:JU.JQ_FILE_ARGUMENTS,subId:1}),{behavior:"ask",message:"jq command contains dangerous flags that could execute code or read arbitrary files"};return{behavior:"passthrough",message:"jq command is safe"}}function _H1(H){let{unquotedContent:$}=H,A="Command contains shell metacharacters (;, |, or &) in arguments";if(/(?:^|\s)["'][^"']*[;&][^"']*["'](?:\s|$)/.test($))return c("tengu_bash_security_check_triggered",{checkId:JU.SHELL_METACHARACTERS,subId:1}),{behavior:"ask",message:"Command contains shell metacharacters (;, |, or &) in arguments"};if([/-name\s+["'][^"']*[;|&][^"']*["']/,/-path\s+["'][^"']*[;|&][^"']*["']/,/-iname\s+["'][^"']*[;|&][^"']*["']/].some((I)=>I.test($)))return c("tengu_bash_security_check_triggered",{checkId:JU.SHELL_METACHARACTERS,subId:2}),{behavior:"ask",message:"Command contains shell metacharacters (;, |, or &) in arguments"};if(/-regex\s+["'][^"']*[;&][^"']*["']/.test($))return c("tengu_bash_security_check_triggered",{checkId:JU.SHELL_METACHARACTERS,subId:3}),{behavior:"ask",message:"Command contains shell metacharacters (;, |, or &) in arguments"};return{behavior:"passthrough",message:"No metacharacters"}}function CH1(H){let{fullyUnquotedContent:$}=H;if(/[<>|]\s*\$[A-Za-z_]/.test($)||/\$[A-Za-z_][A-Za-z0-9_]*\s*[|<>]/.test($))return c("tengu_bash_security_check_triggered",{checkId:JU.DANGEROUS_VARIABLES,subId:1}),{behavior:"ask",message:"Command contains variables in dangerous contexts (redirections or pipes)"};return{behavior:"passthrough",message:"No dangerous variables"}}function YH1(H){let{unquotedContent:$,fullyUnquotedContent:A}=H;if(XH1($,"`"))return{behavior:"ask",message:"Command contains backticks (`) for command substitution"};for(let{pattern:L,message:I}of MH1)if(L.test($))return c("tengu_bash_security_check_triggered",{checkId:JU.DANGEROUS_PATTERNS_COMMAND_SUBSTITUTION,subId:1}),{behavior:"ask",message:`Command contains ${I}`};if(/</.test(A))return c("tengu_bash_security_check_triggered",{checkId:JU.DANGEROUS_PATTERNS_INPUT_REDIRECTION,subId:1}),{behavior:"ask",message:"Command contains input redirection (<) which could read sensitive files"};if(/>/.test(A))return c("tengu_bash_security_check_triggered",{checkId:JU.DANGEROUS_PATTERNS_OUTPUT_REDIRECTION,subId:1}),{behavior:"ask",message:"Command contains output redirection (>) which could write to arbitrary files"};return{behavior:"passthrough",message:"No dangerous patterns"}}function wH1(H){let{fullyUnquotedContent:$}=H;if(!/[\n\r]/.test($))return{behavior:"passthrough",message:"No newlines"};if(/[\n\r]\s*[a-zA-Z/.~({$![>|]/.test($))return c("tengu_bash_security_check_triggered",{checkId:JU.NEWLINES,subId:1}),{behavior:"ask",message:"Command contains newlines that could separate multiple commands"};return{behavior:"passthrough",message:"Newlines appear to be within data"}}function ZH1(H){let{originalCommand:$}=H;if(/\$IFS|\$\{[^}]*IFS/.test($))return c("tengu_bash_security_check_triggered",{checkId:JU.IFS_INJECTION,subId:1}),{behavior:"ask",message:"Command contains IFS variable usage which could bypass security validation"};return{behavior:"passthrough",message:"No IFS injection detected"}}function qH1(H){let{originalCommand:$}=H;if(/\/proc\/.*\/environ/.test($))return c("tengu_bash_security_check_triggered",{checkId:JU.PROC_ENVIRON_ACCESS,subId:1}),{behavior:"ask",message:"Command accesses /proc/*/environ which could expose sensitive environment variables"};return{behavior:"passthrough",message:"No /proc/environ access detected"}}function TH1(H){let{originalCommand:$}=H,A=wE($);if(!A.success)return{behavior:"passthrough",message:"Parse failed, handled elsewhere"};let L=A.tokens;if(!L.some((D)=>typeof D==="object"&&D!==null&&("op"in D)&&(D.op===";"||D.op==="&&"||D.op==="||")))return{behavior:"passthrough",message:"No command separators"};if(EH1(L))return c("tengu_bash_security_check_triggered",{checkId:JU.MALFORMED_TOKEN_INJECTION,subId:1}),{behavior:"ask",message:"Command contains ambiguous syntax with command separators that could be misinterpreted"};return{behavior:"passthrough",message:"No malformed token injection detected"}}function zH1(H){let{originalCommand:$,baseCommand:A}=H,L=/[|&;]/.test($);if(A==="echo"&&!L)return{behavior:"passthrough",message:"echo command is safe and has no dangerous flags"};if(/\$'[^']*'/.test($))return c("tengu_bash_security_check_triggered",{checkId:JU.OBFUSCATED_FLAGS,subId:5}),{behavior:"ask",message:"Command contains ANSI-C quoting which can hide characters"};if(/\$"[^"]*"/.test($))return c("tengu_bash_security_check_triggered",{checkId:JU.OBFUSCATED_FLAGS,subId:6}),{behavior:"ask",message:"Command contains locale quoting which can hide characters"};if(/\$['"]{2}\s*-/.test($))return c("tengu_bash_security_check_triggered",{checkId:JU.OBFUSCATED_FLAGS,subId:9}),{behavior:"ask",message:"Command contains empty special quotes before dash (potential bypass)"};if(/(?:^|\s)(?:''|"")+\s*-/.test($))return c("tengu_bash_security_check_triggered",{checkId:JU.OBFUSCATED_FLAGS,subId:7}),{behavior:"ask",message:"Command contains empty quotes before dash (potential bypass)"};let I=!1,D=!1,B=!1;for(let f=0;f<$.length-1;f++){let E=$[f],M=$[f+1];if(B){B=!1;continue}if(E==="\\"){B=!0;continue}if(E==="'"&&!D){I=!I;continue}if(E==='"'&&!I){D=!D;continue}if(I||D)continue;if(E&&M&&/\s/.test(E)&&/['"`]/.test(M)){let G=M,U=f+2,X="";while(U<$.length&&$[U]!==G)X+=$[U],U++;if(U<$.length&&$[U]===G&&X.startsWith("-"))return c("tengu_bash_security_check_triggered",{checkId:JU.OBFUSCATED_FLAGS,subId:4}),{behavior:"ask",message:"Command contains quoted characters in flag names"}}if(E&&M&&/\s/.test(E)&&M==="-"){let G=f+1,U="";while(G<$.length){let X=$[G];if(!X)break;if(/[\s=]/.test(X))break;if(/['"`]/.test(X)){if(A==="cut"&&U==="-d"&&/['"`]/.test(X))break;if(G+1<$.length){let J=$[G+1];if(J&&!/[a-zA-Z0-9_'"-]/.test(J))break}}U+=X,G++}if(U.includes('"')||U.includes("'"))return c("tengu_bash_security_check_triggered",{checkId:JU.OBFUSCATED_FLAGS,subId:1}),{behavior:"ask",message:"Command contains quoted characters in flag names"}}}if(/\s['"`]-/.test(H.fullyUnquotedContent))return c("tengu_bash_security_check_triggered",{checkId:JU.OBFUSCATED_FLAGS,subId:2}),{behavior:"ask",message:"Command contains quoted characters in flag names"};if(/['"`]{2}-/.test(H.fullyUnquotedContent))return c("tengu_bash_security_check_triggered",{checkId:JU.OBFUSCATED_FLAGS,subId:3}),{behavior:"ask",message:"Command contains quoted characters in flag names"};return{behavior:"passthrough",message:"No obfuscated flags detected"}}function Zh(H){let $=H.split(" ")[0]||"",{withDoubleQuotes:A,fullyUnquoted:L}=GH1(H,$==="jq"),I={originalCommand:H,baseCommand:$,unquotedContent:A,fullyUnquotedContent:UH1(L)},D=[JH1,FH1,QH1,VH1,WH1];for(let f of D){let E=f(I);if(E.behavior==="allow")return{behavior:"passthrough",message:E.decisionReason?.type==="other"?E.decisionReason.reason:"Command allowed"};if(E.behavior!=="passthrough")return E}let B=[PH1,zH1,_H1,CH1,wH1,ZH1,qH1,YH1,TH1];for(let f of B){let E=f(I);if(E.behavior==="ask")return E}return{behavior:"passthrough",message:"Command passed all security checks"}}var twA,MH1,JU;var w_$=K(()=>{z$();DX();twA=/\$\(.*<</,MH1=[{pattern:/<\(/,message:"process substitution <()"},{pattern:/>\(/,message:"process substitution >()"},{pattern:/\$\(/,message:"$() command substitution"},{pattern:/\$\{/,message:"${} parameter substitution"},{pattern:/\$\[/,message:"$[] legacy arithmetic expansion"},{pattern:/~\[/,message:"Zsh-style parameter expansion"},{pattern:/\(e:/,message:"Zsh-style glob qualifiers"},{pattern:/<#/,message:"PowerShell comment syntax"}],JU={INCOMPLETE_COMMANDS:1,JQ_SYSTEM_FUNCTION:2,JQ_FILE_ARGUMENTS:3,OBFUSCATED_FLAGS:4,SHELL_METACHARACTERS:5,DANGEROUS_VARIABLES:6,NEWLINES:7,DANGEROUS_PATTERNS_COMMAND_SUBSTITUTION:8,DANGEROUS_PATTERNS_INPUT_REDIRECTION:9,DANGEROUS_PATTERNS_OUTPUT_REDIRECTION:10,IFS_INJECTION:11,GIT_COMMIT_SUBSTITUTION:12,PROC_ENVIRON_ACCESS:13,MALFORMED_TOKEN_INJECTION:14}});function b7H(H){if(H!==to)throw Error("Illegal constructor")}function lbH(H){return!!H&&typeof H.row==="number"&&typeof H.column==="number"}function aKD(H){D$=H}function AZA(H,$,A,L){let I=A-$,D=H.textCallback($,L);if(D){$+=D.length;while($<A){let B=H.textCallback($,L);if(B&&B.length>0)$+=B.length,D+=B;else break}if($>A)D=D.slice(0,I)}return D??""}function $ZA(H,$,A,L,I){for(let D=0,B=I.length;D<B;D++){let f=D$.getValue(A,"i32");A+=$B;let E=k4($,A);A+=oC,I[D]={patternIndex:L,name:H.captureNames[f],node:E}}return A}function e9(H,$=0){let A=bD+$*oC;D$.setValue(A,H.id,"i32"),A+=$B,D$.setValue(A,H.startIndex,"i32"),A+=$B,D$.setValue(A,H.startPosition.row,"i32"),A+=$B,D$.setValue(A,H.startPosition.column,"i32"),A+=$B,D$.setValue(A,H[0],"i32")}function k4(H,$=bD){let A=D$.getValue($,"i32");if($+=$B,A===0)return null;let L=D$.getValue($,"i32");$+=$B;let I=D$.getValue($,"i32");$+=$B;let D=D$.getValue($,"i32");$+=$B;let B=D$.getValue($,"i32");return new jH1(to,{id:A,tree:H,startIndex:L,startPosition:{row:I,column:D},other:B})}function zG(H,$=bD){D$.setValue($+0*$B,H[0],"i32"),D$.setValue($+1*$B,H[1],"i32"),D$.setValue($+2*$B,H[2],"i32"),D$.setValue($+3*$B,H[3],"i32")}function Zw(H){H[0]=D$.getValue(bD+0*$B,"i32"),H[1]=D$.getValue(bD+1*$B,"i32"),H[2]=D$.getValue(bD+2*$B,"i32"),H[3]=D$.getValue(bD+3*$B,"i32")}function $z(H,$){D$.setValue(H,$.row,"i32"),D$.setValue(H+$B,$.column,"i32")}function L9H(H){return{row:D$.getValue(H,"i32")>>>0,column:D$.getValue(H+$B,"i32")>>>0}}function oKD(H,$){$z(H,$.startPosition),H+=qh,$z(H,$.endPosition),H+=qh,D$.setValue(H,$.startIndex,"i32"),H+=$B,D$.setValue(H,$.endIndex,"i32"),H+=$B}function q_$(H){let $={};return $.startPosition=L9H(H),H+=qh,$.endPosition=L9H(H),H+=qh,$.startIndex=D$.getValue(H,"i32")>>>0,H+=$B,$.endIndex=D$.getValue(H,"i32")>>>0,$}function tKD(H,$=bD){$z($,H.startPosition),$+=qh,$z($,H.oldEndPosition),$+=qh,$z($,H.newEndPosition),$+=qh,D$.setValue($,H.startIndex,"i32"),$+=$B,D$.setValue($,H.oldEndIndex,"i32"),$+=$B,D$.setValue($,H.newEndIndex,"i32"),$+=$B}function sKD(H){let $={};return $.major_version=D$.getValue(H,"i32"),H+=$B,$.minor_version=D$.getValue(H,"i32"),H+=$B,$.field_count=D$.getValue(H,"i32"),$}function eKD(H,$,A,L){if(H.length!==3)throw Error(`Wrong number of arguments to \`#${A}\` predicate. Expected 2, got ${H.length-1}`);if(!rKD(H[1]))throw Error(`First argument of \`#${A}\` predicate must be a capture. Got "${H[1].value}"`);let I=A==="eq?"||A==="any-eq?",D=!A.startsWith("any-");if(rKD(H[2])){let B=H[1].name,f=H[2].name;L[$].push((E)=>{let M=[],G=[];for(let X of E){if(X.name===B)M.push(X.node);if(X.name===f)G.push(X.node)}let U=GA((X,J,F)=>{return F?X.text===J.text:X.text!==J.text},"compare");return D?M.every((X)=>G.some((J)=>U(X,J,I))):M.some((X)=>G.some((J)=>U(X,J,I)))})}else{let B=H[1].name,f=H[2].value,E=GA((G)=>G.text===f,"matches"),M=GA((G)=>G.text!==f,"doesNotMatch");L[$].push((G)=>{let U=[];for(let J of G)if(J.name===B)U.push(J.node);let X=I?E:M;return D?U.every(X):U.some(X)})}}function HQD(H,$,A,L){if(H.length!==3)throw Error(`Wrong number of arguments to \`#${A}\` predicate. Expected 2, got ${H.length-1}.`);if(H[1].type!=="capture")throw Error(`First argument of \`#${A}\` predicate must be a capture. Got "${H[1].value}".`);if(H[2].type!=="string")throw Error(`Second argument of \`#${A}\` predicate must be a string. Got @${H[2].name}.`);let I=A==="match?"||A==="any-match?",D=!A.startsWith("any-"),B=H[1].name,f=new RegExp(H[2].value);L[$].push((E)=>{let M=[];for(let U of E)if(U.name===B)M.push(U.node.text);let G=GA((U,X)=>{return X?f.test(U):!f.test(U)},"test");if(M.length===0)return!I;return D?M.every((U)=>G(U,I)):M.some((U)=>G(U,I))})}function $QD(H,$,A,L){if(H.length<2)throw Error(`Wrong number of arguments to \`#${A}\` predicate. Expected at least 1. Got ${H.length-1}.`);if(H[1].type!=="capture")throw Error(`First argument of \`#${A}\` predicate must be a capture. Got "${H[1].value}".`);let I=A==="any-of?",D=H[1].name,B=H.slice(2);if(!B.every(LZA))throw Error(`Arguments to \`#${A}\` predicate must be strings.".`);let f=B.map((E)=>E.value);L[$].push((E)=>{let M=[];for(let G of E)if(G.name===D)M.push(G.node.text);if(M.length===0)return!I;return M.every((G)=>f.includes(G))===I})}function AQD(H,$,A,L,I){if(H.length<2||H.length>3)throw Error(`Wrong number of arguments to \`#${A}\` predicate. Expected 1 or 2. Got ${H.length-1}.`);if(!H.every(LZA))throw Error(`Arguments to \`#${A}\` predicate must be strings.".`);let D=A==="is?"?L:I;if(!D[$])D[$]={};D[$][H[1].value]=H[2]?.value??null}function LQD(H,$,A){if(H.length<2||H.length>3)throw Error(`Wrong number of arguments to \`#set!\` predicate. Expected 1 or 2. Got ${H.length-1}.`);if(!H.every(LZA))throw Error('Arguments to `#set!` predicate must be strings.".');if(!A[$])A[$]={};A[$][H[1].value]=H[2]?.value??null}function IQD(H,$,A,L,I,D,B,f,E,M,G){if($===RH1){let U=L[A];D.push({type:"capture",name:U})}else if($===yH1)D.push({type:"string",value:I[A]});else if(D.length>0){if(D[0].type!=="string")throw Error("Predicates must begin with a literal value");let U=D[0].value;switch(U){case"any-not-eq?":case"not-eq?":case"any-eq?":case"eq?":eKD(D,H,U,B);break;case"any-not-match?":case"not-match?":case"any-match?":case"match?":HQD(D,H,U,B);break;case"not-any-of?":case"any-of?":$QD(D,H,U,B);break;case"is?":case"is-not?":AQD(D,H,U,M,G);break;case"set!":LQD(D,H,E);break;default:f[H].push({operator:U,operands:D.slice(1)})}D.length=0}}async function DQD(H){if(!Z_$)Z_$=await uH1(H);return Z_$}function BQD(){return!!Z_$}var NH1,GA=(H,$)=>NH1(H,"name",{value:$,configurable:!0}),nKD=2,$B=4,swA,oC,qh,ibH,oo,to,D$,OH1,xH1,SH1,jH1,RH1=1,yH1=2,vH1,xgE,rKD,LZA,PS,cbH,hH1,bH1,T_$,kH1,uH1,Z_$=null,bD,ewA,HZA,nbH;var fQD=K(()=>{NH1=Object.defineProperty,swA=4*$B,oC=5*$B,qh=2*$B,ibH=2*$B+2*qh,oo={row:0,column:0},to=Symbol("INTERNAL");GA(b7H,"assertInternal");GA(lbH,"isPoint");GA(aKD,"setModule");OH1=class{static{GA(this,"LookaheadIterator")}[0]=0;language;constructor(H,$,A){b7H(H),this[0]=$,this.language=A}get currentTypeId(){return D$._ts_lookahead_iterator_current_symbol(this[0])}get currentType(){return this.language.types[this.currentTypeId]||"ERROR"}delete(){D$._ts_lookahead_iterator_delete(this[0]),this[0]=0}reset(H,$){if(D$._ts_lookahead_iterator_reset(this[0],H[0],$))return this.language=H,!0;return!1}resetState(H){return Boolean(D$._ts_lookahead_iterator_reset_state(this[0],H))}[Symbol.iterator](){return{next:GA(()=>{if(D$._ts_lookahead_iterator_next(this[0]))return{done:!1,value:this.currentType};return{done:!0,value:""}},"next")}}};GA(AZA,"getText");xH1=class H{static{GA(this,"Tree")}[0]=0;textCallback;language;constructor($,A,L,I){b7H($),this[0]=A,this.language=L,this.textCallback=I}copy(){let $=D$._ts_tree_copy(this[0]);return new H(to,$,this.language,this.textCallback)}delete(){D$._ts_tree_delete(this[0]),this[0]=0}get rootNode(){return D$._ts_tree_root_node_wasm(this[0]),k4(this)}rootNodeWithOffset($,A){let L=bD+oC;return D$.setValue(L,$,"i32"),$z(L+$B,A),D$._ts_tree_root_node_with_offset_wasm(this[0]),k4(this)}edit($){tKD($),D$._ts_tree_edit_wasm(this[0])}walk(){return this.rootNode.walk()}getChangedRanges($){if(!($ instanceof H))throw TypeError("Argument must be a Tree");D$._ts_tree_get_changed_ranges_wasm(this[0],$[0]);let A=D$.getValue(bD,"i32"),L=D$.getValue(bD+$B,"i32"),I=Array(A);if(A>0){let D=L;for(let B=0;B<A;B++)I[B]=q_$(D),D+=ibH;D$._free(L)}return I}getIncludedRanges(){D$._ts_tree_included_ranges_wasm(this[0]);let $=D$.getValue(bD,"i32"),A=D$.getValue(bD+$B,"i32"),L=Array($);if($>0){let I=A;for(let D=0;D<$;D++)L[D]=q_$(I),I+=ibH;D$._free(A)}return L}},SH1=class H{static{GA(this,"TreeCursor")}[0]=0;[1]=0;[2]=0;[3]=0;tree;constructor($,A){b7H($),this.tree=A,Zw(this)}copy(){let $=new H(to,this.tree);return D$._ts_tree_cursor_copy_wasm(this.tree[0]),Zw($),$}delete(){zG(this),D$._ts_tree_cursor_delete_wasm(this.tree[0]),this[0]=this[1]=this[2]=0}get currentNode(){return zG(this),D$._ts_tree_cursor_current_node_wasm(this.tree[0]),k4(this.tree)}get currentFieldId(){return zG(this),D$._ts_tree_cursor_current_field_id_wasm(this.tree[0])}get currentFieldName(){return this.tree.language.fields[this.currentFieldId]}get currentDepth(){return zG(this),D$._ts_tree_cursor_current_depth_wasm(this.tree[0])}get currentDescendantIndex(){return zG(this),D$._ts_tree_cursor_current_descendant_index_wasm(this.tree[0])}get nodeType(){return this.tree.language.types[this.nodeTypeId]||"ERROR"}get nodeTypeId(){return zG(this),D$._ts_tree_cursor_current_node_type_id_wasm(this.tree[0])}get nodeStateId(){return zG(this),D$._ts_tree_cursor_current_node_state_id_wasm(this.tree[0])}get nodeId(){return zG(this),D$._ts_tree_cursor_current_node_id_wasm(this.tree[0])}get nodeIsNamed(){return zG(this),D$._ts_tree_cursor_current_node_is_named_wasm(this.tree[0])===1}get nodeIsMissing(){return zG(this),D$._ts_tree_cursor_current_node_is_missing_wasm(this.tree[0])===1}get nodeText(){zG(this);let $=D$._ts_tree_cursor_start_index_wasm(this.tree[0]),A=D$._ts_tree_cursor_end_index_wasm(this.tree[0]);D$._ts_tree_cursor_start_position_wasm(this.tree[0]);let L=L9H(bD);return AZA(this.tree,$,A,L)}get startPosition(){return zG(this),D$._ts_tree_cursor_start_position_wasm(this.tree[0]),L9H(bD)}get endPosition(){return zG(this),D$._ts_tree_cursor_end_position_wasm(this.tree[0]),L9H(bD)}get startIndex(){return zG(this),D$._ts_tree_cursor_start_index_wasm(this.tree[0])}get endIndex(){return zG(this),D$._ts_tree_cursor_end_index_wasm(this.tree[0])}gotoFirstChild(){zG(this);let $=D$._ts_tree_cursor_goto_first_child_wasm(this.tree[0]);return Zw(this),$===1}gotoLastChild(){zG(this);let $=D$._ts_tree_cursor_goto_last_child_wasm(this.tree[0]);return Zw(this),$===1}gotoParent(){zG(this);let $=D$._ts_tree_cursor_goto_parent_wasm(this.tree[0]);return Zw(this),$===1}gotoNextSibling(){zG(this);let $=D$._ts_tree_cursor_goto_next_sibling_wasm(this.tree[0]);return Zw(this),$===1}gotoPreviousSibling(){zG(this);let $=D$._ts_tree_cursor_goto_previous_sibling_wasm(this.tree[0]);return Zw(this),$===1}gotoDescendant($){zG(this),D$._ts_tree_cursor_goto_descendant_wasm(this.tree[0],$),Zw(this)}gotoFirstChildForIndex($){zG(this),D$.setValue(bD+swA,$,"i32");let A=D$._ts_tree_cursor_goto_first_child_for_index_wasm(this.tree[0]);return Zw(this),A===1}gotoFirstChildForPosition($){zG(this),$z(bD+swA,$);let A=D$._ts_tree_cursor_goto_first_child_for_position_wasm(this.tree[0]);return Zw(this),A===1}reset($){e9($),zG(this,bD+oC),D$._ts_tree_cursor_reset_wasm(this.tree[0]),Zw(this)}resetTo($){zG(this,bD),zG($,bD+swA),D$._ts_tree_cursor_reset_to_wasm(this.tree[0],$.tree[0]),Zw(this)}},jH1=class{static{GA(this,"Node")}[0]=0;_children;_namedChildren;constructor(H,{id:$,tree:A,startIndex:L,startPosition:I,other:D}){b7H(H),this[0]=D,this.id=$,this.tree=A,this.startIndex=L,this.startPosition=I}id;startIndex;startPosition;tree;get typeId(){return e9(this),D$._ts_node_symbol_wasm(this.tree[0])}get grammarId(){return e9(this),D$._ts_node_grammar_symbol_wasm(this.tree[0])}get type(){return this.tree.language.types[this.typeId]||"ERROR"}get grammarType(){return this.tree.language.types[this.grammarId]||"ERROR"}get isNamed(){return e9(this),D$._ts_node_is_named_wasm(this.tree[0])===1}get isExtra(){return e9(this),D$._ts_node_is_extra_wasm(this.tree[0])===1}get isError(){return e9(this),D$._ts_node_is_error_wasm(this.tree[0])===1}get isMissing(){return e9(this),D$._ts_node_is_missing_wasm(this.tree[0])===1}get hasChanges(){return e9(this),D$._ts_node_has_changes_wasm(this.tree[0])===1}get hasError(){return e9(this),D$._ts_node_has_error_wasm(this.tree[0])===1}get endIndex(){return e9(this),D$._ts_node_end_index_wasm(this.tree[0])}get endPosition(){return e9(this),D$._ts_node_end_point_wasm(this.tree[0]),L9H(bD)}get text(){return AZA(this.tree,this.startIndex,this.endIndex,this.startPosition)}get parseState(){return e9(this),D$._ts_node_parse_state_wasm(this.tree[0])}get nextParseState(){return e9(this),D$._ts_node_next_parse_state_wasm(this.tree[0])}equals(H){return this.tree===H.tree&&this.id===H.id}child(H){return e9(this),D$._ts_node_child_wasm(this.tree[0],H),k4(this.tree)}namedChild(H){return e9(this),D$._ts_node_named_child_wasm(this.tree[0],H),k4(this.tree)}childForFieldId(H){return e9(this),D$._ts_node_child_by_field_id_wasm(this.tree[0],H),k4(this.tree)}childForFieldName(H){let $=this.tree.language.fields.indexOf(H);if($!==-1)return this.childForFieldId($);return null}fieldNameForChild(H){e9(this);let $=D$._ts_node_field_name_for_child_wasm(this.tree[0],H);if(!$)return null;return D$.AsciiToString($)}fieldNameForNamedChild(H){e9(this);let $=D$._ts_node_field_name_for_named_child_wasm(this.tree[0],H);if(!$)return null;return D$.AsciiToString($)}childrenForFieldName(H){let $=this.tree.language.fields.indexOf(H);if($!==-1&&$!==0)return this.childrenForFieldId($);return[]}childrenForFieldId(H){e9(this),D$._ts_node_children_by_field_id_wasm(this.tree[0],H);let $=D$.getValue(bD,"i32"),A=D$.getValue(bD+$B,"i32"),L=Array($);if($>0){let I=A;for(let D=0;D<$;D++)L[D]=k4(this.tree,I),I+=oC;D$._free(A)}return L}firstChildForIndex(H){e9(this);let $=bD+oC;return D$.setValue($,H,"i32"),D$._ts_node_first_child_for_byte_wasm(this.tree[0]),k4(this.tree)}firstNamedChildForIndex(H){e9(this);let $=bD+oC;return D$.setValue($,H,"i32"),D$._ts_node_first_named_child_for_byte_wasm(this.tree[0]),k4(this.tree)}get childCount(){return e9(this),D$._ts_node_child_count_wasm(this.tree[0])}get namedChildCount(){return e9(this),D$._ts_node_named_child_count_wasm(this.tree[0])}get firstChild(){return this.child(0)}get firstNamedChild(){return this.namedChild(0)}get lastChild(){return this.child(this.childCount-1)}get lastNamedChild(){return this.namedChild(this.namedChildCount-1)}get children(){if(!this._children){e9(this),D$._ts_node_children_wasm(this.tree[0]);let H=D$.getValue(bD,"i32"),$=D$.getValue(bD+$B,"i32");if(this._children=Array(H),H>0){let A=$;for(let L=0;L<H;L++)this._children[L]=k4(this.tree,A),A+=oC;D$._free($)}}return this._children}get namedChildren(){if(!this._namedChildren){e9(this),D$._ts_node_named_children_wasm(this.tree[0]);let H=D$.getValue(bD,"i32"),$=D$.getValue(bD+$B,"i32");if(this._namedChildren=Array(H),H>0){let A=$;for(let L=0;L<H;L++)this._namedChildren[L]=k4(this.tree,A),A+=oC;D$._free($)}}return this._namedChildren}descendantsOfType(H,$=oo,A=oo){if(!Array.isArray(H))H=[H];let L=[],I=this.tree.language.types;for(let M of H)if(M=="ERROR")L.push(65535);for(let M=0,G=I.length;M<G;M++)if(H.includes(I[M]))L.push(M);let D=D$._malloc($B*L.length);for(let M=0,G=L.length;M<G;M++)D$.setValue(D+M*$B,L[M],"i32");e9(this),D$._ts_node_descendants_of_type_wasm(this.tree[0],D,L.length,$.row,$.column,A.row,A.column);let B=D$.getValue(bD,"i32"),f=D$.getValue(bD+$B,"i32"),E=Array(B);if(B>0){let M=f;for(let G=0;G<B;G++)E[G]=k4(this.tree,M),M+=oC}return D$._free(f),D$._free(D),E}get nextSibling(){return e9(this),D$._ts_node_next_sibling_wasm(this.tree[0]),k4(this.tree)}get previousSibling(){return e9(this),D$._ts_node_prev_sibling_wasm(this.tree[0]),k4(this.tree)}get nextNamedSibling(){return e9(this),D$._ts_node_next_named_sibling_wasm(this.tree[0]),k4(this.tree)}get previousNamedSibling(){return e9(this),D$._ts_node_prev_named_sibling_wasm(this.tree[0]),k4(this.tree)}get descendantCount(){return e9(this),D$._ts_node_descendant_count_wasm(this.tree[0])}get parent(){return e9(this),D$._ts_node_parent_wasm(this.tree[0]),k4(this.tree)}childWithDescendant(H){return e9(this),e9(H,1),D$._ts_node_child_with_descendant_wasm(this.tree[0]),k4(this.tree)}descendantForIndex(H,$=H){if(typeof H!=="number"||typeof $!=="number")throw Error("Arguments must be numbers");e9(this);let A=bD+oC;return D$.setValue(A,H,"i32"),D$.setValue(A+$B,$,"i32"),D$._ts_node_descendant_for_index_wasm(this.tree[0]),k4(this.tree)}namedDescendantForIndex(H,$=H){if(typeof H!=="number"||typeof $!=="number")throw Error("Arguments must be numbers");e9(this);let A=bD+oC;return D$.setValue(A,H,"i32"),D$.setValue(A+$B,$,"i32"),D$._ts_node_named_descendant_for_index_wasm(this.tree[0]),k4(this.tree)}descendantForPosition(H,$=H){if(!lbH(H)||!lbH($))throw Error("Arguments must be {row, column} objects");e9(this);let A=bD+oC;return $z(A,H),$z(A+qh,$),D$._ts_node_descendant_for_position_wasm(this.tree[0]),k4(this.tree)}namedDescendantForPosition(H,$=H){if(!lbH(H)||!lbH($))throw Error("Arguments must be {row, column} objects");e9(this);let A=bD+oC;return $z(A,H),$z(A+qh,$),D$._ts_node_named_descendant_for_position_wasm(this.tree[0]),k4(this.tree)}walk(){return e9(this),D$._ts_tree_cursor_new_wasm(this.tree[0]),new SH1(to,this.tree)}edit(H){if(this.startIndex>=H.oldEndIndex){this.startIndex=H.newEndIndex+(this.startIndex-H.oldEndIndex);let $,A;if(this.startPosition.row>H.oldEndPosition.row)$=this.startPosition.row-H.oldEndPosition.row,A=this.startPosition.column;else if($=0,A=this.startPosition.column,this.startPosition.column>=H.oldEndPosition.column)A=this.startPosition.column-H.oldEndPosition.column;if($>0)this.startPosition.row+=$,this.startPosition.column=A;else this.startPosition.column+=A}else if(this.startIndex>H.startIndex)this.startIndex=H.newEndIndex,this.startPosition.row=H.newEndPosition.row,this.startPosition.column=H.newEndPosition.column}toString(){e9(this);let H=D$._ts_node_to_string_wasm(this.tree[0]),$=D$.AsciiToString(H);return D$._free(H),$}};GA($ZA,"unmarshalCaptures");GA(e9,"marshalNode");GA(k4,"unmarshalNode");GA(zG,"marshalTreeCursor");GA(Zw,"unmarshalTreeCursor");GA($z,"marshalPoint");GA(L9H,"unmarshalPoint");GA(oKD,"marshalRange");GA(q_$,"unmarshalRange");GA(tKD,"marshalEdit");GA(sKD,"unmarshalLanguageMetadata");vH1=/[\w-]+/g,xgE={Zero:0,ZeroOrOne:1,ZeroOrMore:2,One:3,OneOrMore:4},rKD=GA((H)=>H.type==="capture","isCaptureStep"),LZA=GA((H)=>H.type==="string","isStringStep"),PS={Syntax:1,NodeName:2,FieldName:3,CaptureName:4,PatternStructure:5},cbH=class H extends Error{constructor($,A,L,I){super(H.formatMessage($,A));this.kind=$,this.info=A,this.index=L,this.length=I,this.name="QueryError"}static{GA(this,"QueryError")}static formatMessage($,A){switch($){case PS.NodeName:return`Bad node name '${A.word}'`;case PS.FieldName:return`Bad field name '${A.word}'`;case PS.CaptureName:return`Bad capture name @${A.word}`;case PS.PatternStructure:return`Bad pattern structure at offset ${A.suffix}`;case PS.Syntax:return`Bad syntax at offset ${A.suffix}`}}};GA(eKD,"parseAnyPredicate");GA(HQD,"parseMatchPredicate");GA($QD,"parseAnyOfPredicate");GA(AQD,"parseIsPredicate");GA(LQD,"parseSetDirective");GA(IQD,"parsePattern");hH1=class{static{GA(this,"Query")}[0]=0;exceededMatchLimit;textPredicates;captureNames;captureQuantifiers;predicates;setProperties;assertedProperties;refutedProperties;matchLimit;constructor(H,$){let A=D$.lengthBytesUTF8($),L=D$._malloc(A+1);D$.stringToUTF8($,L,A+1);let I=D$._ts_query_new(H[0],L,A,bD,bD+$B);if(!I){let W=D$.getValue(bD+$B,"i32"),P=D$.getValue(bD,"i32"),Y=D$.UTF8ToString(L,P).length,C=$.slice(Y,Y+100).split(`
</${f5}>`}function iT1(H){let $=H.filter((f)=>typeof f.value!=="string"||!cT1(f.value)),A=$.filter((f)=>f.mode==="task-notification"),L=$.filter((f)=>f.mode!=="task-notification");if(A.length<=UuA)return[...L,...A];let I=A.slice(0,UuA-1),D=A.length-(UuA-1),B={value:lT1(D),mode:"task-notification"};return[...L,...I,B]}function o$B(){let H=W$((D)=>D.queuedCommands),$=TX();if(zjI($.getState()))return null;if(H.length===0)return null;let A=H.filter((D)=>D.mode!=="task-notification");if(A.length===0)return null;let L=iT1(A),I=b5(L.map((D)=>R$({content:D.value,imagePasteIds:D.imagePasteIds})));return U8H.createElement(x,{marginTop:1,flexDirection:"column"},I.map((D,B)=>U8H.createElement(r$B,{key:B,isFirst:B===0},U8H.createElement(Hz,{message:D,lookups:xh,addMargin:!1,tools:[],commands:[],verbose:!1,inProgressToolUseIDs:dT1,progressMessagesForMessage:[],shouldAnimate:!1,shouldShowDot:!1,isTranscriptMode:!1,isStatic:!0}))))}var U8H,dT1,UuA=3;var t$B=K(()=>{pL();xH();S7H();_L();a$B();DE();Z$();oDH();U8H=h(t(),1),dT1=new Set});function s$B({hasStash:H}){if(!H)return null;return dpH.createElement(x,{paddingLeft:2},dpH.createElement(V,{dimColor:!0},mH.pointerSmall," Stashed (auto-restores after submit)"))}var dpH;var e$B=K(()=>{xH();SI();dpH=h(t(),1)});function HAB(H){if(k9())return;return H.standaloneAgentContext?.name}var $AB=K(()=>{ME()});function AAB(){let H=W$((B)=>B.teamContext),$=W$((B)=>B.standaloneAgentContext),A=W$((B)=>B.agent),L=TX(),[I,D]=yN$.useState(null);if(yN$.useEffect(()=>{qS().then(D)},[]),rf()&&!iW()){let B=k1(),f=k9(),E=H?.selfAgentColor??Y4();if(B&&f){let M=E?h5[E]:"cyan_FOR_SUBAGENTS_ONLY";return{text:`@${B}`,bgColor:M}}}else if((H?.teammates?Object.keys(H.teammates).length:0)>0&&H?.teamName){let E=TT(L.getState()),M=E?.identity.color&&v5.includes(E.identity.color)?h5[E.identity.color]:void 0,G=Oh();if(I===!1&&!G)return{text:`View teammates: \`tmux -L ${q7H()} a\``,bgColor:M??"cyan_FOR_SUBAGENTS_ONLY"};else if(I===!0||G){if(E)return{text:`@${E.identity.agentName}`,bgColor:M??"cyan_FOR_SUBAGENTS_ONLY"};return null}}if(dL()){let B=HAB(L.getState()),f=$?.color;if(B||f){let E=f?h5[f]:"cyan_FOR_SUBAGENTS_ONLY";return{text:B??"",bgColor:E}}}if(A){let f=L.getState().agentDefinitions.activeAgents.find((M)=>M.agentType===A)?.color,E=f&&v5.includes(f)?h5[f]:"promptBorder";return{text:A,bgColor:E}}return null}var yN$;var LAB=K(()=>{pL();oDH();ME();x2();Nh();zS();_7();Z8();$AB();yN$=h(t(),1)});function IAB({pastedContents:H,isSelected:$=!1,selectedIndex:A=0}){let L=Object.values(H).filter((D)=>D.type==="image");if(L.length===0)return null;let I=$?a4.createElement(rA,null,L.length>1&&a4.createElement(a4.Fragment,null,a4.createElement(VA,{action:"attachments:next",context:"Attachments",fallback:"\u2192",description:"next"}),a4.createElement(VA,{action:"attachments:previous",context:"Attachments",fallback:"\u2190",description:"prev"})),a4.createElement(VA,{action:"attachments:remove",context:"Attachments",fallback:"backspace",description:"remove"}),a4.createElement(VA,{action:"attachments:exit",context:"Attachments",fallback:"\u2193",description:"cancel"})):"(\u2191 to select)";return a4.createElement(x,{flexDirection:"row",gap:1,paddingX:1,flexWrap:"wrap"},L.map((D,B)=>a4.createElement($4$,{key:D.id,imageId:D.id,isSelected:$&&B===A})),a4.createElement(x,{flexGrow:1,justifyContent:"flex-start",flexDirection:"row"},a4.createElement(V,{dimColor:!0},I)))}function XuA(H){return Object.values(H).filter(($)=>$.type==="image").length}var a4;var JuA=K(()=>{xH();I5A();S0();sB();a4=h(t(),1)});function DAB(H,$,A,L,I,D,B,f,E,M,G){let[U,X]=_U.useState(""),[J,F]=_U.useState(!1),[Q,W]=_U.useState(""),[P,Y]=_U.useState(0),[C,Z]=_U.useState("prompt"),[q,O]=_U.useState({}),[j,u]=_U.useState(void 0),y=_U.useRef(void 0),g=_U.useRef(new Set),v=_U.useRef(null),p=_U.useCallback(()=>{if(y.current)y.current.return(void 0),y.current=void 0},[]),d=_U.useCallback(()=>{E(!1),X(""),F(!1),W(""),Y(0),Z("prompt"),O({}),u(void 0),p(),g.current.clear()},[E,p]),k=_U.useCallback(async(qH,s)=>{if(!f)return;if(U.length===0){p(),g.current.clear(),u(void 0),F(!1),A(Q),L(P),D(C),M(q);return}if(!qH)p(),y.current=t4A(),g.current.clear();if(!y.current)return;while(!0){if(s?.aborted)return;let IH=await y.current.next();if(IH.done){F(!0);return}let FH=IH.value.display,EH=FH.lastIndexOf(U);if(EH!==-1&&!g.current.has(FH)){g.current.add(FH),u(IH.value),F(!1);let YH=ly(FH);D(YH),A(FH),M(IH.value.pastedContents);let HH=aIH(FH).lastIndexOf(U);L(HH!==-1?HH:EH);return}}},[f,U,p,A,L,D,M,Q,P,C,q]),n=_U.useCallback(()=>{RD("history-search"),E(!0),W($),Y(I),Z(B),O(G),y.current=t4A(),g.current.clear()},[E,$,I,B,G]),GH=_U.useCallback(()=>{k(!0)},[k]),e=_U.useCallback(()=>{if(j){let qH=ly(j.display),s=aIH(j.display);A(s),D(qH),M(j.pastedContents)}else M(q);d()},[j,A,D,M,q,d]),BH=_U.useCallback(()=>{A(Q),L(P),M(q),d()},[A,L,M,Q,P,q,d]),VH=_U.useCallback(()=>{if(U.length===0)H({display:Q,pastedContents:q});else if(j){let qH=ly(j.display),s=aIH(j.display);D(qH),H({display:s,pastedContents:j.pastedContents})}d()},[U,j,H,D,Q,q,d]);BA("history:search",n,{context:"Global",isActive:!f});let wH=_U.useMemo(()=>({"historySearch:next":GH,"historySearch:accept":e,"historySearch:cancel":BH,"historySearch:execute":VH}),[GH,e,BH,VH]);rI(wH,{context:"HistorySearch",isActive:f}),WL((qH,s)=>{if(s.backspace&&U==="")BH()},{isActive:f});let WH=_U.useRef(k);return WH.current=k,_U.useEffect(()=>{v.current?.abort();let qH=new AbortController;return v.current=qH,WH.current(!1,qH.signal),()=>{qH.abort()}},[U]),{historyQuery:U,setHistoryQuery:X,historyMatch:j,historyFailedMatch:J}}var _U;var BAB=K(()=>{xH();oO();SE();LI();_U=h(t(),1)});function fAB({inputValue:H,isAssistantResponding:$}){let A=W$((Y)=>Y.promptSuggestion),L=RI(),{text:I,promptId:D,shownAt:B,acceptedAt:f,generationRequestId:E}=A,M=$||H.length>0?null:I,G=I&&B>0,U=Sd.useRef(0),X=Sd.useRef(!0),J=Sd.useRef(0);if(B>0&&B!==J.current)J.current=B,X.current=G1$(),U.current=0;else if(B===0)J.current=0;if(H.length>0&&U.current===0&&G)U.current=Date.now();let F=Sd.useCallback(()=>{m9H(L),L((Y)=>({...Y,promptSuggestion:{text:null,promptId:null,shownAt:0,acceptedAt:0,generationRequestId:null}}))},[L]),Q=Sd.useCallback(()=>{if(!G)return;L((Y)=>({...Y,promptSuggestion:{...Y.promptSuggestion,acceptedAt:Date.now()}}))},[G,L]),W=Sd.useCallback(()=>{L((Y)=>{if(Y.promptSuggestion.shownAt!==0||!Y.promptSuggestion.text)return Y;return{...Y,promptSuggestion:{...Y.promptSuggestion,shownAt:Date.now()}}})},[L]),P=Sd.useCallback((Y)=>{if(!G)return;let C=f>B,Z=C||Y===I,q=Z?f||Date.now():Date.now();c("tengu_prompt_suggestion",{outcome:Z?"accepted":"ignored",prompt_id:D,coordinator_mode:R8(),...E&&{generationRequestId:E},...Z&&{acceptMethod:C?"tab":"enter"},...Z&&{timeToAcceptMs:q-B},...!Z&&{timeToIgnoreMs:q-B},...U.current>0&&{timeToFirstKeystrokeMs:U.current-B},wasFocusedWhenShown:X.current,similarity:Math.round(Y.length/(I?.length||1)*100)/100,...!1}),F()},[G,f,B,I,D,E,F]);return{suggestion:M,markAccepted:Q,markShown:W,logOutcomeAtSubmission:P,resetSuggestion:F}}var Sd;var EAB=K(()=>{pL();z$();iuH();z5H();V7();Sd=h(t(),1)});function GAB({currentValue:H,onSelect:$,onCancel:A,isMidConversation:L}){let I=qB(),[D,B]=MAB.useState(null),f=[{value:"true",label:"Enabled",description:"Claude will think before responding"},{value:"false",label:"Disabled",description:"Claude will respond without extended thinking"}];BA("confirm:no",()=>{if(D!==null)B(null);else A?.()},{context:"Confirmation"}),BA("confirm:yes",()=>{if(D!==null)$(D)},{context:"Confirmation",isActive:D!==null});function E(M){let G=M==="true";if(L&&G!==H)B(G);else $(G)}return m9.createElement(x,{flexDirection:"column",width:"100%"},m9.createElement(Gf,{dividerColor:"permission",dividerDimColor:!1}),m9.createElement(x,{flexDirection:"column",paddingX:1},m9.createElement(x,{flexDirection:"column"},m9.createElement(x,{marginBottom:1,flexDirection:"column"},m9.createElement(V,{color:"remember",bold:!0},"Toggle thinking mode"),m9.createElement(V,{dimColor:!0},"Enable or disable thinking for this session.")),D!==null?m9.createElement(x,{flexDirection:"column",marginBottom:1,gap:1},m9.createElement(V,{color:"warning"},"Changing thinking mode mid-conversation will increase latency and may reduce quality. For best results, set this at the start of a session."),m9.createElement(V,{color:"warning"},"Do you want to proceed?")):m9.createElement(x,{flexDirection:"column",marginBottom:1},m9.createElement(QA,{defaultValue:H?"true":"false",defaultFocusValue:H?"true":"false",options:f,onChange:E,onCancel:A??(()=>{}),visibleOptionCount:2}))),m9.createElement(V,{dimColor:!0,italic:!0},I.pending?m9.createElement(m9.Fragment,null,"Press ",I.keyName," again to exit"):D!==null?m9.createElement(rA,null,m9.createElement(s$,{shortcut:"Enter",action:"confirm"}),m9.createElement(VA,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"cancel"})):m9.createElement(rA,null,m9.createElement(s$,{shortcut:"Enter",action:"confirm"}),m9.createElement(VA,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"exit"})))))}var m9,MAB;var UAB=K(()=>{xH();p8();fM();s6();dB();S0();sB();LI();m9=h(t(),1),MAB=h(t(),1)});function XAB(H=!0,$=!1){if(!H)return"\u21AF";let L=M$().theme;if($)return oH.dim(ZL("promptBorder",L)("\u21AF"));return ZL("penguin",L)("\u21AF")}var nT1;var JAB=K(()=>{s0();xH();Xn();vA();nT1=h(t(),1)});var FAB;var KAB=K(()=>{FAB=h(t(),1)});function rT1({debug:H,ideSelection:$,toolPermissionContext:A,setToolPermissionContext:L,apiKeyStatus:I,commands:D,agents:B,isLoading:f,verbose:E,messages:M,onAutoUpdaterResult:G,autoUpdaterResult:U,input:X,onInputChange:J,mode:F,onModeChange:Q,stashedPrompt:W,setStashedPrompt:P,submitCount:Y,onShowMessageSelector:C,mcpClients:Z,pastedContents:q,setPastedContents:O,vimMode:j,setVimMode:u,showBashesDialog:y,setShowBashesDialog:g,showDiffDialog:v,setShowDiffDialog:p,tasksSelected:d,setTasksSelected:k,diffSelected:n,setDiffSelected:GH,onForegroundTask:e,onExit:BH,getToolUseContext:VH,onSubmit:wH,onAgentSubmit:WH,isSearchingHistory:qH,setIsSearchingHistory:s,onDismissSideQuestion:IH,isSideQuestionVisible:FH,helpOpen:EH,setHelpOpen:YH,hasSuppressedDialogs:OH}){let HH=mo(),$H=pJH(),[DH,MH]=SB.useState(!1),[AH,KH]=SB.useState({show:!1}),[CH,TH]=SB.useState(X.length),yH=TX(),gH=RI(),QH=W$((y$)=>y$.tasks),lH=W$((y$)=>y$.teamContext),hH=W$((y$)=>y$.queuedCommands),sH=W$((y$)=>y$.gitDiff),F$=W$((y$)=>y$.promptSuggestion),KA=W$((y$)=>y$.speculation),UA=W$((y$)=>y$.speculationSessionTimeSavedMs),U$=W$((y$)=>y$.viewingAgentTaskId),hA=W$((y$)=>y$.viewSelectionMode),iA=W$((y$)=>y$.expandedView)==="teammates",rH=W$((y$)=>y$.mainLoopModel),G$=W$((y$)=>y$.mainLoopModelForSession),b$=W$((y$)=>y$.thinkingEnabled),qA=!1,n$=TT(yH.getState()),fA=n$?.identity.agentName,UH=n$?.identity.color&&v5.includes(n$.identity.color)?n$.identity.color:void 0,_H=SB.useMemo(()=>Kw(QH).filter((y$)=>y$.status==="running").sort((y$,YL)=>y$.identity.agentName.localeCompare(YL.identity.agentName)),[QH]),aH=_H.length>0||n$!==void 0,f$=SB.useMemo(()=>{if(n$)return{...A,mode:n$.permissionMode};return A},[n$,A]),{historyQuery:I$,setHistoryQuery:$$,historyMatch:e$,historyFailedMatch:x$}=DAB((y$)=>{O(y$.pastedContents),t4(y$.display)},X,J,TH,CH,Q,F,qH,s,O,q),zA=SB.useRef(aT1(M)),[gA,HI]=SB.useState(!1),[$I,wB]=SB.useState(!1),[jB,sA]=SB.useState(0),[PD,f9]=SB.useState(0),k8=H$B(),[R9,FI]=SB.useState(!1),[LB,E9]=SB.useState(!1),[IL,ZA]=SB.useState(!1),[IB,KB]=SB.useState(!1),[MD,P9]=SB.useState(!1),[Q1,E8]=SB.useState(0),cE=SB.useMemo(()=>{let y$=X.indexOf(`
`)||$}function XuH(H,$){let A=$?.abortController??($?.shareAbortController?H.abortController:rHH(H.abortController)),L=$?.getAppState?$.getAppState:$?.shareAbortController?H.getAppState:async()=>{let I=await H.getAppState();if(I.toolPermissionContext.shouldAvoidPermissionPrompts)return I;return{...I,toolPermissionContext:{...I.toolPermissionContext,shouldAvoidPermissionPrompts:!0}}};return{readFileState:Bm($?.readFileState??H.readFileState),nestedMemoryAttachmentTriggers:new Set,dynamicSkillDirTriggers:new Set,toolDecisions:void 0,abortController:A,getAppState:L,setAppState:$?.shareSetAppState?H.setAppState:()=>{},setMessages:()=>{},setInProgressToolUseIDs:()=>{},setResponseLength:$?.shareSetResponseLength?H.setResponseLength:()=>{},updateFileHistoryState:()=>{},updateAttributionState:()=>{},addNotification:void 0,setToolJSX:void 0,setStreamMode:void 0,setSDKStatus:void 0,openMessageSelector:void 0,options:$?.options??H.options,messages:$?.messages??H.messages,agentId:$?.agentId??xT(),agentType:$?.agentType,queryTracking:{chainId:lwD.randomUUID(),depth:(H.queryTracking?.depth??-1)+1},fileReadingLimits:H.fileReadingLimits,userModified:H.userModified,criticalSystemReminder_EXPERIMENTAL:$?.criticalSystemReminder_EXPERIMENTAL,requireCanUseTool:$?.requireCanUseTool}}async function ww({promptMessages:H,cacheSafeParams:$,canUseTool:A,querySource:L,forkLabel:I,overrides:D,maxOutputTokens:B,maxTurns:f,onMessage:E,skipTranscript:M}){let G=Date.now(),U=[],X={...TC},{systemPrompt:J,userContext:F,systemContext:Q,toolUseContext:W,forkContextMessages:P}=$,Y=XuH(W,D),C=[...gbH(P),...H],Z=M?void 0:xT(I),q=null;if(Z)await z9H(C,Z).catch((j)=>N(`Forked agent [${I}] failed to record initial transcript: ${j}`)),q=C.length>0?C[C.length-1].uuid:null;for await(let j of OP({messages:C,systemPrompt:J,userContext:F,systemContext:Q,canUseTool:A,toolUseContext:Y,querySource:L,maxOutputTokensOverride:B,maxTurns:f})){if(j.type==="stream_event"){if("event"in j&&j.event?.type==="message_delta"&&j.event.usage){let y=O9H({...TC},j.event.usage);X=cY$(X,y)}continue}if(j.type==="stream_request_start")continue;N(`Forked agent [${I}] received message: type=${j.type}`),U.push(j),E?.(j);let u=j;if(Z&&(u.type==="assistant"||u.type==="user"||u.type==="progress"))await z9H([u],Z,q).catch((y)=>N(`Forked agent [${I}] failed to record transcript: ${y}`)),q=u.uuid}N(`Forked agent [${I}] finished: ${U.length} messages, types=[${U.map((j)=>j.type).join(", ")}], totalUsage: input=${X.input_tokens} output=${X.output_tokens} cacheRead=${X.cache_read_input_tokens} cacheCreate=${X.cache_creation_input_tokens}`);let O=Date.now()-G;return w11({forkLabel:I,querySource:L,durationMs:O,messageCount:U.length,totalUsage:X,queryTracking:W.queryTracking}),{messages:U,totalUsage:X}}function w11({forkLabel:H,querySource:$,durationMs:A,messageCount:L,totalUsage:I,queryTracking:D}){let B=I.input_tokens+I.cache_creation_input_tokens+I.cache_read_input_tokens,f=B>0?I.cache_read_input_tokens/B:0;c("tengu_fork_agent_query",{forkLabel:H,querySource:$,durationMs:A,messageCount:L,inputTokens:I.input_tokens,outputTokens:I.output_tokens,cacheReadInputTokens:I.cache_read_input_tokens,cacheCreationInputTokens:I.cache_creation_input_tokens,serviceTier:I.service_tier,cacheCreationEphemeral1hTokens:I.cache_creation.ephemeral_1h_input_tokens,cacheCreationEphemeral5mTokens:I.cache_creation.ephemeral_5m_input_tokens,cacheHitRate:f,...D?{queryChainId:D.chainId,queryDepth:D.depth}:{}})}var lwD;var VS=K(()=>{N9H();mU();QyH();z$();ao();E$();nB();Q7();vx();aE();_L();bp();lwD=require("crypto")});function Bt(H){return[H.boundaryMarker,...H.summaryMessages,...H.messagesToKeep??[],...H.attachments,...H.hookResults]}async function n7H(H,$,A,L,I,D=!1){try{if(H.length===0)throw Error(JuH);let B=OT(H),f=JhI(H),E={};try{E=FhI(f)}catch(k){r(k)}let M=await $.getAppState();wK$(M.toolPermissionContext,"summary"),$.onCompactProgress?.({type:"hooks_start",hookType:"pre_compact"}),$.setSDKStatus?.("compacting");let G=await iY$({trigger:D?"auto":"manual",customInstructions:I??null},$.abortController.signal);if(G.newCustomInstructions)I=I?`${I}
${G.newCustomInstructions}`:G.newCustomInstructions;let U=G.userDisplayMessage;$.setStreamMode?.("requesting"),$.setResponseLength?.(()=>0),$.onCompactProgress?.({type:"compact_start"});let X=gL("tengu_compact_cache_prefix",!1),J=_6A(I),F=R$({content:J}),Q=await twD({messages:H,summaryRequest:F,appState:M,context:$,preCompactTokenCount:B,cacheSafeParams:A}),W=x9H(Q);if(!W)throw N(`Compact failed: no summary text in response. Response: ${vH(Q)}`,{level:"error"}),c("tengu_compact_failed",{reason:"no_summary",preCompactTokenCount:B,promptCacheSharingEnabled:X}),Error("Failed to generate conversation summary - response did not contain valid text content");else if(W.startsWith(z5))throw c("tengu_compact_failed",{reason:"api_error",preCompactTokenCount:B,promptCacheSharingEnabled:X}),Error(W);else if(W.startsWith(Zg))throw c("tengu_compact_failed",{reason:"prompt_too_long",preCompactTokenCount:B,promptCacheSharingEnabled:X}),Error(rwD);let P=pWA($.readFileState);$.readFileState.clear(),kp();let[Y,C]=await Promise.all([swD(P,$,nwD),$ZD($)]),Z=[...Y,...C],q=ewD($.agentId??j$());if(q)Z.push(q);let O=lY$($.agentId);if(O)Z.push(O);let j=HZD();if(j)Z.push(j);$.onCompactProgress?.({type:"hooks_start",hookType:"session_start"});let u=await p7("compact",{model:$.options.mainLoopModel}),y=VP([Q]),g=Wm(Q);c("tengu_compact",{preCompactTokenCount:B,postCompactTokenCount:y,compactionInputTokens:g?.input_tokens,compactionOutputTokens:g?.output_tokens,compactionCacheReadTokens:g?.cache_read_input_tokens??0,compactionCacheCreationTokens:g?.cache_creation_input_tokens??0,compactionTotalTokens:g?g.input_tokens+(g.cache_creation_input_tokens??0)+(g.cache_read_input_tokens??0)+g.output_tokens:0,promptCacheSharingEnabled:X,...E});let v=FuH(D?"auto":"manual",B??0,H[H.length-1]?.uuid),p=m4(j$()),d=[R$({content:KyH(W,L,p),isCompactSummary:!0,isVisibleInTranscriptOnly:!0})];return P6A($.options.querySource??"compact",$.agentId),{boundaryMarker:v,summaryMessages:d,attachments:Z,hookResults:u,userDisplayMessage:U,preCompactTokenCount:B,postCompactTokenCount:y,compactionUsage:g}}catch(B){throw owD(B,$),B}finally{$.setStreamMode?.("requesting"),$.setResponseLength?.(()=>0),$.onCompactProgress?.({type:"compact_end"}),$.setSDKStatus?.(null)}}async function awD(H,$,A,L,I){try{let D=H.slice($),B=H.slice(0,$);if(D.length===0)throw Error("Nothing to summarize after the selected message.");let f=OT(H);A.onCompactProgress?.({type:"hooks_start",hookType:"pre_compact"}),A.setSDKStatus?.("compacting");let E=await iY$({trigger:"manual",customInstructions:null},A.abortController.signal),M;if(E.newCustomInstructions&&I)M=`${E.newCustomInstructions}
${H.blockingError}`}async function*iS({hookInput:H,toolUseID:$,matchQuery:A,signal:L,timeoutMs:I=c7,toolUseContext:D,messages:B,forceSyncExecution:f}){if(VL().disableAllHooks)return;let E=H.hook_event_name,M=A?`${E}:${A}`:E;if(VND()){N(`Skipping ${M} hook execution - workspace trust not accepted`);return}let G=D?await D.getAppState():void 0,U=D?.agentId??j$(),X=WxA(G,U,E,H);if(X.length===0)return;if(L?.aborted)return;let J=CND(X);c("tengu_run_hook",{hookName:M,numCommands:X.length,...J&&{pluginHookCounts:vH(J)}});let F=wF()?QND(X):[];if(wF())bQ("hook_execution_start",{hook_event:E,hook_name:M,num_hooks:String(X.length),managed_only:String(dp()),hook_definitions:vH(F),hook_source:dp()?"policySettings":"merged"});let Q=qvI(E,M,X.length,vH(F));for(let{hook:C}of X)yield{message:{type:"progress",data:{type:"hook_progress",hookEvent:E,hookName:M,command:RP(C),promptText:C.type==="prompt"?C.prompt:void 0,statusMessage:"statusMessage"in C?C.statusMessage:void 0},parentToolUseID:$,toolUseID:$,timestamp:new Date().toISOString(),uuid:EY.randomUUID()}};let W=X.map(async function*({hook:C,pluginRoot:Z,skillRoot:q},O){if(C.type==="callback"){let v=C.timeout?C.timeout*1000:I,{signal:p,cleanup:d}=zT(AbortSignal.timeout(v),L);yield _U1({toolUseID:$,hook:C,hookEvent:E,hookInput:H,signal:p,hookIndex:O,toolUseContext:D}).finally(d);return}if(C.type==="function"){if(!B){yield{message:FB({type:"hook_error_during_execution",hookName:M,toolUseID:$,hookEvent:E,content:"Messages not provided for function hook"}),outcome:"non_blocking_error",hook:C};return}yield PU1({hook:C,messages:B,hookName:M,toolUseID:$,hookEvent:E,timeoutMs:I,signal:L});return}let j=C.timeout?C.timeout*1000:I,{signal:u,cleanup:y}=zT(AbortSignal.timeout(j),L),g=EY.randomUUID();try{let v;try{v=vH(H)}catch(GH){r(Error(`Failed to stringify hook ${M} input`,{cause:GH})),yield{message:FB({type:"hook_error_during_execution",hookName:M,toolUseID:$,hookEvent:E,content:`Failed to prepare hook input: ${GH instanceof Error?GH.message:String(GH)}`}),outcome:"non_blocking_error",hook:C};return}if(C.type==="prompt"){if(!D)throw Error("ToolUseContext is required for prompt hooks. This is a bug.");yield await lvI(C,M,E,v,u,D,B,$),y?.();return}if(C.type==="agent"){if(!D)throw Error("ToolUseContext is required for agent hooks. This is a bug.");if(!B)throw Error("Messages are required for agent hooks. This is a bug.");yield await JND(C,M,E,v,u,D,$,B),y?.();return}xvI(g,M,E);let p=await s2$(C,E,M,v,u,g,O,Z,q,f);if(y?.(),p.backgrounded){yield{outcome:"success",hook:C};return}if(p.aborted){yx({hookId:g,hookName:M,hookEvent:E,output:p.output,stdout:p.stdout,stderr:p.stderr,exitCode:p.status,outcome:"cancelled"}),yield{message:FB({type:"hook_cancelled",hookName:M,toolUseID:$,hookEvent:E}),outcome:"cancelled",hook:C};return}let{json:d,plainText:k,validationError:n}=PND(p.stdout);if(n){yx({hookId:g,hookName:M,hookEvent:E,output:p.output,stdout:p.stdout,stderr:`JSON validation failed: ${n}`,exitCode:1,outcome:"error"}),yield{message:FB({type:"hook_non_blocking_error",hookName:M,toolUseID:$,hookEvent:E,stderr:`JSON validation failed: ${n}`,stdout:p.stdout,exitCode:1}),outcome:"non_blocking_error",hook:C};return}if(d){if(GBH(d)){yield{outcome:"success",hook:C};return}let GH=_ND({json:d,command:C.type==="command"?C.command:"prompt",hookName:M,toolUseID:$,hookEvent:E,expectedHookEvent:E,stdout:p.stdout,stderr:p.stderr,exitCode:p.status});if(NvI(d)&&!d.suppressOutput&&k&&p.status===0){let e=`${oH.bold(M)} completed`;yx({hookId:g,hookName:M,hookEvent:E,output:p.output,stdout:p.stdout,stderr:p.stderr,exitCode:p.status,outcome:"success"}),yield{...GH,message:GH.message||FB({type:"hook_success",hookName:M,toolUseID:$,hookEvent:E,content:e,stdout:p.stdout,stderr:p.stderr,exitCode:p.status}),outcome:"success",hook:C};return}yx({hookId:g,hookName:M,hookEvent:E,output:p.output,stdout:p.stdout,stderr:p.stderr,exitCode:p.status,outcome:p.status===0?"success":"error"}),yield{...GH,outcome:"success",hook:C};return}if(p.status===0){yx({hookId:g,hookName:M,hookEvent:E,output:p.output,stdout:p.stdout,stderr:p.stderr,exitCode:p.status,outcome:"success"}),yield{message:FB({type:"hook_success",hookName:M,toolUseID:$,hookEvent:E,content:p.stdout.trim(),stdout:p.stdout,stderr:p.stderr,exitCode:p.status}),outcome:"success",hook:C};return}if(p.status===2){yx({hookId:g,hookName:M,hookEvent:E,output:p.output,stdout:p.stdout,stderr:p.stderr,exitCode:p.status,outcome:"error"}),yield{blockingError:{blockingError:`[${C.command}]: ${p.stderr||"No stderr output"}`,command:C.command},outcome:"blocking",hook:C};return}yx({hookId:g,hookName:M,hookEvent:E,output:p.output,stdout:p.stdout,stderr:p.stderr,exitCode:p.status,outcome:"error"}),yield{message:FB({type:"hook_non_blocking_error",hookName:M,toolUseID:$,hookEvent:E,stderr:`Failed with non-blocking status code: ${p.stderr.trim()||"No stderr output"}`,stdout:p.stdout,exitCode:p.status}),outcome:"non_blocking_error",hook:C};return}catch(v){y?.();let p=v instanceof Error?v.message:String(v);yx({hookId:g,hookName:M,hookEvent:E,output:`Failed to run: ${p}`,stdout:"",stderr:`Failed to run: ${p}`,exitCode:1,outcome:"error"}),yield{message:FB({type:"hook_non_blocking_error",hookName:M,toolUseID:$,hookEvent:E,stderr:`Failed to run: ${p}`,stdout:"",exitCode:1}),outcome:"non_blocking_error",hook:C};return}}),P={success:0,blocking:0,non_blocking_error:0,cancelled:0},Y;for await(let C of MK$(W)){if(P[C.outcome]++,C.preventContinuation)yield{preventContinuation:!0,stopReason:C.stopReason};if(C.blockingError)yield{blockingError:C.blockingError};if(C.message)yield{message:C.message};if(C.systemMessage)yield{message:FB({type:"hook_system_message",content:C.systemMessage,hookName:M,toolUseID:$,hookEvent:E})};if(C.additionalContext)yield{additionalContexts:[C.additionalContext]};if(C.updatedMCPToolOutput)yield{updatedMCPToolOutput:C.updatedMCPToolOutput};if(C.permissionBehavior)switch(C.permissionBehavior){case"deny":Y="deny";break;case"ask":if(Y!=="deny")Y="ask";break;case"allow":if(!Y)Y="allow";break;case"passthrough":break}if(Y!==void 0)yield{permissionBehavior:Y,hookPermissionDecisionReason:C.hookPermissionDecisionReason,updatedInput:C.updatedInput&&(C.permissionBehavior==="allow"||C.permissionBehavior==="ask")?C.updatedInput:void 0};if(C.updatedInput&&C.permissionBehavior===void 0)yield{updatedInput:C.updatedInput};if(C.permissionRequestResult)yield{permissionRequestResult:C.permissionRequestResult};if(G&&C.hook.type!=="callback"){let Z=j$(),O=mvI(G,Z,E,A??"",C.hook);if(O?.onHookSuccess&&C.outcome==="success")try{O.onHookSuccess(C.hook,C)}catch(j){r(Error("Session hook success callback failed",{cause:j}))}}}if(c("tengu_repl_hook_finished",{hookName:M,numCommands:X.length,numSuccess:P.success,numBlocking:P.blocking,numNonBlockingError:P.non_blocking_error,numCancelled:P.cancelled}),wF()){let C=QND(X);bQ("hook_execution_complete",{hook_event:E,hook_name:M,num_hooks:String(X.length),num_success:String(P.success),num_blocking:String(P.blocking),num_non_blocking_error:String(P.non_blocking_error),num_cancelled:String(P.cancelled),managed_only:String(dp()),hook_definitions:vH(C),hook_source:dp()?"policySettings":"merged"})}TvI(Q,{numSuccess:P.success,numBlocking:P.blocking,numNonBlockingError:P.non_blocking_error,numCancelled:P.cancelled})}async function PxA({getAppState:H,hookInput:$,matchQuery:A,signal:L,timeoutMs:I=c7}){let D=$.hook_event_name,B=A?`${D}:${A}`:D;if(VL().disableAllHooks)return N(`Skipping hooks for ${B} due to 'disableAllHooks' setting`),[];if(VND())return N(`Skipping ${B} hook execution - workspace trust not accepted`),[];let f=H?await H():void 0,E=j$(),M=WxA(f,E,D,$);if(M.length===0)return[];if(L?.aborted)return[];let G=CND(M);c("tengu_run_hook",{hookName:B,numCommands:M.length,...G&&{pluginHookCounts:vH(G)}});let U;try{U=vH($)}catch(J){return r(J instanceof Error?J:Error(String(J))),[]}let X=M.map(async({hook:J,pluginRoot:F},Q)=>{if(J.type==="callback"){let C=J.timeout?J.timeout*1000:I,{signal:Z,cleanup:q}=zT(AbortSignal.timeout(C),L);try{let O=EY.randomUUID(),j=await J.callback($,O,Z,Q);if(q?.(),GBH(j))return N(`${B} [callback] returned async response, returning empty output`),{command:"callback",succeeded:!0,output:""};let u=j.systemMessage||"";return N(`${B} [callback] completed successfully`),{command:"callback",succeeded:!0,output:u}}catch(O){q?.();let j=O instanceof Error?O.message:String(O);return N(`${B} [callback] failed to run: ${j}`,{level:"error"}),{command:"callback",succeeded:!1,output:j}}}if(J.type==="prompt")return{command:J.prompt,succeeded:!1,output:"Prompt stop hooks are not yet supported outside REPL"};if(J.type==="agent")return{command:J.prompt([]),succeeded:!1,output:"Agent stop hooks are not yet supported outside REPL"};if(J.type==="function")return r(Error(`Function hook reached executeHooksOutsideREPL for ${D}. Function hooks should only be used in REPL context (Stop hooks).`)),{command:"function",succeeded:!1,output:"Internal error: function hook executed outside REPL context"};let W=J.timeout?J.timeout*1000:I,{signal:P,cleanup:Y}=zT(AbortSignal.timeout(W),L);try{let C=await s2$(J,D,B,U,P,EY.randomUUID(),Q,F);if(Y?.(),C.aborted)return N(`${B} [${J.command}] cancelled`),{command:J.command,succeeded:!1,output:"Hook cancelled"};N(`${B} [${J.command}] completed with status ${C.status}`);let{json:Z,validationError:q}=PND(C.stdout);if(q)throw Error(q);if(Z&&!GBH(Z))N(`Parsed JSON output from hook: ${vH(Z)}`);let O=C.status===0?C.stdout||"":C.stderr||"";return{command:J.command,succeeded:C.status===0,output:O}}catch(C){Y?.();let Z=C instanceof Error?C.message:String(C);return N(`${B} [${J.command}] failed to run: ${Z}`,{level:"error"}),{command:J.command,succeeded:!1,output:Z}}});return await Promise.all(X)}async function*uOA(H,$,A,L,I,D,B=c7){N(`executePreToolHooks called for tool: ${H}`);let f={...vF(I),hook_event_name:"PreToolUse",tool_name:H,tool_input:A,tool_use_id:$};yield*iS({hookInput:f,toolUseID:$,matchQuery:H,signal:D,timeoutMs:B,toolUseContext:L})}async function*gOA(H,$,A,L,I,D,B,f=c7){let E={...vF(D),hook_event_name:"PostToolUse",tool_name:H,tool_input:A,tool_response:L,tool_use_id:$};yield*iS({hookInput:E,toolUseID:$,matchQuery:H,signal:B,timeoutMs:f,toolUseContext:I})}async function*mOA(H,$,A,L,I,D,B,f,E=c7){let M={...vF(B),hook_event_name:"PostToolUseFailure",tool_name:H,tool_input:A,tool_use_id:$,error:L,is_interrupt:D};yield*iS({hookInput:M,toolUseID:$,matchQuery:H,signal:f,timeoutMs:E,toolUseContext:I})}async function c2A(H,$=c7){let{message:A,title:L,notificationType:I}=H,D={...vF(void 0),hook_event_name:"Notification",message:A,title:L,notification_type:I};await PxA({hookInput:D,timeoutMs:$,matchQuery:I})}async function*XxA(H,$,A=c7,L=!1,I,D,B,f){let E=I?{...vF(H),hook_event_name:"SubagentStop",stop_hook_active:L,agent_id:I,agent_transcript_path:xx(I),agent_type:f??""}:{...vF(H),hook_event_name:"Stop",stop_hook_active:L};yield*iS({hookInput:E,toolUseID:EY.randomUUID(),signal:$,timeoutMs:A,toolUseContext:D,messages:B})}async function*JxA(H,$,A,L,I=c7){let D={...vF(A),hook_event_name:"TeammateIdle",teammate_name:H,team_name:$};yield*iS({hookInput:D,toolUseID:EY.randomUUID(),signal:L,timeoutMs:I})}async function*DuH(H,$,A,L,I,D,B,f=c7,E){let M={...vF(D),hook_event_name:"TaskCompleted",task_id:H,task_subject:$,task_description:A,teammate_name:L,team_name:I};yield*iS({hookInput:M,toolUseID:EY.randomUUID(),signal:B,timeoutMs:f,toolUseContext:E})}async function*_xA(H,$,A){let L={...vF($),hook_event_name:"UserPromptSubmit",prompt:H};yield*iS({hookInput:L,toolUseID:EY.randomUUID(),signal:A.abortController.signal,timeoutMs:c7,toolUseContext:A})}async function*CxA(H,$,A,L,I,D=c7,B){let f={...vF(void 0,$),hook_event_name:"SessionStart",source:H,agent_type:A,model:L};yield*iS({hookInput:f,toolUseID:EY.randomUUID(),matchQuery:H,signal:I,timeoutMs:D,forceSyncExecution:B})}async function*YxA(H,$,A=c7,L){let I={...vF(void 0),hook_event_name:"Setup",trigger:H};yield*iS({hookInput:I,toolUseID:EY.randomUUID(),matchQuery:H,signal:$,timeoutMs:A,forceSyncExecution:L})}async function*KNA(H,$,A,L=c7){let I={...vF(void 0),hook_event_name:"SubagentStart",agent_id:H,agent_type:$};yield*iS({hookInput:I,toolUseID:EY.randomUUID(),matchQuery:$,signal:A,timeoutMs:L})}async function iY$(H,$,A=c7){let L={...vF(void 0),hook_event_name:"PreCompact",trigger:H.trigger,custom_instructions:H.customInstructions},I=await PxA({hookInput:L,matchQuery:H.trigger,signal:$,timeoutMs:A});if(I.length===0)return{};let D=I.filter((f)=>f.succeeded&&f.output.trim().length>0).map((f)=>f.output.trim()),B=[];for(let f of I)if(f.succeeded)if(f.output.trim())B.push(`PreCompact [${f.command}] completed successfully: ${f.output.trim()}`);else B.push(`PreCompact [${f.command}] completed successfully`);else if(f.output.trim())B.push(`PreCompact [${f.command}] failed: ${f.output.trim()}`);else B.push(`PreCompact [${f.command}] failed`);return{newCustomInstructions:D.length>0?D.join(`
${H}`,I=await ww({promptMessages:[R$({content:L})],cacheSafeParams:{...$,toolUseContext:A},canUseTool:async()=>({behavior:"deny",message:"Side questions cannot use tools",decisionReason:{type:"other",reason:"side_question"}}),querySource:"side_question",forkLabel:"side_question",maxTurns:1}),B=I.messages.find((E)=>E.type==="assistant")?.message?.content?.find((E)=>E.type==="text");return{response:B&&B.type==="text"?B.text.trim():null,usage:I.totalUsage}}var AF1;var EjA=K(()=>{VS();_L();AF1=/^\/btw\b/gi});var hjD={};JA(hjD,{call:()=>IF1});function LF1({question:H,context:$,onDone:A}){let[L,I]=t3H.useState(null),[D,B]=t3H.useState(null),[f,E]=t3H.useState(0);return FF(()=>E((M)=>M+1),L||D?null:80),WL((M,G)=>{if(G.escape||G.return||M===" ")A(void 0,{display:"skip"})}),t3H.useEffect(()=>{let M=cD();async function G(){try{let[U,X,J]=await Promise.all([tC($.options.tools,$.options.mainLoopModel,[],$.options.mcpClients),y5(),R5()]),F=await vjD({question:H,cacheSafeParams:{systemPrompt:U,userContext:X,systemContext:J,toolUseContext:$,forkContextMessages:$.messages}});if(!M.signal.aborted)if(F.response)I(F.response);else B("No response received")}catch(U){if(!M.signal.aborted)B(U.message||"Failed to get response")}}return G(),()=>{M.abort()}},[H,$]),SG.createElement(x,{flexDirection:"column",paddingLeft:2,marginTop:1},SG.createElement(x,null,SG.createElement(V,{color:"warning",bold:!0},"/btw"," "),SG.createElement(V,{dimColor:!0},H)),SG.createElement(x,{marginTop:1,marginLeft:2},D?SG.createElement(V,{color:"error"},D):L?SG.createElement(V,null,L):SG.createElement(x,null,SG.createElement(ihH,{frame:f,messageColor:"warning"}),SG.createElement(V,{color:"warning"},"Answering..."))),(L||D)&&SG.createElement(x,{marginTop:1},SG.createElement(V,{dimColor:!0},"Press Space, Enter, or Escape to dismiss")))}async function IF1(H,$,A){let L=A?.trim();if(!L)return H("Usage: /btw <your question>",{display:"system"}),null;return SG.createElement(LF1,{question:L,context:$,onDone:H})}var SG,t3H;var bjD=K(()=>{xH();EjA();qw();ST();F2A();n6();aE();SG=h(t(),1),t3H=h(t(),1)});var DF1,MjA;var kjD=K(()=>{DF1={type:"local-jsx",name:"btw",description:"Ask a quick side question without interrupting the main conversation",isEnabled:()=>process.env.ENABLE_BTW==="true",isHidden:!1,immediate:!0,argumentHint:"<question>",load:()=>Promise.resolve().then(() => (bjD(),hjD)),userFacingName(){return"btw"}},MjA=DF1});var ujD=()=>{};var gjD=()=>{};function s3H(H){let $=H;return $=$.replace(/"(sk-ant[^\s"']{24,})"/g,'"[REDACTED_API_KEY]"'),$=$.replace(/(?<![A-Za-z0-9"'])(sk-ant-?[A-Za-z0-9_-]{10,})(?![A-Za-z0-9"'])/g,"[REDACTED_API_KEY]"),$=$.replace(/AWS key: "(AWS[A-Z0-9]{20,})"/g,'AWS key: "[REDACTED_AWS_KEY]"'),$=$.replace(/(AKIA[A-Z0-9]{16})/g,"[REDACTED_AWS_KEY]"),$=$.replace(/(?<![A-Za-z0-9])(AIza[A-Za-z0-9_-]{35})(?![A-Za-z0-9])/g,"[REDACTED_GCP_KEY]"),$=$.replace(/(?<![A-Za-z0-9])([a-z0-9-]+@[a-z0-9-]+\.iam\.gserviceaccount\.com)(?![A-Za-z0-9])/g,"[REDACTED_GCP_SERVICE_ACCOUNT]"),$=$.replace(/(["']?x-api-key["']?\s*[:=]\s*["']?)[^"',\s)}\]]+/gi,"$1[REDACTED_API_KEY]"),$=$.replace(/(["']?authorization["']?\s*[:=]\s*["']?(bearer\s+)?)[^"',\s)}\]]+/gi,"$1[REDACTED_TOKEN]"),$=$.replace(/(AWS[_-][A-Za-z0-9_]+\s*[=:]\s*)["']?[^"',\s)}\]]+["']?/gi,"$1[REDACTED_AWS_VALUE]"),$=$.replace(/(GOOGLE[_-][A-Za-z0-9_]+\s*[=:]\s*)["']?[^"',\s)}\]]+["']?/gi,"$1[REDACTED_GCP_VALUE]"),$=$.replace(/((API[-_]?KEY|TOKEN|SECRET|PASSWORD)\s*[=:]\s*)["']?[^"',\s)}\]]+["']?/gi,"$1[REDACTED]"),$}function pjD(){return TMH().map((H)=>{let $={...H};if($&&typeof $.error==="string")$.error=s3H($.error);return $})}async function fF1(){try{let H=j5();return await cjD.readFile(H,"utf-8")}catch{return null}}function ljD({abortSignal:H,messages:$,initialDescription:A,onDone:L,backgroundTasks:I={}}){let[D,B]=pw.useState("userInput"),[f,E]=pw.useState(0),[M,G]=pw.useState(A??""),[U,X]=pw.useState(null),[J,F]=pw.useState(null),[Q,W]=pw.useState({isGit:!1,gitState:null}),[P,Y]=pw.useState(null),C=QL().columns-4;pw.useEffect(()=>{async function O(){let j=await Y6(),u=null;if(j)u=await M9L();W({isGit:j,gitState:u})}O()},[]);let Z=pw.useCallback(async()=>{B("submitting"),F(null),X(null);let O=pjD(),u=IY($)?.requestId??null,y=GjA($),g=UjA(I),v=[...new Set([...y,...g])],[p,d]=await Promise.all([JjA(v),fF1()]),k=XjA(I),n={...p,...k},GH={latestAssistantMessageId:u,message_count:$.length,datetime:new Date().toISOString(),description:M,platform:OA.platform,gitRepo:Q.isGit,terminal:OA.terminal,version:{ISSUES_EXPLAINER:"report the issue at https://github.com/anthropics/claude-code/issues",PACKAGE_URL:"@anthropic-ai/claude-code",README_URL:"https://code.claude.com/docs/en/overview",VERSION:"2.1.33",FEEDBACK_CHANNEL:"https://github.com/anthropics/claude-code/issues",BUILD_TIME:"2026-02-06T00:15:09Z"}.VERSION,transcript:GJ($),errors:O,lastApiRequest:cS$(),...Object.keys(n).length>0&&{subagentTranscripts:n},...d&&{rawTranscriptJsonl:d}},[e,BH]=await Promise.all([GF1(GH,H),MF1(M,H)]);if(Y(BH),e.success){if(e.feedbackId)X(e.feedbackId),c("tengu_bug_report_submitted",{feedback_id:e.feedbackId,last_assistant_message_id:u});B("done")}else{if(e.isZdrOrg)F("Feedback collection is not available for organizations with custom data retention policies.");else F("Could not submit feedback. Please try again later.");B("userInput")}},[M,Q.isGit,$]),q=pw.useCallback(()=>{if(D==="done"){if(J)L("Error submitting feedback / bug report",{display:"system"});else L("Feedback / bug report submitted",{display:"system"});return}L("Feedback / bug report cancelled",{display:"system"})},[D,J,L]);return BA("confirm:no",()=>{},{context:"Confirmation",isActive:D==="userInput"}),WL((O,j)=>{if(D==="done"){if(j.return&&P){let u=EF1(U??"",P,M,pjD());tf(u)}if(J)L("Error submitting feedback / bug report",{display:"system"});else L("Feedback / bug report submitted",{display:"system"});return}if(J&&D!=="userInput"){L("Error submitting feedback / bug report",{display:"system"});return}if(D==="consent"&&(j.return||O===" "))Z()}),vI.createElement(fL,{title:"Submit Feedback / Bug Report",onCancel:q,inputGuide:(O)=>O.pending?vI.createElement(V,null,"Press ",O.keyName," again to exit"):D==="userInput"?vI.createElement(rA,null,vI.createElement(s$,{shortcut:"Enter",action:"continue"}),vI.createElement(VA,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"cancel"})):D==="consent"?vI.createElement(rA,null,vI.createElement(s$,{shortcut:"Enter",action:"submit"}),vI.createElement(VA,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"cancel"})):null},D==="userInput"&&vI.createElement(x,{flexDirection:"column",gap:1},vI.createElement(V,null,"Describe the issue below:"),vI.createElement(F9,{value:M,onChange:(O)=>{if(G(O),J)F(null)},columns:C,onSubmit:()=>B("consent"),onExitMessage:()=>L("Feedback cancelled",{display:"system"}),cursorOffset:f,onChangeCursorOffset:E}),J&&vI.createElement(x,{flexDirection:"column",gap:1},vI.createElement(V,{color:"error"},J),vI.createElement(V,{dimColor:!0},"Edit and press Enter to retry, or Esc to cancel"))),D==="consent"&&vI.createElement(x,{flexDirection:"column"},vI.createElement(V,null,"This report will include:"),vI.createElement(x,{marginLeft:2,flexDirection:"column"},vI.createElement(V,null,"- Your feedback / bug description:"," ",vI.createElement(V,{dimColor:!0},M)),vI.createElement(V,null,"- Environment info:"," ",vI.createElement(V,{dimColor:!0},OA.platform,", ",OA.terminal,", v",{ISSUES_EXPLAINER:"report the issue at https://github.com/anthropics/claude-code/issues",PACKAGE_URL:"@anthropic-ai/claude-code",README_URL:"https://code.claude.com/docs/en/overview",VERSION:"2.1.33",FEEDBACK_CHANNEL:"https://github.com/anthropics/claude-code/issues",BUILD_TIME:"2026-02-06T00:15:09Z"}.VERSION)),Q.gitState&&vI.createElement(V,null,"- Git repo metadata:"," ",vI.createElement(V,{dimColor:!0},Q.gitState.branchName,Q.gitState.commitHash?`, ${Q.gitState.commitHash.slice(0,7)}`:"",Q.gitState.remoteUrl?` @ ${Q.gitState.remoteUrl}`:"",!Q.gitState.isHeadOnRemote&&", not synced",!Q.gitState.isClean&&", has local changes")),vI.createElement(V,null,"- Current session transcript")),vI.createElement(x,{marginTop:1},vI.createElement(V,{wrap:"wrap",dimColor:!0},"We will use your feedback to debug related issues or to improve"," ","Claude Code's functionality (eg. to reduce the risk of bugs occurring in the future).")),vI.createElement(x,{marginTop:1},vI.createElement(V,null,"Press ",vI.createElement(V,{bold:!0},"Enter")," to confirm and submit."))),D==="submitting"&&vI.createElement(x,{flexDirection:"row",gap:1},vI.createElement(V,null,"Submitting report\u2026")),D==="done"&&vI.createElement(x,{flexDirection:"column"},J?vI.createElement(V,{color:"error"},J):vI.createElement(V,{color:"success"},"Thank you for your report!"),U&&vI.createElement(V,{dimColor:!0},"Feedback ID: ",U),vI.createElement(x,{marginTop:1},vI.createElement(V,null,"Press "),vI.createElement(V,{bold:!0},"Enter "),vI.createElement(V,null,"to open your browser and draft a GitHub issue, or any other key to close."))))}function EF1(H,$,A,L){let I=s3H($),B=`**Bug Description**
${H.reason}`:".";return{reasonString:`Hook ${oH.bold(H.hookName)} requires confirmation for this ${$}${A}`,configString:"/hooks to update"}}default:return null}}function CY({permissionResult:H,toolType:$}){let A=qZ1(H?.decisionReason,$);if(!A)return null;return qpH.default.createElement(x,{marginBottom:1,flexDirection:"column"},qpH.default.createElement(V,null,qpH.default.createElement(u9,null,A.reasonString)),A.configString&&qpH.default.createElement(V,{dimColor:!0},A.configString))}var qpH;var Le=K(()=>{xH();s0();qpH=h(t(),1)});function ZPH({options:H,onSelect:$,onCancel:A,question:L="Do you want to proceed?",toolAnalyticsContext:I}){let D=RI(),[B,f]=RJ.useState(""),[E,M]=RJ.useState(""),[G,U]=RJ.useState(!1),[X,J]=RJ.useState(!1),[F,Q]=RJ.useState(null),[W,P]=RJ.useState(!1),[Y,C]=RJ.useState(!1),q=H.find((p)=>p.value===F)?.feedbackConfig?.type,O=q==="accept"&&!G||q==="reject"&&!X,j=RJ.useMemo(()=>{return H.map((p)=>{let{value:d,label:k,feedbackConfig:n}=p;if(!n)return{label:k,value:d};let{type:GH,placeholder:e}=n,BH=GH==="accept"?G:X,VH=GH==="accept"?f:M,wH=TZ1[GH];if(BH)return{type:"input",label:k,value:d,placeholder:e??wH,onChange:VH,allowEmptySubmitToCancel:!0};return{label:k,value:d}})},[H,G,X]),u=RJ.useCallback((p)=>{let d=H.find((GH)=>GH.value===p);if(!d?.feedbackConfig)return;let{type:k}=d.feedbackConfig,n={toolName:I?.toolName,isMcp:I?.isMcp??!1};if(k==="accept")if(G)U(!1),c("tengu_accept_feedback_mode_collapsed",n);else U(!0),P(!0),c("tengu_accept_feedback_mode_entered",n);else if(k==="reject")if(X)J(!1),c("tengu_reject_feedback_mode_collapsed",n);else J(!0),C(!0),c("tengu_reject_feedback_mode_entered",n)},[H,G,X,I]),y=RJ.useCallback((p)=>{let d=H.find((n)=>n.value===p);if(!d)return;let k;if(d.feedbackConfig){let GH=(d.feedbackConfig.type==="accept"?B:E).trim();if(GH)k=GH;let e={toolName:I?.toolName,isMcp:I?.isMcp??!1,has_instructions:!!GH,instructions_length:GH?.length??0,entered_feedback_mode:d.feedbackConfig.type==="accept"?W:Y};if(d.feedbackConfig.type==="accept")c("tengu_accept_submitted",e);else if(d.feedbackConfig.type==="reject")c("tengu_reject_submitted",e)}$(p,k)},[H,B,E,$,I,W,Y]),g=RJ.useMemo(()=>{let p={};for(let d of H)if(d.keybinding)p[d.keybinding]=()=>y(d.value);return p},[H,y]);rI(g,{context:"Confirmation"});let v=RJ.useCallback(()=>{c("tengu_permission_request_escape",{}),D((p)=>({...p,attribution:{...p.attribution,escapeCount:p.attribution.escapeCount+1}})),A?.()},[A,D]);return RJ.default.createElement(x,{flexDirection:"column"},typeof L==="string"?RJ.default.createElement(V,null,L):L,RJ.default.createElement(QA,{options:j,inlineDescriptions:!0,onChange:y,onCancel:v,onFocus:(p)=>{let d=H.find((k)=>k.value===p);if(d?.feedbackConfig?.type!=="accept"&&G&&!B.trim())U(!1);if(d?.feedbackConfig?.type!=="reject"&&X&&!E.trim())J(!1);Q(p)},onInputModeToggle:u}),RJ.default.createElement(x,{marginTop:1},RJ.default.createElement(V,{dimColor:!0},"Esc to cancel",O&&" \xB7 Tab to amend")))}var RJ,TZ1;var sz$=K(()=>{xH();T1();z$();pL();LI();RJ=h(t(),1),TZ1={accept:"tell Claude what to do next",reject:"tell Claude what to do differently"}});function JsD({toolUseConfirm:H,onDone:$,onReject:A,workerBadge:L,serverName:I,toolName:D,args:B}){let f=`${I} - ${D}`,E=`mcp__${I}__${D}`,M=Ie.useMemo(()=>({...H,tool:{...H.tool,name:E,isMcp:!0}}),[H,E]),G=Ie.useMemo(()=>({completion_type:"tool_use_single",language_name:"none"}),[]);Rz(M,G);let U=Ie.useCallback((P,Y)=>{switch(P){case"yes":uX({completion_type:"tool_use_single",event:"accept",metadata:{language_name:"none",message_id:M.assistantMessage.message.id,platform:OA.platform}}),M.onAllow(M.input,[],Y),$();break;case"yes-dont-ask-again":{uX({completion_type:"tool_use_single",event:"accept",metadata:{language_name:"none",message_id:M.assistantMessage.message.id,platform:OA.platform}});let C=M.permissionResult.behavior==="ask"?M.permissionResult.suggestions||[]:[];if(C.length===0)r(Error(`MCPCliPermissionRequest: No MCP suggestions found for ${I}/${D}`)),M.onAllow(M.input,[]);else M.onAllow(M.input,C);$();break}case"no":uX({completion_type:"tool_use_single",event:"reject",metadata:{language_name:"none",message_id:M.assistantMessage.message.id,platform:OA.platform}}),M.onReject(Y),A(),$();break}},[M,$,A,I,D]),X=Ie.useCallback(()=>{uX({completion_type:"tool_use_single",event:"reject",metadata:{language_name:"none",message_id:M.assistantMessage.message.id,platform:OA.platform}}),M.onReject(),A(),$()},[M,$,A]),J=zL(),F=lR(),Q=Ie.useMemo(()=>{let P=[{label:"Yes",value:"yes",feedbackConfig:{type:"accept"}}];if(F)P.push({label:vz.default.createElement(V,null,"Yes, and don't ask again for ",vz.default.createElement(V,{bold:!0},f)," ","commands in ",vz.default.createElement(V,{bold:!0},J)),value:"yes-dont-ask-again"});return P.push({label:"No",value:"no",feedbackConfig:{type:"reject"}}),P},[f,J,F]),W=Ie.useMemo(()=>({toolName:iB(M.tool.name),isMcp:!0}),[M.tool.name]);return vz.default.createElement(CG,{title:"Tool use",workerBadge:L},vz.default.createElement(x,{flexDirection:"column",paddingX:2,paddingY:1},vz.default.createElement(V,null,f,"(",B||"{}",")",vz.default.createElement(V,{dimColor:!0}," (MCP)")),vz.default.createElement(V,{dimColor:!0},M.description)),vz.default.createElement(x,{flexDirection:"column"},vz.default.createElement(CY,{permissionResult:M.permissionResult,toolType:"tool"}),vz.default.createElement(ZPH,{options:Q,onSelect:U,onCancel:X,toolAnalyticsContext:W})))}var vz,Ie;var FsD=K(()=>{xH();Bw();A8H();Y1();p$();L8H();Le();_$();sz$();x4();Kq();vz=h(t(),1),Ie=h(t(),1)});function KsD({sedInfo:H,...$}){let{filePath:A}=H,{oldContent:L,fileExists:I}=TpH.useMemo(()=>{try{if(zH().existsSync(A))return{oldContent:sX(A),fileExists:!0};return{oldContent:"",fileExists:!1}}catch{return{oldContent:"",fileExists:!1}}},[A]),D=TpH.useMemo(()=>{return CKD(L,H)},[L,H]),B=TpH.useMemo(()=>{if(L===D)return[];return[{old_string:L,new_string:D,replace_all:!1}]},[L,D]),f=TpH.useMemo(()=>{if(!I)return"File does not exist";return"Pattern did not match any content"},[I]),E=(M)=>{return{...nD.inputSchema.parse(M),_simulatedSedEdit:{filePath:A,newContent:D}}};return qPH.default.createElement(Pb,{toolUseConfirm:$.toolUseConfirm,toolUseContext:$.toolUseContext,onDone:$.onDone,onReject:$.onReject,title:"Edit file",subtitle:ez$.relative(Y$(),A),question:qPH.default.createElement(V,null,"Do you want to make this edit to"," ",qPH.default.createElement(V,{bold:!0},ez$.basename(A)),"?"),content:B.length>0?qPH.default.createElement(az$,{file_path:A,edits:B}):qPH.default.createElement(V,{dimColor:!0},f),path:A,completionType:"str_replace_single",languageName:rs(A),parseInput:E,workerBadge:$.workerBadge})}var ez$,qPH,TpH;var QsD=K(()=>{xH();XkA();lD();wPH();VI();lD();DL();ubH();TQ();ez$=require("path"),qPH=h(t(),1),TpH=h(t(),1)});function yZ1(H){if(typeof H==="string")return H;try{return vH(H,null,2)}catch{return String(H)}}function vZ1(H,$=1000){let A=H.filter((D)=>D.type==="assistant").slice(-3),L=[],I=0;for(let D of A.reverse()){let B=D.message.content.filter((f)=>f.type==="text").map((f)=>("text"in f)?f.text:"").join(" ");if(B&&I<$){let f=$-I,E=B.length>f?B.slice(0,f)+"...":B;L.unshift(E),I+=E.length}}return L.join(`
${I}`);return}if(MM$(H.error,H.error_description,H.suberror))throw new u2(H.error,H.error_description,H.suberror,H.timestamp||RA.EMPTY_STRING,H.trace_id||RA.EMPTY_STRING,H.correlation_id||RA.EMPTY_STRING,H.claims||RA.EMPTY_STRING,L);throw I}}async handleServerTokenResponse(H,$,A,L,I,D,B,f,E){this.performanceClient?.addQueueMeasurement(EA.HandleServerTokenResponse,H.correlation_id);let M;if(H.id_token){if(M=Bg(H.id_token||RA.EMPTY_STRING,this.cryptoObj.base64Decode),I&&I.nonce){if(M.nonce!==I.nonce)throw HL(uLH)}if(L.maxAge||L.maxAge===0){let J=M.auth_time;if(!J)throw HL(eu);hOH(J,L.maxAge)}}this.homeAccountIdentifier=UF.generateHomeAccountId(H.client_info||RA.EMPTY_STRING,$.authorityType,this.logger,this.cryptoObj,M);let G;if(!!I&&!!I.state)G=UM$.parseRequestState(this.cryptoObj,I.state);H.key_id=H.key_id||L.sshKid||void 0;let U=this.generateCacheRecord(H,$,A,L,M,D,I),X;try{if(this.persistencePlugin&&this.serializableCache)this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),X=new cq(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(X);if(B&&!f&&U.account){let J=this.cacheStorage.generateAccountKey(UF.getAccountInfo(U.account));if(!this.cacheStorage.getAccount(J,L.correlationId))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await FX.generateAuthenticationResult(this.cryptoObj,$,U,!1,L,M,G,void 0,E)}await this.cacheStorage.saveCacheRecord(U,L.correlationId,CEA(M||{}),L.storeInCache)}finally{if(this.persistencePlugin&&this.serializableCache&&X)this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(X)}return FX.generateAuthenticationResult(this.cryptoObj,$,U,!1,L,M,G,H,E)}generateCacheRecord(H,$,A,L,I,D,B){let f=$.getPreferredCache();if(!f)throw HL($g);let E=bE$(I),M,G;if(H.id_token&&!!I)M=zMA(this.homeAccountIdentifier,f,H.id_token,this.clientId,E||""),G=u4I(this.cacheStorage,$,this.homeAccountIdentifier,this.cryptoObj.base64Decode,L.correlationId,I,H.client_info,f,E,B,void 0,this.logger);let U=null;if(H.access_token){let F=H.scope?JX.fromString(H.scope):new JX(L.scopes||[]),Q=(typeof H.expires_in==="string"?parseInt(H.expires_in,10):H.expires_in)||0,W=(typeof H.ext_expires_in==="string"?parseInt(H.ext_expires_in,10):H.ext_expires_in)||0,P=(typeof H.refresh_in==="string"?parseInt(H.refresh_in,10):H.refresh_in)||void 0,Y=A+Q,C=Y+W,Z=P&&P>0?A+P:void 0;U=NMA(this.homeAccountIdentifier,f,H.access_token,this.clientId,E||$.tenant||"",F.printScopes(),Y,C,this.cryptoObj.base64Decode,Z,H.token_type,D,H.key_id,L.claims,L.requestedClaimsHash)}let X=null;if(H.refresh_token){let F;if(H.refresh_token_expires_in){let Q=typeof H.refresh_token_expires_in==="string"?parseInt(H.refresh_token_expires_in,10):H.refresh_token_expires_in;F=A+Q}X=OMA(this.homeAccountIdentifier,f,H.refresh_token,this.clientId,H.foci,D,F)}let J=null;if(H.foci)J={clientId:this.clientId,environment:f,familyId:H.foci};return{account:G,idToken:M,accessToken:U,refreshToken:X,appMetadata:J}}static async generateAuthenticationResult(H,$,A,L,I,D,B,f,E){let M=RA.EMPTY_STRING,G=[],U=null,X,J,F=RA.EMPTY_STRING;if(A.accessToken){if(A.accessToken.tokenType===z8.POP&&!I.popKid){let Y=new KIH(H),{secret:C,keyId:Z}=A.accessToken;if(!Z)throw HL(aLH);M=await Y.signPopToken(C,Z,I)}else M=A.accessToken.secret;if(G=JX.fromString(A.accessToken.target).asArray(),U=HxH(A.accessToken.expiresOn),X=HxH(A.accessToken.extendedExpiresOn),A.accessToken.refreshOn)J=HxH(A.accessToken.refreshOn)}if(A.appMetadata)F=A.appMetadata.familyId===gn?gn:"";let Q=D?.oid||D?.sub||"",W=D?.tid||"";if(f?.spa_accountid&&!!A.account)A.account.nativeAccountId=f?.spa_accountid;let P=A.account?vE$(UF.getAccountInfo(A.account),void 0,D,A.idToken?.secret):null;return{authority:$.canonicalAuthority,uniqueId:Q,tenantId:W,scopes:G,account:P,idToken:A?.idToken?.secret||"",idTokenClaims:D||{},accessToken:M,fromCache:L,expiresOn:U,extExpiresOn:X,refreshOn:J,correlationId:I.correlationId,requestId:E||RA.EMPTY_STRING,familyId:F,tokenType:A.accessToken?.tokenType||RA.EMPTY_STRING,state:B?B.userRequestState:RA.EMPTY_STRING,cloudGraphHostName:A.account?.cloudGraphHostName||RA.EMPTY_STRING,msGraphHost:A.account?.msGraphHost||RA.EMPTY_STRING,code:f?.spa_code,fromNativeBroker:!1}}}function u4I(H,$,A,L,I,D,B,f,E,M,G,U){U?.verbose("setCachedAccount called");let J=H.getAccountKeys().find((Y)=>{return Y.startsWith(A)}),F=null;if(J)F=H.getAccount(J,I);let Q=F||UF.createAccount({homeAccountId:A,idTokenClaims:D,clientInfo:B,environment:f,cloudGraphHostName:M?.cloud_graph_host_name,msGraphHost:M?.msgraph_host,nativeAccountId:G},$,L),W=Q.tenantProfiles||[],P=E||Q.realm;if(P&&!W.find((Y)=>{return Y.tenantId===P})){let Y=yOH(A,Q.localAccountId,P,D);W.push(Y)}return Q.tenantProfiles=W,Q}var BxH=K(()=>{GF();iXH();ROH();kE$();DxH();k4I();AU();XM$();bMA();kO();kXH();_EA();hE$();eE$();Hr();BJ();/*! @azure/msal-common v15.13.1 2025-10-29 */});async function dV(H,$,A){if(typeof H==="string")return H;else return H({clientId:$,tokenEndpoint:A})}var JM$=K(()=>{/*! @azure/msal-common v15.13.1 2025-10-29 */});var FM$;var g4I=K(()=>{AxH();dXH();DIH();AU();mXH();dE$();BxH();tn();GF();sn();XM$();Hr();bXH();uOH();on();kO();Gg();JM$();LM$();BJ();Dg();/*! @azure/msal-common v15.13.1 2025-10-29 */FM$=class FM$ extends c6{constructor(H,$){super(H,$);this.includeRedirectUri=!0,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}async acquireToken(H,$){if(this.performanceClient?.addQueueMeasurement(EA.AuthClientAcquireToken,H.correlationId),!H.code)throw HL(pLH);let A=k2(),L=await u8(this.executeTokenRequest.bind(this),EA.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,H.correlationId)(this.authority,H),I=L.headers?.[$U.X_MS_REQUEST_ID],D=new FX(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return D.validateTokenResponse(L.body),u8(D.handleServerTokenResponse.bind(D),EA.HandleServerTokenResponse,this.logger,this.performanceClient,H.correlationId)(L.body,this.authority,A,H,$,void 0,void 0,void 0,I)}getLogoutUri(H){if(!H)throw xM($IH);let $=this.createLogoutUrlQueryString(H);return n9.appendQueryString(this.authority.endSessionEndpoint,$)}async executeTokenRequest(H,$){this.performanceClient?.addQueueMeasurement(EA.AuthClientExecuteTokenRequest,$.correlationId);let A=this.createTokenQueryParameters($),L=n9.appendQueryString(H.tokenEndpoint,A),I=await u8(this.createTokenRequestBody.bind(this),EA.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,$.correlationId)($),D=void 0;if($.clientInfo)try{let E=hXH($.clientInfo,this.cryptoUtils.base64Decode);D={credential:`${E.uid}${su.CLIENT_INFO_SEPARATOR}${E.utid}`,type:gV.HOME_ACCOUNT_ID}}catch(E){this.logger.verbose("Could not parse client info for CCS Header: "+E)}let B=this.createTokenRequestHeaders(D||$.ccsCredential),f=nXH(this.config.authOptions.clientId,$);return u8(this.executePostToTokenEndpoint.bind(this),EA.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,$.correlationId)(L,I,B,f,$.correlationId,EA.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(H){this.performanceClient?.addQueueMeasurement(EA.AuthClientCreateTokenRequestBody,H.correlationId);let $=new Map;if(GIH($,H.embeddedClientId||H.tokenBodyParameters?.[Oy]||this.config.authOptions.clientId),!this.includeRedirectUri){if(!H.redirectUri)throw xM(oLH)}else UIH($,H.redirectUri);if(MIH($,H.scopes,!0,this.oidcDefaultScopes),YMA($,H.code),mOH($,this.config.libraryInfo),pOH($,this.config.telemetry.application),sOH($),this.serverTelemetryManager&&!pE$(this.config))tOH($,this.serverTelemetryManager);if(H.codeVerifier)ZMA($,H.codeVerifier);if(this.config.clientCredentials.clientSecret)cOH($,this.config.clientCredentials.clientSecret);if(this.config.clientCredentials.clientAssertion){let L=this.config.clientCredentials.clientAssertion;lOH($,await dV(L.assertion,this.config.authOptions.clientId,H.resourceRequestUri)),iOH($,L.assertionType)}if(nOH($,s_.AUTHORIZATION_CODE_GRANT),FIH($),H.authenticationScheme===z8.POP){let L=new KIH(this.cryptoUtils,this.performanceClient),I;if(!H.popKid)I=(await u8(L.generateCnf.bind(L),EA.PopTokenGenerateCnf,this.logger,this.performanceClient,H.correlationId)(H,this.logger)).reqCnfString;else I=this.cryptoUtils.encodeKid(H.popKid);aOH($,I)}else if(H.authenticationScheme===z8.SSH)if(H.sshJwk)oOH($,H.sshJwk);else throw xM(Ig);if(!FG.isEmptyObj(H.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)XIH($,H.claims,this.config.authOptions.clientCapabilities);let A=void 0;if(H.clientInfo)try{let L=hXH(H.clientInfo,this.cryptoUtils.base64Decode);A={credential:`${L.uid}${su.CLIENT_INFO_SEPARATOR}${L.utid}`,type:gV.HOME_ACCOUNT_ID}}catch(L){this.logger.verbose("Could not parse client info for CCS Header: "+L)}else A=H.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&A)switch(A.type){case gV.HOME_ACCOUNT_ID:try{let L=zy(A.credential);fg($,L)}catch(L){this.logger.verbose("Could not parse home account ID for CCS Header: "+L)}break;case gV.UPN:en($,A.credential);break}if(H.embeddedClientId)Mg($,this.config.authOptions.clientId,this.config.authOptions.redirectUri);if(H.tokenBodyParameters)Eg($,H.tokenBodyParameters);if(H.enableSpaAuthorizationCode&&(!H.tokenBodyParameters||!H.tokenBodyParameters[nE$]))Eg($,{[nE$]:"1"});return EIH($,H.correlationId,this.performanceClient),Ny($)}createLogoutUrlQueryString(H){let $=new Map;if(H.postLogoutRedirectUri)WMA($,H.postLogoutRedirectUri);if(H.correlationId)JIH($,H.correlationId);if(H.idTokenHint)VMA($,H.idTokenHint);if(H.state)dOH($,H.state);if(H.logoutHint)qMA($,H.logoutHint);if(H.extraQueryParameters)Eg($,H.extraQueryParameters);if(this.config.authOptions.instanceAware)rOH($);return Ny($,this.config.authOptions.encodeExtraQueryParams,H.extraQueryParameters)}}});var Jn0=300,rXH;var m4I=K(()=>{dE$();AxH();dXH();DIH();AU();mXH();BxH();XM$();tn();on();GF();iXH();Hr();sn();uOH();bXH();DxH();kO();Gg();JM$();LM$();fM$();Dg();BJ();/*! @azure/msal-common v15.13.1 2025-10-29 */rXH=class rXH extends c6{constructor(H,$){super(H,$)}async acquireToken(H){this.performanceClient?.addQueueMeasurement(EA.RefreshTokenClientAcquireToken,H.correlationId);let $=k2(),A=await u8(this.executeTokenRequest.bind(this),EA.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,H.correlationId)(H,this.authority),L=A.headers?.[$U.X_MS_REQUEST_ID],I=new FX(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return I.validateTokenResponse(A.body),u8(I.handleServerTokenResponse.bind(I),EA.HandleServerTokenResponse,this.logger,this.performanceClient,H.correlationId)(A.body,this.authority,$,H,void 0,void 0,!0,H.forceCache,L)}async acquireTokenByRefreshToken(H){if(!H)throw xM(HIH);if(this.performanceClient?.addQueueMeasurement(EA.RefreshTokenClientAcquireTokenByRefreshToken,H.correlationId),!H.account)throw HL(Hg);if(this.cacheManager.isAppMetadataFOCI(H.account.environment))try{return await u8(this.acquireTokenWithCachedRefreshToken.bind(this),EA.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,H.correlationId)(H,!0)}catch(A){let L=A instanceof u2&&A.errorCode===$r,I=A instanceof pV&&A.errorCode===IOH.INVALID_GRANT_ERROR&&A.subError===IOH.CLIENT_MISMATCH_ERROR;if(L||I)return u8(this.acquireTokenWithCachedRefreshToken.bind(this),EA.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,H.correlationId)(H,!1);else throw A}return u8(this.acquireTokenWithCachedRefreshToken.bind(this),EA.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,H.correlationId)(H,!1)}async acquireTokenWithCachedRefreshToken(H,$){this.performanceClient?.addQueueMeasurement(EA.RefreshTokenClientAcquireTokenWithCachedRefreshToken,H.correlationId);let A=j4I(this.cacheManager.getRefreshToken.bind(this.cacheManager),EA.CacheManagerGetRefreshToken,this.logger,this.performanceClient,H.correlationId)(H.account,$,H.correlationId,void 0,this.performanceClient);if(!A)throw GM$($r);if(A.expiresOn&&cXH(A.expiresOn,H.refreshTokenExpirationOffsetSeconds||Jn0))throw this.performanceClient?.addFields({rtExpiresOnMs:Number(A.expiresOn)},H.correlationId),GM$(IxH);let L={...H,refreshToken:A.secret,authenticationScheme:H.authenticationScheme||z8.BEARER,ccsCredential:{credential:H.account.homeAccountId,type:gV.HOME_ACCOUNT_ID}};try{return await u8(this.acquireToken.bind(this),EA.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,H.correlationId)(L)}catch(I){if(I instanceof u2){if(this.performanceClient?.addFields({rtExpiresOnMs:Number(A.expiresOn)},H.correlationId),I.subError===Ar){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");let D=this.cacheManager.generateCredentialKey(A);this.cacheManager.removeRefreshToken(D,H.correlationId)}}throw I}}async executeTokenRequest(H,$){this.performanceClient?.addQueueMeasurement(EA.RefreshTokenClientExecuteTokenRequest,H.correlationId);let A=this.createTokenQueryParameters(H),L=n9.appendQueryString($.tokenEndpoint,A),I=await u8(this.createTokenRequestBody.bind(this),EA.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,H.correlationId)(H),D=this.createTokenRequestHeaders(H.ccsCredential),B=nXH(this.config.authOptions.clientId,H);return u8(this.executePostToTokenEndpoint.bind(this),EA.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,H.correlationId)(L,I,D,B,H.correlationId,EA.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(H){this.performanceClient?.addQueueMeasurement(EA.RefreshTokenClientCreateTokenRequestBody,H.correlationId);let $=new Map;if(GIH($,H.embeddedClientId||H.tokenBodyParameters?.[Oy]||this.config.authOptions.clientId),H.redirectUri)UIH($,H.redirectUri);if(MIH($,H.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),nOH($,s_.REFRESH_TOKEN_GRANT),FIH($),mOH($,this.config.libraryInfo),pOH($,this.config.telemetry.application),sOH($),this.serverTelemetryManager&&!pE$(this.config))tOH($,this.serverTelemetryManager);if(wMA($,H.refreshToken),this.config.clientCredentials.clientSecret)cOH($,this.config.clientCredentials.clientSecret);if(this.config.clientCredentials.clientAssertion){let A=this.config.clientCredentials.clientAssertion;lOH($,await dV(A.assertion,this.config.authOptions.clientId,H.resourceRequestUri)),iOH($,A.assertionType)}if(H.authenticationScheme===z8.POP){let A=new KIH(this.cryptoUtils,this.performanceClient),L;if(!H.popKid)L=(await u8(A.generateCnf.bind(A),EA.PopTokenGenerateCnf,this.logger,this.performanceClient,H.correlationId)(H,this.logger)).reqCnfString;else L=this.cryptoUtils.encodeKid(H.popKid);aOH($,L)}else if(H.authenticationScheme===z8.SSH)if(H.sshJwk)oOH($,H.sshJwk);else throw xM(Ig);if(!FG.isEmptyObj(H.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)XIH($,H.claims,this.config.authOptions.clientCapabilities);if(this.config.systemOptions.preventCorsPreflight&&H.ccsCredential)switch(H.ccsCredential.type){case gV.HOME_ACCOUNT_ID:try{let A=zy(H.ccsCredential.credential);fg($,A)}catch(A){this.logger.verbose("Could not parse home account ID for CCS Header: "+A)}break;case gV.UPN:en($,H.ccsCredential.credential);break}if(H.embeddedClientId)Mg($,this.config.authOptions.clientId,this.config.authOptions.redirectUri);if(H.tokenBodyParameters)Eg($,H.tokenBodyParameters);return EIH($,H.correlationId,this.performanceClient),Ny($)}}});var KM$;var p4I=K(()=>{AxH();Hr();GF();BxH();AU();tn();kXH();kO();Gg();$M$();BJ();/*! @azure/msal-common v15.13.1 2025-10-29 */KM$=class KM$ extends c6{constructor(H,$){super(H,$)}async acquireCachedToken(H){this.performanceClient?.addQueueMeasurement(EA.SilentFlowClientAcquireCachedToken,H.correlationId);let $=JG.NOT_APPLICABLE;if(H.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!FG.isEmptyObj(H.claims))throw this.setCacheOutcome(JG.FORCE_REFRESH_OR_CLAIMS,H.correlationId),HL(Ag);if(!H.account)throw HL(Hg);let A=H.account.tenantId||y4I(H.authority),L=this.cacheManager.getTokenKeys(),I=this.cacheManager.getAccessToken(H.account,H,L,A);if(!I)throw this.setCacheOutcome(JG.NO_CACHED_ACCESS_TOKEN,H.correlationId),HL(Ag);else if(TMA(I.cachedAt)||cXH(I.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(JG.CACHED_ACCESS_TOKEN_EXPIRED,H.correlationId),HL(Ag);else if(I.refreshOn&&cXH(I.refreshOn,0))$=JG.PROACTIVELY_REFRESHED;let D=H.authority||this.authority.getPreferredCache(),B={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(H.account),H.correlationId),accessToken:I,idToken:this.cacheManager.getIdToken(H.account,H.correlationId,L,A,this.performanceClient),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(D)};if(this.setCacheOutcome($,H.correlationId),this.config.serverTelemetryManager)this.config.serverTelemetryManager.incrementCacheHits();return[await u8(this.generateResultFromCacheRecord.bind(this),EA.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,H.correlationId)(B,H),$]}setCacheOutcome(H,$){if(this.serverTelemetryManager?.setCacheOutcome(H),this.performanceClient?.addFields({cacheOutcome:H},$),H!==JG.NOT_APPLICABLE)this.logger.info(`Token refresh is required due to cache outcome: ${H}`)}async generateResultFromCacheRecord(H,$){this.performanceClient?.addQueueMeasurement(EA.SilentFlowClientGenerateResultFromCacheRecord,$.correlationId);let A;if(H.idToken)A=Bg(H.idToken.secret,this.config.cryptoInterface.base64Decode);if($.maxAge||$.maxAge===0){let L=A?.auth_time;if(!L)throw HL(eu);hOH(L,$.maxAge)}return FX.generateAuthenticationResult(this.cryptoUtils,this.authority,H,!0,$,A)}}});var fxH={};JA(fxH,{validateAuthorizationResponse:()=>d4I,getStandardAuthorizeRequestParameters:()=>Fn0,getAuthorizeUrl:()=>Kn0,getAuthorizationCodePayload:()=>Qn0});function Fn0(H,$,A,L){let I=$.correlationId,D=new Map;GIH(D,$.embeddedClientId||$.extraQueryParameters?.[Oy]||H.clientId);let B=[...$.scopes||[],...$.extraScopesToConsent||[]];if(MIH(D,B,!0,H.authority.options.OIDCOptions?.defaultScopes),UIH(D,$.redirectUri),JIH(D,I),QMA(D,$.responseMode),FIH(D),$.prompt)_MA(D,$.prompt),L?.addFields({prompt:$.prompt},I);if($.domainHint)PMA(D,$.domainHint),L?.addFields({domainHintFromRequest:!0},I);if($.prompt!==un.SELECT_ACCOUNT){if($.sid&&$.prompt===un.NONE)A.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),aE$(D,$.sid),L?.addFields({sidFromRequest:!0},I);else if($.account){let f=Vn0($.account),E=Pn0($.account);if(E&&$.domainHint)A.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),E=null;if(E){A.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),pXH(D,E),L?.addFields({loginHintFromClaim:!0},I);try{let M=zy($.account.homeAccountId);fg(D,M)}catch(M){A.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(f&&$.prompt===un.NONE){A.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),aE$(D,f),L?.addFields({sidFromClaim:!0},I);try{let M=zy($.account.homeAccountId);fg(D,M)}catch(M){A.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if($.loginHint)A.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),pXH(D,$.loginHint),en(D,$.loginHint),L?.addFields({loginHintFromRequest:!0},I);else if($.account.username){A.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),pXH(D,$.account.username),L?.addFields({loginHintFromUpn:!0},I);try{let M=zy($.account.homeAccountId);fg(D,M)}catch(M){A.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else if($.loginHint)A.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),pXH(D,$.loginHint),en(D,$.loginHint),L?.addFields({loginHintFromRequest:!0},I)}else A.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if($.nonce)CMA(D,$.nonce);if($.state)dOH(D,$.state);if($.claims||H.clientCapabilities&&H.clientCapabilities.length>0)XIH(D,$.claims,H.clientCapabilities);if($.embeddedClientId)Mg(D,H.clientId,H.redirectUri);if(H.instanceAware&&(!$.extraQueryParameters||!Object.keys($.extraQueryParameters).includes(gXH)))rOH(D);return D}function Kn0(H,$,A,L){let I=Ny($,A,L);return n9.appendQueryString(H.authorizationEndpoint,I)}function Qn0(H,$){if(d4I(H,$),!H.code)throw HL(nLH);return H}function d4I(H,$){if(!H.state||!$)throw H.state?HL(dn,"Cached State"):HL(dn,"Server State");let A,L;try{A=decodeURIComponent(H.state)}catch(I){throw HL(bO,H.state)}try{L=decodeURIComponent($)}catch(I){throw HL(bO,H.state)}if(A!==L)throw HL(kLH);if(H.error||H.error_description||H.suberror){let I=Wn0(H);if(MM$(H.error,H.error_description,H.suberror))throw new u2(H.error||"",H.error_description,H.suberror,H.timestamp||"",H.trace_id||"",H.correlation_id||"",H.claims||"",I);throw new pV(H.error||"",H.error_description,H.suberror,I)}}function Wn0(H){let A=H.error_uri?.lastIndexOf("code=");return A&&A>=0?H.error_uri?.substring(A+5):void 0}function Vn0(H){return H.idTokenClaims?.sid||null}function Pn0(H){return H.loginHint||H.idTokenClaims?.login_hint||null}var c4I=K(()=>{dXH();mXH();AU();bXH();DIH();sn();GF();DxH();iXH();BJ();/*! @azure/msal-common v15.13.1 2025-10-29 */});function _n0(H){let{skus:$,libraryName:A,libraryVersion:L,extensionName:I,extensionVersion:D}=H,B=new Map([[0,[A,L]],[2,[I,D]]]),f=[];if($?.length){if(f=$.split(l4I),f.length<4)return $}else f=Array.from({length:4},()=>i4I);return B.forEach((E,M)=>{if(E.length===2&&E[0]?.length&&E[1]?.length)Cn0({skuArr:f,index:M,skuName:E[0],skuVersion:E[1]})}),f.join(l4I)}function Cn0(H){let{skuArr:$,index:A,skuName:L,skuVersion:I}=H;if(A>=$.length)return;$[A]=[L,I].join(i4I)}class Lr{constructor(H,$){this.cacheOutcome=JG.NOT_APPLICABLE,this.cacheManager=$,this.apiId=H.apiId,this.correlationId=H.correlationId,this.wrapperSKU=H.wrapperSKU||RA.EMPTY_STRING,this.wrapperVer=H.wrapperVer||RA.EMPTY_STRING,this.telemetryCacheKey=GK.CACHE_KEY+su.CACHE_KEY_SEPARATOR+H.clientId}generateCurrentRequestHeaderValue(){let H=`${this.apiId}${GK.VALUE_SEPARATOR}${this.cacheOutcome}`,$=[this.wrapperSKU,this.wrapperVer],A=this.getNativeBrokerErrorCode();if(A?.length)$.push(`broker_error=${A}`);let L=$.join(GK.VALUE_SEPARATOR),I=this.getRegionDiscoveryFields(),D=[H,I].join(GK.VALUE_SEPARATOR);return[GK.SCHEMA_VERSION,D,L].join(GK.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){let H=this.getLastRequests(),$=Lr.maxErrorsToSend(H),A=H.failedRequests.slice(0,2*$).join(GK.VALUE_SEPARATOR),L=H.errors.slice(0,$).join(GK.VALUE_SEPARATOR),I=H.errors.length,D=$<I?GK.OVERFLOW_TRUE:GK.OVERFLOW_FALSE,B=[I,D].join(GK.VALUE_SEPARATOR);return[GK.SCHEMA_VERSION,H.cacheHits,A,L,B].join(GK.CATEGORY_SEPARATOR)}cacheFailedRequest(H){let $=this.getLastRequests();if($.errors.length>=GK.MAX_CACHED_ERRORS)$.failedRequests.shift(),$.failedRequests.shift(),$.errors.shift();if($.failedRequests.push(this.apiId,this.correlationId),H instanceof Error&&!!H&&H.toString())if(H instanceof z9)if(H.subError)$.errors.push(H.subError);else if(H.errorCode)$.errors.push(H.errorCode);else $.errors.push(H.toString());else $.errors.push(H.toString());else $.errors.push(GK.UNKNOWN_ERROR);this.cacheManager.setServerTelemetry(this.telemetryCacheKey,$,this.correlationId);return}incrementCacheHits(){let H=this.getLastRequests();return H.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,H,this.correlationId),H.cacheHits}getLastRequests(){let H={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||H}clearTelemetryCache(){let H=this.getLastRequests(),$=Lr.maxErrorsToSend(H),A=H.errors.length;if($===A)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{let L={failedRequests:H.failedRequests.slice($*2),errors:H.errors.slice($),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,L,this.correlationId)}}static maxErrorsToSend(H){let $,A=0,L=0,I=H.errors.length;for($=0;$<I;$++){let D=H.failedRequests[2*$]||RA.EMPTY_STRING,B=H.failedRequests[2*$+1]||RA.EMPTY_STRING,f=H.errors[$]||RA.EMPTY_STRING;if(L+=D.toString().length+B.toString().length+f.length+3,L<GK.MAX_LAST_HEADER_BYTES)A+=1;else break}return A}getRegionDiscoveryFields(){let H=[];return H.push(this.regionUsed||RA.EMPTY_STRING),H.push(this.regionSource||RA.EMPTY_STRING),H.push(this.regionOutcome||RA.EMPTY_STRING),H.join(",")}updateRegionDiscoveryMetadata(H){this.regionUsed=H.region_used,this.regionSource=H.region_source,this.regionOutcome=H.region_outcome}setCacheOutcome(H){this.cacheOutcome=H}setNativeBrokerErrorCode(H){let $=this.getLastRequests();$.nativeBrokerErrorCode=H,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,$,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){let H=this.getLastRequests();delete H.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,H,this.correlationId)}static makeExtraSkuString(H){return _n0(H)}}var l4I=",",i4I="|";var n4I=K(()=>{AU();pq();/*! @azure/msal-common v15.13.1 2025-10-29 */});var xE=K(()=>{g4I();m4I();p4I();AxH();uOH();$M$();yE$();vOH();OEA();kE$();sn();WEA();c4I();dXH();BxH();ROH();SE$();DxH();fM$();pq();JEA();iXH();GF();BJ();on();Dg();AU();tn();n4I();kXH();jMA();eE$();Hr();DIH();mXH();bMA();JM$();/*! @azure/msal-common v15.13.1 2025-10-29 */});class Ir{static deserializeJSONBlob(H){return!H?{}:JSON.parse(H)}static deserializeAccounts(H){let $={};if(H)Object.keys(H).map(function(A){let L=H[A],I={homeAccountId:L.home_account_id,environment:L.environment,realm:L.realm,localAccountId:L.local_account_id,username:L.username,authorityType:L.authority_type,name:L.name,clientInfo:L.client_info,lastModificationTime:L.last_modification_time,lastModificationApp:L.last_modification_app,tenantProfiles:L.tenantProfiles?.map((B)=>{return JSON.parse(B)}),lastUpdatedAt:Date.now().toString()},D=new UF;BIH.toObject(D,I),$[A]=D});return $}static deserializeIdTokens(H){let $={};if(H)Object.keys(H).map(function(A){let L=H[A],I={homeAccountId:L.home_account_id,environment:L.environment,credentialType:L.credential_type,clientId:L.client_id,secret:L.secret,realm:L.realm,lastUpdatedAt:Date.now().toString()};$[A]=I});return $}static deserializeAccessTokens(H){let $={};if(H)Object.keys(H).map(function(A){let L=H[A],I={homeAccountId:L.home_account_id,environment:L.environment,credentialType:L.credential_type,clientId:L.client_id,secret:L.secret,realm:L.realm,target:L.target,cachedAt:L.cached_at,expiresOn:L.expires_on,extendedExpiresOn:L.extended_expires_on,refreshOn:L.refresh_on,keyId:L.key_id,tokenType:L.token_type,requestedClaims:L.requestedClaims,requestedClaimsHash:L.requestedClaimsHash,userAssertionHash:L.userAssertionHash,lastUpdatedAt:Date.now().toString()};$[A]=I});return $}static deserializeRefreshTokens(H){let $={};if(H)Object.keys(H).map(function(A){let L=H[A],I={homeAccountId:L.home_account_id,environment:L.environment,credentialType:L.credential_type,clientId:L.client_id,secret:L.secret,familyId:L.family_id,target:L.target,realm:L.realm,lastUpdatedAt:Date.now().toString()};$[A]=I});return $}static deserializeAppMetadata(H){let $={};if(H)Object.keys(H).map(function(A){let L=H[A];$[A]={clientId:L.client_id,environment:L.environment,familyId:L.family_id}});return $}static deserializeAllCache(H){return{accounts:H.Account?this.deserializeAccounts(H.Account):{},idTokens:H.IdToken?this.deserializeIdTokens(H.IdToken):{},accessTokens:H.AccessToken?this.deserializeAccessTokens(H.AccessToken):{},refreshTokens:H.RefreshToken?this.deserializeRefreshTokens(H.RefreshToken):{},appMetadata:H.AppMetadata?this.deserializeAppMetadata(H.AppMetadata):{}}}}var QM$=K(()=>{xE();/*! @azure/msal-node v3.8.1 2025-10-29 */});var kMA={};JA(kMA,{Serializer:()=>OLH,Deserializer:()=>Ir});var r4I=K(()=>{zE$();QM$();/*! @azure/msal-node v3.8.1 2025-10-29 */});var a4I="system_assigned_managed_identity",Nn0="managed_identity",uMA,HC,XF,m0,H9,T5,kU,WM$,o4I="REGION_NAME",t4I="MSAL_FORCE_REGION",s4I=32,e4I,VM$,gMA,cV,Xg,lq,PM$,H5I=4096;var uU=K(()=>{xE();/*! @azure/msal-node v3.8.1 2025-10-29 */uMA=`https://login.microsoftonline.com/${Nn0}/`,HC={AUTHORIZATION_HEADER_NAME:"Authorization",METADATA_HEADER_NAME:"Metadata",APP_SERVICE_SECRET_HEADER_NAME:"X-IDENTITY-HEADER",ML_AND_SF_SECRET_HEADER_NAME:"secret"},XF={API_VERSION:"api-version",RESOURCE:"resource",SHA256_TOKEN_TO_REFRESH:"token_sha256_to_refresh",XMS_CC:"xms_cc"},m0={AZURE_POD_IDENTITY_AUTHORITY_HOST:"AZURE_POD_IDENTITY_AUTHORITY_HOST",DEFAULT_IDENTITY_CLIENT_ID:"DEFAULT_IDENTITY_CLIENT_ID",IDENTITY_ENDPOINT:"IDENTITY_ENDPOINT",IDENTITY_HEADER:"IDENTITY_HEADER",IDENTITY_SERVER_THUMBPRINT:"IDENTITY_SERVER_THUMBPRINT",IMDS_ENDPOINT:"IMDS_ENDPOINT",MSI_ENDPOINT:"MSI_ENDPOINT",MSI_SECRET:"MSI_SECRET"},H9={APP_SERVICE:"AppService",AZURE_ARC:"AzureArc",CLOUD_SHELL:"CloudShell",DEFAULT_TO_IMDS:"DefaultToImds",IMDS:"Imds",MACHINE_LEARNING:"MachineLearning",SERVICE_FABRIC:"ServiceFabric"},T5={SYSTEM_ASSIGNED:"system-assigned",USER_ASSIGNED_CLIENT_ID:"user-assigned-client-id",USER_ASSIGNED_RESOURCE_ID:"user-assigned-resource-id",USER_ASSIGNED_OBJECT_ID:"user-assigned-object-id"},kU={GET:"get",POST:"post"},WM$={SUCCESS_RANGE_START:T9.SUCCESS_RANGE_START,SUCCESS_RANGE_END:T9.SUCCESS_RANGE_END,SERVER_ERROR:T9.SERVER_ERROR},e4I={SHA256:"sha256"},VM$={CV_CHARSET:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~"},gMA={KEY_SEPARATOR:"-"},cV={MSAL_SKU:"msal.js.node",JWT_BEARER_ASSERTION_TYPE:"urn:ietf:params:oauth:client-assertion-type:jwt-bearer",AUTHORIZATION_PENDING:"authorization_pending",HTTP_PROTOCOL:"http://",LOCALHOST:"localhost"},Xg={acquireTokenSilent:62,acquireTokenByUsernamePassword:371,acquireTokenByDeviceCode:671,acquireTokenByClientCredential:771,acquireTokenByCode:871,acquireTokenByRefreshToken:872},lq={RSA_256:"RS256",PSS_256:"PS256",X5T_256:"x5t#S256",X5T:"x5t",X5C:"x5c",AUDIENCE:"aud",EXPIRATION_TIME:"exp",ISSUER:"iss",SUBJECT:"sub",NOT_BEFORE:"nbf",JWT_ID:"jti"},PM$={INTERVAL_MS:100,TIMEOUT_MS:5000}});class ExH{static getNetworkResponse(H,$,A){return{headers:H,body:$,status:A}}static urlToHttpOptions(H){let $={protocol:H.protocol,hostname:H.hostname&&H.hostname.startsWith("[")?H.hostname.slice(1,-1):H.hostname,hash:H.hash,search:H.search,pathname:H.pathname,path:`${H.pathname||""}${H.search||""}`,href:H.href};if(H.port!=="")$.port=Number(H.port);if(H.username||H.password)$.auth=`${decodeURIComponent(H.username)}:${decodeURIComponent(H.password)}`;return $}}var $5I=K(()=>{/*! @azure/msal-node v3.8.1 2025-10-29 */});class MxH{constructor(H,$){this.proxyUrl=H||"",this.customAgentOptions=$||{}}async sendGetRequestAsync(H,$,A){if(this.proxyUrl)return A5I(H,this.proxyUrl,kU.GET,$,this.customAgentOptions,A);else return L5I(H,kU.GET,$,this.customAgentOptions,A)}async sendPostRequestAsync(H,$){if(this.proxyUrl)return A5I(H,this.proxyUrl,kU.POST,$,this.customAgentOptions);else return L5I(H,kU.POST,$,this.customAgentOptions)}}var _M$,mMA,A5I=(H,$,A,L,I,D)=>{let B=new URL(H),f=new URL($),E=L?.headers||{},M={host:f.hostname,port:f.port,method:"CONNECT",path:B.hostname,headers:E};if(I&&Object.keys(I).length)M.agent=new _M$.default.Agent(I);let G="";if(A===kU.POST){let X=L?.body||"";G=`Content-Type: application/x-www-form-urlencoded\r
${JSON.stringify(I,null,2)}`),Error("Language.load failed: no language function found in WASM file");let B=L[D]();return new H(to,B)}},kH1=(()=>{var _scriptName="file:///home/runner/work/claude-cli-internal/claude-cli-internal/node_modules/web-tree-sitter/tree-sitter.js";return async function(moduleArg={}){var moduleRtn,Module=moduleArg,readyPromiseResolve,readyPromiseReject,readyPromise=new Promise((H,$)=>{readyPromiseResolve=H,readyPromiseReject=$}),ENVIRONMENT_IS_WEB=typeof window=="object",ENVIRONMENT_IS_WORKER=typeof WorkerGlobalScope<"u",ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer",ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;if(ENVIRONMENT_IS_NODE){let{createRequire:H}=await import("module");var require=H("file:///home/runner/work/claude-cli-internal/claude-cli-internal/node_modules/web-tree-sitter/tree-sitter.js")}Module.currentQueryProgressCallback=null,Module.currentProgressCallback=null,Module.currentLogCallback=null,Module.currentParseCallback=null;var moduleOverrides=Object.assign({},Module),arguments_=[],thisProgram="./this.program",quit_=GA((H,$)=>{throw $},"quit_"),scriptDirectory="";function locateFile(H){if(Module.locateFile)return Module.locateFile(H,scriptDirectory);return scriptDirectory+H}GA(locateFile,"locateFile");var readAsync,readBinary;if(ENVIRONMENT_IS_NODE){var fs=require("fs"),nodePath=require("path");if(!"file:///home/runner/work/claude-cli-internal/claude-cli-internal/node_modules/web-tree-sitter/tree-sitter.js".startsWith("data:"))scriptDirectory=nodePath.dirname(require("url").fileURLToPath("file:///home/runner/work/claude-cli-internal/claude-cli-internal/node_modules/web-tree-sitter/tree-sitter.js"))+"/";if(readBinary=GA((H)=>{H=isFileURI(H)?new URL(H):H;var $=fs.readFileSync(H);return $},"readBinary"),readAsync=GA(async(H,$=!0)=>{H=isFileURI(H)?new URL(H):H;var A=fs.readFileSync(H,$?void 0:"utf8");return A},"readAsync"),!Module.thisProgram&&process.argv.length>1)thisProgram=process.argv[1].replace(/\\/g,"/");arguments_=process.argv.slice(2),quit_=GA((H,$)=>{throw process.exitCode=H,$},"quit_")}else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER)scriptDirectory=self.location.href;else if(typeof document<"u"&&document.currentScript)scriptDirectory=document.currentScript.src;if(_scriptName)scriptDirectory=_scriptName;if(scriptDirectory.startsWith("blob:"))scriptDirectory="";else scriptDirectory=scriptDirectory.slice(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1);{if(ENVIRONMENT_IS_WORKER)readBinary=GA((H)=>{var $=new XMLHttpRequest;return $.open("GET",H,!1),$.responseType="arraybuffer",$.send(null),new Uint8Array($.response)},"readBinary");readAsync=GA(async(H)=>{if(isFileURI(H))return new Promise((A,L)=>{var I=new XMLHttpRequest;I.open("GET",H,!0),I.responseType="arraybuffer",I.onload=()=>{if(I.status==200||I.status==0&&I.response){A(I.response);return}L(I.status)},I.onerror=L,I.send(null)});var $=await fetch(H,{credentials:"same-origin"});if($.ok)return $.arrayBuffer();throw Error($.status+" : "+$.url)},"readAsync")}}var out=Module.print||console.log.bind(console),err=Module.printErr||console.error.bind(console);if(Object.assign(Module,moduleOverrides),moduleOverrides=null,Module.arguments)arguments_=Module.arguments;if(Module.thisProgram)thisProgram=Module.thisProgram;var dynamicLibraries=Module.dynamicLibraries||[],wasmBinary=Module.wasmBinary,wasmMemory,ABORT=!1,EXITSTATUS;function assert(H,$){if(!H)abort($)}GA(assert,"assert");var HEAP,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAP64,HEAPU64,HEAPF64,HEAP_DATA_VIEW,runtimeInitialized=!1,isFileURI=GA((H)=>H.startsWith("file://"),"isFileURI");function updateMemoryViews(){var H=wasmMemory.buffer;Module.HEAP_DATA_VIEW=HEAP_DATA_VIEW=new DataView(H),Module.HEAP8=HEAP8=new Int8Array(H),Module.HEAP16=HEAP16=new Int16Array(H),Module.HEAPU8=HEAPU8=new Uint8Array(H),Module.HEAPU16=HEAPU16=new Uint16Array(H),Module.HEAP32=HEAP32=new Int32Array(H),Module.HEAPU32=HEAPU32=new Uint32Array(H),Module.HEAPF32=HEAPF32=new Float32Array(H),Module.HEAPF64=HEAPF64=new Float64Array(H),Module.HEAP64=HEAP64=new BigInt64Array(H),Module.HEAPU64=HEAPU64=new BigUint64Array(H)}if(GA(updateMemoryViews,"updateMemoryViews"),Module.wasmMemory)wasmMemory=Module.wasmMemory;else{var INITIAL_MEMORY=Module.INITIAL_MEMORY||33554432;wasmMemory=new WebAssembly.Memory({initial:INITIAL_MEMORY/65536,maximum:32768})}updateMemoryViews();var __RELOC_FUNCS__=[];function preRun(){if(Module.preRun){if(typeof Module.preRun=="function")Module.preRun=[Module.preRun];while(Module.preRun.length)addOnPreRun(Module.preRun.shift())}callRuntimeCallbacks(onPreRuns)}GA(preRun,"preRun");function initRuntime(){runtimeInitialized=!0,callRuntimeCallbacks(__RELOC_FUNCS__),wasmExports.__wasm_call_ctors(),callRuntimeCallbacks(onPostCtors)}GA(initRuntime,"initRuntime");function preMain(){}GA(preMain,"preMain");function postRun(){if(Module.postRun){if(typeof Module.postRun=="function")Module.postRun=[Module.postRun];while(Module.postRun.length)addOnPostRun(Module.postRun.shift())}callRuntimeCallbacks(onPostRuns)}GA(postRun,"postRun");var runDependencies=0,dependenciesFulfilled=null;function getUniqueRunDependency(H){return H}GA(getUniqueRunDependency,"getUniqueRunDependency");function addRunDependency(H){runDependencies++,Module.monitorRunDependencies?.(runDependencies)}GA(addRunDependency,"addRunDependency");function removeRunDependency(H){if(runDependencies--,Module.monitorRunDependencies?.(runDependencies),runDependencies==0){if(dependenciesFulfilled){var $=dependenciesFulfilled;dependenciesFulfilled=null,$()}}}GA(removeRunDependency,"removeRunDependency");function abort(H){Module.onAbort?.(H),H="Aborted("+H+")",err(H),ABORT=!0,H+=". Build with -sASSERTIONS for more info.";var $=new WebAssembly.RuntimeError(H);throw readyPromiseReject($),$}GA(abort,"abort");var wasmBinaryFile;function findWasmBinary(){if(Module.locateFile)return locateFile("tree-sitter.wasm");return new URL("tree-sitter.wasm","file:///home/runner/work/claude-cli-internal/claude-cli-internal/node_modules/web-tree-sitter/tree-sitter.js").href}GA(findWasmBinary,"findWasmBinary");function getBinarySync(H){if(H==wasmBinaryFile&&wasmBinary)return new Uint8Array(wasmBinary);if(readBinary)return readBinary(H);throw"both async and sync fetching of the wasm failed"}GA(getBinarySync,"getBinarySync");async function getWasmBinary(H){if(!wasmBinary)try{var $=await readAsync(H);return new Uint8Array($)}catch{}return getBinarySync(H)}GA(getWasmBinary,"getWasmBinary");async function instantiateArrayBuffer(H,$){try{var A=await getWasmBinary(H),L=await WebAssembly.instantiate(A,$);return L}catch(I){err(`failed to asynchronously prepare wasm: ${I}`),abort(I)}}GA(instantiateArrayBuffer,"instantiateArrayBuffer");async function instantiateAsync(H,$,A){if(!H&&typeof WebAssembly.instantiateStreaming=="function"&&!isFileURI($)&&!ENVIRONMENT_IS_NODE)try{var L=fetch($,{credentials:"same-origin"}),I=await WebAssembly.instantiateStreaming(L,A);return I}catch(D){err(`wasm streaming compile failed: ${D}`),err("falling back to ArrayBuffer instantiation")}return instantiateArrayBuffer($,A)}GA(instantiateAsync,"instantiateAsync");function getWasmImports(){return{env:wasmImports,wasi_snapshot_preview1:wasmImports,"GOT.mem":new Proxy(wasmImports,GOTHandler),"GOT.func":new Proxy(wasmImports,GOTHandler)}}GA(getWasmImports,"getWasmImports");async function createWasm(){function H(D,B){wasmExports=D.exports,wasmExports=relocateExports(wasmExports,1024);var f=getDylinkMetadata(B);if(f.neededDynlibs)dynamicLibraries=f.neededDynlibs.concat(dynamicLibraries);return mergeLibSymbols(wasmExports,"main"),LDSO.init(),loadDylibs(),__RELOC_FUNCS__.push(wasmExports.__wasm_apply_data_relocs),removeRunDependency("wasm-instantiate"),wasmExports}GA(H,"receiveInstance"),addRunDependency("wasm-instantiate");function $(D){return H(D.instance,D.module)}GA($,"receiveInstantiationResult");var A=getWasmImports();if(Module.instantiateWasm)return new Promise((D,B)=>{Module.instantiateWasm(A,(f,E)=>{H(f,E),D(f.exports)})});wasmBinaryFile??=findWasmBinary();try{var L=await instantiateAsync(wasmBinary,wasmBinaryFile,A),I=$(L);return I}catch(D){return readyPromiseReject(D),Promise.reject(D)}}GA(createWasm,"createWasm");var ASM_CONSTS={};class ExitStatus{static{GA(this,"ExitStatus")}name="ExitStatus";constructor(H){this.message=`Program terminated with exit(${H})`,this.status=H}}var GOT={},currentModuleWeakSymbols=new Set([]),GOTHandler={get(H,$){var A=GOT[$];if(!A)A=GOT[$]=new WebAssembly.Global({value:"i32",mutable:!0});if(!currentModuleWeakSymbols.has($))A.required=!0;return A}},LE_HEAP_LOAD_F32=GA((H)=>HEAP_DATA_VIEW.getFloat32(H,!0),"LE_HEAP_LOAD_F32"),LE_HEAP_LOAD_F64=GA((H)=>HEAP_DATA_VIEW.getFloat64(H,!0),"LE_HEAP_LOAD_F64"),LE_HEAP_LOAD_I16=GA((H)=>HEAP_DATA_VIEW.getInt16(H,!0),"LE_HEAP_LOAD_I16"),LE_HEAP_LOAD_I32=GA((H)=>HEAP_DATA_VIEW.getInt32(H,!0),"LE_HEAP_LOAD_I32"),LE_HEAP_LOAD_U16=GA((H)=>HEAP_DATA_VIEW.getUint16(H,!0),"LE_HEAP_LOAD_U16"),LE_HEAP_LOAD_U32=GA((H)=>HEAP_DATA_VIEW.getUint32(H,!0),"LE_HEAP_LOAD_U32"),LE_HEAP_STORE_F32=GA((H,$)=>HEAP_DATA_VIEW.setFloat32(H,$,!0),"LE_HEAP_STORE_F32"),LE_HEAP_STORE_F64=GA((H,$)=>HEAP_DATA_VIEW.setFloat64(H,$,!0),"LE_HEAP_STORE_F64"),LE_HEAP_STORE_I16=GA((H,$)=>HEAP_DATA_VIEW.setInt16(H,$,!0),"LE_HEAP_STORE_I16"),LE_HEAP_STORE_I32=GA((H,$)=>HEAP_DATA_VIEW.setInt32(H,$,!0),"LE_HEAP_STORE_I32"),LE_HEAP_STORE_U16=GA((H,$)=>HEAP_DATA_VIEW.setUint16(H,$,!0),"LE_HEAP_STORE_U16"),LE_HEAP_STORE_U32=GA((H,$)=>HEAP_DATA_VIEW.setUint32(H,$,!0),"LE_HEAP_STORE_U32"),callRuntimeCallbacks=GA((H)=>{while(H.length>0)H.shift()(Module)},"callRuntimeCallbacks"),onPostRuns=[],addOnPostRun=GA((H)=>onPostRuns.unshift(H),"addOnPostRun"),onPreRuns=[],addOnPreRun=GA((H)=>onPreRuns.unshift(H),"addOnPreRun"),UTF8Decoder=typeof TextDecoder<"u"?new TextDecoder:void 0,UTF8ArrayToString=GA((H,$=0,A=NaN)=>{var L=$+A,I=$;while(H[I]&&!(I>=L))++I;if(I-$>16&&H.buffer&&UTF8Decoder)return UTF8Decoder.decode(H.subarray($,I));var D="";while($<I){var B=H[$++];if(!(B&128)){D+=String.fromCharCode(B);continue}var f=H[$++]&63;if((B&224)==192){D+=String.fromCharCode((B&31)<<6|f);continue}var E=H[$++]&63;if((B&240)==224)B=(B&15)<<12|f<<6|E;else B=(B&7)<<18|f<<12|E<<6|H[$++]&63;if(B<65536)D+=String.fromCharCode(B);else{var M=B-65536;D+=String.fromCharCode(55296|M>>10,56320|M&1023)}}return D},"UTF8ArrayToString"),getDylinkMetadata=GA((H)=>{var $=0,A=0;function L(){return H[$++]}GA(L,"getU8");function I(){var d=0,k=1;while(!0){var n=H[$++];if(d+=(n&127)*k,k*=128,!(n&128))break}return d}GA(I,"getLEB");function D(){var d=I();return $+=d,UTF8ArrayToString(H,$-d,d)}GA(D,"getString");function B(d,k){if(d)throw Error(k)}GA(B,"failIf");var f="dylink.0";if(H instanceof WebAssembly.Module){var E=WebAssembly.Module.customSections(H,f);if(E.length===0)f="dylink",E=WebAssembly.Module.customSections(H,f);B(E.length===0,"need dylink section"),H=new Uint8Array(E[0]),A=H.length}else{var M=new Uint32Array(new Uint8Array(H.subarray(0,24)).buffer),G=M[0]==1836278016||M[0]==6386541;B(!G,"need to see wasm magic number"),B(H[8]!==0,"need the dylink section to be first"),$=9;var U=I();A=$+U,f=D()}var X={neededDynlibs:[],tlsExports:new Set,weakImports:new Set};if(f=="dylink"){X.memorySize=I(),X.memoryAlign=I(),X.tableSize=I(),X.tableAlign=I();var J=I();for(var F=0;F<J;++F){var Q=D();X.neededDynlibs.push(Q)}}else{B(f!=="dylink.0");var W=1,P=2,Y=3,C=4,Z=256,q=3,O=1;while($<A){var j=L(),u=I();if(j===W)X.memorySize=I(),X.memoryAlign=I(),X.tableSize=I(),X.tableAlign=I();else if(j===P){var J=I();for(var F=0;F<J;++F)Q=D(),X.neededDynlibs.push(Q)}else if(j===Y){var y=I();while(y--){var g=D(),v=I();if(v&Z)X.tlsExports.add(g)}}else if(j===C){var y=I();while(y--){var p=D(),g=D(),v=I();if((v&q)==O)X.weakImports.add(g)}}else $+=u}}return X},"getDylinkMetadata");function getValue(H,$="i8"){if($.endsWith("*"))$="*";switch($){case"i1":return HEAP8[H];case"i8":return HEAP8[H];case"i16":return LE_HEAP_LOAD_I16((H>>1)*2);case"i32":return LE_HEAP_LOAD_I32((H>>2)*4);case"i64":return HEAP64[H>>3];case"float":return LE_HEAP_LOAD_F32((H>>2)*4);case"double":return LE_HEAP_LOAD_F64((H>>3)*8);case"*":return LE_HEAP_LOAD_U32((H>>2)*4);default:abort(`invalid type for getValue: ${$}`)}}GA(getValue,"getValue");var newDSO=GA((H,$,A)=>{var L={refcount:1/0,name:H,exports:A,global:!0};if(LDSO.loadedLibsByName[H]=L,$!=null)LDSO.loadedLibsByHandle[$]=L;return L},"newDSO"),LDSO={loadedLibsByName:{},loadedLibsByHandle:{},init(){newDSO("__main__",0,wasmImports)}},___heap_base=78224,alignMemory=GA((H,$)=>Math.ceil(H/$)*$,"alignMemory"),getMemory=GA((H)=>{if(runtimeInitialized)return _calloc(H,1);var $=___heap_base,A=$+alignMemory(H,16);return ___heap_base=A,GOT.__heap_base.value=A,$},"getMemory"),isInternalSym=GA((H)=>["__cpp_exception","__c_longjmp","__wasm_apply_data_relocs","__dso_handle","__tls_size","__tls_align","__set_stack_limits","_emscripten_tls_init","__wasm_init_tls","__wasm_call_ctors","__start_em_asm","__stop_em_asm","__start_em_js","__stop_em_js"].includes(H)||H.startsWith("__em_js__"),"isInternalSym"),uleb128Encode=GA((H,$)=>{if(H<128)$.push(H);else $.push(H%128|128,H>>7)},"uleb128Encode"),sigToWasmTypes=GA((H)=>{var $={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},A={parameters:[],results:H[0]=="v"?[]:[$[H[0]]]};for(var L=1;L<H.length;++L)A.parameters.push($[H[L]]);return A},"sigToWasmTypes"),generateFuncType=GA((H,$)=>{var A=H.slice(0,1),L=H.slice(1),I={i:127,p:127,j:126,f:125,d:124,e:111};$.push(96),uleb128Encode(L.length,$);for(var D=0;D<L.length;++D)$.push(I[L[D]]);if(A=="v")$.push(0);else $.push(1,I[A])},"generateFuncType"),convertJsFunctionToWasm=GA((H,$)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(sigToWasmTypes($),H);var A=[1];generateFuncType($,A);var L=[0,97,115,109,1,0,0,0,1];uleb128Encode(A.length,L),L.push(...A),L.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var I=new WebAssembly.Module(new Uint8Array(L)),D=new WebAssembly.Instance(I,{e:{f:H}}),B=D.exports.f;return B},"convertJsFunctionToWasm"),wasmTableMirror=[],wasmTable=new WebAssembly.Table({initial:31,element:"anyfunc"}),getWasmTableEntry=GA((H)=>{var $=wasmTableMirror[H];if(!$){if(H>=wasmTableMirror.length)wasmTableMirror.length=H+1;wasmTableMirror[H]=$=wasmTable.get(H)}return $},"getWasmTableEntry"),updateTableMap=GA((H,$)=>{if(functionsInTableMap)for(var A=H;A<H+$;A++){var L=getWasmTableEntry(A);if(L)functionsInTableMap.set(L,A)}},"updateTableMap"),functionsInTableMap,getFunctionAddress=GA((H)=>{if(!functionsInTableMap)functionsInTableMap=new WeakMap,updateTableMap(0,wasmTable.length);return functionsInTableMap.get(H)||0},"getFunctionAddress"),freeTableIndexes=[],getEmptyTableSlot=GA(()=>{if(freeTableIndexes.length)return freeTableIndexes.pop();try{wasmTable.grow(1)}catch(H){if(!(H instanceof RangeError))throw H;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}return wasmTable.length-1},"getEmptyTableSlot"),setWasmTableEntry=GA((H,$)=>{wasmTable.set(H,$),wasmTableMirror[H]=wasmTable.get(H)},"setWasmTableEntry"),addFunction=GA((H,$)=>{var A=getFunctionAddress(H);if(A)return A;var L=getEmptyTableSlot();try{setWasmTableEntry(L,H)}catch(D){if(!(D instanceof TypeError))throw D;var I=convertJsFunctionToWasm(H,$);setWasmTableEntry(L,I)}return functionsInTableMap.set(H,L),L},"addFunction"),updateGOT=GA((H,$)=>{for(var A in H){if(isInternalSym(A))continue;var L=H[A];if(GOT[A]||=new WebAssembly.Global({value:"i32",mutable:!0}),$||GOT[A].value==0)if(typeof L=="function")GOT[A].value=addFunction(L);else if(typeof L=="number")GOT[A].value=L;else err(`unhandled export type for '${A}': ${typeof L}`)}},"updateGOT"),relocateExports=GA((H,$,A)=>{var L={};for(var I in H){var D=H[I];if(typeof D=="object")D=D.value;if(typeof D=="number")D+=$;L[I]=D}return updateGOT(L,A),L},"relocateExports"),isSymbolDefined=GA((H)=>{var $=wasmImports[H];if(!$||$.stub)return!1;return!0},"isSymbolDefined"),dynCall=GA((H,$,A=[])=>{var L=getWasmTableEntry($)(...A);return L},"dynCall"),stackSave=GA(()=>_emscripten_stack_get_current(),"stackSave"),stackRestore=GA((H)=>__emscripten_stack_restore(H),"stackRestore"),createInvokeFunction=GA((H)=>($,...A)=>{var L=stackSave();try{return dynCall(H,$,A)}catch(I){if(stackRestore(L),I!==I+0)throw I;if(_setThrew(1,0),H[0]=="j")return 0n}},"createInvokeFunction"),resolveGlobalSymbol=GA((H,$=!1)=>{var A;if(isSymbolDefined(H))A=wasmImports[H];else if(H.startsWith("invoke_"))A=wasmImports[H]=createInvokeFunction(H.split("_")[1]);return{sym:A,name:H}},"resolveGlobalSymbol"),onPostCtors=[],addOnPostCtor=GA((H)=>onPostCtors.unshift(H),"addOnPostCtor"),UTF8ToString=GA((H,$)=>H?UTF8ArrayToString(HEAPU8,H,$):"","UTF8ToString"),loadWebAssemblyModule=GA((binary,flags,libName,localScope,handle)=>{var metadata=getDylinkMetadata(binary);currentModuleWeakSymbols=metadata.weakImports;function loadModule(){var memAlign=Math.pow(2,metadata.memoryAlign),memoryBase=metadata.memorySize?alignMemory(getMemory(metadata.memorySize+memAlign),memAlign):0,tableBase=metadata.tableSize?wasmTable.length:0;if(handle)HEAP8[handle+8]=1,LE_HEAP_STORE_U32((handle+12>>2)*4,memoryBase),LE_HEAP_STORE_I32((handle+16>>2)*4,metadata.memorySize),LE_HEAP_STORE_U32((handle+20>>2)*4,tableBase),LE_HEAP_STORE_I32((handle+24>>2)*4,metadata.tableSize);if(metadata.tableSize)wasmTable.grow(metadata.tableSize);var moduleExports;function resolveSymbol(H){var $=resolveGlobalSymbol(H).sym;if(!$&&localScope)$=localScope[H];if(!$)$=moduleExports[H];return $}GA(resolveSymbol,"resolveSymbol");var proxyHandler={get(H,$){switch($){case"__memory_base":return memoryBase;case"__table_base":return tableBase}if($ in wasmImports&&!wasmImports[$].stub){var A=wasmImports[$];return A}if(!($ in H)){var L;H[$]=(...I)=>{return L||=resolveSymbol($),L(...I)}}return H[$]}},proxy=new Proxy({},proxyHandler),info={"GOT.mem":new Proxy({},GOTHandler),"GOT.func":new Proxy({},GOTHandler),env:proxy,wasi_snapshot_preview1:proxy};function postInstantiation(module,instance){if(updateTableMap(tableBase,metadata.tableSize),moduleExports=relocateExports(instance.exports,memoryBase),!flags.allowUndefined)reportUndefinedSymbols();function addEmAsm(addr,body){var args=[],arity=0;for(;arity<16;arity++)if(body.indexOf("$"+arity)!=-1)args.push("$"+arity);else break;args=args.join(",");var func=`(${args}) => { ${body} };`;ASM_CONSTS[start]=eval(func)}if(GA(addEmAsm,"addEmAsm"),"__start_em_asm"in moduleExports){var{__start_em_asm:start,__stop_em_asm:stop}=moduleExports;while(start<stop){var jsString=UTF8ToString(start);addEmAsm(start,jsString),start=HEAPU8.indexOf(0,start)+1}}function addEmJs(name,cSig,body){var jsArgs=[];if(cSig=cSig.slice(1,-1),cSig!="void"){cSig=cSig.split(",");for(var i in cSig){var jsArg=cSig[i].split(" ").pop();jsArgs.push(jsArg.replace("*",""))}}var func=`(${jsArgs}) => ${body};`;moduleExports[name]=eval(func)}GA(addEmJs,"addEmJs");for(var name in moduleExports)if(name.startsWith("__em_js__")){var start=moduleExports[name],jsString=UTF8ToString(start),parts=jsString.split("<::>");addEmJs(name.replace("__em_js__",""),parts[0],parts[1]),delete moduleExports[name]}var applyRelocs=moduleExports.__wasm_apply_data_relocs;if(applyRelocs)if(runtimeInitialized)applyRelocs();else __RELOC_FUNCS__.push(applyRelocs);var init=moduleExports.__wasm_call_ctors;if(init)if(runtimeInitialized)init();else addOnPostCtor(init);return moduleExports}if(GA(postInstantiation,"postInstantiation"),flags.loadAsync){if(binary instanceof WebAssembly.Module){var instance=new WebAssembly.Instance(binary,info);return Promise.resolve(postInstantiation(binary,instance))}return WebAssembly.instantiate(binary,info).then((H)=>postInstantiation(H.module,H.instance))}var module=binary instanceof WebAssembly.Module?binary:new WebAssembly.Module(binary),instance=new WebAssembly.Instance(module,info);return postInstantiation(module,instance)}if(GA(loadModule,"loadModule"),flags.loadAsync)return metadata.neededDynlibs.reduce((H,$)=>H.then(()=>loadDynamicLibrary($,flags,localScope)),Promise.resolve()).then(loadModule);return metadata.neededDynlibs.forEach((H)=>loadDynamicLibrary(H,flags,localScope)),loadModule()},"loadWebAssemblyModule"),mergeLibSymbols=GA((H,$)=>{for(var[A,L]of Object.entries(H)){let I=GA((B)=>{if(!isSymbolDefined(B))wasmImports[B]=L},"setImport");I(A);let D="__main_argc_argv";if(A=="main")I(D);if(A==D)I("main")}},"mergeLibSymbols"),asyncLoad=GA(async(H)=>{var $=await readAsync(H);return new Uint8Array($)},"asyncLoad");function loadDynamicLibrary(H,$={global:!0,nodelete:!0},A,L){var I=LDSO.loadedLibsByName[H];if(I){if(!$.global){if(A)Object.assign(A,I.exports)}else if(!I.global)I.global=!0,mergeLibSymbols(I.exports,H);if($.nodelete&&I.refcount!==1/0)I.refcount=1/0;if(I.refcount++,L)LDSO.loadedLibsByHandle[L]=I;return $.loadAsync?Promise.resolve(!0):!0}I=newDSO(H,L,"loading"),I.refcount=$.nodelete?1/0:1,I.global=$.global;function D(){if(L){var E=LE_HEAP_LOAD_U32((L+28>>2)*4),M=LE_HEAP_LOAD_U32((L+32>>2)*4);if(E&&M){var G=HEAP8.slice(E,E+M);return $.loadAsync?Promise.resolve(G):G}}var U=locateFile(H);if($.loadAsync)return asyncLoad(U);if(!readBinary)throw Error(`${U}: file not found, and synchronous loading of external files is not available`);return readBinary(U)}GA(D,"loadLibData");function B(){if($.loadAsync)return D().then((E)=>loadWebAssemblyModule(E,$,H,A,L));return loadWebAssemblyModule(D(),$,H,A,L)}GA(B,"getExports");function f(E){if(I.global)mergeLibSymbols(E,H);else if(A)Object.assign(A,E);I.exports=E}if(GA(f,"moduleLoaded"),$.loadAsync)return B().then((E)=>{return f(E),!0});return f(B()),!0}GA(loadDynamicLibrary,"loadDynamicLibrary");var reportUndefinedSymbols=GA(()=>{for(var[H,$]of Object.entries(GOT))if($.value==0){var A=resolveGlobalSymbol(H,!0).sym;if(!A&&!$.required)continue;if(typeof A=="function")$.value=addFunction(A,A.sig);else if(typeof A=="number")$.value=A;else throw Error(`bad export type for '${H}': ${typeof A}`)}},"reportUndefinedSymbols"),loadDylibs=GA(()=>{if(!dynamicLibraries.length){reportUndefinedSymbols();return}addRunDependency("loadDylibs"),dynamicLibraries.reduce((H,$)=>H.then(()=>loadDynamicLibrary($,{loadAsync:!0,global:!0,nodelete:!0,allowUndefined:!0})),Promise.resolve()).then(()=>{reportUndefinedSymbols(),removeRunDependency("loadDylibs")})},"loadDylibs"),noExitRuntime=Module.noExitRuntime||!0;function setValue(H,$,A="i8"){if(A.endsWith("*"))A="*";switch(A){case"i1":HEAP8[H]=$;break;case"i8":HEAP8[H]=$;break;case"i16":LE_HEAP_STORE_I16((H>>1)*2,$);break;case"i32":LE_HEAP_STORE_I32((H>>2)*4,$);break;case"i64":HEAP64[H>>3]=BigInt($);break;case"float":LE_HEAP_STORE_F32((H>>2)*4,$);break;case"double":LE_HEAP_STORE_F64((H>>3)*8,$);break;case"*":LE_HEAP_STORE_U32((H>>2)*4,$);break;default:abort(`invalid type for setValue: ${A}`)}}GA(setValue,"setValue");var ___memory_base=new WebAssembly.Global({value:"i32",mutable:!1},1024),___stack_pointer=new WebAssembly.Global({value:"i32",mutable:!0},78224),___table_base=new WebAssembly.Global({value:"i32",mutable:!1},1),__abort_js=GA(()=>abort(""),"__abort_js");__abort_js.sig="v";var _emscripten_get_now=GA(()=>performance.now(),"_emscripten_get_now");_emscripten_get_now.sig="d";var _emscripten_date_now=GA(()=>Date.now(),"_emscripten_date_now");_emscripten_date_now.sig="d";var nowIsMonotonic=1,checkWasiClock=GA((H)=>H>=0&&H<=3,"checkWasiClock"),INT53_MAX=9007199254740992,INT53_MIN=-9007199254740992,bigintToI53Checked=GA((H)=>H<INT53_MIN||H>INT53_MAX?NaN:Number(H),"bigintToI53Checked");function _clock_time_get(H,$,A){if($=bigintToI53Checked($),!checkWasiClock(H))return 28;var L;if(H===0)L=_emscripten_date_now();else if(nowIsMonotonic)L=_emscripten_get_now();else return 52;var I=Math.round(L*1000*1000);return HEAP64[A>>3]=BigInt(I),0}GA(_clock_time_get,"_clock_time_get"),_clock_time_get.sig="iijp";var getHeapMax=GA(()=>2147483648,"getHeapMax"),growMemory=GA((H)=>{var $=wasmMemory.buffer,A=(H-$.byteLength+65535)/65536|0;try{return wasmMemory.grow(A),updateMemoryViews(),1}catch(L){}},"growMemory"),_emscripten_resize_heap=GA((H)=>{var $=HEAPU8.length;H>>>=0;var A=getHeapMax();if(H>A)return!1;for(var L=1;L<=4;L*=2){var I=$*(1+0.2/L);I=Math.min(I,H+100663296);var D=Math.min(A,alignMemory(Math.max(H,I),65536)),B=growMemory(D);if(B)return!0}return!1},"_emscripten_resize_heap");_emscripten_resize_heap.sig="ip";var _fd_close=GA((H)=>52,"_fd_close");_fd_close.sig="ii";function _fd_seek(H,$,A,L){return $=bigintToI53Checked($),70}GA(_fd_seek,"_fd_seek"),_fd_seek.sig="iijip";var printCharBuffers=[null,[],[]],printChar=GA((H,$)=>{var A=printCharBuffers[H];if($===0||$===10)(H===1?out:err)(UTF8ArrayToString(A)),A.length=0;else A.push($)},"printChar"),flush_NO_FILESYSTEM=GA(()=>{if(printCharBuffers[1].length)printChar(1,10);if(printCharBuffers[2].length)printChar(2,10)},"flush_NO_FILESYSTEM"),SYSCALLS={varargs:void 0,getStr(H){var $=UTF8ToString(H);return $}},_fd_write=GA((H,$,A,L)=>{var I=0;for(var D=0;D<A;D++){var B=LE_HEAP_LOAD_U32(($>>2)*4),f=LE_HEAP_LOAD_U32(($+4>>2)*4);$+=8;for(var E=0;E<f;E++)printChar(H,HEAPU8[B+E]);I+=f}return LE_HEAP_STORE_U32((L>>2)*4,I),0},"_fd_write");_fd_write.sig="iippp";function _tree_sitter_log_callback(H,$){if(Module.currentLogCallback){let A=UTF8ToString($);Module.currentLogCallback(A,H!==0)}}GA(_tree_sitter_log_callback,"_tree_sitter_log_callback");function _tree_sitter_parse_callback(H,$,A,L,I){let B=Module.currentParseCallback($,{row:A,column:L});if(typeof B==="string")setValue(I,B.length,"i32"),stringToUTF16(B,H,10240);else setValue(I,0,"i32")}GA(_tree_sitter_parse_callback,"_tree_sitter_parse_callback");function _tree_sitter_progress_callback(H,$){if(Module.currentProgressCallback)return Module.currentProgressCallback({currentOffset:H,hasError:$});return!1}GA(_tree_sitter_progress_callback,"_tree_sitter_progress_callback");function _tree_sitter_query_progress_callback(H){if(Module.currentQueryProgressCallback)return Module.currentQueryProgressCallback({currentOffset:H});return!1}GA(_tree_sitter_query_progress_callback,"_tree_sitter_query_progress_callback");var runtimeKeepaliveCounter=0,keepRuntimeAlive=GA(()=>noExitRuntime||runtimeKeepaliveCounter>0,"keepRuntimeAlive"),_proc_exit=GA((H)=>{if(EXITSTATUS=H,!keepRuntimeAlive())Module.onExit?.(H),ABORT=!0;quit_(H,new ExitStatus(H))},"_proc_exit");_proc_exit.sig="vi";var exitJS=GA((H,$)=>{EXITSTATUS=H,_proc_exit(H)},"exitJS"),handleException=GA((H)=>{if(H instanceof ExitStatus||H=="unwind")return EXITSTATUS;quit_(1,H)},"handleException"),lengthBytesUTF8=GA((H)=>{var $=0;for(var A=0;A<H.length;++A){var L=H.charCodeAt(A);if(L<=127)$++;else if(L<=2047)$+=2;else if(L>=55296&&L<=57343)$+=4,++A;else $+=3}return $},"lengthBytesUTF8"),stringToUTF8Array=GA((H,$,A,L)=>{if(!(L>0))return 0;var I=A,D=A+L-1;for(var B=0;B<H.length;++B){var f=H.charCodeAt(B);if(f>=55296&&f<=57343){var E=H.charCodeAt(++B);f=65536+((f&1023)<<10)|E&1023}if(f<=127){if(A>=D)break;$[A++]=f}else if(f<=2047){if(A+1>=D)break;$[A++]=192|f>>6,$[A++]=128|f&63}else if(f<=65535){if(A+2>=D)break;$[A++]=224|f>>12,$[A++]=128|f>>6&63,$[A++]=128|f&63}else{if(A+3>=D)break;$[A++]=240|f>>18,$[A++]=128|f>>12&63,$[A++]=128|f>>6&63,$[A++]=128|f&63}}return $[A]=0,A-I},"stringToUTF8Array"),stringToUTF8=GA((H,$,A)=>stringToUTF8Array(H,HEAPU8,$,A),"stringToUTF8"),stackAlloc=GA((H)=>__emscripten_stack_alloc(H),"stackAlloc"),stringToUTF8OnStack=GA((H)=>{var $=lengthBytesUTF8(H)+1,A=stackAlloc($);return stringToUTF8(H,A,$),A},"stringToUTF8OnStack"),AsciiToString=GA((H)=>{var $="";while(!0){var A=HEAPU8[H++];if(!A)return $;$+=String.fromCharCode(A)}},"AsciiToString"),stringToUTF16=GA((H,$,A)=>{if(A??=2147483647,A<2)return 0;A-=2;var L=$,I=A<H.length*2?A/2:H.length;for(var D=0;D<I;++D){var B=H.charCodeAt(D);LE_HEAP_STORE_I16(($>>1)*2,B),$+=2}return LE_HEAP_STORE_I16(($>>1)*2,0),$-L},"stringToUTF16"),wasmImports={__heap_base:___heap_base,__indirect_function_table:wasmTable,__memory_base:___memory_base,__stack_pointer:___stack_pointer,__table_base:___table_base,_abort_js:__abort_js,clock_time_get:_clock_time_get,emscripten_resize_heap:_emscripten_resize_heap,fd_close:_fd_close,fd_seek:_fd_seek,fd_write:_fd_write,memory:wasmMemory,tree_sitter_log_callback:_tree_sitter_log_callback,tree_sitter_parse_callback:_tree_sitter_parse_callback,tree_sitter_progress_callback:_tree_sitter_progress_callback,tree_sitter_query_progress_callback:_tree_sitter_query_progress_callback},wasmExports=await createWasm(),___wasm_call_ctors=wasmExports.__wasm_call_ctors,_malloc=Module._malloc=wasmExports.malloc,_calloc=Module._calloc=wasmExports.calloc,_realloc=Module._realloc=wasmExports.realloc,_free=Module._free=wasmExports.free,_memcmp=Module._memcmp=wasmExports.memcmp,_ts_language_symbol_count=Module._ts_language_symbol_count=wasmExports.ts_language_symbol_count,_ts_language_state_count=Module._ts_language_state_count=wasmExports.ts_language_state_count,_ts_language_version=Module._ts_language_version=wasmExports.ts_language_version,_ts_language_abi_version=Module._ts_language_abi_version=wasmExports.ts_language_abi_version,_ts_language_metadata=Module._ts_language_metadata=wasmExports.ts_language_metadata,_ts_language_name=Module._ts_language_name=wasmExports.ts_language_name,_ts_language_field_count=Module._ts_language_field_count=wasmExports.ts_language_field_count,_ts_language_next_state=Module._ts_language_next_state=wasmExports.ts_language_next_state,_ts_language_symbol_name=Module._ts_language_symbol_name=wasmExports.ts_language_symbol_name,_ts_language_symbol_for_name=Module._ts_language_symbol_for_name=wasmExports.ts_language_symbol_for_name,_strncmp=Module._strncmp=wasmExports.strncmp,_ts_language_symbol_type=Module._ts_language_symbol_type=wasmExports.ts_language_symbol_type,_ts_language_field_name_for_id=Module._ts_language_field_name_for_id=wasmExports.ts_language_field_name_for_id,_ts_lookahead_iterator_new=Module._ts_lookahead_iterator_new=wasmExports.ts_lookahead_iterator_new,_ts_lookahead_iterator_delete=Module._ts_lookahead_iterator_delete=wasmExports.ts_lookahead_iterator_delete,_ts_lookahead_iterator_reset_state=Module._ts_lookahead_iterator_reset_state=wasmExports.ts_lookahead_iterator_reset_state,_ts_lookahead_iterator_reset=Module._ts_lookahead_iterator_reset=wasmExports.ts_lookahead_iterator_reset,_ts_lookahead_iterator_next=Module._ts_lookahead_iterator_next=wasmExports.ts_lookahead_iterator_next,_ts_lookahead_iterator_current_symbol=Module._ts_lookahead_iterator_current_symbol=wasmExports.ts_lookahead_iterator_current_symbol,_ts_parser_delete=Module._ts_parser_delete=wasmExports.ts_parser_delete,_ts_parser_reset=Module._ts_parser_reset=wasmExports.ts_parser_reset,_ts_parser_set_language=Module._ts_parser_set_language=wasmExports.ts_parser_set_language,_ts_parser_timeout_micros=Module._ts_parser_timeout_micros=wasmExports.ts_parser_timeout_micros,_ts_parser_set_timeout_micros=Module._ts_parser_set_timeout_micros=wasmExports.ts_parser_set_timeout_micros,_ts_parser_set_included_ranges=Module._ts_parser_set_included_ranges=wasmExports.ts_parser_set_included_ranges,_ts_query_new=Module._ts_query_new=wasmExports.ts_query_new,_ts_query_delete=Module._ts_query_delete=wasmExports.ts_query_delete,_iswspace=Module._iswspace=wasmExports.iswspace,_iswalnum=Module._iswalnum=wasmExports.iswalnum,_ts_query_pattern_count=Module._ts_query_pattern_count=wasmExports.ts_query_pattern_count,_ts_query_capture_count=Module._ts_query_capture_count=wasmExports.ts_query_capture_count,_ts_query_string_count=Module._ts_query_string_count=wasmExports.ts_query_string_count,_ts_query_capture_name_for_id=Module._ts_query_capture_name_for_id=wasmExports.ts_query_capture_name_for_id,_ts_query_capture_quantifier_for_id=Module._ts_query_capture_quantifier_for_id=wasmExports.ts_query_capture_quantifier_for_id,_ts_query_string_value_for_id=Module._ts_query_string_value_for_id=wasmExports.ts_query_string_value_for_id,_ts_query_predicates_for_pattern=Module._ts_query_predicates_for_pattern=wasmExports.ts_query_predicates_for_pattern,_ts_query_start_byte_for_pattern=Module._ts_query_start_byte_for_pattern=wasmExports.ts_query_start_byte_for_pattern,_ts_query_end_byte_for_pattern=Module._ts_query_end_byte_for_pattern=wasmExports.ts_query_end_byte_for_pattern,_ts_query_is_pattern_rooted=Module._ts_query_is_pattern_rooted=wasmExports.ts_query_is_pattern_rooted,_ts_query_is_pattern_non_local=Module._ts_query_is_pattern_non_local=wasmExports.ts_query_is_pattern_non_local,_ts_query_is_pattern_guaranteed_at_step=Module._ts_query_is_pattern_guaranteed_at_step=wasmExports.ts_query_is_pattern_guaranteed_at_step,_ts_query_disable_capture=Module._ts_query_disable_capture=wasmExports.ts_query_disable_capture,_ts_query_disable_pattern=Module._ts_query_disable_pattern=wasmExports.ts_query_disable_pattern,_ts_tree_copy=Module._ts_tree_copy=wasmExports.ts_tree_copy,_ts_tree_delete=Module._ts_tree_delete=wasmExports.ts_tree_delete,_ts_init=Module._ts_init=wasmExports.ts_init,_ts_parser_new_wasm=Module._ts_parser_new_wasm=wasmExports.ts_parser_new_wasm,_ts_parser_enable_logger_wasm=Module._ts_parser_enable_logger_wasm=wasmExports.ts_parser_enable_logger_wasm,_ts_parser_parse_wasm=Module._ts_parser_parse_wasm=wasmExports.ts_parser_parse_wasm,_ts_parser_included_ranges_wasm=Module._ts_parser_included_ranges_wasm=wasmExports.ts_parser_included_ranges_wasm,_ts_language_type_is_named_wasm=Module._ts_language_type_is_named_wasm=wasmExports.ts_language_type_is_named_wasm,_ts_language_type_is_visible_wasm=Module._ts_language_type_is_visible_wasm=wasmExports.ts_language_type_is_visible_wasm,_ts_language_supertypes_wasm=Module._ts_language_supertypes_wasm=wasmExports.ts_language_supertypes_wasm,_ts_language_subtypes_wasm=Module._ts_language_subtypes_wasm=wasmExports.ts_language_subtypes_wasm,_ts_tree_root_node_wasm=Module._ts_tree_root_node_wasm=wasmExports.ts_tree_root_node_wasm,_ts_tree_root_node_with_offset_wasm=Module._ts_tree_root_node_with_offset_wasm=wasmExports.ts_tree_root_node_with_offset_wasm,_ts_tree_edit_wasm=Module._ts_tree_edit_wasm=wasmExports.ts_tree_edit_wasm,_ts_tree_included_ranges_wasm=Module._ts_tree_included_ranges_wasm=wasmExports.ts_tree_included_ranges_wasm,_ts_tree_get_changed_ranges_wasm=Module._ts_tree_get_changed_ranges_wasm=wasmExports.ts_tree_get_changed_ranges_wasm,_ts_tree_cursor_new_wasm=Module._ts_tree_cursor_new_wasm=wasmExports.ts_tree_cursor_new_wasm,_ts_tree_cursor_copy_wasm=Module._ts_tree_cursor_copy_wasm=wasmExports.ts_tree_cursor_copy_wasm,_ts_tree_cursor_delete_wasm=Module._ts_tree_cursor_delete_wasm=wasmExports.ts_tree_cursor_delete_wasm,_ts_tree_cursor_reset_wasm=Module._ts_tree_cursor_reset_wasm=wasmExports.ts_tree_cursor_reset_wasm,_ts_tree_cursor_reset_to_wasm=Module._ts_tree_cursor_reset_to_wasm=wasmExports.ts_tree_cursor_reset_to_wasm,_ts_tree_cursor_goto_first_child_wasm=Module._ts_tree_cursor_goto_first_child_wasm=wasmExports.ts_tree_cursor_goto_first_child_wasm,_ts_tree_cursor_goto_last_child_wasm=Module._ts_tree_cursor_goto_last_child_wasm=wasmExports.ts_tree_cursor_goto_last_child_wasm,_ts_tree_cursor_goto_first_child_for_index_wasm=Module._ts_tree_cursor_goto_first_child_for_index_wasm=wasmExports.ts_tree_cursor_goto_first_child_for_index_wasm,_ts_tree_cursor_goto_first_child_for_position_wasm=Module._ts_tree_cursor_goto_first_child_for_position_wasm=wasmExports.ts_tree_cursor_goto_first_child_for_position_wasm,_ts_tree_cursor_goto_next_sibling_wasm=Module._ts_tree_cursor_goto_next_sibling_wasm=wasmExports.ts_tree_cursor_goto_next_sibling_wasm,_ts_tree_cursor_goto_previous_sibling_wasm=Module._ts_tree_cursor_goto_previous_sibling_wasm=wasmExports.ts_tree_cursor_goto_previous_sibling_wasm,_ts_tree_cursor_goto_descendant_wasm=Module._ts_tree_cursor_goto_descendant_wasm=wasmExports.ts_tree_cursor_goto_descendant_wasm,_ts_tree_cursor_goto_parent_wasm=Module._ts_tree_cursor_goto_parent_wasm=wasmExports.ts_tree_cursor_goto_parent_wasm,_ts_tree_cursor_current_node_type_id_wasm=Module._ts_tree_cursor_current_node_type_id_wasm=wasmExports.ts_tree_cursor_current_node_type_id_wasm,_ts_tree_cursor_current_node_state_id_wasm=Module._ts_tree_cursor_current_node_state_id_wasm=wasmExports.ts_tree_cursor_current_node_state_id_wasm,_ts_tree_cursor_current_node_is_named_wasm=Module._ts_tree_cursor_current_node_is_named_wasm=wasmExports.ts_tree_cursor_current_node_is_named_wasm,_ts_tree_cursor_current_node_is_missing_wasm=Module._ts_tree_cursor_current_node_is_missing_wasm=wasmExports.ts_tree_cursor_current_node_is_missing_wasm,_ts_tree_cursor_current_node_id_wasm=Module._ts_tree_cursor_current_node_id_wasm=wasmExports.ts_tree_cursor_current_node_id_wasm,_ts_tree_cursor_start_position_wasm=Module._ts_tree_cursor_start_position_wasm=wasmExports.ts_tree_cursor_start_position_wasm,_ts_tree_cursor_end_position_wasm=Module._ts_tree_cursor_end_position_wasm=wasmExports.ts_tree_cursor_end_position_wasm,_ts_tree_cursor_start_index_wasm=Module._ts_tree_cursor_start_index_wasm=wasmExports.ts_tree_cursor_start_index_wasm,_ts_tree_cursor_end_index_wasm=Module._ts_tree_cursor_end_index_wasm=wasmExports.ts_tree_cursor_end_index_wasm,_ts_tree_cursor_current_field_id_wasm=Module._ts_tree_cursor_current_field_id_wasm=wasmExports.ts_tree_cursor_current_field_id_wasm,_ts_tree_cursor_current_depth_wasm=Module._ts_tree_cursor_current_depth_wasm=wasmExports.ts_tree_cursor_current_depth_wasm,_ts_tree_cursor_current_descendant_index_wasm=Module._ts_tree_cursor_current_descendant_index_wasm=wasmExports.ts_tree_cursor_current_descendant_index_wasm,_ts_tree_cursor_current_node_wasm=Module._ts_tree_cursor_current_node_wasm=wasmExports.ts_tree_cursor_current_node_wasm,_ts_node_symbol_wasm=Module._ts_node_symbol_wasm=wasmExports.ts_node_symbol_wasm,_ts_node_field_name_for_child_wasm=Module._ts_node_field_name_for_child_wasm=wasmExports.ts_node_field_name_for_child_wasm,_ts_node_field_name_for_named_child_wasm=Module._ts_node_field_name_for_named_child_wasm=wasmExports.ts_node_field_name_for_named_child_wasm,_ts_node_children_by_field_id_wasm=Module._ts_node_children_by_field_id_wasm=wasmExports.ts_node_children_by_field_id_wasm,_ts_node_first_child_for_byte_wasm=Module._ts_node_first_child_for_byte_wasm=wasmExports.ts_node_first_child_for_byte_wasm,_ts_node_first_named_child_for_byte_wasm=Module._ts_node_first_named_child_for_byte_wasm=wasmExports.ts_node_first_named_child_for_byte_wasm,_ts_node_grammar_symbol_wasm=Module._ts_node_grammar_symbol_wasm=wasmExports.ts_node_grammar_symbol_wasm,_ts_node_child_count_wasm=Module._ts_node_child_count_wasm=wasmExports.ts_node_child_count_wasm,_ts_node_named_child_count_wasm=Module._ts_node_named_child_count_wasm=wasmExports.ts_node_named_child_count_wasm,_ts_node_child_wasm=Module._ts_node_child_wasm=wasmExports.ts_node_child_wasm,_ts_node_named_child_wasm=Module._ts_node_named_child_wasm=wasmExports.ts_node_named_child_wasm,_ts_node_child_by_field_id_wasm=Module._ts_node_child_by_field_id_wasm=wasmExports.ts_node_child_by_field_id_wasm,_ts_node_next_sibling_wasm=Module._ts_node_next_sibling_wasm=wasmExports.ts_node_next_sibling_wasm,_ts_node_prev_sibling_wasm=Module._ts_node_prev_sibling_wasm=wasmExports.ts_node_prev_sibling_wasm,_ts_node_next_named_sibling_wasm=Module._ts_node_next_named_sibling_wasm=wasmExports.ts_node_next_named_sibling_wasm,_ts_node_prev_named_sibling_wasm=Module._ts_node_prev_named_sibling_wasm=wasmExports.ts_node_prev_named_sibling_wasm,_ts_node_descendant_count_wasm=Module._ts_node_descendant_count_wasm=wasmExports.ts_node_descendant_count_wasm,_ts_node_parent_wasm=Module._ts_node_parent_wasm=wasmExports.ts_node_parent_wasm,_ts_node_child_with_descendant_wasm=Module._ts_node_child_with_descendant_wasm=wasmExports.ts_node_child_with_descendant_wasm,_ts_node_descendant_for_index_wasm=Module._ts_node_descendant_for_index_wasm=wasmExports.ts_node_descendant_for_index_wasm,_ts_node_named_descendant_for_index_wasm=Module._ts_node_named_descendant_for_index_wasm=wasmExports.ts_node_named_descendant_for_index_wasm,_ts_node_descendant_for_position_wasm=Module._ts_node_descendant_for_position_wasm=wasmExports.ts_node_descendant_for_position_wasm,_ts_node_named_descendant_for_position_wasm=Module._ts_node_named_descendant_for_position_wasm=wasmExports.ts_node_named_descendant_for_position_wasm,_ts_node_start_point_wasm=Module._ts_node_start_point_wasm=wasmExports.ts_node_start_point_wasm,_ts_node_end_point_wasm=Module._ts_node_end_point_wasm=wasmExports.ts_node_end_point_wasm,_ts_node_start_index_wasm=Module._ts_node_start_index_wasm=wasmExports.ts_node_start_index_wasm,_ts_node_end_index_wasm=Module._ts_node_end_index_wasm=wasmExports.ts_node_end_index_wasm,_ts_node_to_string_wasm=Module._ts_node_to_string_wasm=wasmExports.ts_node_to_string_wasm,_ts_node_children_wasm=Module._ts_node_children_wasm=wasmExports.ts_node_children_wasm,_ts_node_named_children_wasm=Module._ts_node_named_children_wasm=wasmExports.ts_node_named_children_wasm,_ts_node_descendants_of_type_wasm=Module._ts_node_descendants_of_type_wasm=wasmExports.ts_node_descendants_of_type_wasm,_ts_node_is_named_wasm=Module._ts_node_is_named_wasm=wasmExports.ts_node_is_named_wasm,_ts_node_has_changes_wasm=Module._ts_node_has_changes_wasm=wasmExports.ts_node_has_changes_wasm,_ts_node_has_error_wasm=Module._ts_node_has_error_wasm=wasmExports.ts_node_has_error_wasm,_ts_node_is_error_wasm=Module._ts_node_is_error_wasm=wasmExports.ts_node_is_error_wasm,_ts_node_is_missing_wasm=Module._ts_node_is_missing_wasm=wasmExports.ts_node_is_missing_wasm,_ts_node_is_extra_wasm=Module._ts_node_is_extra_wasm=wasmExports.ts_node_is_extra_wasm,_ts_node_parse_state_wasm=Module._ts_node_parse_state_wasm=wasmExports.ts_node_parse_state_wasm,_ts_node_next_parse_state_wasm=Module._ts_node_next_parse_state_wasm=wasmExports.ts_node_next_parse_state_wasm,_ts_query_matches_wasm=Module._ts_query_matches_wasm=wasmExports.ts_query_matches_wasm,_ts_query_captures_wasm=Module._ts_query_captures_wasm=wasmExports.ts_query_captures_wasm,_memset=Module._memset=wasmExports.memset,_memcpy=Module._memcpy=wasmExports.memcpy,_memmove=Module._memmove=wasmExports.memmove,_iswalpha=Module._iswalpha=wasmExports.iswalpha,_iswblank=Module._iswblank=wasmExports.iswblank,_iswdigit=Module._iswdigit=wasmExports.iswdigit,_iswlower=Module._iswlower=wasmExports.iswlower,_iswupper=Module._iswupper=wasmExports.iswupper,_iswxdigit=Module._iswxdigit=wasmExports.iswxdigit,_memchr=Module._memchr=wasmExports.memchr,_strlen=Module._strlen=wasmExports.strlen,_strcmp=Module._strcmp=wasmExports.strcmp,_strncat=Module._strncat=wasmExports.strncat,_strncpy=Module._strncpy=wasmExports.strncpy,_towlower=Module._towlower=wasmExports.towlower,_towupper=Module._towupper=wasmExports.towupper,_setThrew=wasmExports.setThrew,__emscripten_stack_restore=wasmExports._emscripten_stack_restore,__emscripten_stack_alloc=wasmExports._emscripten_stack_alloc,_emscripten_stack_get_current=wasmExports.emscripten_stack_get_current,___wasm_apply_data_relocs=wasmExports.__wasm_apply_data_relocs;Module.setValue=setValue,Module.getValue=getValue,Module.UTF8ToString=UTF8ToString,Module.stringToUTF8=stringToUTF8,Module.lengthBytesUTF8=lengthBytesUTF8,Module.AsciiToString=AsciiToString,Module.stringToUTF16=stringToUTF16,Module.loadWebAssemblyModule=loadWebAssemblyModule;function callMain(H=[]){var $=resolveGlobalSymbol("main").sym;if(!$)return;H.unshift(thisProgram);var A=H.length,L=stackAlloc((A+1)*4),I=L;H.forEach((B)=>{LE_HEAP_STORE_U32((I>>2)*4,stringToUTF8OnStack(B)),I+=4}),LE_HEAP_STORE_U32((I>>2)*4,0);try{var D=$(A,L);return exitJS(D,!0),D}catch(B){return handleException(B)}}GA(callMain,"callMain");function run(H=arguments_){if(runDependencies>0){dependenciesFulfilled=run;return}if(preRun(),runDependencies>0){dependenciesFulfilled=run;return}function $(){if(Module.calledRun=!0,ABORT)return;initRuntime(),preMain(),readyPromiseResolve(Module),Module.onRuntimeInitialized?.();var A=Module.noInitialRun;if(!A)callMain(H);postRun()}if(GA($,"doRun"),Module.setStatus)Module.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>Module.setStatus(""),1),$()},1);else $()}if(GA(run,"run"),Module.preInit){if(typeof Module.preInit=="function")Module.preInit=[Module.preInit];while(Module.preInit.length>0)Module.preInit.pop()()}return run(),moduleRtn=readyPromise,moduleRtn}})(),uH1=kH1;GA(DQD,"initializeBinding");GA(BQD,"checkModule");nbH=class{static{GA(this,"Parser")}[0]=0;[1]=0;logCallback=null;language=null;static async init(H){aKD(await DQD(H)),bD=D$._ts_init(),ewA=D$.getValue(bD,"i32"),HZA=D$.getValue(bD+$B,"i32")}constructor(){this.initialize()}initialize(){if(!BQD())throw Error("cannot construct a Parser before calling `init()`");D$._ts_parser_new_wasm(),this[0]=D$.getValue(bD,"i32"),this[1]=D$.getValue(bD+$B,"i32")}delete(){D$._ts_parser_delete(this[0]),D$._free(this[1]),this[0]=0,this[1]=0}setLanguage(H){let $;if(!H)$=0,this.language=null;else if(H.constructor===T_$){$=H[0];let A=D$._ts_language_version($);if(A<HZA||ewA<A)throw Error(`Incompatible language version ${A}. Compatibility range ${HZA} through ${ewA}.`);this.language=H}else throw Error("Argument must be a Language");return D$._ts_parser_set_language(this[0],$),this}parse(H,$,A){if(typeof H==="string")D$.currentParseCallback=(f)=>H.slice(f);else if(typeof H==="function")D$.currentParseCallback=H;else throw Error("Argument must be a string or a function");if(A?.progressCallback)D$.currentProgressCallback=A.progressCallback;else D$.currentProgressCallback=null;if(this.logCallback)D$.currentLogCallback=this.logCallback,D$._ts_parser_enable_logger_wasm(this[0],1);else D$.currentLogCallback=null,D$._ts_parser_enable_logger_wasm(this[0],0);let L=0,I=0;if(A?.includedRanges){L=A.includedRanges.length,I=D$._calloc(L,ibH);let f=I;for(let E=0;E<L;E++)oKD(f,A.includedRanges[E]),f+=ibH}let D=D$._ts_parser_parse_wasm(this[0],this[1],$?$[0]:0,I,L);if(!D)return D$.currentParseCallback=null,D$.currentLogCallback=null,D$.currentProgressCallback=null,null;if(!this.language)throw Error("Parser must have a language to parse");let B=new xH1(to,D,this.language,D$.currentParseCallback);return D$.currentParseCallback=null,D$.currentLogCallback=null,D$.currentProgressCallback=null,B}reset(){D$._ts_parser_reset(this[0])}getIncludedRanges(){D$._ts_parser_included_ranges_wasm(this[0]);let H=D$.getValue(bD,"i32"),$=D$.getValue(bD+$B,"i32"),A=Array(H);if(H>0){let L=$;for(let I=0;I<H;I++)A[I]=q_$(L),L+=ibH;D$._free($)}return A}getTimeoutMicros(){return D$._ts_parser_timeout_micros(this[0])}setTimeoutMicros(H){D$._ts_parser_set_timeout_micros(this[0],0,H)}setLogger(H){if(!H)this.logCallback=null;else if(typeof H!=="function")throw Error("Logger callback must be a function");else this.logCallback=H;return this}getLogger(){return this.logCallback}}});function GQD(){return(process.argv[1]||"").includes("/.claude/local/node_modules/")}async function gH1(){try{if(!zH().existsSync(so))zH().mkdirSync(so);if(!zH().existsSync(EQD))iL(EQD,vH({name:"claude-local",version:"0.0.1",private:!0},null,2),{encoding:"utf8",flush:!1});let H=k7H.join(so,"claude");if(!zH().existsSync(H)){let $=`#!/bin/sh
`),$(L);else if(B==="\x03")process.stdin.setRawMode?.(!1),process.stdin.removeListener("data",I),A(Error("Cancelled"));else if(B==="\x7F"||B==="\b")L=L.slice(0,-1);else L+=B};process.stdin.on("data",I)})}function JgH(H,$,A){let L=jW(),I=L.read()||{},D=lh(H,$);L.update({...I,mcpOAuthClientConfig:{...I.mcpOAuthClientConfig,[D]:{clientSecret:A}}})}function qxD(H,$){let A=jW(),L=A.read();if(!L?.mcpOAuthClientConfig)return;let I=lh(H,$);if(L.mcpOAuthClientConfig[I])delete L.mcpOAuthClientConfig[I],A.update(L)}function FSA(H,$){let L=jW().read(),I=lh(H,$);return L?.mcpOAuthClientConfig?.[I]}function XSA(H){if(!H)return;if("scope"in H&&typeof H.scope==="string")return H.scope;if("default_scope"in H&&typeof H.default_scope==="string")return H.default_scope;if(H.scopes_supported&&Array.isArray(H.scopes_supported))return H.scopes_supported.join(" ");return}var cw$,wxD,GSA,lw$,fX1=30000,EX1,y3H,GX1,USA=3118;var s9H=K(()=>{HeH();z$();j5$();CjH();YFA();M3();C1();_$();yF();C9();Z$();cw$=require("http"),wxD=require("url"),GSA=h(_xD(),1),lw$=require("crypto"),EX1=["state","nonce","code_challenge","code_verifier","code"];y3H=class y3H extends Error{constructor(){super("Authentication was cancelled");this.name="AuthenticationCancelledError"}};GX1=oA()==="windows"?{min:39152,max:49151}:{min:49152,max:65535}});function JX1(H){return H.scope==="project"||H.scope==="local"}async function FX1(H,$){if(!$.headersHelper)return null;if("scope"in $&&JX1($)&&!eI()){if(!GG(!0)){let L=Error(`Security: headersHelper for MCP server '${H}' executed before workspace trust is confirmed. If you see this message, post in ${{ISSUES_EXPLAINER:"report the issue at https://github.com/anthropics/claude-code/issues",PACKAGE_URL:"@anthropic-ai/claude-code",README_URL:"https://code.claude.com/docs/en/overview",VERSION:"2.1.33",FEEDBACK_CHANNEL:"https://github.com/anthropics/claude-code/issues",BUILD_TIME:"2026-02-06T00:15:09Z"}.FEEDBACK_CHANNEL}.`);return bZ("MCP headersHelper invoked before trust check",L),c("tengu_mcp_headersHelper_missing_trust",{}),null}}try{TA(H,"Executing headersHelper to get dynamic headers");let A=await mD($.headersHelper,[],{shell:!0,timeout:1e4});if(A.code!==0||!A.stdout)throw Error(`headersHelper for MCP server '${H}' did not return a valid value`);let L=A.stdout.trim(),I=DA(L);if(typeof I!=="object"||I===null||Array.isArray(I))throw Error(`headersHelper for MCP server '${H}' must return a JSON object with string key-value pairs`);for(let[D,B]of Object.entries(I))if(typeof B!=="string")throw Error(`headersHelper for MCP server '${H}' returned non-string value for key "${D}": ${typeof B}`);return TA(H,`Successfully retrieved ${Object.keys(I).length} headers from headersHelper`),I}catch(A){return BE(H,`Error getting headers from headersHelper: ${A instanceof Error?A.message:String(A)}`),r(Error(`Error getting MCP headers from headersHelper for server '${H}': ${A instanceof Error?A.message:String(A)}`)),null}}async function rw$(H,$){let A=$.headers||{},L=await FX1(H,$)||{};return{...A,...L}}var TxD=K(()=>{D0();vA();_$();E$();z$();p$();Z$()});class KSA{serverName;sendMcpMessage;isClosed=!1;onclose;onerror;onmessage;constructor(H,$){this.serverName=H;this.sendMcpMessage=$}async start(){}async send(H){if(this.isClosed)throw Error("Transport is closed");let $=await this.sendMcpMessage(this.serverName,H);if(this.onmessage)this.onmessage($)}async close(){if(this.isClosed)return;this.isClosed=!0,this.onclose?.()}}function QX1(H,$,A){let L=H.tabId;if(typeof L==="number")KOD(L);let I=[];switch($){case"navigate":if(typeof H.url==="string")try{let D=new URL(H.url);I.push(D.hostname)}catch{I.push(FgH(H.url,30))}break;case"find":if(typeof H.query==="string")I.push(`pattern: ${FgH(H.query,30)}`);break;case"computer":if(typeof H.action==="string"){let D=H.action;if(D==="left_click"||D==="right_click"||D==="double_click"||D==="middle_click")if(typeof H.ref==="string")I.push(`${D} on ${H.ref}`);else if(Array.isArray(H.coordinate))I.push(`${D} at (${H.coordinate.join(", ")})`);else I.push(D);else if(D==="type"&&typeof H.text==="string")I.push(`type "${FgH(H.text,15)}"`);else if(D==="key"&&typeof H.text==="string")I.push(`key ${H.text}`);else if(D==="scroll"&&typeof H.scroll_direction==="string")I.push(`scroll ${H.scroll_direction}`);else if(D==="wait"&&typeof H.duration==="number")I.push(`wait ${H.duration}s`);else if(D==="left_click_drag")I.push("drag");else I.push(D)}break;case"gif_creator":if(typeof H.action==="string")I.push(`${H.action}`);break;case"resize_window":if(typeof H.width==="number"&&typeof H.height==="number")I.push(`${H.width}x${H.height}`);break;case"read_console_messages":if(typeof H.pattern==="string")I.push(`pattern: ${FgH(H.pattern,20)}`);if(H.onlyErrors===!0)I.push("errors only");break;case"read_network_requests":if(typeof H.urlPattern==="string")I.push(`pattern: ${FgH(H.urlPattern,20)}`);break;case"shortcuts_execute":if(typeof H.shortcutId==="string")I.push(`shortcut_id: ${H.shortcutId}`);break;case"javascript_tool":if(A&&typeof H.text==="string")return H.text;return"";case"tabs_create_mcp":case"tabs_context_mcp":case"form_input":case"shortcuts_list":case"read_page":case"upload_image":case"get_page_text":case"update_plan":return""}return I.join(", ")||null}function WX1(H){if(!n2())return null;if(typeof H!=="object"||H===null||!("tabId"in H))return null;let $=typeof H.tabId==="number"?H.tabId:typeof H.tabId==="string"?parseInt(H.tabId,10):NaN;if(isNaN($))return null;let A=`${KX1}${$}`;return oS.createElement(V,null," ",oS.createElement(aI,{url:A},oS.createElement(V,{color:"subtle"},"[View Tab]")))}function VX1(H,$,A){if(A)return Rw$(H,[],{verbose:A});let L=null;switch($){case"navigate":L="Navigation completed";break;case"tabs_create_mcp":L="Tab created";break;case"tabs_context_mcp":L="Tabs read";break;case"form_input":L="Input completed";break;case"computer":L="Action completed";break;case"resize_window":L="Window resized";break;case"find":L="Search completed";break;case"gif_creator":L="GIF action completed";break;case"read_console_messages":L="Console messages retrieved";break;case"read_network_requests":L="Network requests retrieved";break;case"shortcuts_list":L="Shortcuts retrieved";break;case"shortcuts_execute":L="Shortcut executed";break;case"javascript_tool":L="Script executed";break;case"read_page":L="Page read";break;case"upload_image":L="Image uploaded";break;case"get_page_text":L="Page text retrieved";break;case"update_plan":L="Plan updated";break}if(L)return oS.createElement(HA,{height:1},oS.createElement(V,{dimColor:!0},L));return null}function zxD(H){return{userFacingName($){return`Claude in Chrome[${H.replace(/_mcp$/,"")}]`},renderToolUseMessage($,{verbose:A}){return QX1($,H,A)},renderToolUseTag($){return WX1($)},renderToolResultMessage($,A,{verbose:L}){if(!PX1($))return null;return VX1($,H,L)}}}function FgH(H,$){return H.length>$?H.slice(0,$)+"\u2026":H}function PX1(H){return typeof H==="object"&&H!==null}var oS,KX1="https://clau.de/chrome/tab/";var NxD=K(()=>{xH();cB();Yr();LSA();aS();oS=h(t(),1)});async function OxD(H,$){return new(await import("ws")).default(H,["mcp"],$)}function aw$(){return parseInt(process.env.MCP_TIMEOUT||"",10)||30000}function QSA(H){return async($,A)=>{if((A?.method??"GET").toUpperCase()==="GET")return H($,A);let I=AbortSignal.timeout(jxD);if(!A?.signal)return H($,{...A,signal:I});let D=new AbortController,B=()=>D.abort();A.signal.addEventListener("abort",B),I.addEventListener("abort",B);let f=()=>{A.signal?.removeEventListener("abort",B),I.removeEventListener("abort",B)};if(A.signal.aborted)D.abort();try{let E=await H($,{...A,signal:D.signal});return f(),E}catch(E){throw f(),E}}}function VSA(){return parseInt(process.env.MCP_SERVER_CONNECTION_BATCH_SIZE||"",10)||3}function CX1(){return parseInt(process.env.MCP_REMOTE_SERVER_CONNECTION_BATCH_SIZE||"",10)||20}function xxD(H){return!H.type||H.type==="stdio"||H.type==="sdk"}function wX1(H){return!H.name.startsWith("mcp__ide__")||YX1.includes(H.name)}function WSA(H,$){return`${H}-${vH($)}`}async function ih(H,$){let A=WSA(H,$);try{let L=await Uz(H,$);if(L.type==="connected")await L.cleanup()}catch{}Uz.cache.delete(A)}async function g6H(H){if(H.config.type==="sdk")return H;let $=await Uz(H.name,H.config);if($.type!=="connected")throw new pZ(`MCP server "${H.name}" is not connected`,"MCP server not connected");return $}function RxD(H,$){if(H.type!==$.type)return!1;let{scope:A,...L}=H,{scope:I,...D}=$;return vH(L)===vH(D)}async function Gx(H,$,A){return(await vxD({client:A,tool:H,args:$,signal:cD().signal})).content}async function nh(H,$){try{await ih(H,$);let A=await Uz(H,$);if(A.type!=="connected")return{client:A,tools:[],commands:[]};let L=!!A.capabilities?.resources,[I,D,B]=await Promise.all([kS(A),QgH(A),L?KgH(A):Promise.resolve([])]),f=[];if(L){if(![Rp,yp].some((M)=>I.some((G)=>G.name===M.name)))f.push(Rp,yp)}return{client:A,tools:[...I,...f],commands:D,resources:B.length>0?B:void 0}}catch(A){return BE(H,`Error during reconnection: ${A instanceof Error?A.message:String(A)}`),{client:{name:H,type:"failed",config:$},tools:[],commands:[]}}}async function SxD(H,$,A){for(let L=0;L<H.length;L+=$){let I=H.slice(L,L+$);await Promise.all(I.map(A))}}async function tw$(H,$){let A=!1,L=Object.entries($??(await dh()).servers),I=L.length,D=L.filter(([F,Q])=>Q.type==="stdio").length,B=L.filter(([F,Q])=>Q.type==="sse").length,f=L.filter(([F,Q])=>Q.type==="http").length,E=L.filter(([F,Q])=>Q.type==="sse-ide").length,M=L.filter(([F,Q])=>Q.type==="ws-ide").length,G=L.filter(([F,Q])=>xxD(Q)),U=L.filter(([F,Q])=>!xxD(Q)),X={totalServers:I,stdioCount:D,sseCount:B,httpCount:f,sseIdeCount:E,wsIdeCount:M},J=async([F,Q])=>{try{if(fgH(F)){H({client:{name:F,type:"disabled",config:Q},tools:[],commands:[]});return}let W=await Uz(F,Q,X);if(W.type!=="connected"){H({client:W,tools:[],commands:[]});return}let P=!!W.capabilities?.resources,[Y,C,Z]=await Promise.all([kS(W),QgH(W),P?KgH(W):Promise.resolve([])]),q=[];if(P&&!A)A=!0,q.push(Rp,yp);H({client:W,tools:[...Y,...q],commands:C,resources:Z.length>0?Z:void 0})}catch(W){BE(F,`Error fetching tools/commands/resources: ${W instanceof Error?W.message:String(W)}`),H({client:{name:F,type:"failed",config:Q},tools:[],commands:[]})}};await Promise.all([SxD(G,VSA(),J),SxD(U,CX1(),J)])}async function yxD(H,$){switch(H.type){case"text":return[{type:"text",text:H.text}];case"image":{let A=Buffer.from(String(H.data),"base64"),L=await pIH(A,void 0,H.mimeType);return[{type:"image",source:{data:L.base64,media_type:L.mediaType,type:"base64"}}]}case"resource":{let A=H.resource,L=`[Resource from ${$} at ${A.uri}] `;if("text"in A)return[{type:"text",text:`${L}${A.text}`}];else if("blob"in A)if(_X1.has(A.mimeType??"")){let D=Buffer.from(A.blob,"base64"),B=await pIH(D,void 0,A.mimeType),f=[];if(L)f.push({type:"text",text:L});return f.push({type:"image",source:{data:B.base64,media_type:B.mediaType,type:"base64"}}),f}else return[{type:"text",text:`${L}Base64 data (${A.mimeType||"unknown type"}) ${A.blob}`}];return[]}case"resource_link":{let A=H,L=`[Resource link: ${A.name}] ${A.uri}`;if(A.description)L+=` (${A.description})`;return[{type:"text",text:L}]}default:return[]}}function ow$(H,$=2){if(H===null)return"null";if(Array.isArray(H)){if(H.length===0)return"[]";return`[${ow$(H[0],$-1)}]`}if(typeof H==="object"){if($<=0)return"{...}";let L=Object.entries(H).slice(0,10).map(([D,B])=>`${D}: ${ow$(B,$-1)}`),I=Object.keys(H).length>10?", ...":"";return`{${L.join(", ")}${I}}`}return typeof H}async function PSA(H,$,A){if(H&&typeof H==="object"){if("toolResult"in H)return{content:String(H.toolResult),type:"toolResult"};if("structuredContent"in H&&H.structuredContent!==void 0)return{content:vH(H.structuredContent),type:"structuredContent",schema:ow$(H.structuredContent)};if("content"in H&&Array.isArray(H.content)){let I=(await Promise.all(H.content.map((D)=>yxD(D,A)))).flat();return{content:I,type:"contentArray",schema:ow$(I)}}}let L=`MCP server "${A}" tool "${$}": unexpected response format`;throw BE(A,L),new pZ(L,"MCP tool unexpected response format")}function ZX1(H){if(!H||typeof H==="string")return!1;return H.some(($)=>$.type==="image")}async function qX1(H,$,A){let{content:L,type:I,schema:D}=await PSA(H,$,A);if(A==="ide")return L;if(!await NjH(L))return L;if(LE(process.env.ENABLE_MCP_LARGE_OUTPUT_FILES))return await aFA(L);if(!L)return L;if(ZX1(L))return await aFA(L);let B=Date.now(),f=`mcp-${B1(A)}-${B1($)}-${B}`,E=typeof L==="string"?L:vH(L,null,2),M=await WDH(E,f);if(VDH(M))return`Error: result (${E.length.toLocaleString()} characters) exceeds maximum allowed tokens. Failed to save output to file: ${M.error}. If this MCP server provides pagination or filtering tools, use them to retrieve specific portions of the data.`;let G=IX$(I,D);return DX$(M.filepath,M.originalSize,G)}async function vxD({client:{client:H,name:$},tool:A,args:L,meta:I,signal:D,onProgress:B}){let f=Date.now(),E,M;try{if(TA($,`Calling MCP tool: ${A}`),E=setInterval(()=>{let Y=Date.now()-f,Z=`${Math.floor(Y/1000)}s`;TA($,`Tool '${A}' still running (${Z} elapsed)`)},30000),lwI())M=setInterval(()=>{cwI()},50000);let G=$s(),U,X=new Promise((Y,C)=>{U=setTimeout(()=>{C(new pZ(`MCP server "${$}" tool "${A}" timed out after ${Math.floor(G/1000)}s`,"MCP tool timeout"))},G)}),J=await Promise.race([H.callTool({name:A,arguments:L,_meta:I},sV,{signal:D,timeout:G,onprogress:B?(Y)=>{B({type:"mcp_progress",status:"progress",serverName:$,toolName:A,progress:Y.progress,total:Y.total,progressMessage:Y.message})}:void 0}),X]).finally(()=>{if(U)clearTimeout(U)});if("isError"in J&&J.isError){let Y="Unknown error";if("content"in J&&Array.isArray(J.content)&&J.content.length>0){let C=J.content[0];if(C&&typeof C==="object"&&"text"in C)Y=C.text}else if("error"in J)Y=String(J.error);throw BE($,Y),new pZ(Y,"MCP tool returned error")}let F=Date.now()-f,Q=F<1000?`${F}ms`:F<60000?`${Math.floor(F/1000)}s`:`${Math.floor(F/60000)}m ${Math.floor(F%60000/1000)}s`;TA($,`Tool '${A}' completed successfully in ${Q}`);let W=SOD($);if(W)c("tengu_code_indexing_tool_used",{tool:W,source:"mcp",success:!0});return{content:await qX1(J,A,$),_meta:J._meta,structuredContent:J.structuredContent}}catch(G){if(E!==void 0)clearInterval(E);if(M!==void 0)clearInterval(M);let U=Date.now()-f;if(G instanceof Error&&G.name!=="AbortError")TA($,`Tool '${A}' failed after ${Math.floor(U/1000)}s: ${G.message}`);if(G instanceof Error){if(("code"in G?G.code:void 0)===401||G instanceof ZQ)throw TA($,"Tool call returned 401 Unauthorized - token may have expired"),c("tengu_mcp_tool_call_auth_error",{}),new y2$($,`MCP server "${$}" requires re-authorization (token expired)`)}if(!(G instanceof Error)||G.name!=="AbortError")throw G;return{content:void 0}}finally{if(E!==void 0)clearInterval(E);if(M!==void 0)clearInterval(M)}}function TX1(H){if(H.message.content[0]?.type!=="tool_use")return;return H.message.content[0].id}async function hxD(H,$){let A=[],L=[],I=await Promise.allSettled(Object.entries(H).map(async([D,B])=>{let f=new KSA(D,$),E=new T5$({name:"claude-code",version:{ISSUES_EXPLAINER:"report the issue at https://github.com/anthropics/claude-code/issues",PACKAGE_URL:"@anthropic-ai/claude-code",README_URL:"https://code.claude.com/docs/en/overview",VERSION:"2.1.33",FEEDBACK_CHANNEL:"https://github.com/anthropics/claude-code/issues",BUILD_TIME:"2026-02-06T00:15:09Z"}.VERSION??"unknown"},{capabilities:{}});try{await E.connect(f);let M=E.getServerCapabilities(),G={type:"connected",name:D,capabilities:M||{},client:E,config:{...B,scope:"dynamic"},cleanup:async()=>{await E.close()}},U=[];if(M?.tools){let X=await kS(G);U.push(...X)}return{client:G,tools:U}}catch(M){return BE(D,`Failed to connect SDK MCP server: ${M}`),{client:{type:"failed",name:D,config:{...B,scope:"user"}},tools:[]}}}));for(let D of I)if(D.status==="fulfilled")A.push(D.value.client),L.push(...D.value.tools);return{clients:A,tools:L}}var y2$,_X1,jxD=60000,YX1,Uz,kS,KgH,QgH,O2$;var $3=K(()=>{aD();i2I();a2I();JwI();KwI();QK();NnA();_$();dG();KQ();z$();lU();p$();fI();YE();CE();tr();LX$();oFA();lg();NA();yF();$SA();jOD();gUH();gR();aE();tq();mOD();hY$();bY$();s9H();S3();TxD();CjH();tQ();aS();NxD();Z$();y2$=class y2$ extends Error{serverName;constructor(H,$){super($);this.name="McpAuthError",this.serverName=H}};_X1=new Set(["image/jpeg","image/png","image/gif","image/webp"]);YX1=["mcp__ide__executeCode","mcp__ide__getDiagnostics"];Uz=o$(async(H,$,A)=>{let L=Date.now();try{let I,D=WC();if($.type==="sse"){let y=new t9H(H,$),g=await rw$(H,$),v={authProvider:y,fetch:QSA(KDH()),requestInit:{headers:{"User-Agent":$n(),...g}}};v.eventSourceInit={fetch:async(p,d)=>{let k={},n=await y.tokens();if(n)k.Authorization=`Bearer ${n.access_token}`;let GH=MAH();return fetch(p,{...d,...GH,headers:{"User-Agent":$n(),...k,...d?.headers,...g,Accept:"text/event-stream"}})}},I=new d5$(new URL($.url),v),TA(H,"SSE transport initialized, awaiting connection")}else if($.type==="sse-ide"){TA(H,`Setting up SSE-IDE transport to ${$.url}`);let y=MAH(),g=y.dispatcher?{eventSourceInit:{fetch:async(v,p)=>{return fetch(v,{...p,...y,headers:{"User-Agent":$n(),...p?.headers}})}}}:{};I=new d5$(new URL($.url),Object.keys(g).length>0?g:void 0)}else if($.type==="ws-ide"){let y=P$A(),g={"User-Agent":$n(),...$.authToken&&{"X-Claude-Code-Ide-Authorization":$.authToken}},v;if(typeof Bun<"u")v=new globalThis.WebSocket($.url,{protocols:["mcp"],headers:g,proxy:EAH($.url),tls:y||void 0});else v=await OxD($.url,{headers:g,agent:fAH($.url),...y||{}});I=new jw$(v)}else if($.type==="ws"){TA(H,`Initializing WebSocket transport to ${$.url}`);let y=await rw$(H,$),g=P$A(),v={"User-Agent":$n(),...D&&{Authorization:`Bearer ${D}`},...y},p=Object.fromEntries(Object.entries(v).map(([k,n])=>k.toLowerCase()==="authorization"?[k,"[REDACTED]"]:[k,n]));TA(H,`WebSocket transport options: ${vH({url:$.url,headers:p,hasSessionAuth:!!D})}`);let d;if(typeof Bun<"u")d=new globalThis.WebSocket($.url,{protocols:["mcp"],headers:v,proxy:EAH($.url),tls:g||void 0});else d=await OxD($.url,{headers:v,agent:fAH($.url),...g||{}});I=new jw$(d)}else if($.type==="http"){TA(H,`Initializing HTTP transport to ${$.url}`),TA(H,`Node version: ${process.version}, Platform: linux`),TA(H,`Environment: ${vH({NODE_OPTIONS:process.env.NODE_OPTIONS||"not set",UV_THREADPOOL_SIZE:process.env.UV_THREADPOOL_SIZE||"default",HTTP_PROXY:process.env.HTTP_PROXY||"not set",HTTPS_PROXY:process.env.HTTPS_PROXY||"not set",NO_PROXY:process.env.NO_PROXY||"not set"})}`);let y=new t9H(H,$),g=await rw$(H,$),v=MAH();TA(H,`Proxy options: ${v.dispatcher?"custom dispatcher":"default"}`);let p={authProvider:y,fetch:QSA(KDH()),requestInit:{...v,headers:{"User-Agent":$n(),...D&&{Authorization:`Bearer ${D}`},...g}}},d=p.requestInit?.headers?Object.fromEntries(Object.entries(p.requestInit.headers).map(([k,n])=>k.toLowerCase()==="authorization"?[k,"[REDACTED]"]:[k,n])):void 0;TA(H,`HTTP transport options: ${vH({url:$.url,headers:d,hasAuthProvider:!!y,timeoutMs:jxD})}`),I=new c5$(new URL($.url),p),TA(H,"HTTP transport created successfully")}else if($.type==="sdk")throw Error("SDK servers should be handled in print.ts");else if($.type==="claudeai-proxy"){if(TA(H,`Initializing claude.ai proxy transport for server ${$.id}`),!iD())throw Error("No claude.ai OAuth token found");let g=UD(),v=`${g.MCP_PROXY_URL}${g.MCP_PROXY_PATH.replace("{server_id}",$.id)}`;TA(H,`Using claude.ai proxy at ${v}`);let p=async(n,GH)=>{await pW();let e=iD();if(!e)throw Error("No claude.ai OAuth token available");let BH=new Headers(GH?.headers);return BH.set("Authorization",`Bearer ${e.accessToken}`),globalThis.fetch(n,{...GH,headers:BH})},d=MAH(),k={fetch:QSA(p),requestInit:{...d,headers:{"User-Agent":$n(),"X-Mcp-Client-Session-Id":j$()}}};I=new c5$(new URL(v),k),TA(H,"claude.ai proxy transport created successfully")}else if($.type==="stdio"||!$.type){let y=process.env.CLAUDE_CODE_SHELL_PREFIX||$.command,g=process.env.CLAUDE_CODE_SHELL_PREFIX?[[$.command,...$.args].join(" ")]:$.args;I=new DFA({command:y,args:g,env:{...process.env,...$.env},stderr:"pipe"})}else throw Error(`Unsupported server type: ${$.type}. claude.ai MCP servers require ENABLE_CLAUDEAI_MCP_SERVERS=true.`);let B,f="";if($.type==="stdio"||!$.type){let y=I;if(y.stderr)B=(g)=>{f+=g.toString()},y.stderr.on("data",B)}let E=new T5$({name:"claude-code",version:{ISSUES_EXPLAINER:"report the issue at https://github.com/anthropics/claude-code/issues",PACKAGE_URL:"@anthropic-ai/claude-code",README_URL:"https://code.claude.com/docs/en/overview",VERSION:"2.1.33",FEEDBACK_CHANNEL:"https://github.com/anthropics/claude-code/issues",BUILD_TIME:"2026-02-06T00:15:09Z"}.VERSION??"unknown"},{capabilities:{roots:{},...{}}});if($.type==="http")TA(H,"Client created, setting up request handler");if(E.setRequestHandler(r5A,async()=>{return TA(H,"Received ListRoots request from server"),{roots:[{uri:`file://${zL()}`}]}}),TA(H,`Starting connection with timeout of ${aw$()}ms`),$.type==="http"){TA(H,`Testing basic HTTP connectivity to ${$.url}`);try{let y=new URL($.url);if(TA(H,`Parsed URL: host=${y.hostname}, port=${y.port||"default"}, protocol=${y.protocol}`),y.hostname==="127.0.0.1"||y.hostname==="localhost")TA(H,`Using loopback address: ${y.hostname}`)}catch(y){TA(H,`Failed to parse URL: ${y}`)}}let M=E.connect(I),G=new Promise((y,g)=>{let v=setTimeout(()=>{let p=Date.now()-L;TA(H,`Connection timeout triggered after ${p}ms (limit: ${aw$()}ms)`),I.close().catch(()=>{}),g(new pZ(`MCP server "${H}" connection timed out after ${aw$()}ms`,"MCP connection timeout"))},aw$());M.then(()=>{clearTimeout(v)},(p)=>{clearTimeout(v)})});try{if(await Promise.race([M,G]),f)BE(H,`Server stderr: ${f}`);let y=Date.now()-L;TA(H,`Successfully connected to ${$.type} server in ${y}ms`)}catch(y){let g=Date.now()-L;if($.type==="sse"&&y instanceof Error){if(TA(H,`SSE Connection failed after ${g}ms: ${vH({url:$.url,error:y.message,errorType:y.constructor.name,stack:y.stack})}`),BE(H,y),y instanceof ZQ)return c("tengu_mcp_server_needs_auth",{transportType:"sse",...SX($)?{mcpServerBaseUrl:SX($)}:{}}),TA(H,"Authentication required for SSE server"),{name:H,type:"needs-auth",config:$}}else if($.type==="http"&&y instanceof Error){let v=y;if(TA(H,`HTTP Connection failed after ${g}ms: ${y.message} (code: ${v.code||"none"}, errno: ${v.errno||"none"})`),BE(H,y),y instanceof ZQ)return c("tengu_mcp_server_needs_auth",{transportType:"http",...SX($)?{mcpServerBaseUrl:SX($)}:{}}),TA(H,"Authentication required for HTTP server"),{name:H,type:"needs-auth",config:$}}else if($.type==="claudeai-proxy"&&y instanceof Error){if(TA(H,`claude.ai proxy connection failed after ${g}ms: ${y.message}`),BE(H,y),y.code===401)return c("tengu_mcp_server_needs_auth",{transportType:"claudeai-proxy",...SX($)?{mcpServerBaseUrl:SX($)}:{}}),TA(H,"Authentication required for claude.ai proxy server"),{name:H,type:"needs-auth",config:$}}else if($.type==="sse-ide"||$.type==="ws-ide")c("tengu_mcp_ide_server_connection_failed",{connectionDurationMs:g});if(I.close().catch(()=>{}),f)BE(H,`Server stderr: ${f}`);throw y}let U=E.getServerCapabilities(),X=E.getServerVersion(),J=E.getInstructions();if(TA(H,`Connection established with capabilities: ${vH({hasTools:!!U?.tools,hasPrompts:!!U?.prompts,hasResources:!!U?.resources,serverVersion:X||"unknown"})}`),$.type==="sse-ide"||$.type==="ws-ide"){let y=Date.now()-L;c("tengu_mcp_ide_server_connection_succeeded",{connectionDurationMs:y,serverVersion:X});try{ywI(E)}catch(g){BE(H,`Failed to send ide_connected notification: ${g}`)}}let F=Date.now(),Q=!1,W=E.onerror,P=E.onclose,Y=0,C=3,Z=(y)=>{return y.includes("ECONNRESET")||y.includes("ETIMEDOUT")||y.includes("EPIPE")||y.includes("EHOSTUNREACH")||y.includes("ECONNREFUSED")||y.includes("Body Timeout Error")||y.includes("terminated")};E.onerror=(y)=>{let g=Date.now()-F;Q=!0;let v=$.type||"stdio";if(TA(H,`${v.toUpperCase()} connection dropped after ${Math.floor(g/1000)}s uptime`),y.message)if(y.message.includes("ECONNRESET"))TA(H,"Connection reset - server may have crashed or restarted");else if(y.message.includes("ETIMEDOUT"))TA(H,"Connection timeout - network issue or server unresponsive");else if(y.message.includes("ECONNREFUSED"))TA(H,"Connection refused - server may be down");else if(y.message.includes("EPIPE"))TA(H,"Broken pipe - server closed connection unexpectedly");else if(y.message.includes("EHOSTUNREACH"))TA(H,"Host unreachable - network connectivity issue");else if(y.message.includes("ESRCH"))TA(H,"Process not found - stdio server process terminated");else if(y.message.includes("spawn"))TA(H,"Failed to spawn process - check command and permissions");else TA(H,`Connection error: ${y.message}`);if(v==="sse"||v==="http"||v==="claudeai-proxy")if(Z(y.message)){if(Y++,TA(H,`Terminal connection error ${Y}/${C}`),Y>=C)TA(H,"Max consecutive errors reached, triggering reconnection via onclose"),Y=0,E.onclose?.()}else Y=0;if(W)W(y)},E.onclose=()=>{let y=Date.now()-F,g=$.type??"unknown";TA(H,`${g.toUpperCase()} connection closed after ${Math.floor(y/1000)}s (${Q?"with errors":"cleanly"})`);let v=WSA(H,$);if(Uz.cache.delete(v),TA(H,"Cleared connection cache for reconnection"),P)P()};let q=async()=>{if(B&&($.type==="stdio"||!$.type))I.stderr?.off("data",B);if($.type==="stdio")try{let g=I.pid;if(g){TA(H,"Sending SIGINT to MCP server process");try{process.kill(g,"SIGINT")}catch(v){TA(H,`Error sending SIGINT: ${v}`);return}await new Promise(async(v)=>{let p=!1,d=setInterval(()=>{try{process.kill(g,0)}catch{if(!p)p=!0,clearInterval(d),clearTimeout(k),TA(H,"MCP server process exited cleanly"),v()}},50),k=setTimeout(()=>{if(!p)p=!0,clearInterval(d),TA(H,"Cleanup timeout reached, stopping process monitoring"),v()},600);try{if(await new Promise((n)=>setTimeout(n,100)),!p){try{process.kill(g,0),TA(H,"SIGINT failed, sending SIGTERM to MCP server process");try{process.kill(g,"SIGTERM")}catch(n){TA(H,`Error sending SIGTERM: ${n}`),p=!0,clearInterval(d),clearTimeout(k),v();return}}catch{p=!0,clearInterval(d),clearTimeout(k),v();return}if(await new Promise((n)=>setTimeout(n,400)),!p)try{process.kill(g,0),TA(H,"SIGTERM failed, sending SIGKILL to MCP server process");try{process.kill(g,"SIGKILL")}catch(n){TA(H,`Error sending SIGKILL: ${n}`)}}catch{p=!0,clearInterval(d),clearTimeout(k),v()}}if(!p)p=!0,clearInterval(d),clearTimeout(k),v()}catch{if(!p)p=!0,clearInterval(d),clearTimeout(k),v()}})}}catch(y){TA(H,`Error terminating process: ${y}`)}try{await E.close()}catch(y){TA(H,`Error closing client: ${y}`)}},O=WB(q),j=async()=>{O?.(),await q()},u=Date.now()-L;return c("tengu_mcp_server_connection_succeeded",{connectionDurationMs:u,transportType:$.type??"stdio",totalServers:A?.totalServers,stdioCount:A?.stdioCount,sseCount:A?.sseCount,httpCount:A?.httpCount,sseIdeCount:A?.sseIdeCount,wsIdeCount:A?.wsIdeCount,...SX($)?{mcpServerBaseUrl:SX($)}:{}}),{name:H,client:E,type:"connected",capabilities:U??{},serverInfo:X,instructions:J,config:$,cleanup:j}}catch(I){let D=Date.now()-L;return c("tengu_mcp_server_connection_failed",{connectionDurationMs:D,totalServers:A?.totalServers||1,stdioCount:A?.stdioCount||($.type==="stdio"?1:0),sseCount:A?.sseCount||($.type==="sse"?1:0),httpCount:A?.httpCount||($.type==="http"?1:0),sseIdeCount:A?.sseIdeCount||($.type==="sse-ide"?1:0),wsIdeCount:A?.wsIdeCount||($.type==="ws-ide"?1:0),transportType:$.type??"stdio",...SX($)?{mcpServerBaseUrl:SX($)}:{}}),TA(H,`Connection failed after ${D}ms: ${I instanceof Error?I.message:String(I)}`),BE(H,`Connection failed: ${I instanceof Error?I.message:String(I)}`),{name:H,type:"failed",config:$,error:I instanceof Error?I.message:String(I)}}},WSA);kS=o$(async(H)=>{if(H.type!=="connected")return[];try{if(!H.capabilities?.tools)return[];let $=await H.client.request({method:"tools/list"},bSH),A=sr($.tools),L=H.config.type==="sdk"&&A$(process.env.CLAUDE_AGENT_SDK_MCP_NO_PREFIX);return A.map((I)=>({...gOD,name:L?I.name:`mcp__${B1(H.name)}__${B1(I.name)}`,originalMcpToolName:I.name,isMcp:!0,async description(){return I.description??""},async prompt(){return I.description??""},isConcurrencySafe(){return I.annotations?.readOnlyHint??!1},isReadOnly(){return I.annotations?.readOnlyHint??!1},isDestructive(){return I.annotations?.destructiveHint??!1},isOpenWorld(){return I.annotations?.openWorldHint??!1},inputJSONSchema:I.inputSchema,async checkPermissions(){return{behavior:"passthrough",message:"MCPTool requires permission.",suggestions:[{type:"addRules",rules:[{toolName:L?I.name:`mcp__${B1(H.name)}__${B1(I.name)}`,ruleContent:void 0}],behavior:"allow",destination:"localSettings"}]}},async call(D,B,f,E,M){let G=TX1(E),U=G?{"claudecode/toolUseId":G}:{};if(M&&G)M({toolUseID:G,data:{type:"mcp_progress",status:"started",serverName:H.name,toolName:I.name}});let X=Date.now();try{let J=await g6H(H),F=await vxD({client:J,tool:I.name,args:D,meta:U,signal:B.abortController.signal,onProgress:M&&G?(Q)=>{M({toolUseID:G,data:Q})}:void 0});if(M&&G)M({toolUseID:G,data:{type:"mcp_progress",status:"completed",serverName:H.name,toolName:I.name,elapsedTimeMs:Date.now()-X}});return{data:F.content,...F._meta||F.structuredContent?{mcpMeta:{...F._meta&&{_meta:F._meta},...F.structuredContent&&{structuredContent:F.structuredContent}}}:{}}}catch(J){if(M&&G)M({toolUseID:G,data:{type:"mcp_progress",status:"failed",serverName:H.name,toolName:I.name,elapsedTimeMs:Date.now()-X}});if(J instanceof Error&&!(J instanceof pZ)){let F=J.constructor.name;if(F==="Error")throw new pZ(J.message,J.message.slice(0,200));if(F==="McpError"&&"code"in J&&typeof J.code==="number")throw new pZ(J.message,`McpError ${J.code}`)}throw J}},userFacingName(){let D=I.annotations?.title||I.name;return`${H.name} - ${D} (MCP)`},...z3H(H.name)?zxD(I.name):{}})).filter(wX1)}catch($){return BE(H.name,`Failed to fetch tools: ${$ instanceof Error?$.message:String($)}`),[]}}),KgH=o$(async(H)=>{if(H.type!=="connected")return[];try{if(!H.capabilities?.resources)return[];let $=await H.client.request({method:"resources/list"},IDH);if(!$.resources)return[];return $.resources.map((A)=>({...A,server:H.name}))}catch($){return BE(H.name,`Failed to fetch resources: ${$ instanceof Error?$.message:String($)}`),[]}}),QgH=o$(async(H)=>{if(H.type!=="connected")return[];try{if(!H.capabilities?.prompts)return[];let $=await H.client.request({method:"prompts/list"},vSH);if(!$.prompts)return[];return sr($.prompts).map((L)=>{let I=Object.values(L.arguments??{}).map((D)=>D.name);return{type:"prompt",name:"mcp__"+B1(H.name)+"__"+L.name,description:L.description??"",hasUserSpecifiedDescription:!!L.description,contentLength:0,isEnabled:()=>!0,isHidden:!1,isMcp:!0,progressMessage:"running",userFacingName(){return`${H.name}:${L.name} (MCP)`},argNames:I,source:"mcp",async getPromptForCommand(D){let B=D.split(" ");try{let f=await g6H(H),E=await f.client.getPrompt({name:L.name,arguments:znA(I,B)});return(await Promise.all(E.messages.map((G)=>yxD(G.content,f.name)))).flat()}catch(f){throw BE(H.name,`Error running command '${L.name}': ${f instanceof Error?f.message:String(f)}`),f}}}})}catch($){return BE(H.name,`Failed to fetch commands: ${$ instanceof Error?$.message:String($)}`),[]}});O2$=o$(async(H)=>{return new Promise(($)=>{let A=0,L=0;if(A=Object.keys(H).length,A===0){$({clients:[],tools:[],commands:[]});return}let I=[],D=[],B=[];tw$((f)=>{if(I.push(f.client),D.push(...f.tools),B.push(...f.commands),L++,L>=A){let E=B.reduce((M,G)=>{let U=G.name.length+(G.description??"").length+(G.argumentHint??"").length;return M+U},0);c("tengu_mcp_tools_commands_loaded",{tools_count:D.length,commands_count:B.length,commands_metadata_length:E}),$({clients:I,tools:D,commands:B})}},H).catch((f)=>{BE("prefetchAllMcpResources",`Failed to get MCP resources: ${f instanceof Error?f.message:String(f)}`),$({clients:[],tools:[],commands:[]})})})})});class KS{static instance;baseline=new Map;initialized=!1;mcpClient;lastProcessedTimestamps=new Map;rightFileDiagnosticsState=new Map;static getInstance(){if(!KS.instance)KS.instance=new KS;return KS.instance}initialize(H){if(this.initialized)return;this.mcpClient=H,this.initialized=!0}async shutdown(){this.initialized=!1,this.baseline.clear()}reset(){this.baseline.clear(),this.rightFileDiagnosticsState.clear()}normalizeFileUri(H){let $=["file://","_claude_fs_right:","_claude_fs_left:"],A=H;for(let L of $)if(H.startsWith(L)){A=H.slice(L.length);break}return sw$(A)}async ensureFileOpened(H){if(!this.initialized||!this.mcpClient||this.mcpClient.type!=="connected")return;try{await Gx("openFile",{filePath:H,preview:!1,startText:"",endText:"",selectToEndOfLine:!1,makeFrontmost:!1},this.mcpClient)}catch($){r($)}}async beforeFileEdited(H){if(!this.initialized||!this.mcpClient||this.mcpClient.type!=="connected")return;let $=Date.now();try{let A=await Gx("getDiagnostics",{uri:`file://${H}`},this.mcpClient),L=this.parseDiagnosticResult(A)[0];if(L){if(!uxD(this.normalizeFileUri(H),this.normalizeFileUri(L.uri))){r(new kxD(`Diagnostics file path mismatch: expected ${H}, got ${L.uri})`));return}let I=this.normalizeFileUri(H);this.baseline.set(I,L.diagnostics),this.lastProcessedTimestamps.set(I,$)}else{let I=this.normalizeFileUri(H);this.baseline.set(I,[]),this.lastProcessedTimestamps.set(I,$)}}catch(A){}}async getNewDiagnostics(){if(!this.initialized||!this.mcpClient||this.mcpClient.type!=="connected")return[];let H=[];try{let I=await Gx("getDiagnostics",{},this.mcpClient);H=this.parseDiagnosticResult(I)}catch(I){return[]}let $=H.filter((I)=>this.baseline.has(this.normalizeFileUri(I.uri))).filter((I)=>I.uri.startsWith("file://")),A=new Map;H.filter((I)=>this.baseline.has(this.normalizeFileUri(I.uri))).filter((I)=>I.uri.startsWith("_claude_fs_right:")).forEach((I)=>{A.set(this.normalizeFileUri(I.uri),I)});let L=[];for(let I of $){let D=this.normalizeFileUri(I.uri),B=this.baseline.get(D)||[],f=A.get(D),E=I;if(f){let G=this.rightFileDiagnosticsState.get(D);if(!G||!this.areDiagnosticArraysEqual(G,f.diagnostics))E=f;this.rightFileDiagnosticsState.set(D,f.diagnostics)}let M=E.diagnostics.filter((G)=>!B.some((U)=>this.areDiagnosticsEqual(G,U)));if(M.length>0)L.push({uri:I.uri,diagnostics:M});this.baseline.set(D,E.diagnostics)}return L}parseDiagnosticResult(H){if(Array.isArray(H)){let $=H.find((A)=>A.type==="text");if($&&"text"in $)return DA($.text)}return[]}areDiagnosticsEqual(H,$){return H.message===$.message&&H.severity===$.severity&&H.source===$.source&&H.code===$.code&&H.range.start.line===$.range.start.line&&H.range.start.character===$.range.start.character&&H.range.end.line===$.range.end.line&&H.range.end.character===$.range.end.character}areDiagnosticArraysEqual(H,$){if(H.length!==$.length)return!1;return H.every((A)=>$.some((L)=>this.areDiagnosticsEqual(A,L)))&&$.every((A)=>H.some((L)=>this.areDiagnosticsEqual(L,A)))}isLinterDiagnostic(H){let $=["eslint","eslint-plugin","tslint","prettier","stylelint","jshint","standardjs","xo","rome","biome","deno-lint","rubocop","pylint","flake8","black","ruff","clippy","rustfmt","golangci-lint","gofmt","swiftlint","detekt","ktlint","checkstyle","pmd","sonarqube","sonarjs"];if(!H.source)return!1;let A=H.source.toLowerCase();return $.some((L)=>A.includes(L))}async handleQueryStart(H){if(!this.initialized){let $=QC(H);if($)this.initialize($)}else this.reset()}static formatDiagnosticsSummary(H){let A=H.map((L)=>{let I=L.uri.split("/").pop()||L.uri,D=L.diagnostics.map((B)=>{return`  ${KS.getSeveritySymbol(B.severity)} [Line ${B.range.start.line+1}:${B.range.start.character+1}] ${B.message}${B.code?` [${B.code}]`:""}${B.source?` (${B.source})`:""}`}).join(`
`+$);let A;try{A=tm.Metadata.fromHttp2Headers(H)}catch(D){A=new tm.Metadata}let L=A.getMap(),I;if(typeof L["grpc-status"]==="string"){let D=Number(L["grpc-status"]);this.trace("received status code "+D+" from server"),A.remove("grpc-status");let B="";if(typeof L["grpc-message"]==="string"){try{B=decodeURI(L["grpc-message"])}catch(f){B=L["grpc-message"]}A.remove("grpc-message"),this.trace('received status details string "'+B+'" from server')}I={code:D,details:B,metadata:A}}else if(this.httpStatusCode)I=kCA(this.httpStatusCode),I.metadata=A;else I={code:kM.Status.UNKNOWN,details:"No status information received",metadata:A};this.endCall(I)}destroyHttp2Stream(){var H;if(this.http2Stream.destroyed)return;if(this.serverEndedCall)this.http2Stream.end();else{let $;if(((H=this.finalStatus)===null||H===void 0?void 0:H.code)===kM.Status.OK)$=om.constants.NGHTTP2_NO_ERROR;else $=om.constants.NGHTTP2_CANCEL;this.trace("close http2 stream with code "+$),this.http2Stream.close($)}}cancelWithStatus(H,$){this.trace("cancelWithStatus code: "+H+' details: "'+$+'"'),this.endCall({code:H,details:$,metadata:new tm.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}getAuthContext(){return this.transport.getAuthContext()}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==kM.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let H=this.unpushedReadMessages.shift();this.push(H);return}this.http2Stream.resume()}sendMessageWithContext(H,$){this.trace("write() called with message of length "+$.length);let A=(L)=>{process.nextTick(()=>{var I;let D=kM.Status.UNAVAILABLE;if((L===null||L===void 0?void 0:L.code)==="ERR_STREAM_WRITE_AFTER_END")D=kM.Status.INTERNAL;if(L)this.cancelWithStatus(D,`Write error: ${L.message}`);(I=H.callback)===null||I===void 0||I.call(H)})};this.trace("sending data chunk of length "+$.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write($,A)}catch(L){this.endCall({code:kM.Status.UNAVAILABLE,details:`Write failed with error ${L.message}`,metadata:new tm.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}b3$.Http2SubchannelCall=sfD});var AED=z((g3$)=>{Object.defineProperty(g3$,"__esModule",{value:!0});g3$.Http2SubchannelConnector=void 0;var K0H=require("http2"),nl9=require("tls"),k3$=Zo(),QhH=I8(),rl9=hCA(),yWH=wG(),al9=sx(),u3$=gC(),uCA=CP(),ol9=require("net"),tl9=efD(),sl9=T3$(),gCA="transport",el9="transport_flowctrl",Hi9=sPA().version,{HTTP2_HEADER_AUTHORITY:$i9,HTTP2_HEADER_CONTENT_TYPE:Ai9,HTTP2_HEADER_METHOD:Li9,HTTP2_HEADER_PATH:Ii9,HTTP2_HEADER_TE:Di9,HTTP2_HEADER_USER_AGENT:Bi9}=K0H.constants,fi9=20000,Ei9=Buffer.from("too_many_pings","ascii");class HED{constructor(H,$,A,L){if(this.session=H,this.options=A,this.remoteName=L,this.keepaliveTimer=null,this.pendingSendKeepalivePing=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,u3$.subchannelAddressToString)($),A["grpc.enable_channelz"]===0)this.channelzEnabled=!1,this.streamTracker=new k3$.ChannelzCallTrackerStub;else this.streamTracker=new k3$.ChannelzCallTracker;if(this.channelzRef=(0,k3$.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[A["grpc.primary_user_agent"],`grpc-node-js/${Hi9}`,A["grpc.secondary_user_agent"]].filter((I)=>I).join(" "),"grpc.keepalive_time_ms"in A)this.keepaliveTimeMs=A["grpc.keepalive_time_ms"];else this.keepaliveTimeMs=-1;if("grpc.keepalive_timeout_ms"in A)this.keepaliveTimeoutMs=A["grpc.keepalive_timeout_ms"];else this.keepaliveTimeoutMs=fi9;if("grpc.keepalive_permit_without_calls"in A)this.keepaliveWithoutCalls=A["grpc.keepalive_permit_without_calls"]===1;else this.keepaliveWithoutCalls=!1;if(H.once("close",()=>{this.trace("session closed"),this.handleDisconnect()}),H.once("goaway",(I,D,B)=>{let f=!1;if(I===K0H.constants.NGHTTP2_ENHANCE_YOUR_CALM&&B&&B.equals(Ei9))f=!0;this.trace("connection closed by GOAWAY with code "+I+" and data "+(B===null||B===void 0?void 0:B.toString())),this.reportDisconnectToOwner(f)}),H.once("error",(I)=>{this.trace("connection closed with error "+I.message),this.handleDisconnect()}),H.socket.once("close",(I)=>{this.trace("connection closed. hadError="+I),this.handleDisconnect()}),yWH.isTracerEnabled(gCA))H.on("remoteSettings",(I)=>{this.trace("new settings received"+(this.session!==H?" on the old connection":"")+": "+JSON.stringify(I))}),H.on("localSettings",(I)=>{this.trace("local settings acknowledged by remote"+(this.session!==H?" on the old connection":"")+": "+JSON.stringify(I))});if(this.keepaliveWithoutCalls)this.maybeStartKeepalivePingTimer();if(H.socket instanceof nl9.TLSSocket)this.authContext={transportSecurityType:"ssl",sslPeerCertificate:H.socket.getPeerCertificate()};else this.authContext={}}getChannelzInfo(){var H,$,A;let L=this.session.socket,I=L.remoteAddress?(0,u3$.stringToSubchannelAddress)(L.remoteAddress,L.remotePort):null,D=L.localAddress?(0,u3$.stringToSubchannelAddress)(L.localAddress,L.localPort):null,B;if(this.session.encrypted){let E=L,M=E.getCipher(),G=E.getCertificate(),U=E.getPeerCertificate();B={cipherSuiteStandardName:(H=M.standardName)!==null&&H!==void 0?H:null,cipherSuiteOtherName:M.standardName?null:M.name,localCertificate:G&&"raw"in G?G.raw:null,remoteCertificate:U&&"raw"in U?U.raw:null}}else B=null;return{remoteAddress:I,localAddress:D,security:B,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:($=this.session.state.localWindowSize)!==null&&$!==void 0?$:null,remoteFlowControlWindow:(A=this.session.state.remoteWindowSize)!==null&&A!==void 0?A:null}}trace(H){yWH.trace(QhH.LogVerbosity.DEBUG,gCA,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+H)}keepaliveTrace(H){yWH.trace(QhH.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+H)}flowControlTrace(H){yWH.trace(QhH.LogVerbosity.DEBUG,el9,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+H)}internalsTrace(H){yWH.trace(QhH.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+H)}reportDisconnectToOwner(H){if(this.disconnectHandled)return;this.disconnectHandled=!0,this.disconnectListeners.forEach(($)=>$(H))}handleDisconnect(){this.clearKeepaliveTimeout(),this.reportDisconnectToOwner(!1);for(let H of this.activeCalls)H.onDisconnect();setImmediate(()=>{this.session.destroy()})}addDisconnectListener(H){this.disconnectListeners.push(H)}canSendPing(){return!this.session.destroyed&&this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var H,$;if(!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}if(this.keepaliveTimer){console.error("keepaliveTimeout is not null");return}if(this.channelzEnabled)this.keepalivesSent+=1;this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimer=setTimeout(()=>{this.keepaliveTimer=null,this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),($=(H=this.keepaliveTimer).unref)===null||$===void 0||$.call(H);let A="";try{if(!this.session.ping((I,D,B)=>{if(this.clearKeepaliveTimeout(),I)this.keepaliveTrace("Ping failed with error "+I.message),this.handleDisconnect();else this.keepaliveTrace("Received ping response"),this.maybeStartKeepalivePingTimer()}))A="Ping returned false"}catch(L){A=(L instanceof Error?L.message:"")||"Unknown error"}if(A)this.keepaliveTrace("Ping send failed: "+A),this.handleDisconnect()}maybeStartKeepalivePingTimer(){var H,$;if(!this.canSendPing())return;if(this.pendingSendKeepalivePing)this.pendingSendKeepalivePing=!1,this.maybeSendPing();else if(!this.keepaliveTimer)this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimer=setTimeout(()=>{this.keepaliveTimer=null,this.maybeSendPing()},this.keepaliveTimeMs),($=(H=this.keepaliveTimer).unref)===null||$===void 0||$.call(H)}clearKeepaliveTimeout(){if(this.keepaliveTimer)clearTimeout(this.keepaliveTimer),this.keepaliveTimer=null}removeActiveCall(H){if(this.activeCalls.delete(H),this.activeCalls.size===0)this.session.unref()}addActiveCall(H){if(this.activeCalls.add(H),this.activeCalls.size===1){if(this.session.ref(),!this.keepaliveWithoutCalls)this.maybeStartKeepalivePingTimer()}}createCall(H,$,A,L,I){let D=H.toHttp2Headers();D[$i9]=$,D[Bi9]=this.userAgent,D[Ai9]="application/grpc",D[Li9]="POST",D[Ii9]=A,D[Di9]="trailers";let B;try{B=this.session.request(D)}catch(M){throw this.handleDisconnect(),M}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let f,E;if(this.channelzEnabled)this.streamTracker.addCallStarted(),f={addMessageSent:()=>{var M;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(M=I.addMessageSent)===null||M===void 0||M.call(I)},addMessageReceived:()=>{var M;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(M=I.addMessageReceived)===null||M===void 0||M.call(I)},onCallEnd:(M)=>{var G;(G=I.onCallEnd)===null||G===void 0||G.call(I,M),this.removeActiveCall(E)},onStreamEnd:(M)=>{var G;if(M)this.streamTracker.addCallSucceeded();else this.streamTracker.addCallFailed();(G=I.onStreamEnd)===null||G===void 0||G.call(I,M)}};else f={addMessageSent:()=>{var M;(M=I.addMessageSent)===null||M===void 0||M.call(I)},addMessageReceived:()=>{var M;(M=I.addMessageReceived)===null||M===void 0||M.call(I)},onCallEnd:(M)=>{var G;(G=I.onCallEnd)===null||G===void 0||G.call(I,M),this.removeActiveCall(E)},onStreamEnd:(M)=>{var G;(G=I.onStreamEnd)===null||G===void 0||G.call(I,M)}};return E=new tl9.Http2SubchannelCall(B,f,L,this,(0,sl9.getNextCallNumber)()),this.addActiveCall(E),E}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}getAuthContext(){return this.authContext}shutdown(){this.session.close(),(0,k3$.unregisterChannelzRef)(this.channelzRef)}}class $ED{constructor(H){this.channelTarget=H,this.session=null,this.isShutdown=!1}trace(H){yWH.trace(QhH.LogVerbosity.DEBUG,gCA,(0,uCA.uriToString)(this.channelTarget)+" "+H)}createSession(H,$,A){if(this.isShutdown)return Promise.reject();if(H.socket.closed)return Promise.reject("Connection closed before starting HTTP/2 handshake");return new Promise((L,I)=>{var D,B,f,E,M,G,U;let X=null,J=this.channelTarget;if("grpc.http_connect_target"in A){let u=(0,uCA.parseUri)(A["grpc.http_connect_target"]);if(u)J=u,X=(0,uCA.uriToString)(u)}let F=H.secure?"https":"http",Q=(0,al9.getDefaultAuthority)(J),W=()=>{var u;(u=this.session)===null||u===void 0||u.destroy(),this.session=null,setImmediate(()=>{if(!j)j=!0,I(`${O.trim()} (${new Date().toISOString()})`)})},P=(u)=>{var y;if((y=this.session)===null||y===void 0||y.destroy(),O=u.message,this.trace("connection failed with error "+O),!j)j=!0,I(`${O} (${new Date().toISOString()})`)},Y={createConnection:(u,y)=>{return H.socket},settings:{initialWindowSize:(E=(D=A["grpc-node.flow_control_window"])!==null&&D!==void 0?D:(f=(B=K0H.getDefaultSettings)===null||B===void 0?void 0:B.call(K0H))===null||f===void 0?void 0:f.initialWindowSize)!==null&&E!==void 0?E:65535}},C=K0H.connect(`${F}://${Q}`,Y),Z=(U=(G=(M=K0H.getDefaultSettings)===null||M===void 0?void 0:M.call(K0H))===null||G===void 0?void 0:G.initialWindowSize)!==null&&U!==void 0?U:65535,q=A["grpc-node.flow_control_window"];this.session=C;let O="Failed to connect",j=!1;C.unref(),C.once("remoteSettings",()=>{var u;if(q&&q>Z)try{C.setLocalWindowSize(q)}catch(y){let g=q-((u=C.state.localWindowSize)!==null&&u!==void 0?u:Z);if(g>0)C.incrementWindowSize(g)}C.removeAllListeners(),H.socket.removeListener("close",W),H.socket.removeListener("error",P),L(new HED(C,$,A,X)),this.session=null}),C.once("close",W),C.once("error",P),H.socket.once("close",W),H.socket.once("error",P)})}tcpConnect(H,$){return(0,rl9.getProxiedConnection)(H,$).then((A)=>{if(A)return A;else return new Promise((L,I)=>{let D=()=>{I(Error("Socket closed"))},B=(E)=>{I(E)},f=ol9.connect(H,()=>{f.removeListener("close",D),f.removeListener("error",B),L(f)});f.once("close",D),f.once("error",B)})})}async connect(H,$,A){if(this.isShutdown)return Promise.reject();let L=null,I=null,D=(0,u3$.subchannelAddressToString)(H);try{return this.trace(D+" Waiting for secureConnector to be ready"),await $.waitForReady(),this.trace(D+" secureConnector is ready"),L=await this.tcpConnect(H,A),L.setNoDelay(),this.trace(D+" Established TCP connection"),I=await $.connect(L),this.trace(D+" Established secure connection"),this.createSession(I,H,A)}catch(B){throw L===null||L===void 0||L.destroy(),I===null||I===void 0||I.socket.destroy(),B}}shutdown(){var H;this.isShutdown=!0,(H=this.session)===null||H===void 0||H.close(),this.session=null}}g3$.Http2SubchannelConnector=$ED});var LED=z((WhH)=>{Object.defineProperty(WhH,"__esModule",{value:!0});WhH.SubchannelPool=void 0;WhH.getSubchannelPool=Qi9;var Mi9=r9D(),Gi9=mfD(),Ui9=gC(),Xi9=CP(),Ji9=AED(),Fi9=1e4;class m3${constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let H=!0;for(let $ in this.pool){let L=this.pool[$].filter((I)=>!I.subchannel.unrefIfOneRef());if(L.length>0)H=!1;this.pool[$]=L}if(H&&this.cleanupTimer!==null)clearInterval(this.cleanupTimer),this.cleanupTimer=null}ensureCleanupTask(){var H,$;if(this.cleanupTimer===null)this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},Fi9),($=(H=this.cleanupTimer).unref)===null||$===void 0||$.call(H)}getOrCreateSubchannel(H,$,A,L){this.ensureCleanupTask();let I=(0,Xi9.uriToString)(H);if(I in this.pool){let B=this.pool[I];for(let f of B)if((0,Ui9.subchannelAddressEqual)($,f.subchannelAddress)&&(0,Mi9.channelOptionsEqual)(A,f.channelArguments)&&L._equals(f.channelCredentials))return f.subchannel}let D=new Gi9.Subchannel(H,$,A,L,new Ji9.Http2SubchannelConnector(H));if(!(I in this.pool))this.pool[I]=[];return this.pool[I].push({subchannelAddress:$,channelArguments:A,channelCredentials:L,subchannel:D}),D.ref(),D}}WhH.SubchannelPool=m3$;var Ki9=new m3$;function Qi9(H){if(H)return Ki9;else return new m3$}});var fED=z((c3$)=>{Object.defineProperty(c3$,"__esModule",{value:!0});c3$.LoadBalancingCall=void 0;var IED=YP(),p3$=I8(),DED=OWH(),d3$=dQ(),VhH=pm(),Wi9=CP(),Vi9=wG(),mCA=GhH(),Pi9=require("http2"),_i9="load_balancing_call";class BED{constructor(H,$,A,L,I,D,B){var f,E;this.channel=H,this.callConfig=$,this.methodName=A,this.host=L,this.credentials=I,this.deadline=D,this.callNumber=B,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null,this.childStartTime=null;let M=this.methodName.split("/"),G="";if(M.length>=2)G=M[1];let U=(E=(f=(0,Wi9.splitHostPort)(this.host))===null||f===void 0?void 0:f.host)!==null&&E!==void 0?E:"localhost";this.serviceUrl=`https://${U}/${G}`,this.startTime=new Date}getDeadlineInfo(){var H,$;let A=[];if(this.childStartTime){if(this.childStartTime>this.startTime){if((H=this.metadata)===null||H===void 0?void 0:H.getOptions().waitForReady)A.push("wait_for_ready");A.push(`LB pick: ${(0,DED.formatDateDifference)(this.startTime,this.childStartTime)}`)}return A.push(...this.child.getDeadlineInfo()),A}else{if(($=this.metadata)===null||$===void 0?void 0:$.getOptions().waitForReady)A.push("wait_for_ready");A.push("Waiting for LB pick")}return A}trace(H){Vi9.trace(p3$.LogVerbosity.DEBUG,_i9,"["+this.callNumber+"] "+H)}outputStatus(H,$){var A,L;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+H.code+' details="'+H.details+'" start time='+this.startTime.toISOString());let I=Object.assign(Object.assign({},H),{progress:$});(A=this.listener)===null||A===void 0||A.onReceiveStatus(I),(L=this.onCallEnded)===null||L===void 0||L.call(this,I.code,I.details,I.metadata)}}doPick(){var H,$;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let A=this.metadata.clone(),L=this.channel.doPick(A,this.callConfig.pickInformation),I=L.subchannel?"("+L.subchannel.getChannelzRef().id+") "+L.subchannel.getAddress():""+L.subchannel;switch(this.trace("Pick result: "+VhH.PickResultType[L.pickResultType]+" subchannel: "+I+" status: "+((H=L.status)===null||H===void 0?void 0:H.code)+" "+(($=L.status)===null||$===void 0?void 0:$.details)),L.pickResultType){case VhH.PickResultType.COMPLETE:this.credentials.compose(L.subchannel.getCallCredentials()).generateMetadata({method_name:this.methodName,service_url:this.serviceUrl}).then((E)=>{var M;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}if(A.merge(E),A.get("authorization").length>1)this.outputStatus({code:p3$.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new d3$.Metadata},"PROCESSED");if(L.subchannel.getConnectivityState()!==IED.ConnectivityState.READY){this.trace("Picked subchannel "+I+" has state "+IED.ConnectivityState[L.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}if(this.deadline!==1/0)A.set("grpc-timeout",(0,DED.getDeadlineTimeoutString)(this.deadline));try{this.child=L.subchannel.getRealSubchannel().createCall(A,this.host,this.methodName,{onReceiveMetadata:(G)=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(G)},onReceiveMessage:(G)=>{this.trace("Received message"),this.listener.onReceiveMessage(G)},onReceiveStatus:(G)=>{if(this.trace("Received status"),G.rstCode===Pi9.constants.NGHTTP2_REFUSED_STREAM)this.outputStatus(G,"REFUSED");else this.outputStatus(G,"PROCESSED")}}),this.childStartTime=new Date}catch(G){this.trace("Failed to start call on picked subchannel "+I+" with error "+G.message),this.outputStatus({code:p3$.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+G.message,metadata:new d3$.Metadata},"NOT_STARTED");return}if((M=L.onCallStarted)===null||M===void 0||M.call(L),this.onCallEnded=L.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending)this.child.startRead();if(this.pendingMessage)this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message);if(this.pendingHalfClose)this.child.halfClose()},(E)=>{let{code:M,details:G}=(0,mCA.restrictControlPlaneStatusCode)(typeof E.code==="number"?E.code:p3$.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${E.message}`);this.outputStatus({code:M,details:G,metadata:new d3$.Metadata},"PROCESSED")});break;case VhH.PickResultType.DROP:let{code:B,details:f}=(0,mCA.restrictControlPlaneStatusCode)(L.status.code,L.status.details);setImmediate(()=>{this.outputStatus({code:B,details:f,metadata:L.status.metadata},"DROP")});break;case VhH.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:E,details:M}=(0,mCA.restrictControlPlaneStatusCode)(L.status.code,L.status.details);setImmediate(()=>{this.outputStatus({code:E,details:M,metadata:L.status.metadata},"PROCESSED")})}break;case VhH.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(H,$){var A;this.trace("cancelWithStatus code: "+H+' details: "'+$+'"'),(A=this.child)===null||A===void 0||A.cancelWithStatus(H,$),this.outputStatus({code:H,details:$,metadata:new d3$.Metadata},"PROCESSED")}getPeer(){var H,$;return($=(H=this.child)===null||H===void 0?void 0:H.getPeer())!==null&&$!==void 0?$:this.channel.getTarget()}start(H,$){this.trace("start called"),this.listener=$,this.metadata=H,this.doPick()}sendMessageWithContext(H,$){if(this.trace("write() called with message of length "+$.length),this.child)this.child.sendMessageWithContext(H,$);else this.pendingMessage={context:H,message:$}}startRead(){if(this.trace("startRead called"),this.child)this.child.startRead();else this.readPending=!0}halfClose(){if(this.trace("halfClose called"),this.child)this.child.halfClose();else this.pendingHalfClose=!0}setCredentials(H){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}getAuthContext(){if(this.child)return this.child.getAuthContext();else return null}}c3$.LoadBalancingCall=BED});var GED=z((l3$)=>{Object.defineProperty(l3$,"__esModule",{value:!0});l3$.ResolvingCall=void 0;var Ci9=j6$(),Q0H=I8(),W0H=OWH(),EED=dQ(),Yi9=wG(),wi9=GhH(),Zi9="resolving_call";class MED{constructor(H,$,A,L,I){if(this.channel=H,this.method=$,this.filterStackFactory=L,this.callNumber=I,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadlineStartTime=null,this.configReceivedTime=null,this.childStartTime=null,this.credentials=Ci9.CallCredentials.createEmpty(),this.deadline=A.deadline,this.host=A.host,A.parentCall){if(A.flags&Q0H.Propagate.CANCELLATION)A.parentCall.on("cancelled",()=>{this.cancelWithStatus(Q0H.Status.CANCELLED,"Cancelled by parent call")});if(A.flags&Q0H.Propagate.DEADLINE)this.trace("Propagating deadline from parent: "+A.parentCall.getDeadline()),this.deadline=(0,W0H.minDeadline)(this.deadline,A.parentCall.getDeadline())}this.trace("Created"),this.runDeadlineTimer()}trace(H){Yi9.trace(Q0H.LogVerbosity.DEBUG,Zi9,"["+this.callNumber+"] "+H)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.deadlineStartTime=new Date,this.trace("Deadline: "+(0,W0H.deadlineToString)(this.deadline));let H=(0,W0H.getRelativeTimeout)(this.deadline);if(H!==1/0){this.trace("Deadline will be reached in "+H+"ms");let $=()=>{if(!this.deadlineStartTime){this.cancelWithStatus(Q0H.Status.DEADLINE_EXCEEDED,"Deadline exceeded");return}let A=[],L=new Date;if(A.push(`Deadline exceeded after ${(0,W0H.formatDateDifference)(this.deadlineStartTime,L)}`),this.configReceivedTime){if(this.configReceivedTime>this.deadlineStartTime)A.push(`name resolution: ${(0,W0H.formatDateDifference)(this.deadlineStartTime,this.configReceivedTime)}`);if(this.childStartTime){if(this.childStartTime>this.configReceivedTime)A.push(`metadata filters: ${(0,W0H.formatDateDifference)(this.configReceivedTime,this.childStartTime)}`)}else A.push("waiting for metadata filters")}else A.push("waiting for name resolution");if(this.child)A.push(...this.child.getDeadlineInfo());this.cancelWithStatus(Q0H.Status.DEADLINE_EXCEEDED,A.join(","))};if(H<=0)process.nextTick($);else this.deadlineTimer=setTimeout($,H)}}outputStatus(H){if(!this.ended){if(this.ended=!0,!this.filterStack)this.filterStack=this.filterStackFactory.createFilter();clearTimeout(this.deadlineTimer);let $=this.filterStack.receiveTrailers(H);this.trace("ended with status: code="+$.code+' details="'+$.details+'"'),this.statusWatchers.forEach((A)=>A($)),process.nextTick(()=>{var A;(A=this.listener)===null||A===void 0||A.onReceiveStatus($)})}}sendMessageOnChild(H,$){if(!this.child)throw Error("sendMessageonChild called with child not populated");let A=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:$,flags:H.flags})).then((L)=>{if(this.writeFilterPending=!1,A.sendMessageWithContext(H,L.message),this.pendingHalfClose)A.halfClose()},(L)=>{this.cancelWithStatus(L.code,L.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let H=this.channel.getConfig(this.method,this.metadata);if(H.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(H.type==="ERROR"){if(this.metadata.getOptions().waitForReady)this.channel.queueCallForConfig(this);else this.outputStatus(H.error);return}this.configReceivedTime=new Date;let $=H.config;if($.status!==Q0H.Status.OK){let{code:A,details:L}=(0,wi9.restrictControlPlaneStatusCode)($.status,"Failed to route call to method "+this.method);this.outputStatus({code:A,details:L,metadata:new EED.Metadata});return}if($.methodConfig.timeout){let A=new Date;A.setSeconds(A.getSeconds()+$.methodConfig.timeout.seconds),A.setMilliseconds(A.getMilliseconds()+$.methodConfig.timeout.nanos/1e6),this.deadline=(0,W0H.minDeadline)(this.deadline,A),this.runDeadlineTimer()}this.filterStackFactory.push($.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then((A)=>{if(this.child=this.channel.createRetryingCall($,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.childStartTime=new Date,this.child.start(A,{onReceiveMetadata:(L)=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(L))},onReceiveMessage:(L)=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(L).then((I)=>{if(this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(I),this.pendingChildStatus)this.outputStatus(this.pendingChildStatus)},(I)=>{this.cancelWithStatus(I.code,I.details)})},onReceiveStatus:(L)=>{if(this.trace("Received status"),this.readFilterPending)this.pendingChildStatus=L;else this.outputStatus(L)}}),this.readPending)this.child.startRead();if(this.pendingMessage)this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message);else if(this.pendingHalfClose)this.child.halfClose()},(A)=>{this.outputStatus(A)})}reportResolverError(H){var $;if(($=this.metadata)===null||$===void 0?void 0:$.getOptions().waitForReady)this.channel.queueCallForConfig(this);else this.outputStatus(H)}cancelWithStatus(H,$){var A;this.trace("cancelWithStatus code: "+H+' details: "'+$+'"'),(A=this.child)===null||A===void 0||A.cancelWithStatus(H,$),this.outputStatus({code:H,details:$,metadata:new EED.Metadata})}getPeer(){var H,$;return($=(H=this.child)===null||H===void 0?void 0:H.getPeer())!==null&&$!==void 0?$:this.channel.getTarget()}start(H,$){this.trace("start called"),this.metadata=H.clone(),this.listener=$,this.getConfig()}sendMessageWithContext(H,$){if(this.trace("write() called with message of length "+$.length),this.child)this.sendMessageOnChild(H,$);else this.pendingMessage={context:H,message:$}}startRead(){if(this.trace("startRead called"),this.child)this.child.startRead();else this.readPending=!0}halfClose(){if(this.trace("halfClose called"),this.child&&!this.writeFilterPending)this.child.halfClose();else this.pendingHalfClose=!0}setCredentials(H){this.credentials=H}addStatusWatcher(H){this.statusWatchers.push(H)}getCallNumber(){return this.callNumber}getAuthContext(){if(this.child)return this.child.getAuthContext();else return null}}l3$.ResolvingCall=MED});var FED=z((To)=>{Object.defineProperty(To,"__esModule",{value:!0});To.RetryingCall=To.MessageBufferTracker=To.RetryThrottler=void 0;var i3$=I8(),qi9=OWH(),Ti9=dQ(),zi9=wG(),Ni9="retrying_call";class UED{constructor(H,$,A){if(this.maxTokens=H,this.tokenRatio=$,A)this.tokens=A.tokens*(H/A.maxTokens);else this.tokens=H}addCallSucceeded(){this.tokens=Math.min(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.max(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}To.RetryThrottler=UED;class XED{constructor(H,$){this.totalLimit=H,this.limitPerCall=$,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(H,$){var A;let L=(A=this.allocatedPerCall.get($))!==null&&A!==void 0?A:0;if(this.limitPerCall-L<H||this.totalLimit-this.totalAllocated<H)return!1;return this.allocatedPerCall.set($,L+H),this.totalAllocated+=H,!0}free(H,$){var A;if(this.totalAllocated<H)throw Error(`Invalid buffer allocation state: call ${$} freed ${H} > total allocated ${this.totalAllocated}`);this.totalAllocated-=H;let L=(A=this.allocatedPerCall.get($))!==null&&A!==void 0?A:0;if(L<H)throw Error(`Invalid buffer allocation state: call ${$} freed ${H} > allocated for call ${L}`);this.allocatedPerCall.set($,L-H)}freeAll(H){var $;let A=($=this.allocatedPerCall.get(H))!==null&&$!==void 0?$:0;if(this.totalAllocated<A)throw Error(`Invalid buffer allocation state: call ${H} allocated ${A} > total allocated ${this.totalAllocated}`);this.totalAllocated-=A,this.allocatedPerCall.delete(H)}}To.MessageBufferTracker=XED;var pCA="grpc-previous-rpc-attempts",Oi9=5;class JED{constructor(H,$,A,L,I,D,B,f,E){var M;this.channel=H,this.callConfig=$,this.methodName=A,this.host=L,this.credentials=I,this.deadline=D,this.callNumber=B,this.bufferTracker=f,this.retryThrottler=E,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0;let G=(M=H.getOptions()["grpc-node.retry_max_attempts_limit"])!==null&&M!==void 0?M:Oi9;if(H.getOptions()["grpc.enable_retries"]===0)this.state="NO_RETRY",this.maxAttempts=1;else if($.methodConfig.retryPolicy){this.state="RETRY";let U=$.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(U.initialBackoff.substring(0,U.initialBackoff.length-1)),this.maxAttempts=Math.min(U.maxAttempts,G)}else if($.methodConfig.hedgingPolicy)this.state="HEDGING",this.maxAttempts=Math.min($.methodConfig.hedgingPolicy.maxAttempts,G);else this.state="TRANSPARENT_ONLY",this.maxAttempts=1;this.startTime=new Date}getDeadlineInfo(){if(this.underlyingCalls.length===0)return[];let H=[],$=this.underlyingCalls[this.underlyingCalls.length-1];if(this.underlyingCalls.length>1)H.push(`previous attempts: ${this.underlyingCalls.length-1}`);if($.startTime>this.startTime)H.push(`time to current attempt start: ${(0,qi9.formatDateDifference)(this.startTime,$.startTime)}`);return H.push(...$.call.getDeadlineInfo()),H}getCallNumber(){return this.callNumber}trace(H){zi9.trace(i3$.LogVerbosity.DEBUG,Ni9,"["+this.callNumber+"] "+H)}reportStatus(H){this.trace("ended with status: code="+H.code+' details="'+H.details+'" start time='+this.startTime.toISOString()),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var $;($=this.listener)===null||$===void 0||$.onReceiveStatus({code:H.code,details:H.details,metadata:H.metadata})})}cancelWithStatus(H,$){this.trace("cancelWithStatus code: "+H+' details: "'+$+'"'),this.reportStatus({code:H,details:$,metadata:new Ti9.Metadata});for(let{call:A}of this.underlyingCalls)A.cancelWithStatus(H,$)}getPeer(){if(this.committedCallIndex!==null)return this.underlyingCalls[this.committedCallIndex].call.getPeer();else return"unknown"}getBufferEntry(H){var $;return($=this.writeBuffer[H-this.writeBufferOffset])!==null&&$!==void 0?$:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let H;if(this.underlyingCalls[this.committedCallIndex].state==="COMPLETED")H=this.getNextBufferIndex();else H=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let $=this.writeBufferOffset;$<H;$++){let A=this.getBufferEntry($);if(A.allocated)this.bufferTracker.free(A.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(H-this.writeBufferOffset),this.writeBufferOffset=H}commitCall(H){var $,A;if(this.state==="COMMITTED")return;this.trace("Committing call ["+this.underlyingCalls[H].call.getCallNumber()+"] at index "+H),this.state="COMMITTED",(A=($=this.callConfig).onCommitted)===null||A===void 0||A.call($),this.committedCallIndex=H;for(let L=0;L<this.underlyingCalls.length;L++){if(L===H)continue;if(this.underlyingCalls[L].state==="COMPLETED")continue;this.underlyingCalls[L].state="COMPLETED",this.underlyingCalls[L].call.cancelWithStatus(i3$.Status.CANCELLED,"Discarded in favor of other hedged attempt")}this.clearSentMessages()}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let H=-1,$=-1;for(let[A,L]of this.underlyingCalls.entries())if(L.state==="ACTIVE"&&L.nextMessageToSend>H)H=L.nextMessageToSend,$=A;if($===-1)this.state="TRANSPARENT_ONLY";else this.commitCall($)}isStatusCodeInList(H,$){return H.some((A)=>{var L;return A===$||A.toString().toLowerCase()===((L=i3$.Status[$])===null||L===void 0?void 0:L.toLowerCase())})}getNextRetryJitter(){return Math.random()*0.3999999999999999+0.8}getNextRetryBackoffMs(){var H;let $=(H=this.callConfig)===null||H===void 0?void 0:H.methodConfig.retryPolicy;if(!$)return 0;let L=this.getNextRetryJitter()*this.nextRetryBackoffSec*1000,I=Number($.maxBackoff.substring(0,$.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*$.backoffMultiplier,I),L}maybeRetryCall(H,$){if(this.state!=="RETRY"){$(!1);return}if(this.attempts>=this.maxAttempts){$(!1);return}let A;if(H===null)A=this.getNextRetryBackoffMs();else if(H<0){this.state="TRANSPARENT_ONLY",$(!1);return}else A=H,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var L,I;if(this.state!=="RETRY"){$(!1);return}if((I=(L=this.retryThrottler)===null||L===void 0?void 0:L.canRetryCall())!==null&&I!==void 0?I:!0)$(!0),this.attempts+=1,this.startNewAttempt();else this.trace("Retry attempt denied by throttling policy"),$(!1)},A)}countActiveCalls(){let H=0;for(let $ of this.underlyingCalls)if(($===null||$===void 0?void 0:$.state)==="ACTIVE")H+=1;return H}handleProcessedStatus(H,$,A){var L,I,D;switch(this.state){case"COMMITTED":case"NO_RETRY":case"TRANSPARENT_ONLY":this.commitCall($),this.reportStatus(H);break;case"HEDGING":if(this.isStatusCodeInList((L=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&L!==void 0?L:[],H.code)){(I=this.retryThrottler)===null||I===void 0||I.addCallFailed();let B;if(A===null)B=0;else if(A<0){this.state="TRANSPARENT_ONLY",this.commitCall($),this.reportStatus(H);return}else B=A;setTimeout(()=>{if(this.maybeStartHedgingAttempt(),this.countActiveCalls()===0)this.commitCall($),this.reportStatus(H)},B)}else this.commitCall($),this.reportStatus(H);break;case"RETRY":if(this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,H.code))(D=this.retryThrottler)===null||D===void 0||D.addCallFailed(),this.maybeRetryCall(A,(B)=>{if(!B)this.commitCall($),this.reportStatus(H)});else this.commitCall($),this.reportStatus(H);break}}getPushback(H){let $=H.get("grpc-retry-pushback-ms");if($.length===0)return null;try{return parseInt($[0])}catch(A){return-1}}handleChildStatus(H,$){var A;if(this.underlyingCalls[$].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+H.progress+" from child ["+this.underlyingCalls[$].call.getCallNumber()+"] in state "+this.underlyingCalls[$].state),this.underlyingCalls[$].state="COMPLETED",H.code===i3$.Status.OK){(A=this.retryThrottler)===null||A===void 0||A.addCallSucceeded(),this.commitCall($),this.reportStatus(H);return}if(this.state==="NO_RETRY"){this.commitCall($),this.reportStatus(H);return}if(this.state==="COMMITTED"){this.reportStatus(H);return}let L=this.getPushback(H.metadata);switch(H.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":if(this.transparentRetryUsed)this.handleProcessedStatus(H,$,L);else this.transparentRetryUsed=!0,this.startNewAttempt();break;case"DROP":this.commitCall($),this.reportStatus(H);break;case"PROCESSED":this.handleProcessedStatus(H,$,L);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING")return;if(!this.callConfig.methodConfig.hedgingPolicy)return;if(this.attempts>=this.maxAttempts)return;this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}maybeStartHedgingTimer(){var H,$,A;if(this.hedgingTimer)clearTimeout(this.hedgingTimer);if(this.state!=="HEDGING")return;if(!this.callConfig.methodConfig.hedgingPolicy)return;let L=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=this.maxAttempts)return;let I=(H=L.hedgingDelay)!==null&&H!==void 0?H:"0s",D=Number(I.substring(0,I.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},D*1000),(A=($=this.hedgingTimer).unref)===null||A===void 0||A.call($)}startNewAttempt(){let H=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+H.getCallNumber()+"] for attempt "+this.attempts);let $=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:H,nextMessageToSend:0,startTime:new Date});let A=this.attempts-1,L=this.initialMetadata.clone();if(A>0)L.set(pCA,`${A}`);let I=!1;if(H.start(L,{onReceiveMetadata:(D)=>{if(this.trace("Received metadata from child ["+H.getCallNumber()+"]"),this.commitCall($),I=!0,A>0)D.set(pCA,`${A}`);if(this.underlyingCalls[$].state==="ACTIVE")this.listener.onReceiveMetadata(D)},onReceiveMessage:(D)=>{if(this.trace("Received message from child ["+H.getCallNumber()+"]"),this.commitCall($),this.underlyingCalls[$].state==="ACTIVE")this.listener.onReceiveMessage(D)},onReceiveStatus:(D)=>{if(this.trace("Received status from child ["+H.getCallNumber()+"]"),!I&&A>0)D.metadata.set(pCA,`${A}`);this.handleChildStatus(D,$)}}),this.sendNextChildMessage($),this.readStarted)H.startRead()}start(H,$){this.trace("start called"),this.listener=$,this.initialMetadata=H,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(H){var $,A;let L=this.underlyingCalls[H],I=L.nextMessageToSend;(A=($=this.getBufferEntry(I)).callback)===null||A===void 0||A.call($),this.clearSentMessages(),L.nextMessageToSend+=1,this.sendNextChildMessage(H)}sendNextChildMessage(H){let $=this.underlyingCalls[H];if($.state==="COMPLETED")return;if(this.getBufferEntry($.nextMessageToSend)){let A=this.getBufferEntry($.nextMessageToSend);switch(A.entryType){case"MESSAGE":$.call.sendMessageWithContext({callback:(L)=>{this.handleChildWriteCompleted(H)}},A.message.message);break;case"HALF_CLOSE":$.nextMessageToSend+=1,$.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(H,$){var A;this.trace("write() called with message of length "+$.length);let L={message:$,flags:H.flags},I=this.getNextBufferIndex(),D={entryType:"MESSAGE",message:L,allocated:this.bufferTracker.allocate($.length,this.callNumber)};if(this.writeBuffer.push(D),D.allocated){(A=H.callback)===null||A===void 0||A.call(H);for(let[B,f]of this.underlyingCalls.entries())if(f.state==="ACTIVE"&&f.nextMessageToSend===I)f.call.sendMessageWithContext({callback:(E)=>{this.handleChildWriteCompleted(B)}},$)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let B=this.underlyingCalls[this.committedCallIndex];if(D.callback=H.callback,B.state==="ACTIVE"&&B.nextMessageToSend===I)B.call.sendMessageWithContext({callback:(f)=>{this.handleChildWriteCompleted(this.committedCallIndex)}},$)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let H of this.underlyingCalls)if((H===null||H===void 0?void 0:H.state)==="ACTIVE")H.call.startRead()}halfClose(){this.trace("halfClose called");let H=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let $ of this.underlyingCalls)if(($===null||$===void 0?void 0:$.state)==="ACTIVE"&&$.nextMessageToSend===H)$.nextMessageToSend+=1,$.call.halfClose()}setCredentials(H){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}getAuthContext(){if(this.committedCallIndex!==null)return this.underlyingCalls[this.committedCallIndex].call.getAuthContext();else return null}}To.RetryingCall=JED});var PhH=z((n3$)=>{Object.defineProperty(n3$,"__esModule",{value:!0});n3$.BaseSubchannelWrapper=void 0;class KED{constructor(H){this.child=H,this.healthy=!0,this.healthListeners=new Set,this.refcount=0,this.dataWatchers=new Set,H.addHealthStateWatcher(($)=>{if(this.healthy)this.updateHealthListeners()})}updateHealthListeners(){for(let H of this.healthListeners)H(this.isHealthy())}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(H){this.child.addConnectivityStateListener(H)}removeConnectivityStateListener(H){this.child.removeConnectivityStateListener(H)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(H){this.child.throttleKeepalive(H)}ref(){this.child.ref(),this.refcount+=1}unref(){if(this.child.unref(),this.refcount-=1,this.refcount===0)this.destroy()}destroy(){for(let H of this.dataWatchers)H.destroy()}getChannelzRef(){return this.child.getChannelzRef()}isHealthy(){return this.healthy&&this.child.isHealthy()}addHealthStateWatcher(H){this.healthListeners.add(H)}removeHealthStateWatcher(H){this.healthListeners.delete(H)}addDataWatcher(H){H.setSubchannel(this.getRealSubchannel()),this.dataWatchers.add(H)}setHealthy(H){if(H!==this.healthy){if(this.healthy=H,this.child.isHealthy())this.updateHealthListeners()}}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(H){return this.getRealSubchannel()===H.getRealSubchannel()}getCallCredentials(){return this.child.getCallCredentials()}getChannel(){return this.child.getChannel()}}n3$.BaseSubchannelWrapper=KED});var iCA=z((V0H)=>{Object.defineProperty(V0H,"__esModule",{value:!0});V0H.InternalChannel=V0H.SUBCHANNEL_ARGS_EXCLUDE_KEY_PREFIX=void 0;var xi9=JWH(),Si9=n9D(),ji9=LED(),lCA=pm(),Ri9=dQ(),zo=I8(),yi9=x3$(),vi9=TCA(),QED=sx(),r3$=wG(),hi9=hCA(),a3$=CP(),rT=YP(),_hH=Zo(),bi9=fED(),ki9=OWH(),ui9=GED(),dCA=T3$(),gi9=GhH(),cCA=FED(),mi9=PhH(),pi9=2147483647,di9=1000,ci9=1800000,o3$=new Map,li9=16777216,ii9=1048576;class WED extends mi9.BaseSubchannelWrapper{constructor(H,$){super(H);this.channel=$,this.refCount=0,this.subchannelStateListener=(A,L,I,D)=>{$.throttleKeepalive(D)}}ref(){if(this.refCount===0)this.child.addConnectivityStateListener(this.subchannelStateListener),this.channel.addWrappedSubchannel(this);this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0)this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this)}}class VED{pick(H){return{pickResultType:lCA.PickResultType.DROP,status:{code:zo.Status.UNAVAILABLE,details:"Channel closed before call started",metadata:new Ri9.Metadata},subchannel:null,onCallStarted:null,onCallEnded:null}}}V0H.SUBCHANNEL_ARGS_EXCLUDE_KEY_PREFIX="grpc.internal.no_subchannel";class PED{constructor(H){this.target=H,this.trace=new _hH.ChannelzTrace,this.callTracker=new _hH.ChannelzCallTracker,this.childrenTracker=new _hH.ChannelzChildrenTracker,this.state=rT.ConnectivityState.IDLE}getChannelzInfoCallback(){return()=>{return{target:this.target,state:this.state,trace:this.trace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}}}class _ED{constructor(H,$,A){var L,I,D,B,f,E;if(this.credentials=$,this.options=A,this.connectivityState=rT.ConnectivityState.IDLE,this.currentPicker=new lCA.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.callRefTimer=null,this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.randomChannelId=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER),typeof H!=="string")throw TypeError("Channel target must be a string");if(!($ instanceof xi9.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(A){if(typeof A!=="object")throw TypeError("Channel options must be an object")}this.channelzInfoTracker=new PED(H);let M=(0,a3$.parseUri)(H);if(M===null)throw Error(`Could not parse target name "${H}"`);let G=(0,QED.mapUriDefaultScheme)(M);if(G===null)throw Error(`Could not find a default scheme for target name "${H}"`);if(this.options["grpc.enable_channelz"]===0)this.channelzEnabled=!1;if(this.channelzRef=(0,_hH.registerChannelzChannel)(H,this.channelzInfoTracker.getChannelzInfoCallback(),this.channelzEnabled),this.channelzEnabled)this.channelzInfoTracker.trace.addTrace("CT_INFO","Channel created");if(this.options["grpc.default_authority"])this.defaultAuthority=this.options["grpc.default_authority"];else this.defaultAuthority=(0,QED.getDefaultAuthority)(G);let U=(0,hi9.mapProxyName)(G,A);this.target=U.target,this.options=Object.assign({},this.options,U.extraOptions),this.subchannelPool=(0,ji9.getSubchannelPool)(((L=this.options["grpc.use_local_subchannel_pool"])!==null&&L!==void 0?L:0)===0),this.retryBufferTracker=new cCA.MessageBufferTracker((I=this.options["grpc.retry_buffer_size"])!==null&&I!==void 0?I:li9,(D=this.options["grpc.per_rpc_retry_buffer_size"])!==null&&D!==void 0?D:ii9),this.keepaliveTime=(B=this.options["grpc.keepalive_time_ms"])!==null&&B!==void 0?B:-1,this.idleTimeoutMs=Math.max((f=this.options["grpc.client_idle_timeout_ms"])!==null&&f!==void 0?f:ci9,di9);let X={createSubchannel:(F,Q)=>{let W={};for(let[C,Z]of Object.entries(Q))if(!C.startsWith(V0H.SUBCHANNEL_ARGS_EXCLUDE_KEY_PREFIX))W[C]=Z;let P=this.subchannelPool.getOrCreateSubchannel(this.target,F,W,this.credentials);if(P.throttleKeepalive(this.keepaliveTime),this.channelzEnabled)this.channelzInfoTracker.trace.addTrace("CT_INFO","Created subchannel or used existing subchannel",P.getChannelzRef());return new WED(P,this)},updateState:(F,Q)=>{this.currentPicker=Q;let W=this.pickQueue.slice();if(this.pickQueue=[],W.length>0)this.callRefTimerUnref();for(let P of W)P.doPick();this.updateState(F)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:(F)=>{if(this.channelzEnabled)this.channelzInfoTracker.childrenTracker.refChild(F)},removeChannelzChild:(F)=>{if(this.channelzEnabled)this.channelzInfoTracker.childrenTracker.unrefChild(F)}};this.resolvingLoadBalancer=new Si9.ResolvingLoadBalancer(this.target,X,this.options,(F,Q)=>{var W;if(F.retryThrottling)o3$.set(this.getTarget(),new cCA.RetryThrottler(F.retryThrottling.maxTokens,F.retryThrottling.tokenRatio,o3$.get(this.getTarget())));else o3$.delete(this.getTarget());if(this.channelzEnabled)this.channelzInfoTracker.trace.addTrace("CT_INFO","Address resolution succeeded");(W=this.configSelector)===null||W===void 0||W.unref(),this.configSelector=Q,this.currentResolutionError=null,process.nextTick(()=>{let P=this.configSelectionQueue;if(this.configSelectionQueue=[],P.length>0)this.callRefTimerUnref();for(let Y of P)Y.getConfig()})},(F)=>{if(this.channelzEnabled)this.channelzInfoTracker.trace.addTrace("CT_WARNING","Address resolution failed with code "+F.code+' and details "'+F.details+'"');if(this.configSelectionQueue.length>0)this.trace("Name resolution failed with calls queued for config selection");if(this.configSelector===null)this.currentResolutionError=Object.assign(Object.assign({},(0,gi9.restrictControlPlaneStatusCode)(F.code,F.details)),{metadata:F.metadata});let Q=this.configSelectionQueue;if(this.configSelectionQueue=[],Q.length>0)this.callRefTimerUnref();for(let W of Q)W.reportResolverError(F)}),this.filterStackFactory=new yi9.FilterStackFactory([new vi9.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(A,void 0,2));let J=Error();if((0,r3$.isTracerEnabled)("channel_stacktrace"))(0,r3$.trace)(zo.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
${L}`;throw new JR(I)}var qZI,m59,p59;var tFH=K(()=>{TQ();dG();E$();UJ();_L();lg();qZI=require("crypto"),m59=/```!\s*\n?([\s\S]*?)\n?```/g,p59=/(?<!\w|\$)!`([^`]+)`/g});var zZI,c59,l59,i59,n59,r59,a59,o59,t59,s59,iDE,JX$,nDE;var vjH=K(()=>{tTH();zZI=N2({command:bL(),args:UX(bL()).optional(),env:MO(bL(),bL()).optional()}),c59=N2({name:bL(),email:bL().email().optional(),url:bL().url().optional()}),l59=N2({type:bL(),url:bL().url()}),i59=zZI.partial(),n59=zZI.extend({platform_overrides:MO(bL(),i59).optional()}),r59=N2({type:GO(["python","node","binary"]),entry_point:bL(),mcp_config:n59}),a59=N2({claude_desktop:bL().optional(),platforms:UX(GO(["darwin","win32","linux"])).optional(),runtimes:N2({python:bL().optional(),node:bL().optional()}).optional()}).passthrough(),o59=N2({name:bL(),description:bL().optional()}),t59=N2({name:bL(),description:bL().optional(),arguments:UX(bL()).optional(),text:bL()}),s59=N2({type:GO(["string","number","boolean","directory","file"]),title:bL(),description:bL(),required:FQ().optional(),default:gAH([bL(),Cq(),FQ(),UX(bL())]).optional(),multiple:FQ().optional(),sensitive:FQ().optional(),min:Cq().optional(),max:Cq().optional()}),iDE=MO(bL(),gAH([bL(),Cq(),FQ(),UX(bL())])),JX$=N2({$schema:bL().optional(),dxt_version:bL().optional().describe("@deprecated Use manifest_version instead"),manifest_version:bL().optional(),name:bL(),display_name:bL().optional(),version:bL(),description:bL(),long_description:bL().optional(),author:c59,repository:l59.optional(),homepage:bL().url().optional(),documentation:bL().url().optional(),support:bL().url().optional(),icon:bL().optional(),screenshots:UX(bL()).optional(),server:r59,tools:UX(o59).optional(),tools_generated:FQ().optional(),prompts:UX(t59).optional(),prompts_generated:FQ().optional(),keywords:UX(bL()).optional(),license:bL().optional(),privacy_policies:UX(bL()).optional(),compatibility:a59.optional(),user_config:MO(bL(),s59).optional()}).refine((H)=>!!(H.dxt_version||H.manifest_version),{message:"Either 'dxt_version' (deprecated) or 'manifest_version' must be provided"}),nDE=N2({status:GO(["signed","unsigned","self-signed"]),publisher:bL().optional(),issuer:bL().optional(),valid_from:bL().optional(),valid_to:bL().optional(),fingerprint:bL().optional()})});var JKA=K(()=>{vjH()});function XX9(H,$){return GX9(H,{i:2},$&&$.out,$&&$.dictionary)}function KX9(H,$){if($){var A="";for(var L=0;L<H.length;L+=16384)A+=String.fromCharCode.apply(null,H.subarray(L,L+16384));return A}else if(VKA)return VKA.decode(H);else{var I=FX9(H),D=I.s,A=I.r;if(A.length)JT(8);return D}}function hZI(H,$){var A={},L=H.length-22;for(;Jx(H,L)!=101010256;--L)if(!L||H.length-L>65558)JT(13);var I=Xv(H,L+8);if(!I)return{};var D=Jx(H,L+16),B=D==4294967295||I==65535;if(B){var f=Jx(H,L-12);if(B=Jx(H,f)==101075792,B)I=Jx(H,f+32),D=Jx(H,f+48)}var E=$&&$.filter;for(var M=0;M<I;++M){var G=WX9(H,D,B),U=G[0],X=G[1],J=G[2],F=G[3],Q=G[4],W=G[5],P=QX9(H,W);if(D=Q,!E||E({name:F,size:X,originalSize:J,compression:U}))if(!U)A[F]=PKA(H,P,P+X);else if(U==8)A[F]=XX9(H.subarray(P,P+X),{out:new Hw(J)});else JT(14,"unknown compression type "+U)}return A}var NZI,HX9,$X9,Hw,sFH,AX9,OZI,xZI,LX9,SZI=function(H,$){var A=new sFH(31);for(var L=0;L<31;++L)A[L]=$+=1<<H[L-1];var I=new AX9(A[30]);for(var L=1;L<30;++L)for(var D=A[L];D<A[L+1];++D)I[D]=D-A[L]<<5|L;return{b:A,r:I}},jZI,RZI,IX9,yZI,DX9,tDE,WKA,Uv,O8,hjH=function(H,$,A){var L=H.length,I=0,D=new sFH($);for(;I<L;++I)if(H[I])++D[H[I]-1];var B=new sFH($);for(I=1;I<$;++I)B[I]=B[I-1]+D[I-1]<<1;var f;if(A){f=new sFH(1<<$);var E=15-$;for(I=0;I<L;++I)if(H[I]){var M=I<<4|H[I],G=$-H[I],U=B[H[I]-1]++<<G;for(var X=U|(1<<G)-1;U<=X;++U)f[WKA[U]>>E]=M}}else{f=new sFH(L);for(I=0;I<L;++I)if(H[I])f[I]=WKA[B[H[I]-1]++]>>15-H[I]}return f},bjH,O8,O8,O8,O8,vZI,O8,BX9,fX9,FKA=function(H){var $=H[0];for(var A=1;A<H.length;++A)if(H[A]>$)$=H[A];return $},Xx=function(H,$,A){var L=$/8|0;return(H[L]|H[L+1]<<8)>>($&7)&A},KKA=function(H,$){var A=$/8|0;return(H[A]|H[A+1]<<8|H[A+2]<<16)>>($&7)},EX9=function(H){return(H+7)/8|0},PKA=function(H,$,A){if($==null||$<0)$=0;if(A==null||A>H.length)A=H.length;return new Hw(H.subarray($,A))},MX9,JT=function(H,$,A){var L=Error($||MX9[H]);if(L.code=H,Error.captureStackTrace)Error.captureStackTrace(L,JT);if(!A)throw L;return L},GX9=function(H,$,A,L){var I=H.length,D=L?L.length:0;if(!I||$.f&&!$.l)return A||new Hw(0);var B=!A,f=B||$.i!=2,E=$.i;if(B)A=new Hw(I*3);var M=function(DH){var MH=A.length;if(DH>MH){var AH=new Hw(Math.max(MH*2,DH));AH.set(A),A=AH}},G=$.f||0,U=$.p||0,X=$.b||0,J=$.l,F=$.d,Q=$.m,W=$.n,P=I*8;do{if(!J){G=Xx(H,U,1);var Y=Xx(H,U+1,3);if(U+=3,!Y){var C=EX9(U)+4,Z=H[C-4]|H[C-3]<<8,q=C+Z;if(q>I){if(E)JT(0);break}if(f)M(X+Z);A.set(H.subarray(C,q),X),$.b=X+=Z,$.p=U=q*8,$.f=G;continue}else if(Y==1)J=BX9,F=fX9,Q=9,W=5;else if(Y==2){var O=Xx(H,U,31)+257,j=Xx(H,U+10,15)+4,u=O+Xx(H,U+5,31)+1;U+=14;var y=new Hw(u),g=new Hw(19);for(var v=0;v<j;++v)g[LX9[v]]=Xx(H,U+v*3,7);U+=j*3;var p=FKA(g),d=(1<<p)-1,k=hjH(g,p,1);for(var v=0;v<u;){var n=k[Xx(H,U,d)];U+=n&15;var C=n>>4;if(C<16)y[v++]=C;else{var GH=0,e=0;if(C==16)e=3+Xx(H,U,3),U+=2,GH=y[v-1];else if(C==17)e=3+Xx(H,U,7),U+=3;else if(C==18)e=11+Xx(H,U,127),U+=7;while(e--)y[v++]=GH}}var BH=y.subarray(0,O),VH=y.subarray(O);Q=FKA(BH),W=FKA(VH),J=hjH(BH,Q,1),F=hjH(VH,W,1)}else JT(1);if(U>P){if(E)JT(0);break}}if(f)M(X+131072);var wH=(1<<Q)-1,WH=(1<<W)-1,qH=U;for(;;qH=U){var GH=J[KKA(H,U)&wH],s=GH>>4;if(U+=GH&15,U>P){if(E)JT(0);break}if(!GH)JT(2);if(s<256)A[X++]=s;else if(s==256){qH=U,J=null;break}else{var IH=s-254;if(s>264){var v=s-257,FH=OZI[v];IH=Xx(H,U,(1<<FH)-1)+RZI[v],U+=FH}var EH=F[KKA(H,U)&WH],YH=EH>>4;if(!EH)JT(3);U+=EH&15;var VH=DX9[YH];if(YH>3){var FH=xZI[YH];VH+=KKA(H,U)&(1<<FH)-1,U+=FH}if(U>P){if(E)JT(0);break}if(f)M(X+131072);var OH=X+IH;if(X<VH){var HH=D-VH,$H=Math.min(VH,OH);if(HH+X<0)JT(3);for(;X<$H;++X)A[X]=L[HH+X]}for(;X<OH;++X)A[X]=A[X-VH]}}if($.l=J,$.p=qH,$.b=X,$.f=G,J)G=1,$.m=Q,$.d=F,$.n=W}while(!G);return X!=A.length&&B?PKA(A,0,X):A.subarray(0,X)},UX9,Xv=function(H,$){return H[$]|H[$+1]<<8},Jx=function(H,$){return(H[$]|H[$+1]<<8|H[$+2]<<16|H[$+3]<<24)>>>0},QKA=function(H,$){return Jx(H,$)+Jx(H,$+4)*4294967296},VKA,JX9=0,FX9=function(H){for(var $="",A=0;;){var L=H[A++],I=(L>127)+(L>223)+(L>239);if(A+I>H.length)return{s:$,r:PKA(H,A-1)};if(!I)$+=String.fromCharCode(L);else if(I==3)L=((L&15)<<18|(H[A++]&63)<<12|(H[A++]&63)<<6|H[A++]&63)-65536,$+=String.fromCharCode(55296|L>>10,56320|L&1023);else if(I&1)$+=String.fromCharCode((L&31)<<6|H[A++]&63);else $+=String.fromCharCode((L&15)<<12|(H[A++]&63)<<6|H[A++]&63)}},QX9=function(H,$){return $+30+Xv(H,$+26)+Xv(H,$+28)},WX9=function(H,$,A){var L=Xv(H,$+28),I=KX9(H.subarray($+46,$+46+L),!(Xv(H,$+8)&2048)),D=$+46+L,B=Jx(H,$+20),f=A&&B==4294967295?VX9(H,D):[B,Jx(H,$+24),Jx(H,$+42)],E=f[0],M=f[1],G=f[2];return[Xv(H,$+10),E,M,I,D+Xv(H,$+30)+Xv(H,$+32),G]},VX9=function(H,$){for(;Xv(H,$)!=1;$+=4+Xv(H,$+2));return[QKA(H,$+12),QKA(H,$+4),QKA(H,$+20)]};var bZI=K(()=>{NZI=require("module"),HX9=NZI.createRequire("/");try{$X9=HX9("worker_threads").Worker}catch(H){}Hw=Uint8Array,sFH=Uint16Array,AX9=Int32Array,OZI=new Hw([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),xZI=new Hw([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),LX9=new Hw([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),jZI=SZI(OZI,2),RZI=jZI.b,IX9=jZI.r;RZI[28]=258,IX9[258]=28;yZI=SZI(xZI,0),DX9=yZI.b,tDE=yZI.r,WKA=new sFH(32768);for(O8=0;O8<32768;++O8)Uv=(O8&43690)>>1|(O8&21845)<<1,Uv=(Uv&52428)>>2|(Uv&13107)<<2,Uv=(Uv&61680)>>4|(Uv&3855)<<4,WKA[O8]=((Uv&65280)>>8|(Uv&255)<<8)>>1;bjH=new Hw(288);for(O8=0;O8<144;++O8)bjH[O8]=8;for(O8=144;O8<256;++O8)bjH[O8]=9;for(O8=256;O8<280;++O8)bjH[O8]=7;for(O8=280;O8<288;++O8)bjH[O8]=8;vZI=new Hw(32);for(O8=0;O8<32;++O8)vZI[O8]=5;BX9=hjH(bjH,9,1),fX9=hjH(vZI,5,1),MX9=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],UX9=new Hw(0);VKA=typeof TextDecoder<"u"&&new TextDecoder;try{VKA.decode(UX9,{stream:!0}),JX9=1}catch(H){}});var ujH=z((eDE,QX$)=>{function gZI(H){return Array.isArray(H)?H:[H]}var PX9=void 0,CKA="",kZI=" ",_KA="\\",_X9=/^\s+$/,CX9=/(?:[^\\]|^)\\$/,YX9=/^\\!/,wX9=/^\\#/,ZX9=/\r?\n/g,qX9=/^\.{0,2}\/|^\.{1,2}$/,TX9=/\/$/,eFH="/",mZI="node-ignore";if(typeof Symbol<"u")mZI=Symbol.for("node-ignore");var pZI=mZI,HKH=(H,$,A)=>{return Object.defineProperty(H,$,{value:A}),A},zX9=/([0-z])-([0-z])/g,dZI=()=>!1,NX9=(H)=>H.replace(zX9,($,A,L)=>A.charCodeAt(0)<=L.charCodeAt(0)?$:CKA),OX9=(H)=>{let{length:$}=H;return H.slice(0,$-$%2)},xX9=[[/^\uFEFF/,()=>CKA],[/((?:\\\\)*?)(\\?\s+)$/,(H,$,A)=>$+(A.indexOf("\\")===0?kZI:CKA)],[/(\\+?)\s/g,(H,$)=>{let{length:A}=$;return $.slice(0,A-A%2)+kZI}],[/[\\$.|*+(){^]/g,(H)=>`\\${H}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return!/\/(?!$)/.test(this)?"(?:^|\\/)":"^"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(H,$,A)=>$+6<A.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(H,$,A)=>{let L=A.replace(/\\\*/g,"[^\\/]*");return $+L}],[/\\\\\\(?=[$.|*+(){^])/g,()=>_KA],[/\\\\/g,()=>_KA],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(H,$,A,L,I)=>$===_KA?`\\[${A}${OX9(L)}${I}`:I==="]"?L.length%2===0?`[${NX9(A)}${L}]`:"[]":"[]"],[/(?:[^*])$/,(H)=>/\/$/.test(H)?`${H}$`:`${H}(?=$|\\/$)`]],SX9=/(^|\\\/)?\\\*$/,kjH="regex",FX$="checkRegex",uZI="_",jX9={[kjH](H,$){return`${$?`${$}[^/]+`:"[^/]*"}(?=$|\\/$)`},[FX$](H,$){return`${$?`${$}[^/]*`:"[^/]*"}(?=$|\\/$)`}},RX9=(H)=>xX9.reduce(($,[A,L])=>$.replace(A,L.bind(H)),H),KX$=(H)=>typeof H==="string",yX9=(H)=>H&&KX$(H)&&!_X9.test(H)&&!CX9.test(H)&&H.indexOf("#")!==0,vX9=(H)=>H.split(ZX9).filter(Boolean);class cZI{constructor(H,$,A,L,I,D){this.pattern=H,this.mark=$,this.negative=I,HKH(this,"body",A),HKH(this,"ignoreCase",L),HKH(this,"regexPrefix",D)}get regex(){let H=uZI+kjH;if(this[H])return this[H];return this._make(kjH,H)}get checkRegex(){let H=uZI+FX$;if(this[H])return this[H];return this._make(FX$,H)}_make(H,$){let A=this.regexPrefix.replace(SX9,jX9[H]),L=this.ignoreCase?new RegExp(A,"i"):new RegExp(A);return HKH(this,$,L)}}var hX9=({pattern:H,mark:$},A)=>{let L=!1,I=H;if(I.indexOf("!")===0)L=!0,I=I.substr(1);I=I.replace(YX9,"!").replace(wX9,"#");let D=RX9(I);return new cZI(H,$,I,A,L,D)};class lZI{constructor(H){this._ignoreCase=H,this._rules=[]}_add(H){if(H&&H[pZI]){this._rules=this._rules.concat(H._rules._rules),this._added=!0;return}if(KX$(H))H={pattern:H};if(yX9(H.pattern)){let $=hX9(H,this._ignoreCase);this._added=!0,this._rules.push($)}}add(H){return this._added=!1,gZI(KX$(H)?vX9(H):H).forEach(this._add,this),this._added}test(H,$,A){let L=!1,I=!1,D;this._rules.forEach((f)=>{let{negative:E}=f;if(I===E&&L!==I||E&&!L&&!I&&!$)return;if(!f[A].test(H))return;L=!E,I=E,D=E?PX9:f});let B={ignored:L,unignored:I};if(D)B.rule=D;return B}}var bX9=(H,$)=>{throw new $(H)},ag=(H,$,A)=>{if(!KX$(H))return A(`path must be a string, but got \`${$}\``,TypeError);if(!H)return A("path must not be empty",TypeError);if(ag.isNotRelative(H))return A(`path should be a \`path.relative()\`d string, but got "${$}"`,RangeError);return!0},iZI=(H)=>qX9.test(H);ag.isNotRelative=iZI;ag.convert=(H)=>H;class nZI{constructor({ignorecase:H=!0,ignoreCase:$=H,allowRelativePaths:A=!1}={}){HKH(this,pZI,!0),this._rules=new lZI($),this._strictPathCheck=!A,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}add(H){if(this._rules.add(H))this._initCache();return this}addPattern(H){return this.add(H)}_test(H,$,A,L){let I=H&&ag.convert(H);return ag(I,H,this._strictPathCheck?bX9:dZI),this._t(I,$,A,L)}checkIgnore(H){if(!TX9.test(H))return this.test(H);let $=H.split(eFH).filter(Boolean);if($.pop(),$.length){let A=this._t($.join(eFH)+eFH,this._testCache,!0,$);if(A.ignored)return A}return this._rules.test(H,!1,FX$)}_t(H,$,A,L){if(H in $)return $[H];if(!L)L=H.split(eFH).filter(Boolean);if(L.pop(),!L.length)return $[H]=this._rules.test(H,A,kjH);let I=this._t(L.join(eFH)+eFH,$,A,L);return $[H]=I.ignored?I:this._rules.test(H,A,kjH)}ignores(H){return this._test(H,this._ignoreCache,!1).ignored}createFilter(){return(H)=>!this.ignores(H)}filter(H){return gZI(H).filter(this.createFilter())}test(H){return this._test(H,this._testCache,!0)}}var YKA=(H)=>new nZI(H),kX9=(H)=>ag(H&&ag.convert(H),H,dZI),uX9=()=>{let H=(A)=>/^\\\\\?\\/.test(A)||/["<>|\u0000-\u001F]+/u.test(A)?A:A.replace(/\\/g,"/");ag.convert=H;let $=/^[a-z]:\//i;ag.isNotRelative=(A)=>$.test(A)||iZI(A)};QX$.exports=YKA;YKA.default=YKA;QX$.exports.isPathValid=kX9;HKH(QX$.exports,Symbol.for("setupWindows"),uX9)});var gX9;var wKA=K(()=>{gX9=h(ujH(),1)});var IU=z((ZKA)=>{ZKA.fromCallback=function(H){return Object.defineProperty(function(...$){if(typeof $[$.length-1]==="function")H.apply(this,$);else return new Promise((A,L)=>{$.push((I,D)=>I!=null?L(I):A(D)),H.apply(this,$)})},"name",{value:H.name})};ZKA.fromPromise=function(H){return Object.defineProperty(function(...$){let A=$[$.length-1];if(typeof A!=="function")return H.apply(this,$);else $.pop(),H.apply(this,$).then((L)=>A(null,L),A)},"name",{value:H.name})}});var YDH=z((Da)=>{var rZI=IU().fromCallback,VC=ZE(),mX9=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchmod","lchown","link","lstat","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","rename","rm","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter((H)=>{return typeof VC[H]==="function"});Object.assign(Da,VC);mX9.forEach((H)=>{Da[H]=rZI(VC[H])});Da.exists=function(H,$){if(typeof $==="function")return VC.exists(H,$);return new Promise((A)=>{return VC.exists(H,A)})};Da.read=function(H,$,A,L,I,D){if(typeof D==="function")return VC.read(H,$,A,L,I,D);return new Promise((B,f)=>{VC.read(H,$,A,L,I,(E,M,G)=>{if(E)return f(E);B({bytesRead:M,buffer:G})})})};Da.write=function(H,$,...A){if(typeof A[A.length-1]==="function")return VC.write(H,$,...A);return new Promise((L,I)=>{VC.write(H,$,...A,(D,B,f)=>{if(D)return I(D);L({bytesWritten:B,buffer:f})})})};if(typeof VC.writev==="function")Da.writev=function(H,$,...A){if(typeof A[A.length-1]==="function")return VC.writev(H,$,...A);return new Promise((L,I)=>{VC.writev(H,$,...A,(D,B,f)=>{if(D)return I(D);L({bytesWritten:B,buffers:f})})})};if(typeof VC.realpath.native==="function")Da.realpath.native=rZI(VC.realpath.native);else process.emitWarning("fs.realpath.native is not a function. Is fs being monkey-patched?","Warning","fs-extra-WARN0003")});var oZI=z((IBE,aZI)=>{var LBE=require("path");aZI.exports.checkPath=function($){}});var HqI=z((DBE,qKA)=>{var tZI=YDH(),{checkPath:sZI}=oZI(),eZI=(H)=>{let $={mode:511};if(typeof H==="number")return H;return{...$,...H}.mode};qKA.exports.makeDir=async(H,$)=>{return sZI(H),tZI.mkdir(H,{mode:eZI($),recursive:!0})};qKA.exports.makeDirSync=(H,$)=>{return sZI(H),tZI.mkdirSync(H,{mode:eZI($),recursive:!0})}});var Fx=z((BBE,$qI)=>{var pX9=IU().fromPromise,{makeDir:dX9,makeDirSync:TKA}=HqI(),zKA=pX9(dX9);$qI.exports={mkdirs:zKA,mkdirsSync:TKA,mkdirp:zKA,mkdirpSync:TKA,ensureDir:zKA,ensureDirSync:TKA}});var Ba=z((fBE,LqI)=>{var cX9=IU().fromPromise,AqI=YDH();function lX9(H){return AqI.access(H).then(()=>!0).catch(()=>!1)}LqI.exports={pathExists:cX9(lX9),pathExistsSync:AqI.existsSync}});var NKA=z((EBE,IqI)=>{var $KH=ZE();function iX9(H,$,A,L){$KH.open(H,"r+",(I,D)=>{if(I)return L(I);$KH.futimes(D,$,A,(B)=>{$KH.close(D,(f)=>{if(L)L(B||f)})})})}function nX9(H,$,A){let L=$KH.openSync(H,"r+");return $KH.futimesSync(L,$,A),$KH.closeSync(L)}IqI.exports={utimesMillis:iX9,utimesMillisSync:nX9}});var wDH=z((MBE,fqI)=>{var AKH=YDH(),zQ=require("path"),rX9=require("util");function aX9(H,$,A){let L=A.dereference?(I)=>AKH.stat(I,{bigint:!0}):(I)=>AKH.lstat(I,{bigint:!0});return Promise.all([L(H),L($).catch((I)=>{if(I.code==="ENOENT")return null;throw I})]).then(([I,D])=>({srcStat:I,destStat:D}))}function oX9(H,$,A){let L,I=A.dereference?(B)=>AKH.statSync(B,{bigint:!0}):(B)=>AKH.lstatSync(B,{bigint:!0}),D=I(H);try{L=I($)}catch(B){if(B.code==="ENOENT")return{srcStat:D,destStat:null};throw B}return{srcStat:D,destStat:L}}function tX9(H,$,A,L,I){rX9.callbackify(aX9)(H,$,L,(D,B)=>{if(D)return I(D);let{srcStat:f,destStat:E}=B;if(E){if(gjH(f,E)){let M=zQ.basename(H),G=zQ.basename($);if(A==="move"&&M!==G&&M.toLowerCase()===G.toLowerCase())return I(null,{srcStat:f,destStat:E,isChangingCase:!0});return I(Error("Source and destination must not be the same."))}if(f.isDirectory()&&!E.isDirectory())return I(Error(`Cannot overwrite non-directory '${$}' with directory '${H}'.`));if(!f.isDirectory()&&E.isDirectory())return I(Error(`Cannot overwrite directory '${$}' with non-directory '${H}'.`))}if(f.isDirectory()&&OKA(H,$))return I(Error(WX$(H,$,A)));return I(null,{srcStat:f,destStat:E})})}function sX9(H,$,A,L){let{srcStat:I,destStat:D}=oX9(H,$,L);if(D){if(gjH(I,D)){let B=zQ.basename(H),f=zQ.basename($);if(A==="move"&&B!==f&&B.toLowerCase()===f.toLowerCase())return{srcStat:I,destStat:D,isChangingCase:!0};throw Error("Source and destination must not be the same.")}if(I.isDirectory()&&!D.isDirectory())throw Error(`Cannot overwrite non-directory '${$}' with directory '${H}'.`);if(!I.isDirectory()&&D.isDirectory())throw Error(`Cannot overwrite directory '${$}' with non-directory '${H}'.`)}if(I.isDirectory()&&OKA(H,$))throw Error(WX$(H,$,A));return{srcStat:I,destStat:D}}function DqI(H,$,A,L,I){let D=zQ.resolve(zQ.dirname(H)),B=zQ.resolve(zQ.dirname(A));if(B===D||B===zQ.parse(B).root)return I();AKH.stat(B,{bigint:!0},(f,E)=>{if(f){if(f.code==="ENOENT")return I();return I(f)}if(gjH($,E))return I(Error(WX$(H,A,L)));return DqI(H,$,B,L,I)})}function BqI(H,$,A,L){let I=zQ.resolve(zQ.dirname(H)),D=zQ.resolve(zQ.dirname(A));if(D===I||D===zQ.parse(D).root)return;let B;try{B=AKH.statSync(D,{bigint:!0})}catch(f){if(f.code==="ENOENT")return;throw f}if(gjH($,B))throw Error(WX$(H,A,L));return BqI(H,$,D,L)}function gjH(H,$){return $.ino&&$.dev&&$.ino===H.ino&&$.dev===H.dev}function OKA(H,$){let A=zQ.resolve(H).split(zQ.sep).filter((I)=>I),L=zQ.resolve($).split(zQ.sep).filter((I)=>I);return A.reduce((I,D,B)=>I&&L[B]===D,!0)}function WX$(H,$,A){return`Cannot ${A} '${H}' to a subdirectory of itself, '${$}'.`}fqI.exports={checkPaths:tX9,checkPathsSync:sX9,checkParentPaths:DqI,checkParentPathsSync:BqI,isSrcSubdir:OKA,areIdentical:gjH}});var KqI=z((GBE,FqI)=>{var PC=ZE(),mjH=require("path"),eX9=Fx().mkdirs,HJ9=Ba().pathExists,$J9=NKA().utimesMillis,pjH=wDH();function AJ9(H,$,A,L){if(typeof A==="function"&&!L)L=A,A={};else if(typeof A==="function")A={filter:A};L=L||function(){},A=A||{},A.clobber="clobber"in A?!!A.clobber:!0,A.overwrite="overwrite"in A?!!A.overwrite:A.clobber,A.preserveTimestamps,pjH.checkPaths(H,$,"copy",A,(I,D)=>{if(I)return L(I);let{srcStat:B,destStat:f}=D;pjH.checkParentPaths(H,B,$,"copy",(E)=>{if(E)return L(E);if(A.filter)return GqI(EqI,f,H,$,A,L);return EqI(f,H,$,A,L)})})}function EqI(H,$,A,L,I){let D=mjH.dirname(A);HJ9(D,(B,f)=>{if(B)return I(B);if(f)return VX$(H,$,A,L,I);eX9(D,(E)=>{if(E)return I(E);return VX$(H,$,A,L,I)})})}function GqI(H,$,A,L,I,D){Promise.resolve(I.filter(A,L)).then((B)=>{if(B)return H($,A,L,I,D);return D()},(B)=>D(B))}function LJ9(H,$,A,L,I){if(L.filter)return GqI(VX$,H,$,A,L,I);return VX$(H,$,A,L,I)}function VX$(H,$,A,L,I){(L.dereference?PC.stat:PC.lstat)($,(B,f)=>{if(B)return I(B);if(f.isDirectory())return GJ9(f,H,$,A,L,I);else if(f.isFile()||f.isCharacterDevice()||f.isBlockDevice())return IJ9(f,H,$,A,L,I);else if(f.isSymbolicLink())return JJ9(H,$,A,L,I);else if(f.isSocket())return I(Error(`Cannot copy a socket file: ${$}`));else if(f.isFIFO())return I(Error(`Cannot copy a FIFO pipe: ${$}`));return I(Error(`Unknown file: ${$}`))})}function IJ9(H,$,A,L,I,D){if(!$)return UqI(H,A,L,I,D);return DJ9(H,A,L,I,D)}function DJ9(H,$,A,L,I){if(L.overwrite)PC.unlink(A,(D)=>{if(D)return I(D);return UqI(H,$,A,L,I)});else if(L.errorOnExist)return I(Error(`'${A}' already exists`));else return I()}function UqI(H,$,A,L,I){PC.copyFile($,A,(D)=>{if(D)return I(D);if(L.preserveTimestamps)return BJ9(H.mode,$,A,I);return PX$(A,H.mode,I)})}function BJ9(H,$,A,L){if(fJ9(H))return EJ9(A,H,(I)=>{if(I)return L(I);return MqI(H,$,A,L)});return MqI(H,$,A,L)}function fJ9(H){return(H&128)===0}function EJ9(H,$,A){return PX$(H,$|128,A)}function MqI(H,$,A,L){MJ9($,A,(I)=>{if(I)return L(I);return PX$(A,H,L)})}function PX$(H,$,A){return PC.chmod(H,$,A)}function MJ9(H,$,A){PC.stat(H,(L,I)=>{if(L)return A(L);return $J9($,I.atime,I.mtime,A)})}function GJ9(H,$,A,L,I,D){if(!$)return UJ9(H.mode,A,L,I,D);return XqI(A,L,I,D)}function UJ9(H,$,A,L,I){PC.mkdir(A,(D)=>{if(D)return I(D);XqI($,A,L,(B)=>{if(B)return I(B);return PX$(A,H,I)})})}function XqI(H,$,A,L){PC.readdir(H,(I,D)=>{if(I)return L(I);return JqI(D,H,$,A,L)})}function JqI(H,$,A,L,I){let D=H.pop();if(!D)return I();return XJ9(H,D,$,A,L,I)}function XJ9(H,$,A,L,I,D){let B=mjH.join(A,$),f=mjH.join(L,$);pjH.checkPaths(B,f,"copy",I,(E,M)=>{if(E)return D(E);let{destStat:G}=M;LJ9(G,B,f,I,(U)=>{if(U)return D(U);return JqI(H,A,L,I,D)})})}function JJ9(H,$,A,L,I){PC.readlink($,(D,B)=>{if(D)return I(D);if(L.dereference)B=mjH.resolve(process.cwd(),B);if(!H)return PC.symlink(B,A,I);else PC.readlink(A,(f,E)=>{if(f){if(f.code==="EINVAL"||f.code==="UNKNOWN")return PC.symlink(B,A,I);return I(f)}if(L.dereference)E=mjH.resolve(process.cwd(),E);if(pjH.isSrcSubdir(B,E))return I(Error(`Cannot copy '${B}' to a subdirectory of itself, '${E}'.`));if(H.isDirectory()&&pjH.isSrcSubdir(E,B))return I(Error(`Cannot overwrite '${E}' with '${B}'.`));return FJ9(B,A,I)})})}function FJ9(H,$,A){PC.unlink($,(L)=>{if(L)return A(L);return PC.symlink(H,$,A)})}FqI.exports=AJ9});var _qI=z((UBE,PqI)=>{var A3=ZE(),djH=require("path"),KJ9=Fx().mkdirsSync,QJ9=NKA().utimesMillisSync,cjH=wDH();function WJ9(H,$,A){if(typeof A==="function")A={filter:A};A=A||{},A.clobber="clobber"in A?!!A.clobber:!0,A.overwrite="overwrite"in A?!!A.overwrite:A.clobber,A.preserveTimestamps;let{srcStat:L,destStat:I}=cjH.checkPathsSync(H,$,"copy",A);return cjH.checkParentPathsSync(H,L,$,"copy"),VJ9(I,H,$,A)}function VJ9(H,$,A,L){if(L.filter&&!L.filter($,A))return;let I=djH.dirname(A);if(!A3.existsSync(I))KJ9(I);return QqI(H,$,A,L)}function PJ9(H,$,A,L){if(L.filter&&!L.filter($,A))return;return QqI(H,$,A,L)}function QqI(H,$,A,L){let D=(L.dereference?A3.statSync:A3.lstatSync)($);if(D.isDirectory())return TJ9(D,H,$,A,L);else if(D.isFile()||D.isCharacterDevice()||D.isBlockDevice())return _J9(D,H,$,A,L);else if(D.isSymbolicLink())return OJ9(H,$,A,L);else if(D.isSocket())throw Error(`Cannot copy a socket file: ${$}`);else if(D.isFIFO())throw Error(`Cannot copy a FIFO pipe: ${$}`);throw Error(`Unknown file: ${$}`)}function _J9(H,$,A,L,I){if(!$)return WqI(H,A,L,I);return CJ9(H,A,L,I)}function CJ9(H,$,A,L){if(L.overwrite)return A3.unlinkSync(A),WqI(H,$,A,L);else if(L.errorOnExist)throw Error(`'${A}' already exists`)}function WqI(H,$,A,L){if(A3.copyFileSync($,A),L.preserveTimestamps)YJ9(H.mode,$,A);return xKA(A,H.mode)}function YJ9(H,$,A){if(wJ9(H))ZJ9(A,H);return qJ9($,A)}function wJ9(H){return(H&128)===0}function ZJ9(H,$){return xKA(H,$|128)}function xKA(H,$){return A3.chmodSync(H,$)}function qJ9(H,$){let A=A3.statSync(H);return QJ9($,A.atime,A.mtime)}function TJ9(H,$,A,L,I){if(!$)return zJ9(H.mode,A,L,I);return VqI(A,L,I)}function zJ9(H,$,A,L){return A3.mkdirSync(A),VqI($,A,L),xKA(A,H)}function VqI(H,$,A){A3.readdirSync(H).forEach((L)=>NJ9(L,H,$,A))}function NJ9(H,$,A,L){let I=djH.join($,H),D=djH.join(A,H),{destStat:B}=cjH.checkPathsSync(I,D,"copy",L);return PJ9(B,I,D,L)}function OJ9(H,$,A,L){let I=A3.readlinkSync($);if(L.dereference)I=djH.resolve(process.cwd(),I);if(!H)return A3.symlinkSync(I,A);else{let D;try{D=A3.readlinkSync(A)}catch(B){if(B.code==="EINVAL"||B.code==="UNKNOWN")return A3.symlinkSync(I,A);throw B}if(L.dereference)D=djH.resolve(process.cwd(),D);if(cjH.isSrcSubdir(I,D))throw Error(`Cannot copy '${I}' to a subdirectory of itself, '${D}'.`);if(A3.statSync(A).isDirectory()&&cjH.isSrcSubdir(D,I))throw Error(`Cannot overwrite '${D}' with '${I}'.`);return xJ9(I,A)}}function xJ9(H,$){return A3.unlinkSync($),A3.symlinkSync(H,$)}PqI.exports=WJ9});var _X$=z((XBE,CqI)=>{var SJ9=IU().fromCallback;CqI.exports={copy:SJ9(KqI()),copySync:_qI()}});var NqI=z((JBE,zqI)=>{var YqI=ZE(),ZqI=require("path"),VX=require("assert");function qqI(H){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach((A)=>{H[A]=H[A]||YqI[A],A=A+"Sync",H[A]=H[A]||YqI[A]}),H.maxBusyTries=H.maxBusyTries||3}function RKA(H,$,A){let L=0;if(typeof $==="function")A=$,$={};VX(H,"rimraf: missing path"),VX.strictEqual(typeof H,"string","rimraf: path should be a string"),VX.strictEqual(typeof A,"function","rimraf: callback function required"),VX($,"rimraf: invalid options argument provided"),VX.strictEqual(typeof $,"object","rimraf: options should be object"),qqI($),wqI(H,$,function I(D){if(D){if((D.code==="EBUSY"||D.code==="ENOTEMPTY"||D.code==="EPERM")&&L<$.maxBusyTries){L++;let B=L*100;return setTimeout(()=>wqI(H,$,I),B)}if(D.code==="ENOENT")D=null}A(D)})}function wqI(H,$,A){VX(H),VX($),VX(typeof A==="function"),$.lstat(H,(L,I)=>{if(L&&L.code==="ENOENT")return A(null);if(L&&L.code,I&&I.isDirectory())return SKA(H,$,L,A);$.unlink(H,(D)=>{if(D){if(D.code==="ENOENT")return A(null);if(D.code==="EPERM")return SKA(H,$,D,A);if(D.code==="EISDIR")return SKA(H,$,D,A)}return A(D)})})}function SKA(H,$,A,L){VX(H),VX($),VX(typeof L==="function"),$.rmdir(H,(I)=>{if(I&&(I.code==="ENOTEMPTY"||I.code==="EEXIST"||I.code==="EPERM"))jJ9(H,$,L);else if(I&&I.code==="ENOTDIR")L(A);else L(I)})}function jJ9(H,$,A){VX(H),VX($),VX(typeof A==="function"),$.readdir(H,(L,I)=>{if(L)return A(L);let D=I.length,B;if(D===0)return $.rmdir(H,A);I.forEach((f)=>{RKA(ZqI.join(H,f),$,(E)=>{if(B)return;if(E)return A(B=E);if(--D===0)$.rmdir(H,A)})})})}function TqI(H,$){let A;$=$||{},qqI($),VX(H,"rimraf: missing path"),VX.strictEqual(typeof H,"string","rimraf: path should be a string"),VX($,"rimraf: missing options"),VX.strictEqual(typeof $,"object","rimraf: options should be object");try{A=$.lstatSync(H)}catch(L){if(L.code==="ENOENT")return;L.code}try{if(A&&A.isDirectory())jKA(H,$,null);else $.unlinkSync(H)}catch(L){if(L.code==="ENOENT")return;else if(L.code==="EPERM")return jKA(H,$,L);else if(L.code!=="EISDIR")throw L;jKA(H,$,L)}}function jKA(H,$,A){VX(H),VX($);try{$.rmdirSync(H)}catch(L){if(L.code==="ENOTDIR")throw A;else if(L.code==="ENOTEMPTY"||L.code==="EEXIST"||L.code==="EPERM")RJ9(H,$);else if(L.code!=="ENOENT")throw L}}function RJ9(H,$){return VX(H),VX($),$.readdirSync(H).forEach((A)=>TqI(ZqI.join(H,A),$)),$.rmdirSync(H,$)}zqI.exports=RKA;RKA.sync=TqI});var ljH=z((FBE,xqI)=>{var CX$=ZE(),yJ9=IU().fromCallback,OqI=NqI();function vJ9(H,$){if(CX$.rm)return CX$.rm(H,{recursive:!0,force:!0},$);OqI(H,$)}function hJ9(H){if(CX$.rmSync)return CX$.rmSync(H,{recursive:!0,force:!0});OqI.sync(H)}xqI.exports={remove:yJ9(vJ9),removeSync:hJ9}});var kqI=z((KBE,bqI)=>{var bJ9=IU().fromPromise,RqI=YDH(),yqI=require("path"),vqI=Fx(),hqI=ljH(),SqI=bJ9(async function($){let A;try{A=await RqI.readdir($)}catch{return vqI.mkdirs($)}return Promise.all(A.map((L)=>hqI.remove(yqI.join($,L))))});function jqI(H){let $;try{$=RqI.readdirSync(H)}catch{return vqI.mkdirsSync(H)}$.forEach((A)=>{A=yqI.join(H,A),hqI.removeSync(A)})}bqI.exports={emptyDirSync:jqI,emptydirSync:jqI,emptyDir:SqI,emptydir:SqI}});var pqI=z((QBE,mqI)=>{var kJ9=IU().fromCallback,uqI=require("path"),fa=ZE(),gqI=Fx();function uJ9(H,$){function A(){fa.writeFile(H,"",(L)=>{if(L)return $(L);$()})}fa.stat(H,(L,I)=>{if(!L&&I.isFile())return $();let D=uqI.dirname(H);fa.stat(D,(B,f)=>{if(B){if(B.code==="ENOENT")return gqI.mkdirs(D,(E)=>{if(E)return $(E);A()});return $(B)}if(f.isDirectory())A();else fa.readdir(D,(E)=>{if(E)return $(E)})})})}function gJ9(H){let $;try{$=fa.statSync(H)}catch{}if($&&$.isFile())return;let A=uqI.dirname(H);try{if(!fa.statSync(A).isDirectory())fa.readdirSync(A)}catch(L){if(L&&L.code==="ENOENT")gqI.mkdirsSync(A);else throw L}fa.writeFileSync(H,"")}mqI.exports={createFile:kJ9(uJ9),createFileSync:gJ9}});var nqI=z((WBE,iqI)=>{var mJ9=IU().fromCallback,dqI=require("path"),Ea=ZE(),cqI=Fx(),pJ9=Ba().pathExists,{areIdentical:lqI}=wDH();function dJ9(H,$,A){function L(I,D){Ea.link(I,D,(B)=>{if(B)return A(B);A(null)})}Ea.lstat($,(I,D)=>{Ea.lstat(H,(B,f)=>{if(B)return B.message=B.message.replace("lstat","ensureLink"),A(B);if(D&&lqI(f,D))return A(null);let E=dqI.dirname($);pJ9(E,(M,G)=>{if(M)return A(M);if(G)return L(H,$);cqI.mkdirs(E,(U)=>{if(U)return A(U);L(H,$)})})})})}function cJ9(H,$){let A;try{A=Ea.lstatSync($)}catch{}try{let D=Ea.lstatSync(H);if(A&&lqI(D,A))return}catch(D){throw D.message=D.message.replace("lstat","ensureLink"),D}let L=dqI.dirname($);if(Ea.existsSync(L))return Ea.linkSync(H,$);return cqI.mkdirsSync(L),Ea.linkSync(H,$)}iqI.exports={createLink:mJ9(dJ9),createLinkSync:cJ9}});var aqI=z((VBE,rqI)=>{var Ma=require("path"),ijH=ZE(),lJ9=Ba().pathExists;function iJ9(H,$,A){if(Ma.isAbsolute(H))return ijH.lstat(H,(L)=>{if(L)return L.message=L.message.replace("lstat","ensureSymlink"),A(L);return A(null,{toCwd:H,toDst:H})});else{let L=Ma.dirname($),I=Ma.join(L,H);return lJ9(I,(D,B)=>{if(D)return A(D);if(B)return A(null,{toCwd:I,toDst:H});else return ijH.lstat(H,(f)=>{if(f)return f.message=f.message.replace("lstat","ensureSymlink"),A(f);return A(null,{toCwd:H,toDst:Ma.relative(L,H)})})})}}function nJ9(H,$){let A;if(Ma.isAbsolute(H)){if(A=ijH.existsSync(H),!A)throw Error("absolute srcpath does not exist");return{toCwd:H,toDst:H}}else{let L=Ma.dirname($),I=Ma.join(L,H);if(A=ijH.existsSync(I),A)return{toCwd:I,toDst:H};else{if(A=ijH.existsSync(H),!A)throw Error("relative srcpath does not exist");return{toCwd:H,toDst:Ma.relative(L,H)}}}}rqI.exports={symlinkPaths:iJ9,symlinkPathsSync:nJ9}});var sqI=z((PBE,tqI)=>{var oqI=ZE();function rJ9(H,$,A){if(A=typeof $==="function"?$:A,$=typeof $==="function"?!1:$,$)return A(null,$);oqI.lstat(H,(L,I)=>{if(L)return A(null,"file");$=I&&I.isDirectory()?"dir":"file",A(null,$)})}function aJ9(H,$){let A;if($)return $;try{A=oqI.lstatSync(H)}catch{return"file"}return A&&A.isDirectory()?"dir":"file"}tqI.exports={symlinkType:rJ9,symlinkTypeSync:aJ9}});var BTI=z((_BE,DTI)=>{var oJ9=IU().fromCallback,HTI=require("path"),Kx=YDH(),$TI=Fx(),tJ9=$TI.mkdirs,sJ9=$TI.mkdirsSync,ATI=aqI(),eJ9=ATI.symlinkPaths,HF9=ATI.symlinkPathsSync,LTI=sqI(),$F9=LTI.symlinkType,AF9=LTI.symlinkTypeSync,LF9=Ba().pathExists,{areIdentical:ITI}=wDH();function IF9(H,$,A,L){L=typeof A==="function"?A:L,A=typeof A==="function"?!1:A,Kx.lstat($,(I,D)=>{if(!I&&D.isSymbolicLink())Promise.all([Kx.stat(H),Kx.stat($)]).then(([B,f])=>{if(ITI(B,f))return L(null);eqI(H,$,A,L)});else eqI(H,$,A,L)})}function eqI(H,$,A,L){eJ9(H,$,(I,D)=>{if(I)return L(I);H=D.toDst,$F9(D.toCwd,A,(B,f)=>{if(B)return L(B);let E=HTI.dirname($);LF9(E,(M,G)=>{if(M)return L(M);if(G)return Kx.symlink(H,$,f,L);tJ9(E,(U)=>{if(U)return L(U);Kx.symlink(H,$,f,L)})})})})}function DF9(H,$,A){let L;try{L=Kx.lstatSync($)}catch{}if(L&&L.isSymbolicLink()){let f=Kx.statSync(H),E=Kx.statSync($);if(ITI(f,E))return}let I=HF9(H,$);H=I.toDst,A=AF9(I.toCwd,A);let D=HTI.dirname($);if(Kx.existsSync(D))return Kx.symlinkSync(H,$,A);return sJ9(D),Kx.symlinkSync(H,$,A)}DTI.exports={createSymlink:oJ9(IF9),createSymlinkSync:DF9}});var FTI=z((CBE,JTI)=>{var{createFile:fTI,createFileSync:ETI}=pqI(),{createLink:MTI,createLinkSync:GTI}=nqI(),{createSymlink:UTI,createSymlinkSync:XTI}=BTI();JTI.exports={createFile:fTI,createFileSync:ETI,ensureFile:fTI,ensureFileSync:ETI,createLink:MTI,createLinkSync:GTI,ensureLink:MTI,ensureLinkSync:GTI,createSymlink:UTI,createSymlinkSync:XTI,ensureSymlink:UTI,ensureSymlinkSync:XTI}});var LKH=z((YBE,KTI)=>{function BF9(H,{EOL:$=`
${mB}`:mB}}else N(`[teammate] Custom agent ${IH.agentType} not found in available agents`)}if(!DH){N("[STARTUP] Running showSetupScreens()...");let pA=Date.now(),qL=await TGB(CH,G,f$,QH);if(N(`[STARTUP] showSetupScreens() completed in ${Date.now()-pA}ms`),qL&&D?.trim().toLowerCase()==="/login")D="";if(qL)pW$(),WU$()}if(process.exitCode!==void 0){N("Graceful shutdown initiated, skipping further initialization");return}if(g6D(),!DH){let{errors:pA}=JAH(),qL=pA.filter((mB)=>!mB.mcpErrorMetadata);if(qL.length>0)await IfB(qL)}oQI().catch((pA)=>r(pA)),laL(),zmD(),h6I(),g$B();let{servers:jB}=await hA;N(`[STARTUP] MCP configs loaded in ${Date.now()-U$}ms`);let sA={...jB,...yH},PD={},f9={};for(let[pA,qL]of Object.entries(sA)){let mB=qL;if(mB.type==="sdk")PD[pA]=mB;else f9[pA]=mB}P0("action_mcp_configs_loaded");let k8=O2$(f9),R9=n||k||GH||DH?null:p7("startup",{agentType:gA?.agentType,model:wB}),FI=(rH||DH)&&!A$(process.env.MCP_CONNECTION_NONBLOCKING),LB=FI?void 0:k8,E9,IL;if(FI&&R9)[E9,IL]=await Promise.all([k8,R9]);else if(FI)E9=await k8,IL=[];else E9={clients:[],tools:[],commands:[]},IL=[];let{clients:ZA,tools:IB,commands:KB}=E9,MD;if(Cd())MD=new kgA(ZA,IB),MD.start().then(({url:pA})=>{let qL=MD.getSecret();FPH({url:pA,key:qL}),N(`[MCP CLI Endpoint] Started at ${pA}`)}).catch((pA)=>{r(pA instanceof Error?pA:Error(String(pA)))}),WB(async()=>{await MD?.stop()});if(EL("info","started"),WB(async()=>{EL("info","exited")}),Cj1({hasInitialPrompt:Boolean(D),hasStdin:Boolean(rH),verbose:p,debug:f,debugToStderr:E,print:d??!1,outputFormat:g??"text",inputFormat:v??"text",numAllowedTools:X.length,numDisallowedTools:J.length,mcpClientCount:Object.keys(sA).length,worktreeEnabled:qH,skipWebFetchPreflight:XB().skipWebFetchPreflight,githubActionInputs:process.env.GITHUB_ACTION_INPUTS,dangerouslySkipPermissionsPassed:M??!1,permissionMode:CH,modeIsBypass:CH==="bypassPermissions",allowDangerouslySkipPermissionsPassed:G,systemPromptFlag:MH?B.systemPromptFile?"file":"flag":void 0,appendSystemPromptFlag:AH?B.appendSystemPromptFile?"file":"flag":void 0}),qzD(f9,F$),wK$(null,"initialization"),Ij1(),Bj1(),DH)await GKA(),P0("action_after_plugins_init"),uxA();else GKA().then(()=>{P0("action_after_plugins_init"),uxA()});let P9=n||k?"init":GH?"maintenance":null;if(n){es(),await e2$("init",{forceSyncExecution:!0}),await p7("startup",{forceSyncExecution:!0}),$9(0);return}if(DH){if(g==="stream-json"||g==="json")_lA(!0);es(),IkA();let pA=e?[]:f$.filter((uD)=>uD.type==="prompt"&&!uD.disableNonInteractive||uD.type==="local"&&uD.supportsNonInteractive),qL=l3H(),mB={...qL,mcp:{...qL.mcp,clients:ZA,commands:KB,tools:IB},toolPermissionContext:F$,...{}},oB=qZ$(mB,_j);if(F$.mode==="bypassPermissions"||G)FaD(F$);if(B.sessionPersistence===!1)tS$(!0);NS$(O1L(Y)),Z8H(),Promise.resolve().then(() => (YuA(),nAB)).then((uD)=>uD.startBackgroundHousekeeping()),YEB(rH,async()=>oB.getState(),oB.setState,pA,G$,PD,x$.activeAgents,{continue:B.continue,resume:B.resume,verbose:p,outputFormat:g,jsonSchema:b$,permissionPromptToolName:B.permissionPromptTool,allowedTools:X,maxThinkingTokens:B.maxThinkingTokens,maxTurns:B.maxTurns,maxBudgetUsd:B.maxBudgetUsd,systemPrompt:MH,appendSystemPrompt:AH,userSpecifiedModel:fA,fallbackModel:UH,teleport:YH,sdkUrl:FH,replayUserMessages:B.replayUserMessages,includePartialMessages:EH,forkSession:B.forkSession||!1,resumeSessionAt:B.resumeSessionAt||void 0,rewindFiles:B.rewindFiles,enableAuthStatus:B.enableAuthStatus,agent:y,setupTrigger:P9??void 0,mcpDeferredPromise:LB});return}let{renderOptions:Q1,getFpsMetrics:E8}=Vj1(!1);c("tengu_startup_manual_model_config",{cli_flag:B.model,env_var:process.env.ANTHROPIC_MODEL,settings_file:(XB()||{}).model,subscriptionType:B0(),agent:zA});let cE=B.model||process.env.ANTHROPIC_MODEL||XB().model;if(nL()&&!Xq()&&cE!==void 0&&M9$(cE)){let pA=rN()?"turn on /extra-usage or ":"";console.error(oH.yellow(`Your plan doesn't include Opus in Claude Code. You can ${pA}/upgrade to Max to access it. The current model is now Sonnet.`))}let D4=QO$(wB),c8=[];if(TH)c8.push({key:"permission-mode-notification",text:TH,priority:"high"});if(D4)c8.push({key:"model-deprecation-warning",text:D4,color:"warning",priority:"high"});let o4=j$(),mM={...F$,mode:dL()&&wGB().isPlanModeRequired()?"plan":F$.mode},j1={settings:XB(),tasks:{},verbose:p??M$().verbose??!1,mainLoopModel:$I,mainLoopModelForSession:null,expandedView:M$().showSpinnerTree?"teammates":M$().showExpandedTodos?"tasks":"none",showTeammateMessagePreview:dL()?!1:void 0,selectedIPAgentIndex:-1,viewSelectionMode:"none",toolPermissionContext:mM,agent:gA?.agentType,agentDefinitions:x$,mcp:{clients:[],tools:[],commands:[],resources:{}},plugins:{enabled:[],disabled:[],commands:[],agents:[],errors:[],installationStatus:{marketplaces:[],plugins:[]}},statusLineText:void 0,remoteSessionUrl:void 0,notifications:{current:null,queue:c8},elicitation:{queue:[]},todos:{[o4]:Yv(o4)},fileHistory:{snapshots:[],trackedFiles:new Set},attribution:D4$(),thinkingEnabled:ZK$(),promptSuggestionEnabled:t2$(),feedbackSurvey:{timeLastShown:null,submitCountAtLastAppearance:null},sessionHooks:{},inbox:{messages:[]},promptSuggestion:{text:null,promptId:null,shownAt:0,acceptedAt:0,generationRequestId:null},speculation:p9H,speculationSessionTimeSavedMs:0,promptCoaching:{tip:null,shownAt:0},queuedCommands:[],workerSandboxPermissions:{queue:[],selectedIndex:0},pendingWorkerRequest:null,pendingSandboxRequest:null,gitDiff:{stats:null,perFileStats:new Map,hunks:new Map,lastUpdated:0},prStatus:{number:null,url:null,reviewState:null,lastUpdated:0},authVersion:0,initialMessage:rH?{message:R$({content:String(rH)})}:null,effortValue:CyD(),teamContext:MLB?.()};if(rH)rIH(String(rH));let kG=IB;if(Ej1(),B.continue)try{c("tengu_continue",{});let{clearSessionCaches:pA}=await Promise.resolve().then(() => (dZ$(),hjA));pA();let qL=await ot(void 0,void 0);if(!qL)console.error("No conversation found to continue"),process.exit(1);let mB;if(!B.forkSession){if(qL.sessionId)EV(P7(qL.sessionId)),await cw(),IzH(qL.sessionId)}let oB;if(!gA&&qL.agentSetting){let h0=x$.activeAgents.find((AE)=>AE.agentType===qL.agentSetting);if(h0){if(gA=h0,KN(h0.agentType),oB=h0.agentType,!W_()&&h0.model&&h0.model!=="inherit")MV(t8(h0.model))}else N(`Resumed session had agent "${qL.agentSetting}" but it is no longer available. Using default behavior.`)}let uD=IIB(qL),p9=opH(qL.agentName,qL.agentColor),M9={...j1,...oB&&{agent:oB},...uD&&{attribution:uD},...p9&&{standaloneAgentContext:p9},agentDefinitions:x$};if(rqA(qL.messages))Ct();agA(B);let{waitUntilExit:bf}=await H8(S1.default.createElement(uPH,{getFpsMetrics:E8},S1.default.createElement(d8,{initialState:M9,onChangeAppState:_j},S1.default.createElement(P8H,{debug:f||E,commands:[...f$,...KB],initialTools:kG,initialMessages:qL.messages,initialFileHistorySnapshots:qL.fileHistorySnapshots,initialAgentName:qL.agentName,initialAgentColor:qL.agentColor,mcpClients:ZA,dynamicMcpConfig:yH,mcpCliEndpoint:MD,autoConnectIdeFlag:C,strictMcpConfig:hH,systemPrompt:MH,appendSystemPrompt:AH,mainThreadAgentDefinition:gA,disableSlashCommands:e,taskListId:VH}))),Q1);Z8H(),await bf(),await Y0(0)}catch(pA){r(pA instanceof Error?pA:Error(String(pA))),process.exit(1)}else if(B.resume||B.fromPr||YH||HH!==null){let{clearSessionCaches:pA}=await Promise.resolve().then(() => (dZ$(),hjA));pA();let qL=null,mB=void 0,oB=void 0,uD=void 0,p9=void 0,v0=void 0,M9=Iw(B.resume),bf=void 0,h0=null,AE=void 0;if(B.fromPr){if(B.fromPr===!0)AE=!0;else if(typeof B.fromPr==="string")AE=B.fromPr}if(B.resume&&typeof B.resume==="string"&&!M9){let aL=B.resume.trim();if(aL){let RH=await Eb(aL,{exact:!0});if(RH.length===1)h0=RH[0],M9=uM(h0)??null;else bf=aL}}if(HH!==null){if(await Y4A(),!JK("allow_remote_sessions"))process.stderr.write(oH.red(`Error: Remote sessions are disabled by your organization's policy.
${M}`);let U=M.substr(0,G),X=M.substr(G+1).trim();B.set(H?U.toLowerCase():U,X)}return B}tryReadBody(H){if(this._totalLength<H)return;return this._read(H)}get numberOfBytes(){return this._totalLength}_read(H){if(H===0)return this.emptyBuffer();if(H>this._totalLength)throw Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===H){let I=this._chunks[0];return this._chunks.shift(),this._totalLength-=H,this.asNative(I)}if(this._chunks[0].byteLength>H){let I=this._chunks[0],D=this.asNative(I,H);return this._chunks[0]=I.slice(H),this._totalLength-=H,D}let $=this.allocNative(H),A=0,L=0;while(H>0){let I=this._chunks[L];if(I.byteLength>H){let D=I.slice(0,H);$.set(D,A),A+=H,this._chunks[L]=I.slice(H),this._totalLength-=H,H-=H}else $.set(I,A),A+=I.byteLength,this._chunks.shift(),this._totalLength-=I.byteLength,H-=I.byteLength}return $}}JC$.AbstractMessageBuffer=i7D});var e7D=z((H1)=>{Object.defineProperty(H1,"__esModule",{value:!0});H1.createMessageConnection=H1.ConnectionOptions=H1.MessageStrategy=H1.CancellationStrategy=H1.CancellationSenderStrategy=H1.CancellationReceiverStrategy=H1.RequestCancellationReceiverStrategy=H1.IdCancellationReceiverStrategy=H1.ConnectionStrategy=H1.ConnectionError=H1.ConnectionErrors=H1.LogTraceNotification=H1.SetTraceNotification=H1.TraceFormat=H1.TraceValues=H1.Trace=H1.NullLogger=H1.ProgressType=H1.ProgressToken=void 0;var r7D=Xt(),k5=$6H(),d0=JqA(),a7D=KqA(),KkH=L6H(),NqA=UC$(),VkH;(function(H){H.type=new d0.NotificationType("$/cancelRequest")})(VkH||(VkH={}));var OqA;(function(H){function $(A){return typeof A==="string"||typeof A==="number"}H.is=$})(OqA||(H1.ProgressToken=OqA={}));var QkH;(function(H){H.type=new d0.NotificationType("$/progress")})(QkH||(QkH={}));class s7D{constructor(){}}H1.ProgressType=s7D;var xqA;(function(H){function $(A){return k5.func(A)}H.is=$})(xqA||(xqA={}));H1.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var XE;(function(H){H[H.Off=0]="Off",H[H.Messages=1]="Messages",H[H.Compact=2]="Compact",H[H.Verbose=3]="Verbose"})(XE||(H1.Trace=XE={}));var o7D;(function(H){H.Off="off",H.Messages="messages",H.Compact="compact",H.Verbose="verbose"})(o7D||(H1.TraceValues=o7D={}));(function(H){function $(L){if(!k5.string(L))return H.Off;switch(L=L.toLowerCase(),L){case"off":return H.Off;case"messages":return H.Messages;case"compact":return H.Compact;case"verbose":return H.Verbose;default:return H.Off}}H.fromString=$;function A(L){switch(L){case H.Off:return"off";case H.Messages:return"messages";case H.Compact:return"compact";case H.Verbose:return"verbose";default:return"off"}}H.toString=A})(XE||(H1.Trace=XE={}));var Tw;(function(H){H.Text="text",H.JSON="json"})(Tw||(H1.TraceFormat=Tw={}));(function(H){function $(A){if(!k5.string(A))return H.Text;if(A=A.toLowerCase(),A==="json")return H.JSON;else return H.Text}H.fromString=$})(Tw||(H1.TraceFormat=Tw={}));var SqA;(function(H){H.type=new d0.NotificationType("$/setTrace")})(SqA||(H1.SetTraceNotification=SqA={}));var FC$;(function(H){H.type=new d0.NotificationType("$/logTrace")})(FC$||(H1.LogTraceNotification=FC$={}));var WkH;(function(H){H[H.Closed=1]="Closed",H[H.Disposed=2]="Disposed",H[H.AlreadyListening=3]="AlreadyListening"})(WkH||(H1.ConnectionErrors=WkH={}));class f6H extends Error{constructor(H,$){super($);this.code=H,Object.setPrototypeOf(this,f6H.prototype)}}H1.ConnectionError=f6H;var jqA;(function(H){function $(A){let L=A;return L&&k5.func(L.cancelUndispatched)}H.is=$})(jqA||(H1.ConnectionStrategy=jqA={}));var KC$;(function(H){function $(A){let L=A;return L&&(L.kind===void 0||L.kind==="id")&&k5.func(L.createCancellationTokenSource)&&(L.dispose===void 0||k5.func(L.dispose))}H.is=$})(KC$||(H1.IdCancellationReceiverStrategy=KC$={}));var RqA;(function(H){function $(A){let L=A;return L&&L.kind==="request"&&k5.func(L.createCancellationTokenSource)&&(L.dispose===void 0||k5.func(L.dispose))}H.is=$})(RqA||(H1.RequestCancellationReceiverStrategy=RqA={}));var QC$;(function(H){H.Message=Object.freeze({createCancellationTokenSource(A){return new NqA.CancellationTokenSource}});function $(A){return KC$.is(A)||RqA.is(A)}H.is=$})(QC$||(H1.CancellationReceiverStrategy=QC$={}));var WC$;(function(H){H.Message=Object.freeze({sendCancellation(A,L){return A.sendNotification(VkH.type,{id:L})},cleanup(A){}});function $(A){let L=A;return L&&k5.func(L.sendCancellation)&&k5.func(L.cleanup)}H.is=$})(WC$||(H1.CancellationSenderStrategy=WC$={}));var VC$;(function(H){H.Message=Object.freeze({receiver:QC$.Message,sender:WC$.Message});function $(A){let L=A;return L&&QC$.is(L.receiver)&&WC$.is(L.sender)}H.is=$})(VC$||(H1.CancellationStrategy=VC$={}));var PC$;(function(H){function $(A){let L=A;return L&&k5.func(L.handleMessage)}H.is=$})(PC$||(H1.MessageStrategy=PC$={}));var t7D;(function(H){function $(A){let L=A;return L&&(VC$.is(L.cancellationStrategy)||jqA.is(L.connectionStrategy)||PC$.is(L.messageStrategy))}H.is=$})(t7D||(H1.ConnectionOptions=t7D={}));var OS;(function(H){H[H.New=1]="New",H[H.Listening=2]="Listening",H[H.Closed=3]="Closed",H[H.Disposed=4]="Disposed"})(OS||(OS={}));function iA1(H,$,A,L){let I=A!==void 0?A:H1.NullLogger,D=0,B=0,f=0,E="2.0",M=void 0,G=new Map,U=void 0,X=new Map,J=new Map,F,Q=new a7D.LinkedMap,W=new Map,P=new Set,Y=new Map,C=XE.Off,Z=Tw.Text,q,O=OS.New,j=new KkH.Emitter,u=new KkH.Emitter,y=new KkH.Emitter,g=new KkH.Emitter,v=new KkH.Emitter,p=L&&L.cancellationStrategy?L.cancellationStrategy:VC$.Message;function d(rH){if(rH===null)throw Error("Can't send requests with id null since the response can't be correlated.");return"req-"+rH.toString()}function k(rH){if(rH===null)return"res-unknown-"+(++f).toString();else return"res-"+rH.toString()}function n(){return"not-"+(++B).toString()}function GH(rH,G$){if(d0.Message.isRequest(G$))rH.set(d(G$.id),G$);else if(d0.Message.isResponse(G$))rH.set(k(G$.id),G$);else rH.set(n(),G$)}function e(rH){return}function BH(){return O===OS.Listening}function VH(){return O===OS.Closed}function wH(){return O===OS.Disposed}function WH(){if(O===OS.New||O===OS.Listening)O=OS.Closed,u.fire(void 0)}function qH(rH){j.fire([rH,void 0,void 0])}function s(rH){j.fire(rH)}H.onClose(WH),H.onError(qH),$.onClose(WH),$.onError(s);function IH(){if(F||Q.size===0)return;F=(0,r7D.default)().timer.setImmediate(()=>{F=void 0,EH()})}function FH(rH){if(d0.Message.isRequest(rH))OH(rH);else if(d0.Message.isNotification(rH))$H(rH);else if(d0.Message.isResponse(rH))HH(rH);else DH(rH)}function EH(){if(Q.size===0)return;let rH=Q.shift();try{let G$=L?.messageStrategy;if(PC$.is(G$))G$.handleMessage(rH,FH);else FH(rH)}finally{IH()}}let YH=(rH)=>{try{if(d0.Message.isNotification(rH)&&rH.method===VkH.type.method){let G$=rH.params.id,b$=d(G$),qA=Q.get(b$);if(d0.Message.isRequest(qA)){let fA=L?.connectionStrategy,UH=fA&&fA.cancelUndispatched?fA.cancelUndispatched(qA,e):e(qA);if(UH&&(UH.error!==void 0||UH.result!==void 0)){Q.delete(b$),Y.delete(G$),UH.id=qA.id,CH(UH,rH.method,Date.now()),$.write(UH).catch(()=>I.error("Sending response for canceled message failed."));return}}let n$=Y.get(G$);if(n$!==void 0){n$.cancel(),yH(rH);return}else P.add(G$)}GH(Q,rH)}finally{IH()}};function OH(rH){if(wH())return;function G$(aH,f$,I$){let $$={jsonrpc:E,id:rH.id};if(aH instanceof d0.ResponseError)$$.error=aH.toJson();else $$.result=aH===void 0?null:aH;CH($$,f$,I$),$.write($$).catch(()=>I.error("Sending response failed."))}function b$(aH,f$,I$){let $$={jsonrpc:E,id:rH.id,error:aH.toJson()};CH($$,f$,I$),$.write($$).catch(()=>I.error("Sending response failed."))}function qA(aH,f$,I$){if(aH===void 0)aH=null;let $$={jsonrpc:E,id:rH.id,result:aH};CH($$,f$,I$),$.write($$).catch(()=>I.error("Sending response failed."))}TH(rH);let n$=G.get(rH.method),fA,UH;if(n$)fA=n$.type,UH=n$.handler;let _H=Date.now();if(UH||M){let aH=rH.id??String(Date.now()),f$=KC$.is(p.receiver)?p.receiver.createCancellationTokenSource(aH):p.receiver.createCancellationTokenSource(rH);if(rH.id!==null&&P.has(rH.id))f$.cancel();if(rH.id!==null)Y.set(aH,f$);try{let I$;if(UH)if(rH.params===void 0){if(fA!==void 0&&fA.numberOfParams!==0){b$(new d0.ResponseError(d0.ErrorCodes.InvalidParams,`Request ${rH.method} defines ${fA.numberOfParams} params but received none.`),rH.method,_H);return}I$=UH(f$.token)}else if(Array.isArray(rH.params)){if(fA!==void 0&&fA.parameterStructures===d0.ParameterStructures.byName){b$(new d0.ResponseError(d0.ErrorCodes.InvalidParams,`Request ${rH.method} defines parameters by name but received parameters by position`),rH.method,_H);return}I$=UH(...rH.params,f$.token)}else{if(fA!==void 0&&fA.parameterStructures===d0.ParameterStructures.byPosition){b$(new d0.ResponseError(d0.ErrorCodes.InvalidParams,`Request ${rH.method} defines parameters by position but received parameters by name`),rH.method,_H);return}I$=UH(rH.params,f$.token)}else if(M)I$=M(rH.method,rH.params,f$.token);let $$=I$;if(!I$)Y.delete(aH),qA(I$,rH.method,_H);else if($$.then)$$.then((e$)=>{Y.delete(aH),G$(e$,rH.method,_H)},(e$)=>{if(Y.delete(aH),e$ instanceof d0.ResponseError)b$(e$,rH.method,_H);else if(e$&&k5.string(e$.message))b$(new d0.ResponseError(d0.ErrorCodes.InternalError,`Request ${rH.method} failed with message: ${e$.message}`),rH.method,_H);else b$(new d0.ResponseError(d0.ErrorCodes.InternalError,`Request ${rH.method} failed unexpectedly without providing any details.`),rH.method,_H)});else Y.delete(aH),G$(I$,rH.method,_H)}catch(I$){if(Y.delete(aH),I$ instanceof d0.ResponseError)G$(I$,rH.method,_H);else if(I$&&k5.string(I$.message))b$(new d0.ResponseError(d0.ErrorCodes.InternalError,`Request ${rH.method} failed with message: ${I$.message}`),rH.method,_H);else b$(new d0.ResponseError(d0.ErrorCodes.InternalError,`Request ${rH.method} failed unexpectedly without providing any details.`),rH.method,_H)}}else b$(new d0.ResponseError(d0.ErrorCodes.MethodNotFound,`Unhandled method ${rH.method}`),rH.method,_H)}function HH(rH){if(wH())return;if(rH.id===null)if(rH.error)I.error(`Received response message without id: Error is: 
${oH.dim("Run /status in Claude Code to check your account.")}`);throw r(f),Error(`Failed to fetch session from Sessions API: ${f.message}`)}}async function kND(H){let $=iD()?.accessToken;if(!$)throw Error("No access token for polling");let A=await qR();if(!A)throw Error("No org UUID for polling");let L=ZK($),I=`${UD().BASE_API_URL}/v1/sessions/${H}/events`,D=await nA.get(I,{headers:{...L,"x-organization-uuid":A},timeout:30000});if(D.status!==200)throw Error(`Failed to fetch session events: ${D.statusText}`);let B=D.data;if(!B?.data||!Array.isArray(B.data))throw Error("Invalid events response");let f=[];for(let M of B.data)if(M&&typeof M==="object"&&"type"in M){if(M.type==="env_manager_log"||M.type==="control_response")continue;if("session_id"in M)f.push(M)}let E;try{let M=await wbH(H);E=WwA(M)}catch{}return{log:f,branch:E}}async function n9H(H){if(!JK("allow_remote_sessions"))throw Error("Remote sessions are disabled by your organization's policy.");let{initialMessage:$,description:A,signal:L}=H;try{await pW();let I=iD()?.accessToken;if(!I)return r(Error("No access token found for remote session creation")),null;let D=await qR();if(!D)return r(Error("Unable to get organization UUID for remote session creation")),null;let B=await XS(),f=null,E=null,{title:M,branchName:G}=await xU1(A||$||"Background task",L);if(B){let[u,y]=B.split("/");if(u&&y){let g=H.branchName??await w6()??void 0;N(`[teleportToRemote] Git source: ${u}/${y}, revision: ${g??"none"}`),f={type:"git_repository",url:`https://github.com/${u}/${y}`,revision:g},E={type:"git_repository",git_info:{type:"github",repo:`${u}/${y}`,branches:[G]}}}else r(Error(`Invalid repository format: ${B} - expected 'owner/name'`))}else N("[teleportToRemote] No repository detected \u2014 session will have an empty sandbox");let U=await V3H();if(!U||U.length===0)return r(Error("No environments available for session creation")),null;let J=VL()?.remote?.defaultEnvironmentId,F=J&&U.find((u)=>u.environment_id===J)||U[0];if(!F)return r(Error("No environments available for session creation")),null;if(J){let u=F.environment_id===J;N(u?`Using configured default environment: ${J}`:`Configured default environment ${J} not found, using first available`)}let Q=F.environment_id;N(`Selected environment: ${Q} (${F.name})`);let W=`${UD().BASE_API_URL}/v1/sessions`,P={...ZK(I),"x-organization-uuid":D},Y={sources:f?[f]:[],outcomes:E?[E]:[],model:G1()},C=$?[{type:"event",data:{uuid:hND.randomUUID(),session_id:"",type:"user",parent_tool_use_id:null,message:{role:"user",content:$}}}]:[],Z={title:M,events:C,session_context:Y,environment_id:Q};N(`Creating session with payload: ${vH(Z,null,2)}`);let q=await nA.post(W,Z,{headers:P,signal:L});if(!(q.status===200||q.status===201))return r(Error(`API request failed with status ${q.status}: ${q.statusText}
`)}}),$.on("request",async(A,L)=>{try{let I=new ncL.URL(A.url),D=I.hostname,B=I.port?parseInt(I.port,10):I.protocol==="https:"?443:80;if(!await H.filter(B,D,A.socket)){wL(`HTTP request blocked to ${D}:${B}`,{level:"error"}),L.writeHead(403,{"Content-Type":"text/plain","X-Proxy-Error":"blocked-by-allowlist"}),L.end("Connection blocked by network allowlist");return}let E=H.getMitmSocketPath?.(D);if(E){wL(`Routing HTTP ${A.method} ${D}:${B} through MITM proxy at ${E}`);let M=new tB$.Agent({socketPath:E}),G=AIA.request({agent:M,path:A.url,method:A.method,headers:{...A.headers,host:I.host}},(U)=>{L.writeHead(U.statusCode,U.headers),U.pipe(L)});G.on("error",(U)=>{if(wL(`MITM proxy request failed: ${U.message}`,{level:"error"}),!L.headersSent)L.writeHead(502,{"Content-Type":"text/plain"}),L.end("Bad Gateway")}),A.pipe(G)}else{let G=(I.protocol==="https:"?icL.request:AIA.request)({hostname:D,port:B,path:I.pathname+I.search,method:A.method,headers:{...A.headers,host:I.host}},(U)=>{L.writeHead(U.statusCode,U.headers),U.pipe(L)});G.on("error",(U)=>{if(wL(`Proxy request failed: ${U.message}`,{level:"error"}),!L.headersSent)L.writeHead(502,{"Content-Type":"text/plain"}),L.end("Bad Gateway")}),A.pipe(G)}}catch(I){wL(`Error handling HTTP request: ${I}`,{level:"error"}),L.writeHead(500,{"Content-Type":"text/plain"}),L.end("Internal Server Error")}}),$}var tB$,AIA,icL,LIA,ncL;var acL=K(()=>{tB$=require("http"),AIA=require("http"),icL=require("https"),LIA=require("net"),ncL=require("url")});function ocL(H,$){if(H.command!=="connect")return $("COMMAND_NOT_SUPPORTED");H.socket.on("error",()=>{});let A=ecL.default.createConnection({host:H.destAddress,port:H.destPort});A.setNoDelay();let L=!1;return A.on("error",(I)=>{if(!L)switch(I.code){case"EINVAL":case"ENOENT":case"ENOTFOUND":case"ETIMEDOUT":case"EADDRNOTAVAIL":case"EHOSTUNREACH":$("HOST_UNREACHABLE");break;case"ENETUNREACH":$("NETWORK_UNREACHABLE");break;case"ECONNREFUSED":$("CONNECTION_REFUSED");break;default:$("GENERAL_FAILURE")}}),A.on("ready",()=>{L=!0,$("REQUEST_GRANTED"),H.socket.pipe(A).pipe(H.socket)}),H.socket.on("close",()=>A.destroy()),A}function HlL(H){let $=new MZ0;if(H?.auth)$.setAuthHandler((A)=>{return A.username===H.auth.username&&A.password===H.auth.password});if(H?.port)$.listen(H.port,H.hostname);return $}var tcL,ecL,scL,IIA,EZ0=class{constructor(H,$){this.errorHandler=()=>{},this.metadata={},this.socket=$,this.server=H,$.on("error",this.errorHandler),$.pause(),this.handleGreeting()}readBytes(H){return new Promise(($)=>{let A=Buffer.allocUnsafe(H),L=0,I=(D)=>{let B=Math.min(D.length,H-L);if(D.copy(A,L,0,B),L+=B,L<H)return;this.socket.removeListener("data",I),this.socket.push(D.subarray(B)),$(A),this.socket.pause()};this.socket.on("data",I),this.socket.resume()})}async handleGreeting(){if((await this.readBytes(1)).readUInt8()!==5)return this.socket.destroy();let $=(await this.readBytes(1)).readUInt8();if($>128||$===0)return this.socket.destroy();let A=await this.readBytes($),L=this.server.authHandler?2:0;if(!A.includes(L))return this.socket.write(Buffer.from([5,255])),this.socket.destroy();if(this.socket.write(Buffer.from([5,L])),this.server.authHandler)this.handleUserPassword();else this.handleConnectionRequest()}async handleUserPassword(){await this.readBytes(1);let H=(await this.readBytes(1)).readUint8(),$=(await this.readBytes(H)).toString(),A=(await this.readBytes(1)).readUint8(),L=(await this.readBytes(A)).toString();this.username=$,this.password=L;let I=!1,D=()=>{if(I)return;I=!0,this.socket.write(Buffer.from([1,0])),this.handleConnectionRequest()},B=()=>{if(I)return;I=!0,this.socket.write(Buffer.from([1,1])),this.socket.destroy()},f=await this.server.authHandler(this,D,B);if(f===!0)D();else if(f===!1)B()}async handleConnectionRequest(){await this.readBytes(1);let H=(await this.readBytes(1))[0],$=scL[H];if(!$)return this.socket.destroy();this.command=$,await this.readBytes(1);let A=(await this.readBytes(1)).readUInt8(),L="";switch(A){case 1:L=(await this.readBytes(4)).join(".");break;case 3:let M=(await this.readBytes(1)).readUInt8();L=(await this.readBytes(M)).toString();break;case 4:let G=await this.readBytes(16);for(let U=0;U<16;U++){if(U%2===0&&U>0)L+=":";L+=`${G[U]<16?"0":""}${G[U].toString(16)}`}break;default:this.socket.destroy();return}let I=(await this.readBytes(2)).readUInt16BE();if(!this.server.supportedCommands.has($))return this.socket.write(Buffer.from([5,7])),this.socket.destroy();this.destAddress=L,this.destPort=I;let D=!1,B=()=>{if(D)return;D=!0,this.connect()};if(!this.server.rulesetValidator)return B();let f=()=>{if(D)return;D=!0,this.socket.write(Buffer.from([5,2,0,1,0,0,0,0,0,0])),this.socket.destroy()},E=await this.server.rulesetValidator(this,B,f);if(E===!0)B();else if(E===!1)f()}connect(){this.socket.removeListener("error",this.errorHandler),this.server.connectionHandler(this,(H)=>{if(IIA[H]===void 0)throw Error(`"${H}" is not a valid status.`);if(this.socket.write(Buffer.from([5,IIA[H],0,1,0,0,0,0,0,0])),H!=="REQUEST_GRANTED")this.socket.destroy()}),this.socket.resume()}},MZ0=class{constructor(){this.supportedCommands=new Set(["connect"]),this.connectionHandler=ocL,this.server=tcL.default.createServer((H)=>{H.setNoDelay(),this._handleConnection(H)})}listen(...H){return this.server.listen(...H),this}close(H){return this.server.close(H),this}setAuthHandler(H){return this.authHandler=H,this}disableAuthHandler(){return this.authHandler=void 0,this}setRulesetValidator(H){return this.rulesetValidator=H,this}disableRulesetValidator(){return this.rulesetValidator=void 0,this}setConnectionHandler(H){return this.connectionHandler=H,this}useDefaultConnectionHandler(){return this.connectionHandler=ocL,this}_handleConnection(H){return new EZ0(this,H),this}};var $lL=K(()=>{tcL=h(require("net")),ecL=h(require("net")),scL=((H)=>{return H[H.connect=1]="connect",H[H.bind=2]="bind",H[H.udp=3]="udp",H})(scL||{}),IIA=((H)=>{return H[H.REQUEST_GRANTED=0]="REQUEST_GRANTED",H[H.GENERAL_FAILURE=1]="GENERAL_FAILURE",H[H.CONNECTION_NOT_ALLOWED=2]="CONNECTION_NOT_ALLOWED",H[H.NETWORK_UNREACHABLE=3]="NETWORK_UNREACHABLE",H[H.HOST_UNREACHABLE=4]="HOST_UNREACHABLE",H[H.CONNECTION_REFUSED=5]="CONNECTION_REFUSED",H[H.TTL_EXPIRED=6]="TTL_EXPIRED",H[H.COMMAND_NOT_SUPPORTED=7]="COMMAND_NOT_SUPPORTED",H[H.ADDRESS_TYPE_NOT_SUPPORTED=8]="ADDRESS_TYPE_NOT_SUPPORTED",H})(IIA||{})});function AlL(H){let $=HlL();return $.setRulesetValidator(async(A)=>{try{let{destAddress:L,destPort:I}=A;if(wL(`Connection request to ${L}:${I}`),!await H.filter(I,L))return wL(`Connection blocked to ${L}:${I}`,{level:"error"}),!1;return wL(`Connection allowed to ${L}:${I}`),!0}catch(L){return wL(`Error validating connection: ${L}`,{level:"error"}),!1}}),{server:$,getPort(){try{let A=$?.server;if(A&&typeof A?.address==="function"){let L=A.address();if(L&&typeof L==="object"&&"port"in L)return L.port}}catch(A){wL(`Error getting port: ${A}`,{level:"error"})}return},listen(A,L){return new Promise((I,D)=>{let B=()=>{let f=this.getPort();if(f)wL(`SOCKS proxy listening on ${L}:${f}`),I(f);else D(Error("Failed to get SOCKS proxy server port"))};$.listen(A,L,B)})},async close(){return new Promise((A,L)=>{$.close((I)=>{if(I){let D=I.message?.toLowerCase()||"";if(!(D.includes("not running")||D.includes("already closed")||D.includes("not listening"))){L(I);return}}A()})})},unref(){try{let A=$?.server;if(A&&typeof A?.unref==="function")A.unref()}catch(A){wL(`Error calling unref: ${A}`,{level:"error"})}}}}var LlL=K(()=>{$lL()});var GZ0,sB$;var DIA=K(()=>{GZ0=typeof global=="object"&&global&&global.Object===Object&&global,sB$=GZ0});var UZ0,XZ0,DF;var $O=K(()=>{DIA();UZ0=typeof self=="object"&&self&&self.Object===Object&&self,XZ0=sB$||UZ0||Function("return this")(),DF=XZ0});var JZ0,Vu;var eB$=K(()=>{$O();JZ0=DF.Symbol,Vu=JZ0});function QZ0(H){var $=FZ0.call(H,TTH),A=H[TTH];try{H[TTH]=void 0;var L=!0}catch(D){}var I=KZ0.call(H);if(L)if($)H[TTH]=A;else delete H[TTH];return I}var IlL,FZ0,KZ0,TTH,DlL;var BlL=K(()=>{eB$();IlL=Object.prototype,FZ0=IlL.hasOwnProperty,KZ0=IlL.toString,TTH=Vu?Vu.toStringTag:void 0;DlL=QZ0});function PZ0(H){return VZ0.call(H)}var WZ0,VZ0,flL;var ElL=K(()=>{WZ0=Object.prototype,VZ0=WZ0.toString;flL=PZ0});function YZ0(H){if(H==null)return H===void 0?CZ0:_Z0;return MlL&&MlL in Object(H)?DlL(H):flL(H)}var _Z0="[object Null]",CZ0="[object Undefined]",MlL,Pu;var zTH=K(()=>{eB$();BlL();ElL();MlL=Vu?Vu.toStringTag:void 0;Pu=YZ0});function wZ0(H){return H!=null&&typeof H=="object"}var aR;var K4H=K(()=>{aR=wZ0});var ZZ0,Q4H;var H0$=K(()=>{ZZ0=Array.isArray,Q4H=ZZ0});function qZ0(H){var $=typeof H;return H!=null&&($=="object"||$=="function")}var oR;var W4H=K(()=>{oR=qZ0});function xZ0(H){if(!oR(H))return!1;var $=Pu(H);return $==zZ0||$==NZ0||$==TZ0||$==OZ0}var TZ0="[object AsyncFunction]",zZ0="[object Function]",NZ0="[object GeneratorFunction]",OZ0="[object Proxy]",$0$;var BIA=K(()=>{zTH();W4H();$0$=xZ0});var SZ0,A0$;var GlL=K(()=>{$O();SZ0=DF["__core-js_shared__"],A0$=SZ0});function jZ0(H){return!!UlL&&UlL in H}var UlL,XlL;var JlL=K(()=>{GlL();UlL=function(){var H=/[^.]+$/.exec(A0$&&A0$.keys&&A0$.keys.IE_PROTO||"");return H?"Symbol(src)_1."+H:""}();XlL=jZ0});function vZ0(H){if(H!=null){try{return yZ0.call(H)}catch($){}try{return H+""}catch($){}}return""}var RZ0,yZ0,_u;var fIA=K(()=>{RZ0=Function.prototype,yZ0=RZ0.toString;_u=vZ0});function dZ0(H){if(!oR(H)||XlL(H))return!1;var $=$0$(H)?pZ0:bZ0;return $.test(_u(H))}var hZ0,bZ0,kZ0,uZ0,gZ0,mZ0,pZ0,FlL;var KlL=K(()=>{BIA();JlL();W4H();fIA();hZ0=/[\\^$.*+?()[\]{}|]/g,bZ0=/^\[object .+?Constructor\]$/,kZ0=Function.prototype,uZ0=Object.prototype,gZ0=kZ0.toString,mZ0=uZ0.hasOwnProperty,pZ0=RegExp("^"+gZ0.call(mZ0).replace(hZ0,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");FlL=dZ0});function cZ0(H,$){return H==null?void 0:H[$]}var QlL;var WlL=K(()=>{QlL=cZ0});function lZ0(H,$){var A=QlL(H,$);return FlL(A)?A:void 0}var d_;var gi=K(()=>{KlL();WlL();d_=lZ0});var iZ0,L0$;var VlL=K(()=>{gi();$O();iZ0=d_(DF,"WeakMap"),L0$=iZ0});var PlL,nZ0,_lL;var ClL=K(()=>{W4H();PlL=Object.create,nZ0=function(){function H(){}return function($){if(!oR($))return{};if(PlL)return PlL($);H.prototype=$;var A=new H;return H.prototype=void 0,A}}(),_lL=nZ0});function rZ0(H,$){var A=-1,L=H.length;$||($=Array(L));while(++A<L)$[A]=H[A];return $}var YlL;var wlL=K(()=>{YlL=rZ0});var aZ0,EIA;var ZlL=K(()=>{gi();aZ0=function(){try{var H=d_(Object,"defineProperty");return H({},"",{}),H}catch($){}}(),EIA=aZ0});function oZ0(H,$){var A=-1,L=H==null?0:H.length;while(++A<L)if($(H[A],A,H)===!1)break;return H}var qlL;var TlL=K(()=>{qlL=oZ0});function eZ0(H,$){var A=typeof H;return $=$==null?tZ0:$,!!$&&(A=="number"||A!="symbol"&&sZ0.test(H))&&(H>-1&&H%1==0&&H<$)}var tZ0=9007199254740991,sZ0,zlL;var NlL=K(()=>{sZ0=/^(?:0|[1-9]\d*)$/;zlL=eZ0});function Hq0(H,$,A){if($=="__proto__"&&EIA)EIA(H,$,{configurable:!0,enumerable:!0,value:A,writable:!0});else H[$]=A}var I0$;var MIA=K(()=>{ZlL();I0$=Hq0});function $q0(H,$){return H===$||H!==H&&$!==$}var D0$;var GIA=K(()=>{D0$=$q0});function Iq0(H,$,A){var L=H[$];if(!(Lq0.call(H,$)&&D0$(L,A))||A===void 0&&!($ in H))I0$(H,$,A)}var Aq0,Lq0,B0$;var UIA=K(()=>{MIA();GIA();Aq0=Object.prototype,Lq0=Aq0.hasOwnProperty;B0$=Iq0});function Dq0(H,$,A,L){var I=!A;A||(A={});var D=-1,B=$.length;while(++D<B){var f=$[D],E=L?L(A[f],H[f],f,A,H):void 0;if(E===void 0)E=H[f];if(I)I0$(A,f,E);else B0$(A,f,E)}return A}var mi;var NTH=K(()=>{UIA();MIA();mi=Dq0});function fq0(H){return typeof H=="number"&&H>-1&&H%1==0&&H<=Bq0}var Bq0=9007199254740991,f0$;var XIA=K(()=>{f0$=fq0});function Eq0(H){return H!=null&&f0$(H.length)&&!$0$(H)}var E0$;var JIA=K(()=>{BIA();XIA();E0$=Eq0});function Gq0(H){var $=H&&H.constructor,A=typeof $=="function"&&$.prototype||Mq0;return H===A}var Mq0,V4H;var M0$=K(()=>{Mq0=Object.prototype;V4H=Gq0});function Uq0(H,$){var A=-1,L=Array(H);while(++A<H)L[A]=$(A);return L}var OlL;var xlL=K(()=>{OlL=Uq0});function Jq0(H){return aR(H)&&Pu(H)==Xq0}var Xq0="[object Arguments]",FIA;var SlL=K(()=>{zTH();K4H();FIA=Jq0});var jlL,Fq0,Kq0,Qq0,RlL;var ylL=K(()=>{SlL();K4H();jlL=Object.prototype,Fq0=jlL.hasOwnProperty,Kq0=jlL.propertyIsEnumerable,Qq0=FIA(function(){return arguments}())?FIA:function(H){return aR(H)&&Fq0.call(H,"callee")&&!Kq0.call(H,"callee")},RlL=Qq0});function Wq0(){return!1}var vlL;var hlL=K(()=>{vlL=Wq0});var OTH={};JA(OTH,{default:()=>xTH});var ulL,blL,Vq0,klL,Pq0,_q0,xTH;var KIA=K(()=>{$O();hlL();ulL=typeof OTH=="object"&&OTH&&!OTH.nodeType&&OTH,blL=ulL&&typeof G0$=="object"&&G0$&&!G0$.nodeType&&G0$,Vq0=blL&&blL.exports===ulL,klL=Vq0?DF.Buffer:void 0,Pq0=klL?klL.isBuffer:void 0,_q0=Pq0||vlL,xTH=_q0});function lq0(H){return aR(H)&&f0$(H.length)&&!!yU[Pu(H)]}var Cq0="[object Arguments]",Yq0="[object Array]",wq0="[object Boolean]",Zq0="[object Date]",qq0="[object Error]",Tq0="[object Function]",zq0="[object Map]",Nq0="[object Number]",Oq0="[object Object]",xq0="[object RegExp]",Sq0="[object Set]",jq0="[object String]",Rq0="[object WeakMap]",yq0="[object ArrayBuffer]",vq0="[object DataView]",hq0="[object Float32Array]",bq0="[object Float64Array]",kq0="[object Int8Array]",uq0="[object Int16Array]",gq0="[object Int32Array]",mq0="[object Uint8Array]",pq0="[object Uint8ClampedArray]",dq0="[object Uint16Array]",cq0="[object Uint32Array]",yU,glL;var mlL=K(()=>{zTH();XIA();K4H();yU={};yU[hq0]=yU[bq0]=yU[kq0]=yU[uq0]=yU[gq0]=yU[mq0]=yU[pq0]=yU[dq0]=yU[cq0]=!0;yU[Cq0]=yU[Yq0]=yU[yq0]=yU[wq0]=yU[vq0]=yU[Zq0]=yU[qq0]=yU[Tq0]=yU[zq0]=yU[Nq0]=yU[Oq0]=yU[xq0]=yU[Sq0]=yU[jq0]=yU[Rq0]=!1;glL=lq0});function iq0(H){return function($){return H($)}}var P4H;var U0$=K(()=>{P4H=iq0});var STH={};JA(STH,{default:()=>tR});var plL,jTH,nq0,QIA,rq0,tR;var J0$=K(()=>{DIA();plL=typeof STH=="object"&&STH&&!STH.nodeType&&STH,jTH=plL&&typeof X0$=="object"&&X0$&&!X0$.nodeType&&X0$,nq0=jTH&&jTH.exports===plL,QIA=nq0&&sB$.process,rq0=function(){try{var H=jTH&&jTH.require&&jTH.require("util").types;if(H)return H;return QIA&&QIA.binding&&QIA.binding("util")}catch($){}}(),tR=rq0});var dlL,aq0,clL;var llL=K(()=>{mlL();U0$();J0$();dlL=tR&&tR.isTypedArray,aq0=dlL?P4H(dlL):glL,clL=aq0});function sq0(H,$){var A=Q4H(H),L=!A&&RlL(H),I=!A&&!L&&xTH(H),D=!A&&!L&&!I&&clL(H),B=A||L||I||D,f=B?OlL(H.length,String):[],E=f.length;for(var M in H)if(($||tq0.call(H,M))&&!(B&&(M=="length"||I&&(M=="offset"||M=="parent")||D&&(M=="buffer"||M=="byteLength"||M=="byteOffset")||zlL(M,E))))f.push(M);return f}var oq0,tq0,F0$;var WIA=K(()=>{xlL();ylL();H0$();KIA();NlL();llL();oq0=Object.prototype,tq0=oq0.hasOwnProperty;F0$=sq0});function eq0(H,$){return function(A){return H($(A))}}var K0$;var VIA=K(()=>{K0$=eq0});var HT0,ilL;var nlL=K(()=>{VIA();HT0=K0$(Object.keys,Object),ilL=HT0});function LT0(H){if(!V4H(H))return ilL(H);var $=[];for(var A in Object(H))if(AT0.call(H,A)&&A!="constructor")$.push(A);return $}var $T0,AT0,rlL;var alL=K(()=>{M0$();nlL();$T0=Object.prototype,AT0=$T0.hasOwnProperty;rlL=LT0});function IT0(H){return E0$(H)?F0$(H):rlL(H)}var _4H;var Q0$=K(()=>{WIA();alL();JIA();_4H=IT0});function DT0(H){var $=[];if(H!=null)for(var A in Object(H))$.push(A);return $}var olL;var tlL=K(()=>{olL=DT0});function ET0(H){if(!oR(H))return olL(H);var $=V4H(H),A=[];for(var L in H)if(!(L=="constructor"&&($||!fT0.call(H,L))))A.push(L);return A}var BT0,fT0,slL;var elL=K(()=>{W4H();M0$();tlL();BT0=Object.prototype,fT0=BT0.hasOwnProperty;slL=ET0});function MT0(H){return E0$(H)?F0$(H,!0):slL(H)}var C4H;var W0$=K(()=>{WIA();elL();JIA();C4H=MT0});var GT0,Cu;var RTH=K(()=>{gi();GT0=d_(Object,"create"),Cu=GT0});function UT0(){this.__data__=Cu?Cu(null):{},this.size=0}var HiL;var $iL=K(()=>{RTH();HiL=UT0});function XT0(H){var $=this.has(H)&&delete this.__data__[H];return this.size-=$?1:0,$}var AiL;var LiL=K(()=>{AiL=XT0});function QT0(H){var $=this.__data__;if(Cu){var A=$[H];return A===JT0?void 0:A}return KT0.call($,H)?$[H]:void 0}var JT0="__lodash_hash_undefined__",FT0,KT0,IiL;var DiL=K(()=>{RTH();FT0=Object.prototype,KT0=FT0.hasOwnProperty;IiL=QT0});function PT0(H){var $=this.__data__;return Cu?$[H]!==void 0:VT0.call($,H)}var WT0,VT0,BiL;var fiL=K(()=>{RTH();WT0=Object.prototype,VT0=WT0.hasOwnProperty;BiL=PT0});function CT0(H,$){var A=this.__data__;return this.size+=this.has(H)?0:1,A[H]=Cu&&$===void 0?_T0:$,this}var _T0="__lodash_hash_undefined__",EiL;var MiL=K(()=>{RTH();EiL=CT0});function Y4H(H){var $=-1,A=H==null?0:H.length;this.clear();while(++$<A){var L=H[$];this.set(L[0],L[1])}}var PIA;var GiL=K(()=>{$iL();LiL();DiL();fiL();MiL();Y4H.prototype.clear=HiL;Y4H.prototype.delete=AiL;Y4H.prototype.get=IiL;Y4H.prototype.has=BiL;Y4H.prototype.set=EiL;PIA=Y4H});function YT0(){this.__data__=[],this.size=0}var UiL;var XiL=K(()=>{UiL=YT0});function wT0(H,$){var A=H.length;while(A--)if(D0$(H[A][0],$))return A;return-1}var pi;var yTH=K(()=>{GIA();pi=wT0});function TT0(H){var $=this.__data__,A=pi($,H);if(A<0)return!1;var L=$.length-1;if(A==L)$.pop();else qT0.call($,A,1);return--this.size,!0}var ZT0,qT0,JiL;var FiL=K(()=>{yTH();ZT0=Array.prototype,qT0=ZT0.splice;JiL=TT0});function zT0(H){var $=this.__data__,A=pi($,H);return A<0?void 0:$[A][1]}var KiL;var QiL=K(()=>{yTH();KiL=zT0});function NT0(H){return pi(this.__data__,H)>-1}var WiL;var ViL=K(()=>{yTH();WiL=NT0});function OT0(H,$){var A=this.__data__,L=pi(A,H);if(L<0)++this.size,A.push([H,$]);else A[L][1]=$;return this}var PiL;var _iL=K(()=>{yTH();PiL=OT0});function w4H(H){var $=-1,A=H==null?0:H.length;this.clear();while(++$<A){var L=H[$];this.set(L[0],L[1])}}var di;var vTH=K(()=>{XiL();FiL();QiL();ViL();_iL();w4H.prototype.clear=UiL;w4H.prototype.delete=JiL;w4H.prototype.get=KiL;w4H.prototype.has=WiL;w4H.prototype.set=PiL;di=w4H});var xT0,ci;var V0$=K(()=>{gi();$O();xT0=d_(DF,"Map"),ci=xT0});function ST0(){this.size=0,this.__data__={hash:new PIA,map:new(ci||di),string:new PIA}}var CiL;var YiL=K(()=>{GiL();vTH();V0$();CiL=ST0});function jT0(H){var $=typeof H;return $=="string"||$=="number"||$=="symbol"||$=="boolean"?H!=="__proto__":H===null}var wiL;var ZiL=K(()=>{wiL=jT0});function RT0(H,$){var A=H.__data__;return wiL($)?A[typeof $=="string"?"string":"hash"]:A.map}var li;var hTH=K(()=>{ZiL();li=RT0});function yT0(H){var $=li(this,H).delete(H);return this.size-=$?1:0,$}var qiL;var TiL=K(()=>{hTH();qiL=yT0});function vT0(H){return li(this,H).get(H)}var ziL;var NiL=K(()=>{hTH();ziL=vT0});function hT0(H){return li(this,H).has(H)}var OiL;var xiL=K(()=>{hTH();OiL=hT0});function bT0(H,$){var A=li(this,H),L=A.size;return A.set(H,$),this.size+=A.size==L?0:1,this}var SiL;var jiL=K(()=>{hTH();SiL=bT0});function Z4H(H){var $=-1,A=H==null?0:H.length;this.clear();while(++$<A){var L=H[$];this.set(L[0],L[1])}}var RiL;var yiL=K(()=>{YiL();TiL();NiL();xiL();jiL();Z4H.prototype.clear=CiL;Z4H.prototype.delete=qiL;Z4H.prototype.get=ziL;Z4H.prototype.has=OiL;Z4H.prototype.set=SiL;RiL=Z4H});function kT0(H,$){var A=-1,L=$.length,I=H.length;while(++A<L)H[I+A]=$[A];return H}var P0$;var _IA=K(()=>{P0$=kT0});var uT0,_0$;var CIA=K(()=>{VIA();uT0=K0$(Object.getPrototypeOf,Object),_0$=uT0});function gT0(){this.__data__=new di,this.size=0}var viL;var hiL=K(()=>{vTH();viL=gT0});function mT0(H){var $=this.__data__,A=$.delete(H);return this.size=$.size,A}var biL;var kiL=K(()=>{biL=mT0});function pT0(H){return this.__data__.get(H)}var uiL;var giL=K(()=>{uiL=pT0});function dT0(H){return this.__data__.has(H)}var miL;var piL=K(()=>{miL=dT0});function lT0(H,$){var A=this.__data__;if(A instanceof di){var L=A.__data__;if(!ci||L.length<cT0-1)return L.push([H,$]),this.size=++A.size,this;A=this.__data__=new RiL(L)}return A.set(H,$),this.size=A.size,this}var cT0=200,diL;var ciL=K(()=>{vTH();V0$();yiL();diL=lT0});function q4H(H){var $=this.__data__=new di(H);this.size=$.size}var liL;var iiL=K(()=>{vTH();hiL();kiL();giL();piL();ciL();q4H.prototype.clear=viL;q4H.prototype.delete=biL;q4H.prototype.get=uiL;q4H.prototype.has=miL;q4H.prototype.set=diL;liL=q4H});function iT0(H,$){return H&&mi($,_4H($),H)}var niL;var riL=K(()=>{NTH();Q0$();niL=iT0});function nT0(H,$){return H&&mi($,C4H($),H)}var aiL;var oiL=K(()=>{NTH();W0$();aiL=nT0});var bTH={};JA(bTH,{default:()=>YIA});function aT0(H,$){if($)return H.slice();var A=H.length,L=eiL?eiL(A):new H.constructor(A);return H.copy(L),L}var HnL,tiL,rT0,siL,eiL,YIA;var $nL=K(()=>{$O();HnL=typeof bTH=="object"&&bTH&&!bTH.nodeType&&bTH,tiL=HnL&&typeof C0$=="object"&&C0$&&!C0$.nodeType&&C0$,rT0=tiL&&tiL.exports===HnL,siL=rT0?DF.Buffer:void 0,eiL=siL?siL.allocUnsafe:void 0;YIA=aT0});function oT0(H,$){var A=-1,L=H==null?0:H.length,I=0,D=[];while(++A<L){var B=H[A];if($(B,A,H))D[I++]=B}return D}var AnL;var LnL=K(()=>{AnL=oT0});function tT0(){return[]}var Y0$;var wIA=K(()=>{Y0$=tT0});var sT0,eT0,InL,Hz0,T4H;var w0$=K(()=>{LnL();wIA();sT0=Object.prototype,eT0=sT0.propertyIsEnumerable,InL=Object.getOwnPropertySymbols,Hz0=!InL?Y0$:function(H){if(H==null)return[];return H=Object(H),AnL(InL(H),function($){return eT0.call(H,$)})},T4H=Hz0});function $z0(H,$){return mi(H,T4H(H),$)}var DnL;var BnL=K(()=>{NTH();w0$();DnL=$z0});var Az0,Lz0,Z0$;var ZIA=K(()=>{_IA();CIA();w0$();wIA();Az0=Object.getOwnPropertySymbols,Lz0=!Az0?Y0$:function(H){var $=[];while(H)P0$($,T4H(H)),H=_0$(H);return $},Z0$=Lz0});function Iz0(H,$){return mi(H,Z0$(H),$)}var fnL;var EnL=K(()=>{NTH();ZIA();fnL=Iz0});function Dz0(H,$,A){var L=$(H);return Q4H(H)?L:P0$(L,A(H))}var q0$;var qIA=K(()=>{_IA();H0$();q0$=Dz0});function Bz0(H){return q0$(H,_4H,T4H)}var MnL;var GnL=K(()=>{qIA();w0$();Q0$();MnL=Bz0});function fz0(H){return q0$(H,C4H,Z0$)}var UnL;var XnL=K(()=>{qIA();ZIA();W0$();UnL=fz0});var Ez0,T0$;var JnL=K(()=>{gi();$O();Ez0=d_(DF,"DataView"),T0$=Ez0});var Mz0,z0$;var FnL=K(()=>{gi();$O();Mz0=d_(DF,"Promise"),z0$=Mz0});var Gz0,N0$;var KnL=K(()=>{gi();$O();Gz0=d_(DF,"Set"),N0$=Gz0});var QnL="[object Map]",Uz0="[object Object]",WnL="[object Promise]",VnL="[object Set]",PnL="[object WeakMap]",_nL="[object DataView]",Xz0,Jz0,Fz0,Kz0,Qz0,xAH,z4H;var O0$=K(()=>{JnL();V0$();FnL();KnL();VlL();zTH();fIA();Xz0=_u(T0$),Jz0=_u(ci),Fz0=_u(z0$),Kz0=_u(N0$),Qz0=_u(L0$),xAH=Pu;if(T0$&&xAH(new T0$(new ArrayBuffer(1)))!=_nL||ci&&xAH(new ci)!=QnL||z0$&&xAH(z0$.resolve())!=WnL||N0$&&xAH(new N0$)!=VnL||L0$&&xAH(new L0$)!=PnL)xAH=function(H){var $=Pu(H),A=$==Uz0?H.constructor:void 0,L=A?_u(A):"";if(L)switch(L){case Xz0:return _nL;case Jz0:return QnL;case Fz0:return WnL;case Kz0:return VnL;case Qz0:return PnL}return $};z4H=xAH});function Pz0(H){var $=H.length,A=new H.constructor($);if($&&typeof H[0]=="string"&&Vz0.call(H,"index"))A.index=H.index,A.input=H.input;return A}var Wz0,Vz0,CnL;var YnL=K(()=>{Wz0=Object.prototype,Vz0=Wz0.hasOwnProperty;CnL=Pz0});var _z0,TIA;var wnL=K(()=>{$O();_z0=DF.Uint8Array,TIA=_z0});function Cz0(H){var $=new H.constructor(H.byteLength);return new TIA($).set(new TIA(H)),$}var N4H;var x0$=K(()=>{wnL();N4H=Cz0});function Yz0(H,$){var A=$?N4H(H.buffer):H.buffer;return new H.constructor(A,H.byteOffset,H.byteLength)}var ZnL;var qnL=K(()=>{x0$();ZnL=Yz0});function Zz0(H){var $=new H.constructor(H.source,wz0.exec(H));return $.lastIndex=H.lastIndex,$}var wz0,TnL;var znL=K(()=>{wz0=/\w*$/;TnL=Zz0});function qz0(H){return OnL?Object(OnL.call(H)):{}}var NnL,OnL,xnL;var SnL=K(()=>{eB$();NnL=Vu?Vu.prototype:void 0,OnL=NnL?NnL.valueOf:void 0;xnL=qz0});function Tz0(H,$){var A=$?N4H(H.buffer):H.buffer;return new H.constructor(A,H.byteOffset,H.length)}var jnL;var RnL=K(()=>{x0$();jnL=Tz0});function iz0(H,$,A){var L=H.constructor;switch($){case vz0:return N4H(H);case zz0:case Nz0:return new L(+H);case hz0:return ZnL(H,A);case bz0:case kz0:case uz0:case gz0:case mz0:case pz0:case dz0:case cz0:case lz0:return jnL(H,A);case Oz0:return new L;case xz0:case Rz0:return new L(H);case Sz0:return TnL(H);case jz0:return new L;case yz0:return xnL(H)}}var zz0="[object Boolean]",Nz0="[object Date]",Oz0="[object Map]",xz0="[object Number]",Sz0="[object RegExp]",jz0="[object Set]",Rz0="[object String]",yz0="[object Symbol]",vz0="[object ArrayBuffer]",hz0="[object DataView]",bz0="[object Float32Array]",kz0="[object Float64Array]",uz0="[object Int8Array]",gz0="[object Int16Array]",mz0="[object Int32Array]",pz0="[object Uint8Array]",dz0="[object Uint8ClampedArray]",cz0="[object Uint16Array]",lz0="[object Uint32Array]",ynL;var vnL=K(()=>{x0$();qnL();znL();SnL();RnL();ynL=iz0});function nz0(H){return typeof H.constructor=="function"&&!V4H(H)?_lL(_0$(H)):{}}var hnL;var bnL=K(()=>{ClL();CIA();M0$();hnL=nz0});function az0(H){return aR(H)&&z4H(H)==rz0}var rz0="[object Map]",knL;var unL=K(()=>{O0$();K4H();knL=az0});var gnL,oz0,mnL;var pnL=K(()=>{unL();U0$();J0$();gnL=tR&&tR.isMap,oz0=gnL?P4H(gnL):knL,mnL=oz0});function sz0(H){return aR(H)&&z4H(H)==tz0}var tz0="[object Set]",dnL;var cnL=K(()=>{O0$();K4H();dnL=sz0});var lnL,ez0,inL;var nnL=K(()=>{cnL();U0$();J0$();lnL=tR&&tR.isSet,ez0=lnL?P4H(lnL):dnL,inL=ez0});function S0$(H,$,A,L,I,D){var B,f=$&HN0,E=$&$N0,M=$&AN0;if(A)B=I?A(H,L,I,D):A(H);if(B!==void 0)return B;if(!oR(H))return H;var G=Q4H(H);if(G){if(B=CnL(H),!f)return YlL(H,B)}else{var U=z4H(H),X=U==anL||U==fN0;if(xTH(H))return YIA(H,f);if(U==onL||U==rnL||X&&!I){if(B=E||X?{}:hnL(H),!f)return E?fnL(H,aiL(B,H)):DnL(H,niL(B,H))}else{if(!aG[U])return I?H:{};B=ynL(H,U,f)}}D||(D=new liL);var J=D.get(H);if(J)return J;if(D.set(H,B),inL(H))H.forEach(function(W){B.add(S0$(W,$,A,W,H,D))});else if(mnL(H))H.forEach(function(W,P){B.set(P,S0$(W,$,A,P,H,D))});var F=M?E?UnL:MnL:E?C4H:_4H,Q=G?void 0:F(H);return qlL(Q||H,function(W,P){if(Q)P=W,W=H[P];B0$(B,P,S0$(W,$,A,P,H,D))}),B}var HN0=1,$N0=2,AN0=4,rnL="[object Arguments]",LN0="[object Array]",IN0="[object Boolean]",DN0="[object Date]",BN0="[object Error]",anL="[object Function]",fN0="[object GeneratorFunction]",EN0="[object Map]",MN0="[object Number]",onL="[object Object]",GN0="[object RegExp]",UN0="[object Set]",XN0="[object String]",JN0="[object Symbol]",FN0="[object WeakMap]",KN0="[object ArrayBuffer]",QN0="[object DataView]",WN0="[object Float32Array]",VN0="[object Float64Array]",PN0="[object Int8Array]",_N0="[object Int16Array]",CN0="[object Int32Array]",YN0="[object Uint8Array]",wN0="[object Uint8ClampedArray]",ZN0="[object Uint16Array]",qN0="[object Uint32Array]",aG,tnL;var snL=K(()=>{iiL();TlL();UIA();riL();oiL();$nL();wlL();BnL();EnL();GnL();XnL();O0$();YnL();vnL();bnL();H0$();KIA();pnL();W4H();nnL();Q0$();W0$();aG={};aG[rnL]=aG[LN0]=aG[KN0]=aG[QN0]=aG[IN0]=aG[DN0]=aG[WN0]=aG[VN0]=aG[PN0]=aG[_N0]=aG[CN0]=aG[EN0]=aG[MN0]=aG[onL]=aG[GN0]=aG[UN0]=aG[XN0]=aG[JN0]=aG[YN0]=aG[wN0]=aG[ZN0]=aG[qN0]=!0;aG[BN0]=aG[anL]=aG[FN0]=!1;tnL=S0$});function NN0(H){return tnL(H,TN0|zN0)}var TN0=1,zN0=4,zIA;var enL=K(()=>{snL();zIA=NN0});var HrL=K(()=>{enL()});function NIA(){try{let H=$rL.readFileSync("/proc/version",{encoding:"utf8"}),$=H.match(/WSL(\d+)/i);if($&&$[1])return $[1];if(H.toLowerCase().includes("microsoft"))return"1";return}catch{return}}function Pq(){switch("linux"){case"darwin":return"macos";case"linux":return"linux";case"win32":return"windows";default:return"unknown"}}var $rL;var j0$=K(()=>{$rL=h(require("fs"))});async function LrL(H,$,A,L={command:"rg"}){let{command:I,args:D=[]}=L;return new Promise((B,f)=>{ArL.execFile(I,[...D,...H,$],{maxBuffer:20000000,signal:A,timeout:1e4},(E,M,G)=>{if(!E){B(M.trim().split(`
${pA}`:pA}let KH=void 0,{mode:CH,notification:TH}=XaD({permissionModeCli:Q,dangerouslySkipPermissions:M,...{}});rS$(CH==="bypassPermissions");let yH={};if(F&&F.length>0){let pA=F.map((oB)=>oB.trim()).filter((oB)=>oB.length>0),qL={},mB=[];for(let oB of pA){let uD=null,p9=[],v0=w1(oB);if(v0){let M9=DgH({configObject:v0,filePath:"command line",expandVars:!0,scope:"dynamic"});if(M9.config)uD=M9.config.mcpServers;else p9=M9.errors}else{let M9=CdH.resolve(oB),bf=N3H({filePath:M9,expandVars:!0,scope:"dynamic"});if(bf.config)uD=bf.config.mcpServers;else p9=bf.errors}if(p9.length>0)mB.push(...p9);else if(uD)qL={...qL,...uD}}if(mB.length>0){let oB=mB.map((uD)=>`${uD.path?uD.path+": ":""}${uD.message}`).join(`
${UhA}`:UhA}catch(pA){N(`[Claude in Chrome] Error (auto-enable): ${pA}`)}let hH=B.strictMcpConfig||!1;if(BgH()){if(hH)process.stderr.write(oH.red("You cannot use --strict-mcp-config when an enterprise MCP config is present")),process.exit(1);if(yH&&!qOD(yH))process.stderr.write(oH.red("You cannot dynamically configure MCP servers when an enterprise MCP config is present")),process.exit(1)}NCH(W);let sH=JaD({allowedToolsCli:X,disallowedToolsCli:J,baseToolsCli:U,permissionMode:CH,allowDangerouslySkipPermissions:G,addDirs:W}),F$=sH.toolPermissionContext,{warnings:KA,dangerousPermissions:UA}=sH;KA.forEach((pA)=>{console.error(pA)}),QQD(),N("[STARTUP] Loading MCP configs...");let U$=Date.now(),hA=hH?Promise.resolve({servers:{}}):DH?dh():O3H();if(v&&v!=="text"&&v!=="stream-json")console.error(`Error: Invalid input format "${v}".`),process.exit(1);if(v==="stream-json"&&g!=="stream-json")console.error("Error: --input-format=stream-json requires output-format=stream-json."),process.exit(1);if(FH){if(v!=="stream-json"||g!=="stream-json")console.error("Error: --sdk-url requires both --input-format=stream-json and --output-format=stream-json."),process.exit(1)}if(B.replayUserMessages){if(v!=="stream-json"||g!=="stream-json")console.error("Error: --replay-user-messages requires both --input-format=stream-json and --output-format=stream-json."),process.exit(1)}if(EH){if(!DH||g!=="stream-json")Wc("Error: --include-partial-messages requires --print and --output-format=stream-json."),process.exit(1)}if(B.sessionPersistence===!1&&!DH)Wc("Error: --no-session-persistence can only be used with --print mode."),process.exit(1);let rH=await Pj1(D||"",v??"text");P0("action_after_input_prompt");let G$=NK(F$);P0("action_tools_loaded");let b$;if(sjI({isNonInteractiveSession:DH})&&B.jsonSchema)b$=DA(B.jsonSchema);if(b$){let pA=sJ$(b$);if(pA)G$=[...G$,pA],c("tengu_structured_output_enabled",{schema_property_count:Object.keys(b$.properties||{}).length,has_required_fields:Boolean(b$.required)});else c("tengu_structured_output_failure",{error:"Invalid JSON schema"})}P0("action_before_setup"),N("[STARTUP] Running setup()...");let qA=Date.now(),{setup:n$}=await Promise.resolve().then(() => (bO$(),hO$));await n$(ZGB.cwd(),CH,G,qH,WH,s,Z?Iw(Z):void 0),N(`[STARTUP] setup() completed in ${Date.now()-qA}ms`),P0("action_after_setup");let fA=B.model==="default"?Zq():B.model,UH=P==="default"?Zq():P,_H=Y$();N("[STARTUP] Loading commands and agents...");let aH=Date.now(),[f$,I$]=await Promise.all([zP(_H),khI(_H)]);N(`[STARTUP] Commands and agents loaded in ${Date.now()-aH}ms`),P0("action_commands_loaded");let $$=[];if(u)try{let pA=w1(u);if(pA)$$=NK$(pA,"flagSettings")}catch(pA){r(pA instanceof Error?pA:Error(String(pA)))}let e$=[...I$.allAgents,...$$],x$={...I$,allAgents:e$,activeAgents:Ym(e$)},zA=y??XB().agent,gA;if(zA){if(gA=x$.activeAgents.find((pA)=>pA.agentType===zA),!gA)N(`Warning: agent "${zA}" not found. Available agents: ${x$.activeAgents.map((pA)=>pA.agentType).join(", ")}. Using default behavior.`)}if(KN(gA?.agentType),gA)c("tengu_agent_flag",{agentType:_K(gA)?gA.agentType:"custom",...y&&{source:"cli"}});if(gA?.agentType)WbA(j$(),gA.agentType);if(DH&&gA&&!MH&&!_K(gA)){let pA=gA.getSystemPrompt();if(pA)MH=pA}let HI=fA;if(!HI&&gA?.model&&gA.model!=="inherit")HI=t8(gA.model);MV(HI),zS$(G9$()||null);let $I=QCH(),wB=t8($I??Zq());if(dL()&&IH?.agentId&&IH?.agentName&&IH?.teamName&&IH?.agentType){let pA=x$.activeAgents.find((qL)=>qL.agentType===IH.agentType);if(pA){let qL;if(pA.source==="built-in")N(`[teammate] Built-in agent ${IH.agentType} - skipping custom prompt (not supported)`);else qL=pA.getSystemPrompt();if(qL){let mB=`